<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Group 1 - Alkali Metals | Chemistry Mastery</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-storage-compat.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        .typing-text {
            overflow: hidden;
            border-right: 2px solid #fff;
            white-space: nowrap;
            animation: typing 3s steps(40, end), blink-caret 0.75s step-end infinite;
        }
        
        @keyframes typing {
            from { width: 0 }
            to { width: 100% }
        }
        
        @keyframes blink-caret {
            from, to { border-color: transparent }
            50% { border-color: #fff }
        }
        
        .element-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 0.75rem;
            padding: 1rem;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.2);
            height: 100%;
        }
        
        .element-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
        }
        
        .property-card {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 0.75rem;
            padding: 1rem;
            margin: 0.5rem 0;
            border-left: 4px solid #ff6b6b;
        }
        
        .equation-box {
            background: rgba(0, 0, 0, 0.1);
            border-radius: 0.5rem;
            padding: 0.75rem;
            margin: 0.5rem 0;
            font-family: 'Courier New', monospace;
            font-weight: 600;
            font-size: 0.9rem;
        }
        
        .fun-fact-banner {
            background: linear-gradient(90deg, #fbbf24, #f59e0b);
            border-radius: 0.75rem;
            padding: 0.75rem;
            margin: 1rem 0;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.02); }
            100% { transform: scale(1); }
        }
        
        .quiz-button {
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
            transition: all 0.3s ease;
        }
        
        .quiz-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(251, 191, 36, 0.4);
        }
        
        .element-image {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid white;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
        }
        
        .element-image:hover {
            transform: scale(1.1) rotate(5deg);
        }
        
        .leaderboard-item {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 0.5rem;
            padding: 0.5rem;
            margin: 0.25rem 0;
            transition: all 0.3s ease;
        }
        
        .leaderboard-item:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateX(3px);
        }
        
        .nav-button {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }
        
        .nav-button:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }
        
        .quiz-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }
        
        .quiz-modal.active {
            display: flex;
        }
        
        .quiz-content {
            background: white;
            border-radius: 1rem;
            padding: 1.5rem;
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        @media (max-width: 640px) {
            .quiz-content {
                padding: 1rem;
                margin: 0.5rem;
            }
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e5e7eb;
            border-radius: 4px;
            overflow: hidden;
            margin: 1rem 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff6b6b, #ee5a24);
            transition: width 0.3s ease;
        }
        
        .quiz-option {
            padding: 0.75rem;
            border: 2px solid #e5e7eb;
            border-radius: 0.5rem;
            margin: 0.5rem 0;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .quiz-option:hover {
            border-color: #ff6b6b;
            background: #fef2f2;
        }
        
        .quiz-option.selected {
            border-color: #ff6b6b;
            background: #fee2e2;
        }
        
        .quiz-option.correct {
            border-color: #10b981;
            background: #d1fae5;
        }
        
        .quiz-option.incorrect {
            border-color: #ef4444;
            background: #fee2e2;
        }
        
        .property-table {
            width: 100%;
            border-collapse: collapse;
            margin: 0.5rem 0;
            font-size: 0.9rem;
        }
        
        .property-table th, .property-table td {
            padding: 0.5rem;
            text-align: left;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .property-table th {
            background-color: #ff6b6b;
            color: white;
            font-weight: 600;
            font-size: 0.85rem;
        }
        
        .property-table tr:nth-child(even) {
            background-color: rgba(255, 255, 255, 0.5);
        }
        
        .reaction-card {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 0.75rem;
            padding: 1rem;
            margin: 0.5rem 0;
            border-left: 4px solid #3b82f6;
        }
        
        .trend-card {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 0.75rem;
            padding: 1rem;
            margin: 0.5rem 0;
            border-left: 4px solid #10b981;
        }
        
        .tip-box {
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
            border-radius: 0.75rem;
            padding: 1rem;
            margin: 0.5rem 0;
            color: white;
        }
        
        /* Tab styles */
        .tabs {
            display: flex;
            border-bottom: 2px solid rgba(255, 255, 255, 0.3);
            margin-bottom: 1rem;
            overflow-x: auto;
        }
        
        .tab {
            padding: 0.75rem 1rem;
            cursor: pointer;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: white;
            font-weight: 500;
            transition: all 0.3s ease;
            border-radius: 0.5rem 0.5rem 0 0;
            margin-right: 0.25rem;
            white-space: nowrap;
        }
        
        .tab.active {
            background: rgba(255, 255, 255, 0.9);
            color: #1f2937;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .compact-section {
            margin-bottom: 1.5rem;
        }
        
        .section-title {
            font-size: 1.5rem;
            margin-bottom: 0.75rem;
        }
        
        /* New styles for different question types */
        .matching-table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
        }
        
        .matching-table th, .matching-table td {
            padding: 0.75rem;
            border: 1px solid #e5e7eb;
            text-align: left;
        }
        
        .matching-table th {
            background-color: #f3f4f6;
        }
        
        .matching-select {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
        }
        
        .multi-select {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            margin: 1rem 0;
        }
        
        .multi-select-option {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            cursor: pointer;
        }
        
        .multi-select-option:hover {
            background-color: #f3f4f6;
        }
        
        .multi-select-option.selected {
            background-color: #fee2e2;
            border-color: #f87171;
        }
        
        .ordering-container {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            margin: 1rem 0;
        }
        
        .ordering-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
        }
        
        .order-select {
            width: 100px;
            padding: 0.5rem;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
        }
        
        .submit-btn {
            background: #10b981;
            color: white;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 1rem;
            font-weight: 600;
        }
        
        .submit-btn:hover {
            background: #059669;
        }
        
        .submit-btn:disabled {
            background: #9ca3af;
            cursor: not-allowed;
        }
        
        /* Social Learning & Gamification Styles */
        .social-panel {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 0.75rem;
            padding: 1rem;
            margin-bottom: 1.5rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .achievement-badge {
            display: inline-flex;
            align-items: center;
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
            color: #1f2937;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-right: 0.5rem;
            margin-bottom: 0.5rem;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        
        .achievement-badge i {
            margin-right: 0.25rem;
        }
        
        .challenge-button {
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            margin-right: 0.5rem;
            margin-bottom: 0.5rem;
        }
        
        .challenge-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 10px rgba(139, 92, 246, 0.4);
        }
        
        .share-button {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            margin-right: 0.5rem;
            margin-bottom: 0.5rem;
        }
        
        .share-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 10px rgba(59, 130, 246, 0.4);
        }
        
        .comment-section {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 0.75rem;
            padding: 1rem;
            margin-top: 1.5rem;
        }
        
        .comment {
            background: #f3f4f6;
            border-radius: 0.5rem;
            padding: 0.75rem;
            margin-bottom: 0.75rem;
            border-left: 3px solid #3b82f6;
        }
        
        .comment-author {
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 0.25rem;
        }
        
        .comment-text {
            color: #4b5563;
            font-size: 0.875rem;
        }
        
        .comment-form {
            display: flex;
            margin-top: 1rem;
        }
        
        .comment-input {
            flex: 1;
            padding: 0.5rem;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem 0 0 0.375rem;
            font-size: 0.875rem;
        }
        
        .comment-submit {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 0 0.375rem 0.375rem 0;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .comment-submit:hover {
            background: #2563eb;
        }
        
        .points-display {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            margin-right: 0.5rem;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        
        .points-display i {
            margin-right: 0.25rem;
        }
        
        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            margin-right: 0.75rem;
        }
        
        .notification-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            background: #ef4444;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: 600;
        }
        
        .notification-icon {
            position: relative;
            margin-right: 0.5rem;
        }
        
        .study-group-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 0.75rem;
            padding: 1rem;
            margin-bottom: 1rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }
        
        .study-group-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
        }
        
        .study-group-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }
        
        .study-group-title {
            color: white;
            font-weight: 600;
        }
        
        .study-group-members {
            display: flex;
            margin-top: 0.5rem;
        }
        
        .member-avatar {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 0.75rem;
            margin-right: -10px;
            border: 2px solid rgba(255, 255, 255, 0.8);
        }
        
        .join-button {
            background: #10b981;
            color: white;
            border: none;
            padding: 0.25rem 0.75rem;
            border-radius: 0.375rem;
            font-size: 0.75rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .join-button:hover {
            background: #059669;
        }
        
        /* Login Modal Styles */
        .login-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }
        
        .login-modal.active {
            display: flex;
        }
        
        .login-content {
            background: white;
            border-radius: 1rem;
            padding: 2rem;
            max-width: 400px;
            width: 100%;
        }
        
        .login-header {
            text-align: center;
            margin-bottom: 1.5rem;
        }
        
        .login-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 0.5rem;
        }
        
        .login-subtitle {
            color: #6b7280;
            font-size: 0.875rem;
        }
        
        .form-group {
            margin-bottom: 1rem;
        }
        
        .form-label {
            display: block;
            font-weight: 500;
            color: #374151;
            margin-bottom: 0.25rem;
        }
        
        .form-input {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            font-size: 0.875rem;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        .login-button {
            width: 100%;
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            color: white;
            padding: 0.75rem;
            border: none;
            border-radius: 0.375rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 0.5rem;
        }
        
        .login-button:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(238, 90, 36, 0.3);
        }
        
        .google-login {
            width: 100%;
            background: white;
            color: #374151;
            padding: 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-top: 0.5rem;
        }
        
        .google-login:hover {
            background: #f9fafb;
        }
        
        .google-login i {
            margin-right: 0.5rem;
            color: #ea4335;
        }
        
        .login-divider {
            text-align: center;
            margin: 1rem 0;
            position: relative;
        }
        
        .login-divider::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 1px;
            background: #e5e7eb;
        }
        
        .login-divider span {
            background: white;
            padding: 0 1rem;
            position: relative;
            color: #6b7280;
            font-size: 0.875rem;
        }
        
        .login-link {
            text-align: center;
            margin-top: 1rem;
            color: #6b7280;
            font-size: 0.875rem;
        }
        
        .login-link a {
            color: #3b82f6;
            font-weight: 600;
        }
        
        /* Loading Spinner */
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #ff6b6b;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Toast Notification */
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: white;
            padding: 1rem;
            border-radius: 0.5rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            z-index: 1000;
            display: flex;
            align-items: center;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }
        
        .toast.show {
            transform: translateX(0);
        }
        
        .toast-icon {
            margin-right: 0.75rem;
            font-size: 1.25rem;
        }
        
        .toast.success .toast-icon {
            color: #10b981;
        }
        
        .toast.error .toast-icon {
            color: #ef4444;
        }
        
        .toast.info .toast-icon {
            color: #3b82f6;
        }
        
        .toast-message {
            flex: 1;
        }
        
        .toast-title {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }
        
        .toast-description {
            font-size: 0.875rem;
            color: #6b7280;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="bg-white/10 backdrop-blur-md shadow-lg">
        <div class="container mx-auto px-4 py-3">
            <div class="flex justify-between items-center">
                <div class="flex items-center">
                    <a href="index.html" class="text-white hover:text-yellow-300 transition mr-4">
                        <i class="fas fa-arrow-left mr-2"></i>Back
                    </a>
                    <i class="fas fa-fire text-white text-2xl mr-2"></i>
                    <h1 class="text-xl font-bold text-white">Group 1 - Alkali Metals</h1>
                </div>
                <div class="flex items-center space-x-2">
                    <div class="notification-icon">
                        <i class="fas fa-bell text-white"></i>
                        <span class="notification-badge" id="notificationCount">0</span>
                    </div>
                    <div id="userProfile" class="flex items-center">
                        <div class="user-avatar" id="userAvatar">G</div>
                        <span class="text-white text-sm font-medium mr-2" id="userName">Guest</span>
                        <button onclick="showLoginModal()" class="nav-button text-white px-3 py-1 rounded-lg text-sm">
                            <i class="fas fa-sign-in-alt mr-1"></i>Login
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </nav>
    
    <!-- Main Content -->
    <section class="container mx-auto px-4 py-6">
        <!-- Hero Section -->
        <div class="text-center mb-6">
            <h1 class="text-3xl font-bold text-white mb-3 typing-text">
                Group 1: The Alkali Metals
            </h1>
            <p class="text-lg text-white/90 max-w-2xl mx-auto">
                The most reactive metals in the periodic table
            </p>
        </div>
        
        <!-- Social Learning & Gamification Panel -->
        <div class="social-panel">
            <div class="flex flex-wrap items-center justify-between">
                <div class="flex flex-wrap items-center">
                    <div class="points-display">
                        <i class="fas fa-coins"></i>
                        <span id="userPoints">0</span> pts
                    </div>
                    <div id="achievementsContainer" class="flex flex-wrap">
                        <!-- Achievements will be loaded here -->
                    </div>
                </div>
                <div class="flex flex-wrap mt-2 sm:mt-0">
                    <button class="challenge-button" onclick="showChallengeModal()">
                        <i class="fas fa-users mr-1"></i> Challenge Friends
                    </button>
                    <button class="share-button" onclick="shareProgress()">
                        <i class="fas fa-share-alt mr-1"></i> Share Progress
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Study Groups Section -->
        <div class="mb-6">
            <h2 class="text-xl font-bold text-white mb-3">
                <i class="fas fa-users mr-2"></i>Study Groups
            </h2>
            <div id="studyGroupsContainer" class="grid grid-cols-1 md:grid-cols-2 gap-3">
                <!-- Study groups will be loaded here -->
            </div>
        </div>
        
        <!-- Fun Facts Banner -->
        <div class="fun-fact-banner mb-6">
            <div class="flex items-center">
                <i class="fas fa-lightbulb text-3xl text-white mr-3"></i>
                <div>
                    <h3 class="text-lg font-bold text-white mb-1">Amazing Fact!</h3>
                    <p class="text-white/90 text-sm">
                        Alkali metals are so reactive they can explode when dropped in water!
                    </p>
                </div>
            </div>
        </div>
        
        <!-- Elements Grid -->
        <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-3 mb-6 element-grid">
            <div class="element-card text-center">
                <img src="https://upload.wikimedia.org/wikipedia/commons/e/ed/Lithiumcut_cropped.jpg" alt="Lithium" class="element-image mx-auto mb-2">
                <h3 class="text-lg font-bold text-white mb-1">Lithium (Li)</h3>
                <p class="text-white/80 text-xs mb-2">Atomic: 3</p>
                <div class="text-left text-white/90 text-xs">
                    <p><strong>Uses:</strong> Batteries</p>
                    <p><strong>Reacts:</strong> Fizzes</p>
                </div>
            </div>
            
            <div class="element-card text-center">
                <img src="https://upload.wikimedia.org/wikipedia/commons/2/27/Na_%28Sodium%29.jpg" alt="Sodium" class="element-image mx-auto mb-2">
                <h3 class="text-lg font-bold text-white mb-1">Sodium (Na)</h3>
                <p class="text-white/80 text-xs mb-2">Atomic: 11</p>
                <div class="text-left text-white/90 text-xs">
                    <p><strong>Uses:</strong> Salt</p>
                    <p><strong>Reacts:</strong> Melts</p>
                </div>
            </div>
            
            <div class="element-card text-center">
                <img src="https://cdn.britannica.com/77/131177-050-79292189/fragments-Potassium-metal.jpg" alt="Potassium" class="element-image mx-auto mb-2">
                <h3 class="text-lg font-bold text-white mb-1">Potassium (K)</h3>
                <p class="text-white/80 text-xs mb-2">Atomic: 19</p>
                <div class="text-left text-white/90 text-xs">
                    <p><strong>Uses:</strong> Fertilizers</p>
                    <p><strong>Reacts:</strong> Ignites</p>
                </div>
            </div>
            
            <div class="element-card text-center">
                <img src="https://upload.wikimedia.org/wikipedia/commons/c/c9/Rb5.JPG" alt="Rubidium" class="element-image mx-auto mb-2">
                <h3 class="text-lg font-bold text-white mb-1">Rubidium (Rb)</h3>
                <p class="text-white/80 text-xs mb-2">Atomic: 37</p>
                <div class="text-left text-white/90 text-xs">
                    <p><strong>Uses:</strong> Glasses</p>
                    <p><strong>Reacts:</strong> Violent</p>
                </div>
            </div>
            
            <div class="element-card text-center">
                <img src="https://upload.wikimedia.org/wikipedia/commons/3/3d/Cesium.jpg" alt="Cesium" class="element-image mx-auto mb-2">
                <h3 class="text-lg font-bold text-white mb-1">Cesium (Cs)</h3>
                <p class="text-white/80 text-xs mb-2">Atomic: 55</p>
                <div class="text-left text-white/90 text-xs">
                    <p><strong>Uses:</strong> Clocks</p>
                    <p><strong>Reacts:</strong> Explosive</p>
                </div>
            </div>
            
            <div class="element-card text-center">
                <img src="https://i0.wp.com/periodic-table.com/wp-content/uploads/2018/11/Francium.jpg?fit=238%2C212&ssl=1" alt="Francium" class="element-image mx-auto mb-2">
                <h3 class="text-lg font-bold text-white mb-1">Francium (Fr)</h3>
                <p class="text-white/80 text-xs mb-2">Atomic: 87</p>
                <div class="text-left text-white/90 text-xs">
                    <p><strong>Uses:</strong> Research</p>
                    <p><strong>Reacts:</strong> Ultra</p>
                </div>
            </div>
        </div>
        
        <!-- Properties Section with Tabs -->
        <div class="compact-section">
            <h2 class="text-2xl font-bold text-white mb-4 text-center">
                <i class="fas fa-atom mr-2"></i>Properties
            </h2>
            
            <div class="tabs">
                <button class="tab active" onclick="showTab('appearance')">Appearance</button>
                <button class="tab" onclick="showTab('physical')">Physical</button>
                <button class="tab" onclick="showTab('chemical')">Chemical</button>
                <button class="tab" onclick="showTab('reactions')">Reactions</button>
                <button class="tab" onclick="showTab('trends')">Trends</button>
            </div>
            
            <!-- Appearance Tab -->
            <div id="appearance" class="tab-content active">
                <div class="property-card">
                    <h3 class="text-lg font-semibold text-gray-800 mb-2">Appearance and State</h3>
                    <ul class="space-y-1 text-gray-700 text-sm">
                        <li><strong>State:</strong> All solid metals at room temperature</li>
                        <li><strong>Colors:</strong> Li (silvery-white), Na (shiny silvery), K (silvery with lilac tint)</li>
                        <li><strong>Texture:</strong> Soft; can be cut with a knife</li>
                        <li><strong>Shininess:</strong> Freshly cut surfaces shiny but tarnish quickly in air</li>
                    </ul>
                </div>
            </div>
            
            <!-- Physical Tab -->
            <div id="physical" class="tab-content">
                <div class="property-card">
                    <h3 class="text-lg font-semibold text-gray-800 mb-2">Physical Properties</h3>
                    <table class="property-table">
                        <tr>
                            <th>Property</th>
                            <th>Description</th>
                        </tr>
                        <tr>
                            <td>Density</td>
                            <td>Low; increases down group (Li floats on water)</td>
                        </tr>
                        <tr>
                            <td>Melting/Boiling Points</td>
                            <td>Low; decrease down group</td>
                        </tr>
                        <tr>
                            <td>Hardness</td>
                            <td>Very soft; Li hardest, Cs extremely soft</td>
                        </tr>
                        <tr>
                            <td>Conductivity</td>
                            <td>Good conductors of heat and electricity</td>
                        </tr>
                    </table>
                    
                    <div class="trend-card mt-2">
                        <h4 class="font-semibold text-gray-800 mb-1">Trend:</h4>
                        <p class="text-gray-700 text-sm">Softer, more reactive, lower melting points down the group</p>
                    </div>
                </div>
            </div>
            
            <!-- Chemical Tab -->
            <div id="chemical" class="tab-content">
                <div class="property-card">
                    <h3 class="text-lg font-semibold text-gray-800 mb-2">Chemical Properties</h3>
                    <ul class="space-y-1 text-gray-700 text-sm">
                        <li>• Highly reactive; never found free in nature</li>
                        <li>• Reactivity increases down group (outer electron more easily lost)</li>
                        <li>• React vigorously with: Water (H₂ + hydroxides), Oxygen (oxides/peroxides), Halogens (ionic salts)</li>
                    </ul>
                    
                    <div class="equation-box mt-2">
                        2M(s) + 2H₂O(l) → 2MOH(aq) + H₂(g)
                    </div>
                </div>
            </div>
            
            <!-- Reactions Tab -->
            <div id="reactions" class="tab-content">
                <div class="reaction-card">
                    <h3 class="text-lg font-semibold text-gray-800 mb-2">Key Reactions</h3>
                    
                    <h4 class="font-semibold text-gray-800 mb-1">With Water:</h4>
                    <ul class="list-disc pl-5 text-gray-700 text-sm mb-2">
                        <li>Li: fizzes slowly</li>
                        <li>Na: fizzes rapidly, moves on surface</li>
                        <li>K: bursts into flame (lilac)</li>
                    </ul>
                    
                    <div class="equation-box">
                        2Na(s) + 2H₂O(l) → 2NaOH(aq) + H₂(g)
                    </div>
                    
                    <h4 class="font-semibold text-gray-800 mb-1 mt-3">With Oxygen:</h4>
                    <ul class="list-disc pl-5 text-gray-700 text-sm mb-2">
                        <li>Li → Li₂O (oxide)</li>
                        <li>Na → Na₂O₂ (peroxide)</li>
                        <li>K → KO₂ (superoxide)</li>
                    </ul>
                    
                    <div class="equation-box">
                        4Li(s) + O₂(g) → 2Li₂O(s)
                    </div>
                </div>
            </div>
            
            <!-- Trends Tab -->
            <div id="trends" class="tab-content">
                <div class="trend-card">
                    <h3 class="text-lg font-semibold text-gray-800 mb-2">Summary of Trends</h3>
                    <table class="property-table">
                        <tr>
                            <th>Property</th>
                            <th>Trend Down Group</th>
                        </tr>
                        <tr>
                            <td>Reactivity</td>
                            <td>Increases</td>
                        </tr>
                        <tr>
                            <td>Melting/Boiling Points</td>
                            <td>Decrease</td>
                        </tr>
                        <tr>
                            <td>Density</td>
                            <td>Increases (K lighter than Na)</td>
                        </tr>
                        <tr>
                            <td>Hardness</td>
                            <td>Decreases</td>
                        </tr>
                    </table>
                </div>
                
                <div class="tip-box mt-2">
                    <h3 class="font-semibold mb-1">
                        <i class="fas fa-lightbulb mr-1"></i>Year 10 Tip
                    </h3>
                    <p class="text-sm">
                        Group 1 = "Soft, shiny, highly reactive metals that explode with water"
                    </p>
                </div>
            </div>
        </div>
        
        <!-- Quiz Section -->
        <div class="bg-white/10 backdrop-blur-md rounded-xl p-4 mb-6">
            <h2 class="text-xl font-bold text-white mb-3 text-center">
                <i class="fas fa-clipboard-check mr-2"></i>Test Your Knowledge
            </h2>
            <div class="text-center">
                <div class="flex justify-center space-x-2 mb-3">
                    <button onclick="startPreQuiz()" class="quiz-button text-gray-900 px-4 py-2 rounded-lg font-semibold text-sm">
                        <i class="fas fa-clipboard-list mr-1"></i>Pre-Quiz
                    </button>
                    <button onclick="startPostQuiz()" class="quiz-button text-gray-900 px-4 py-2 rounded-lg font-semibold text-sm">
                        <i class="fas fa-graduation-cap mr-1"></i>Post-Quiz
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Leaderboard Section -->
        <div class="bg-white/10 backdrop-blur-md rounded-xl p-4 mb-6">
            <h2 class="text-xl font-bold text-white text-center mb-3">
                <i class="fas fa-trophy text-yellow-400 mr-2"></i>Top Scores
            </h2>
            <div id="leaderboardContainer" class="grid md:grid-cols-3 gap-2">
                <!-- Leaderboard items will be loaded here -->
            </div>
        </div>
        
        <!-- Discussion Section -->
        <div class="comment-section">
            <h2 class="text-xl font-bold text-gray-800 mb-3">
                <i class="fas fa-comments mr-2"></i>Discussion
            </h2>
            
            <div id="commentsContainer">
                <!-- Comments will be loaded here -->
            </div>
            
            <div class="comment-form">
                <input type="text" id="commentInput" class="comment-input" placeholder="Add your comment...">
                <button onclick="addComment()" class="comment-submit">Post</button>
            </div>
        </div>
    </section>
    
    <!-- Login Modal -->
    <div id="loginModal" class="login-modal">
        <div class="login-content">
            <div class="login-header">
                <h2 class="login-title">Welcome to Chemistry Mastery</h2>
                <p class="login-subtitle">Sign in to track your progress and compete with friends</p>
            </div>
            
            <form id="loginForm">
                <div class="form-group">
                    <label class="form-label" for="email">Email</label>
                    <input type="email" id="email" class="form-input" placeholder="your@email.com" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="password">Password</label>
                    <input type="password" id="password" class="form-input" placeholder="••••••••" required>
                </div>
                
                <button type="submit" class="login-button">Sign In</button>
            </form>
            
            <div class="login-divider">
                <span>or</span>
            </div>
            
            <button onclick="signInWithGoogle()" class="google-login">
                <i class="fab fa-google"></i> Continue with Google
            </button>
            
            <div class="login-link">
                Don't have an account? <a href="#" onclick="showSignupForm()">Sign up</a>
            </div>
        </div>
    </div>
    
    <!-- Quiz Modal -->
    <div id="quizModal" class="quiz-modal">
        <div class="quiz-content">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold text-gray-800" id="quizTitle">Group 1 Quiz</h2>
                <button onclick="closeQuiz()" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            
            <div id="quizProgress" class="hidden">
                <div class="flex justify-between items-center mb-2">
                    <span class="text-sm text-gray-600">Question <span id="currentQuestion">1</span> of <span id="totalQuestions">7</span></span>
                    <span class="text-sm text-gray-600">Score: <span id="currentScore">0</span></span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill" style="width: 14.3%"></div>
                </div>
            </div>
            
            <div id="quizContent">
                <div class="mb-4">
                    <h3 class="text-lg font-semibold mb-3" id="questionText">What happens when sodium reacts with water?</h3>
                    <div id="optionsContainer"></div>
                </div>
                
                <div id="feedback" class="hidden mb-3 p-2 rounded-lg text-sm"></div>
                
                <div class="flex justify-between items-center">
                    <button id="prevButton" class="bg-gray-300 text-gray-700 px-4 py-2 rounded-lg hidden" onclick="previousQuestion()">Previous</button>
                    <div class="flex gap-2">
                        <button id="submitButton" class="submit-btn" onclick="submitAnswer()">Submit Answer</button>
                        <button id="nextButton" class="bg-red-600 text-white px-4 py-2 rounded-lg hidden" onclick="nextQuestion()">Next</button>
                    </div>
                </div>
            </div>
            
            <div id="quizResults" class="hidden text-center">
                <h3 class="text-xl font-bold mb-3">Quiz Complete!</h3>
                <div class="text-3xl font-bold text-red-600 mb-3" id="finalScore">0/7</div>
                <p class="text-gray-600 mb-4" id="scoreMessage">Great job!</p>
                
                <div class="flex justify-center space-x-3 mb-4">
                    <button class="share-button" onclick="shareQuizResult()">
                        <i class="fas fa-share-alt mr-1"></i> Share Result
                    </button>
                    <button class="challenge-button" onclick="challengeFriend()">
                        <i class="fas fa-user-friends mr-1"></i> Challenge Friend
                    </button>
                </div>
                
                <button onclick="closeQuiz()" class="bg-red-600 text-white px-4 py-2 rounded-lg">Close</button>
            </div>
        </div>
    </div>
    
    <!-- Challenge Modal -->
    <div id="challengeModal" class="quiz-modal">
        <div class="quiz-content">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold text-gray-800">Challenge Friends</h2>
                <button onclick="closeChallengeModal()" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            
            <div class="mb-4">
                <p class="text-gray-700 mb-3">Challenge your friends to beat your score on the Group 1 quiz!</p>
                
                <div class="bg-gray-100 p-3 rounded-lg mb-4">
                    <div class="flex items-center justify-between mb-2">
                        <span class="font-semibold">Your Best Score:</span>
                        <span class="text-lg font-bold text-red-600" id="bestScore">0/7</span>
                    </div>
                    <div class="flex items-center justify-between">
                        <span class="font-semibold">Points Earned:</span>
                        <span class="text-lg font-bold text-green-600" id="totalPointsEarned">0 pts</span>
                    </div>
                </div>
                
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="friendEmail">
                        Friend's Email:
                    </label>
                    <input type="email" id="friendEmail" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="friend@example.com">
                </div>
                
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="message">
                        Personal Message (optional):
                    </label>
                    <textarea id="message" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" rows="3" placeholder="I bet you can't beat my score!"></textarea>
                </div>
                
                <button onclick="sendChallenge()" class="w-full bg-purple-600 text-white py-2 rounded-lg font-semibold hover:bg-purple-700 transition">
                    Send Challenge
                </button>
            </div>
        </div>
    </div>
    
    <!-- Toast Container -->
    <div id="toastContainer"></div>

    <script>
        // Firebase Configuration
        // Import the functions you need from the SDKs you need
    import { initializeApp } from "firebase/app";
    import { getAnalytics } from "firebase/analytics";
    // TODO: Add SDKs for Firebase products that you want to use
    // https://firebase.google.com/docs/web/setup#available-libraries
    
    // Your web app's Firebase configuration
    // For Firebase JS SDK v7.20.0 and later, measurementId is optional
    const firebaseConfig = {
      apiKey: "AIzaSyBOp4x0lTFvmt2s3MQKBRYmZT9IJ2ZaRi8",
      authDomain: "group-1-alkali-metals.firebaseapp.com",
      projectId: "group-1-alkali-metals",
      storageBucket: "group-1-alkali-metals.firebasestorage.app",
      messagingSenderId: "806417495419",
      appId: "1:806417495419:web:5b80607e8a23e96da4f9de",
      measurementId: "G-S76E52MQ37"
    };

// Initialize Firebase
const app = initializeApp(firebaseConfig);
const analytics = getAnalytics(app);
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        const storage = firebase.storage();

        // Global variables
        let currentUser = null;
        let userData = null;
        let currentQuiz = [];
        let currentQuestion = 0;
        let score = 0;
        let selectedOption = null;
        let quizType = '';
        let answerSubmitted = false;
        let achievements = [];
        let studyGroups = [];
        let comments = [];
        let leaderboard = [];

        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            // Check authentication state
            auth.onAuthStateChanged((user) => {
                if (user) {
                    currentUser = user;
                    loadUserData(user.uid);
                    updateUserProfile(user);
                    initializeApp();
                } else {
                    // User is signed out
                    currentUser = null;
                    document.getElementById('userProfile').innerHTML = `
                        <div class="user-avatar">G</div>
                        <span class="text-white text-sm font-medium mr-2">Guest</span>
                        <button onclick="showLoginModal()" class="nav-button text-white px-3 py-1 rounded-lg text-sm">
                            <i class="fas fa-sign-in-alt mr-1"></i>Login
                        </button>
                    `;
                    initializeApp();
                }
            });

            // Set up login form
            document.getElementById('loginForm').addEventListener('submit', (e) => {
                e.preventDefault();
                const email = document.getElementById('email').value;
                const password = document.getElementById('password').value;
                
                auth.signInWithEmailAndPassword(email, password)
                    .then((userCredential) => {
                        // Signed in
                        const user = userCredential.user;
                        showToast('success', 'Welcome back!', 'You have been successfully signed in.');
                        closeLoginModal();
                    })
                    .catch((error) => {
                        const errorCode = error.code;
                        const errorMessage = error.message;
                        showToast('error', 'Sign in failed', errorMessage);
                    });
            });

            // Animate cards on scroll
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.style.opacity = '1';
                        entry.target.style.transform = 'translateY(0)';
                    }
                });
            });
            
            document.querySelectorAll('.element-card, .property-card, .reaction-card, .trend-card').forEach(card => {
                card.style.opacity = '0';
                card.style.transform = 'translateY(20px)';
                card.style.transition = 'all 0.5s ease';
                observer.observe(card);
            });
        });

        // Initialize app data
        function initializeApp() {
            loadStudyGroups();
            loadComments();
            loadLeaderboard();
            
            // Check if pre-quiz should be shown automatically
            const preQuizCompleted = localStorage.getItem('preQuizCompleted');
            if (!preQuizCompleted && currentUser) {
                // Show pre-quiz automatically after a short delay
                setTimeout(() => {
                    startPreQuiz();
                }, 1000);
            }
        }

        // Load user data from Firestore
        function loadUserData(userId) {
            const userRef = db.collection('users').doc(userId);
            
            userRef.get().then((doc) => {
                if (doc.exists) {
                    userData = doc.data();
                    updateUserInterface();
                } else {
                    // User doesn't exist, create new user
                    createNewUser(userId);
                }
            }).catch((error) => {
                console.error("Error getting user data:", error);
            });
        }

        // Create new user in Firestore
        function createNewUser(userId) {
            const userRef = db.collection('users').doc(userId);
            
            userRef.set({
                uid: userId,
                email: currentUser.email,
                displayName: currentUser.displayName || 'User',
                photoURL: currentUser.photoURL || '',
                points: 0,
                achievements: [],
                quizzesTaken: 0,
                bestScore: 0,
                createdAt: firebase.firestore.FieldValue.serverTimestamp()
            }).then(() => {
                userData = {
                    uid: userId,
                    email: currentUser.email,
                    displayName: currentUser.displayName || 'User',
                    photoURL: currentUser.photoURL || '',
                    points: 0,
                    achievements: [],
                    quizzesTaken: 0,
                    bestScore: 0
                };
                updateUserInterface();
            }).catch((error) => {
                console.error("Error creating user:", error);
            });
        }

        // Update user interface with user data
        function updateUserInterface() {
            if (userData) {
                document.getElementById('userPoints').textContent = userData.points || 0;
                document.getElementById('userName').textContent = userData.displayName || 'User';
                
                // Update avatar
                const avatar = document.getElementById('userAvatar');
                if (userData.photoURL) {
                    avatar.innerHTML = `<img src="${userData.photoURL}" alt="Avatar" class="w-full h-full object-cover rounded-full">`;
                } else {
                    const initials = (userData.displayName || 'User').split(' ').map(n => n[0]).join('').toUpperCase();
                    avatar.textContent = initials;
                }
                
                // Update achievements
                updateAchievements();
                
                // Update best score in challenge modal
                document.getElementById('bestScore').textContent = `${userData.bestScore}/7`;
                document.getElementById('totalPointsEarned').textContent = `${userData.points} pts`;
            }
        }

        // Update user profile in navigation
        function updateUserProfile(user) {
            if (user) {
                document.getElementById('userProfile').innerHTML = `
                    <div class="user-avatar" id="userAvatar">
                        ${user.photoURL ? `<img src="${user.photoURL}" alt="Avatar" class="w-full h-full object-cover rounded-full">` : 'U'}
                    </div>
                    <span class="text-white text-sm font-medium mr-2">${user.displayName || 'User'}</span>
                    <button onclick="signOut()" class="nav-button text-white px-3 py-1 rounded-lg text-sm">
                        <i class="fas fa-sign-out-alt mr-1"></i>Logout
                    </button>
                `;
            }
        }

        // Update achievements display
        function updateAchievements() {
            const container = document.getElementById('achievementsContainer');
            container.innerHTML = '';
            
            if (userData && userData.achievements) {
                userData.achievements.forEach(achievement => {
                    const badge = document.createElement('div');
                    badge.className = 'achievement-badge';
                    
                    let icon = 'fa-medal';
                    if (achievement.includes('Explorer')) icon = 'fa-compass';
                    else if (achievement.includes('Streak')) icon = 'fa-fire';
                    else if (achievement.includes('Learner')) icon = 'fa-brain';
                    else if (achievement.includes('Master')) icon = 'fa-crown';
                    
                    badge.innerHTML = `<i class="fas ${icon}"></i> ${achievement}`;
                    container.appendChild(badge);
                });
            }
        }

        // Load study groups from Firestore
        function loadStudyGroups() {
            db.collection('studyGroups').get().then((querySnapshot) => {
                const container = document.getElementById('studyGroupsContainer');
                container.innerHTML = '';
                
                querySnapshot.forEach((doc) => {
                    const group = doc.data();
                    const groupCard = createStudyGroupCard(group, doc.id);
                    container.appendChild(groupCard);
                });
            }).catch((error) => {
                console.error("Error loading study groups:", error);
            });
        }

        // Create study group card
        function createStudyGroupCard(group, groupId) {
            const card = document.createElement('div');
            card.className = 'study-group-card';
            
            const membersHtml = group.members ? group.members.map(member => 
                `<div class="member-avatar">${member.charAt(0)}</div>`
            ).join('') : '';
            
            card.innerHTML = `
                <div class="study-group-header">
                    <h3 class="study-group-title">${group.name}</h3>
                    <button class="join-button" onclick="joinStudyGroup('${groupId}')">Join</button>
                </div>
                <p class="text-white/80 text-sm mb-2">${group.description}</p>
                <div class="study-group-members">
                    ${membersHtml}
                    ${group.memberCount > 3 ? `<div class="member-avatar">+${group.memberCount - 3}</div>` : ''}
                </div>
            `;
            
            return card;
        }

        // Join study group
        function joinStudyGroup(groupId) {
            if (!currentUser) {
                showToast('error', 'Sign in required', 'Please sign in to join study groups.');
                showLoginModal();
                return;
            }
            
            const groupRef = db.collection('studyGroups').doc(groupId);
            
            groupRef.update({
                members: firebase.firestore.FieldValue.arrayUnion(currentUser.uid),
                memberCount: firebase.firestore.FieldValue.increment(1)
            }).then(() => {
                showToast('success', 'Joined group', 'You have successfully joined the study group.');
                loadStudyGroups();
            }).catch((error) => {
                console.error("Error joining study group:", error);
                showToast('error', 'Error', 'Failed to join study group.');
            });
        }

        // Load comments from Firestore
        function loadComments() {
            db.collection('comments')
                .orderBy('createdAt', 'desc')
                .onSnapshot((querySnapshot) => {
                    const container = document.getElementById('commentsContainer');
                    container.innerHTML = '';
                    
                    querySnapshot.forEach((doc) => {
                        const comment = doc.data();
                        const commentDiv = createCommentElement(comment);
                        container.appendChild(commentDiv);
                    });
                });
        }

        // Create comment element
        function createCommentElement(comment) {
            const commentDiv = document.createElement('div');
            commentDiv.className = 'comment';
            
            commentDiv.innerHTML = `
                <div class="comment-author">${comment.authorName || 'Anonymous'}</div>
                <div class="comment-text">${comment.text}</div>
            `;
            
            return commentDiv;
        }

        // Add comment
        function addComment() {
            if (!currentUser) {
                showToast('error', 'Sign in required', 'Please sign in to post comments.');
                showLoginModal();
                return;
            }
            
            const commentInput = document.getElementById('commentInput');
            const commentText = commentInput.value.trim();
            
            if (!commentText) {
                return;
            }
            
            db.collection('comments').add({
                authorId: currentUser.uid,
                authorName: userData.displayName,
                text: commentText,
                createdAt: firebase.firestore.FieldValue.serverTimestamp()
            }).then(() => {
                commentInput.value = '';
                showToast('success', 'Comment posted', 'Your comment has been posted successfully.');
                
                // Award points for participation
                awardPoints(10, 'Comment posted');
            }).catch((error) => {
                console.error("Error adding comment:", error);
                showToast('error', 'Error', 'Failed to post comment.');
            });
        }

        // Load leaderboard from Firestore
        function loadLeaderboard() {
            db.collection('users')
                .orderBy('points', 'desc')
                .limit(3)
                .onSnapshot((querySnapshot) => {
                    const container = document.getElementById('leaderboardContainer');
                    container.innerHTML = '';
                    
                    querySnapshot.forEach((doc, index) => {
                        const user = doc.data();
                        const leaderboardItem = createLeaderboardItem(user, index);
                        container.appendChild(leaderboardItem);
                    });
                });
        }

        // Create leaderboard item
        function createLeaderboardItem(user, index) {
            const item = document.createElement('div');
            item.className = 'leaderboard-item';
            
            const medalColors = ['bg-yellow-400', 'bg-gray-300', 'bg-orange-400'];
            const medalTexts = ['1', '2', '3'];
            
            item.innerHTML = `
                <div class="flex items-center">
                    <div class="w-6 h-6 rounded-full ${medalColors[index]} flex items-center justify-center mr-2 text-xs font-bold text-gray-900">
                        ${medalTexts[index]}
                    </div>
                    <div class="flex-1">
                        <div class="font-semibold text-white text-sm">${user.displayName}</div>
                        <div class="text-xs text-white/70">${user.points} pts</div>
                    </div>
                </div>
            `;
            
            return item;
        }

        // Award points to user
        function awardPoints(points, reason) {
            if (!currentUser) return;
            
            const userRef = db.collection('users').doc(currentUser.uid);
            
            userRef.update({
                points: firebase.firestore.FieldValue.increment(points)
            }).then(() => {
                if (userData) {
                    userData.points += points;
                    document.getElementById('userPoints').textContent = userData.points;
                }
                
                showToast('success', 'Points awarded', `+${points} points for ${reason}`);
                
                // Check for achievements
                checkAchievements();
            }).catch((error) => {
                console.error("Error awarding points:", error);
            });
        }

        // Check and award achievements
        function checkAchievements() {
            if (!userData) return;
            
            const newAchievements = [];
            
            // Check for various achievements
            if (userData.points >= 100 && !userData.achievements.includes('Alkali Explorer')) {
                newAchievements.push('Alkali Explorer');
            }
            
            if (userData.quizzesTaken >= 5 && !userData.achievements.includes('Quiz Master')) {
                newAchievements.push('Quiz Master');
            }
            
            if (userData.bestScore >= 6 && !userData.achievements.includes('Alkali Master')) {
                newAchievements.push('Alkali Master');
            }
            
            if (newAchievements.length > 0) {
                const userRef = db.collection('users').doc(currentUser.uid);
                
                userRef.update({
                    achievements: firebase.firestore.FieldValue.arrayUnion(...newAchievements)
                }).then(() => {
                    userData.achievements = [...userData.achievements, ...newAchievements];
                    updateAchievements();
                    
                    // Show achievement notifications
                    newAchievements.forEach(achievement => {
                        showAchievement(achievement);
                    });
                });
            }
        }

        // Show achievement notification
        function showAchievement(achievementName) {
            showToast('success', 'Achievement Unlocked!', achievementName);
        }

        // Tab functionality
        function showTab(tabName) {
            // Hide all tab contents
            const tabContents = document.querySelectorAll('.tab-content');
            tabContents.forEach(content => {
                content.classList.remove('active');
            });
            
            // Remove active class from all tabs
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab content
            document.getElementById(tabName).classList.add('active');
            
            // Add active class to clicked tab
            event.target.classList.add('active');
        }

        // Quiz functions
        const preQuizQuestions = [
            {
                type: 'single',
                question: "Which of the following Group 1 metals is softest at room temperature?",
                options: ["Lithium", "Sodium", "Potassium", "Rubidium"],
                correct: 3,
                explanation: "Softness increases down the group, so rubidium is the softest Group 1 metal at room temperature."
            },
            {
                type: 'single',
                question: "Group 1 metals are found free in nature because they are not very reactive.",
                options: ["True", "False"],
                correct: 1,
                explanation: "Group 1 metals are highly reactive and are never found free in nature. They always exist in compounds."
            },
            {
                type: 'matching',
                question: "Match the Group 1 metal with its reaction with water.",
                items: [
                    { metal: "Lithium", key: "Lithium" },
                    { metal: "Sodium", key: "Sodium" },
                    { metal: "Potassium", key: "Potassium" }
                ],
                matchOptions: [
                    "a) Moves on water rapidly and fizzes",
                    "b) Bursts into flame with lilac flame",
                    "c) Fizzes slowly"
                ],
                correct: {
                    "Lithium": "c) Fizzes slowly",
                    "Sodium": "a) Moves on water rapidly and fizzes",
                    "Potassium": "b) Bursts into flame with lilac flame"
                },
                explanation: "Lithium fizzes slowly, sodium fizzes rapidly and moves on water, and potassium bursts into flame."
            },
            {
                type: 'multiple',
                question: "Which of the following products are formed when sodium reacts with water? (Select all that apply)",
                options: [
                    "A) Sodium hydroxide (NaOH)",
                    "B) Hydrogen gas (H₂)",
                    "C) Sodium chloride (NaCl)",
                    "D) Oxygen gas (O₂)"
                ],
                correct: [0, 1],
                explanation: "Sodium reacts with water to form sodium hydroxide and hydrogen gas: 2Na + 2H₂O → 2NaOH + H₂"
            },
            {
                type: 'ordering',
                question: "Arrange these Group 1 metals in order of increasing reactivity: Lithium, Sodium, Potassium",
                options: ["Lithium", "Sodium", "Potassium"],
                correct: [0, 1, 2],
                explanation: "Reactivity increases down the group: Lithium < Sodium < Potassium"
            },
            {
                type: 'single',
                question: "Which of the following is the correct formula for potassium superoxide?",
                options: ["K₂O", "KO₂", "K₂O₂", "KCl"],
                correct: 1,
                explanation: "Potassium forms the superoxide KO₂ when it reacts with oxygen."
            },
            {
                type: 'single',
                question: "A small piece of sodium is dropped into water. Which of the following would you observe?",
                options: [
                    "Fizzes slowly, no flame",
                    "Fizzes rapidly and moves on water",
                    "Bursts into flame with lilac flame",
                    "No reaction"
                ],
                correct: 1,
                explanation: "Sodium reacts vigorously with water, fizzing rapidly and moving around on the water surface."
            }
        ];

        const postQuizQuestions = [
            {
                type: 'single',
                question: "Which Group 1 element floats on water due to its low density?",
                options: ["Sodium", "Lithium", "Cesium", "Rubidium"],
                correct: 1,
                explanation: "Lithium has the lowest density of all Group 1 metals (0.534 g/cm³), which is less than water (1 g/cm³), so it floats on water."
            },
            {
                type: 'single',
                question: "Potassium reacts more vigorously with water than lithium because its outer electron is further from the nucleus.",
                options: ["True", "False"],
                correct: 0,
                explanation: "True. As you go down Group 1, the atomic radius increases, meaning the outer electron is further from the nucleus and more easily lost. This makes potassium more reactive than lithium."
            },
            {
                type: 'matching',
                question: "Match the Group 1 metal with the type of oxide it forms when reacting with oxygen:",
                items: [
                    { metal: "Lithium", key: "Lithium" },
                    { metal: "Sodium", key: "Sodium" },
                    { metal: "Potassium", key: "Potassium" }
                ],
                matchOptions: [
                    "a) Superoxide (O₂⁻)",
                    "b) Peroxide (O₂²⁻)",
                    "c) Oxide (O²⁻)"
                ],
                correct: {
                    "Lithium": "c) Oxide (O²⁻)",
                    "Sodium": "b) Peroxide (O₂²⁻)",
                    "Potassium": "a) Superoxide (O₂⁻)"
                },
                explanation: "Lithium forms the normal oxide (Li₂O), sodium forms the peroxide (Na₂O₂), and potassium forms the superoxide (KO₂). This trend shows increasing oxidation down the group."
            },
            {
                type: 'multiple',
                question: "Which of the following statements are true about Group 1 metals? (Select all that apply)",
                options: [
                    "A) They have low melting points",
                    "B) Reactivity decreases down the group",
                    "C) They are soft metals",
                    "D) Form ionic salts with halogens"
                ],
                correct: [0, 2, 3],
                explanation: "Group 1 metals have low melting points (A), are soft metals (C), and form ionic salts with halogens (D). However, reactivity increases down the group (B), not decreases."
            },
            {
                type: 'ordering',
                question: "Arrange the Group 1 metals in order of increasing melting point: Sodium, Lithium, Potassium",
                options: ["Sodium", "Lithium", "Potassium"],
                correct: [2, 0, 1],
                explanation: "Melting points decrease down the group: Potassium (63°C) < Sodium (98°C) < Lithium (181°C)"
            },
            {
                type: 'single',
                question: "Which observation correctly describes cesium when dropped in water?",
                options: [
                    "Fizzes slowly",
                    "Fizzes rapidly and floats",
                    "Explodes violently",
                    "No reaction"
                ],
                correct: 2,
                explanation: "Cesium is the most reactive of the naturally occurring Group 1 metals. It explodes violently when dropped in water due to its extreme reactivity."
            },
            {
                type: 'single',
                question: "A student observes a lilac flame when a metal reacts with water. Which metal was most likely used?",
                options: [
                    "Lithium",
                    "Sodium",
                    "Potassium",
                    "Rubidium"
                ],
                correct: 2,
                explanation: "Potassium produces a characteristic lilac flame during its reaction with water. Lithium produces a red flame, sodium produces a yellow flame, and rubidium produces a red-violet flame."
            }
        ];

        function startPreQuiz() {
            if (!currentUser) {
                showToast('error', 'Sign in required', 'Please sign in to take quizzes.');
                showLoginModal();
                return;
            }
            
            currentQuiz = [...preQuizQuestions];
            quizType = 'pre';
            currentQuestion = 0;
            score = 0;
            selectedOption = null;
            answerSubmitted = false;
            showQuiz();
        }

        function startPostQuiz() {
            if (!currentUser) {
                showToast('error', 'Sign in required', 'Please sign in to take quizzes.');
                showLoginModal();
                return;
            }
            
            currentQuiz = [...postQuizQuestions];
            quizType = 'post';
            currentQuestion = 0;
            score = 0;
            selectedOption = null;
            answerSubmitted = false;
            showQuiz();
        }

        function showQuiz() {
            document.getElementById('quizModal').classList.add('active');
            document.getElementById('quizProgress').classList.remove('hidden');
            document.getElementById('quizContent').classList.remove('hidden');
            document.getElementById('quizResults').classList.add('hidden');
            
            document.getElementById('quizTitle').textContent = quizType === 'pre' ? 'Group 1 Pre-Quiz' : 'Group 1 Post-Quiz';
            document.getElementById('currentQuestion').textContent = currentQuestion + 1;
            document.getElementById('totalQuestions').textContent = currentQuiz.length;
            document.getElementById('currentScore').textContent = score;
            document.getElementById('progressFill').style.width = ((currentQuestion + 1) / currentQuiz.length * 100) + '%';
            
            loadQuestion();
        }

        function loadQuestion() {
            const question = currentQuiz[currentQuestion];
            document.getElementById('questionText').textContent = question.question;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            
            // Reset buttons and feedback
            document.getElementById('submitButton').classList.remove('hidden');
            document.getElementById('submitButton').disabled = false;
            document.getElementById('nextButton').classList.add('hidden');
            document.getElementById('feedback').classList.add('hidden');
            answerSubmitted = false;
            
            if (question.type === 'single') {
                // Single choice question
                question.options.forEach((option, index) => {
                    const optionDiv = document.createElement('div');
                    optionDiv.className = 'quiz-option';
                    optionDiv.textContent = option;
                    optionDiv.onclick = () => selectOption(index);
                    optionsContainer.appendChild(optionDiv);
                });
                document.getElementById('submitButton').disabled = true;
            } else if (question.type === 'matching') {
                // Matching question
                const table = document.createElement('table');
                table.className = 'matching-table';
                
                // Header
                const headerRow = document.createElement('tr');
                const metalHeader = document.createElement('th');
                metalHeader.textContent = 'Metal';
                const oxideHeader = document.createElement('th');
                oxideHeader.textContent = 'Oxide Type';
                headerRow.appendChild(metalHeader);
                headerRow.appendChild(oxideHeader);
                table.appendChild(headerRow);
                
                // Rows
                question.items.forEach(item => {
                    const row = document.createElement('tr');
                    
                    const metalCell = document.createElement('td');
                    metalCell.textContent = item.metal;
                    
                    const oxideCell = document.createElement('td');
                    const select = document.createElement('select');
                    select.className = 'matching-select';
                    select.id = `match-${item.key}`;
                    select.onchange = checkMatchingComplete;
                    
                    // Add default option
                    const defaultOption = document.createElement('option');
                    defaultOption.value = '';
                    defaultOption.textContent = 'Select...';
                    select.appendChild(defaultOption);
                    
                    // Add oxide options
                    question.matchOptions.forEach(option => {
                        const optionElement = document.createElement('option');
                        optionElement.value = option;
                        optionElement.textContent = option;
                        select.appendChild(optionElement);
                    });
                    
                    oxideCell.appendChild(select);
                    row.appendChild(metalCell);
                    row.appendChild(oxideCell);
                    table.appendChild(row);
                });
                
                optionsContainer.appendChild(table);
                document.getElementById('submitButton').disabled = true;
            } else if (question.type === 'multiple') {
                // Multiple select question
                const multiSelectContainer = document.createElement('div');
                multiSelectContainer.className = 'multi-select';
                
                question.options.forEach((option, index) => {
                    const optionDiv = document.createElement('div');
                    optionDiv.className = 'multi-select-option';
                    optionDiv.onclick = () => toggleMultiSelect(index);
                    
                    const checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.id = `multi-${index}`;
                    
                    const label = document.createElement('label');
                    label.htmlFor = `multi-${index}`;
                    label.textContent = option;
                    
                    optionDiv.appendChild(checkbox);
                    optionDiv.appendChild(label);
                    multiSelectContainer.appendChild(optionDiv);
                });
                
                optionsContainer.appendChild(multiSelectContainer);
            } else if (question.type === 'ordering') {
                // Ordering question
                const orderingContainer = document.createElement('div');
                orderingContainer.className = 'ordering-container';
                
                question.options.forEach((option, index) => {
                    const orderingItem = document.createElement('div');
                    orderingItem.className = 'ordering-item';
                    
                    const label = document.createElement('span');
                    label.textContent = option;
                    
                    const select = document.createElement('select');
                    select.className = 'order-select';
                    select.id = `order-${index}`;
                    select.onchange = checkOrderingComplete;
                    
                    // Add default option
                    const defaultOption = document.createElement('option');
                    defaultOption.value = '';
                    defaultOption.textContent = 'Select...';
                    select.appendChild(defaultOption);
                    
                    // Add order options
                    for (let i = 1; i <= question.options.length; i++) {
                        const optionElement = document.createElement('option');
                        optionElement.value = i;
                        optionElement.textContent = `${i}${getOrdinalSuffix(i)}`;
                        select.appendChild(optionElement);
                    }
                    
                    orderingItem.appendChild(label);
                    orderingItem.appendChild(select);
                    orderingContainer.appendChild(orderingItem);
                });
                
                optionsContainer.appendChild(orderingContainer);
                document.getElementById('submitButton').disabled = true;
            }
            
            document.getElementById('prevButton').classList.toggle('hidden', currentQuestion === 0);
            
            selectedOption = null;
        }

        function checkMatchingComplete() {
            const question = currentQuiz[currentQuestion];
            let allSelected = true;
            
            question.items.forEach(item => {
                const select = document.getElementById(`match-${item.key}`);
                if (select.value === '') {
                    allSelected = false;
                }
            });
            
            document.getElementById('submitButton').disabled = !allSelected;
        }

        function checkOrderingComplete() {
            const question = currentQuiz[currentQuestion];
            let allSelected = true;
            let hasDuplicates = false;
            const selectedOrders = [];
            
            question.options.forEach((option, index) => {
                const select = document.getElementById(`order-${index}`);
                const value = select.value;
                if (value === '') {
                    allSelected = false;
                }
                if (selectedOrders.includes(value)) {
                    hasDuplicates = true;
                }
                selectedOrders.push(value);
            });
            
            document.getElementById('submitButton').disabled = !allSelected || hasDuplicates;
        }

        function getOrdinalSuffix(num) {
            const j = num % 10;
            const k = num % 100;
            if (j == 1 && k != 11) {
                return "st";
            }
            if (j == 2 && k != 12) {
                return "nd";
            }
            if (j == 3 && k != 13) {
                return "rd";
            }
            return "th";
        }

        function selectOption(index) {
            if (answerSubmitted) return;
            
            selectedOption = index;
            const options = document.querySelectorAll('.quiz-option');
            
            // Remove previous selection
            options.forEach(option => {
                option.classList.remove('selected');
            });
            
            // Add selection to clicked option
            options[index].classList.add('selected');
            
            // Enable submit button
            document.getElementById('submitButton').disabled = false;
        }

        function toggleMultiSelect(index) {
            if (answerSubmitted) return;
            
            const checkbox = document.getElementById(`multi-${index}`);
            checkbox.checked = !checkbox.checked;
            
            const optionDiv = checkbox.parentElement;
            if (checkbox.checked) {
                optionDiv.classList.add('selected');
            } else {
                optionDiv.classList.remove('selected');
            }
        }

        function checkMatchingAnswer() {
            const question = currentQuiz[currentQuestion];
            let correct = true;
            
            for (const [metal, correctObservation] of Object.entries(question.correct)) {
                const select = document.getElementById(`match-${metal}`);
                if (select.value !== correctObservation) {
                    correct = false;
                    break;
                }
            }
            
            return correct;
        }

        function checkMultipleAnswer() {
            const question = currentQuiz[currentQuestion];
            const selectedIndices = [];
            
            question.options.forEach((option, index) => {
                const checkbox = document.getElementById(`multi-${index}`);
                if (checkbox.checked) {
                    selectedIndices.push(index);
                }
            });
            
            // Check if all correct options are selected and no incorrect ones
            const correctSet = new Set(question.correct);
            const selectedSet = new Set(selectedIndices);
            
            return correctSet.size === selectedSet.size && 
                   [...correctSet].every(val => selectedSet.has(val));
        }

        function checkOrderingAnswer() {
            const question = currentQuiz[currentQuestion];
            const order = [];
            
            question.options.forEach((option, index) => {
                const select = document.getElementById(`order-${index}`);
                const position = parseInt(select.value) - 1;
                order[position] = index;
            });
            
            // Check if the order matches the correct order
            return order.every((val, idx) => val === question.correct[idx]);
        }

        function submitAnswer() {
            if (answerSubmitted) return;
            
            const question = currentQuiz[currentQuestion];
            let isCorrect = false;
            
            if (question.type === 'single') {
                isCorrect = selectedOption === question.correct;
            } else if (question.type === 'matching') {
                isCorrect = checkMatchingAnswer();
            } else if (question.type === 'multiple') {
                isCorrect = checkMultipleAnswer();
            } else if (question.type === 'ordering') {
                isCorrect = checkOrderingAnswer();
            }
            
            const feedback = document.getElementById('feedback');
            if (isCorrect) {
                feedback.className = 'mb-3 p-2 rounded-lg bg-green-100 text-green-800 text-sm';
                feedback.textContent = 'Correct! ' + question.explanation;
                score++;
                
                // Award points for correct answer
                awardPoints(25, 'Correct answer');
            } else {
                feedback.className = 'mb-3 p-2 rounded-lg bg-red-100 text-red-800 text-sm';
                feedback.textContent = 'Incorrect. ' + question.explanation;
            }
            
            feedback.classList.remove('hidden');
            document.getElementById('submitButton').classList.add('hidden');
            document.getElementById('nextButton').classList.remove('hidden');
            document.getElementById('currentScore').textContent = score;
            
            // Mark answer as submitted
            answerSubmitted = true;
            
            // Show correct answers for visual feedback
            if (question.type === 'single') {
                const options = document.querySelectorAll('.quiz-option');
                options[question.correct].classList.add('correct');
                if (selectedOption !== null && selectedOption !== question.correct) {
                    options[selectedOption].classList.add('incorrect');
                }
            }
        }

        function nextQuestion() {
            currentQuestion++;
            
            if (currentQuestion >= currentQuiz.length) {
                showResults();
                return;
            }
            
            document.getElementById('currentQuestion').textContent = currentQuestion + 1;
            document.getElementById('progressFill').style.width = ((currentQuestion + 1) / currentQuiz.length * 100) + '%';
            loadQuestion();
        }

        function previousQuestion() {
            if (currentQuestion > 0) {
                currentQuestion--;
                document.getElementById('currentQuestion').textContent = currentQuestion + 1;
                document.getElementById('progressFill').style.width = ((currentQuestion + 1) / currentQuiz.length * 100) + '%';
                loadQuestion();
            }
        }

        function showResults() {
            document.getElementById('quizProgress').classList.add('hidden');
            document.getElementById('quizContent').classList.add('hidden');
            document.getElementById('quizResults').classList.remove('hidden');
            
            const percentage = Math.round((score / currentQuiz.length) * 100);
            document.getElementById('finalScore').textContent = `${score}/${currentQuiz.length}`;
            
            let message = '';
            if (percentage >= 80) {
                message = 'Excellent! You really know your Group 1 elements!';
                
                // Award achievement for high score
                if (quizType === 'post') {
                    awardAchievement('Alkali Master');
                }
            } else if (percentage >= 60) {
                message = 'Good job! You have a solid understanding of Group 1 elements.';
            } else if (percentage >= 40) {
                message = 'Not bad! Keep studying to improve your knowledge.';
            } else {
                message = 'Keep practicing! Review the material and try again.';
            }
            
            document.getElementById('scoreMessage').textContent = message;
            
            // Save quiz result to Firestore
            if (currentUser) {
                saveQuizResult(score, currentQuiz.length, quizType);
                
                // Update user stats
                const userRef = db.collection('users').doc(currentUser.uid);
                userRef.update({
                    quizzesTaken: firebase.firestore.FieldValue.increment(1),
                    bestScore: firebase.firestore.FieldValue.increment(score > (userData.bestScore || 0) ? score - (userData.bestScore || 0) : 0)
                }).then(() => {
                    if (userData) {
                        userData.quizzesTaken += 1;
                        if (score > userData.bestScore) {
                            userData.bestScore = score;
                        }
                    }
                });
            }
            
            // If this is the pre-quiz, mark it as completed
            if (quizType === 'pre') {
                localStorage.setItem('preQuizCompleted', 'true');
                awardAchievement('First Steps');
            }
        }

        function saveQuizResult(score, totalQuestions, quizType) {
            db.collection('quizResults').add({
                userId: currentUser.uid,
                userName: userData.displayName,
                score: score,
                totalQuestions: totalQuestions,
                percentage: Math.round((score / totalQuestions) * 100),
                quizType: quizType,
                topic: 'Group 1 - Alkali Metals',
                createdAt: firebase.firestore.FieldValue.serverTimestamp()
            }).catch((error) => {
                console.error("Error saving quiz result:", error);
            });
        }

        function closeQuiz() {
            document.getElementById('quizModal').classList.remove('active');
        }

        // Social Learning & Gamification Functions
        
        function showChallengeModal() {
            if (!currentUser) {
                showToast('error', 'Sign in required', 'Please sign in to send challenges.');
                showLoginModal();
                return;
            }
            
            document.getElementById('challengeModal').classList.add('active');
        }

        function closeChallengeModal() {
            document.getElementById('challengeModal').classList.remove('active');
        }

        function sendChallenge() {
            if (!currentUser) {
                showToast('error', 'Sign in required', 'Please sign in to send challenges.');
                return;
            }
            
            const friendEmail = document.getElementById('friendEmail').value;
            const message = document.getElementById('message').value;
            
            if (!friendEmail) {
                showToast('error', 'Error', 'Please enter your friend\'s email address');
                return;
            }
            
            // Save challenge to Firestore
            db.collection('challenges').add({
                senderId: currentUser.uid,
                senderName: userData.displayName,
                recipientEmail: friendEmail,
                message: message,
                bestScore: userData.bestScore || 0,
                status: 'pending',
                createdAt: firebase.firestore.FieldValue.serverTimestamp()
            }).then(() => {
                showToast('success', 'Challenge sent', `Challenge sent to ${friendEmail}!`);
                closeChallengeModal();
            }).catch((error) => {
                console.error("Error sending challenge:", error);
                showToast('error', 'Error', 'Failed to send challenge.');
            });
        }

        function shareProgress() {
            if (!currentUser) {
                showToast('error', 'Sign in required', 'Please sign in to share progress.');
                showLoginModal();
                return;
            }
            
            const shareData = {
                title: 'Chemistry Mastery - Group 1 Alkali Metals',
                text: `I'm learning about Group 1 Alkali Metals on Chemistry Mastery. I've earned ${userData.points} points! Join me!`,
                url: window.location.href
            };
            
            if (navigator.share) {
                navigator.share(shareData)
                    .then(() => console.log('Successful share'))
                    .catch((error) => console.log('Error sharing', error));
            } else {
                // Fallback for browsers that don't support Web Share API
                showToast('info', 'Share this link', window.location.href);
            }
        }

        function shareQuizResult() {
            const scoreText = document.getElementById('finalScore').textContent;
            const percentage = Math.round((score / currentQuiz.length) * 100);
            
            const shareData = {
                title: 'Chemistry Mastery Quiz Result',
                text: `I just scored ${scoreText} (${percentage}%) on the Group 1 Alkali Metals quiz! Can you beat my score?`,
                url: window.location.href
            };
            
            if (navigator.share) {
                navigator.share(shareData)
                    .then(() => console.log('Successful share'))
                    .catch((error) => console.log('Error sharing', error));
            } else {
                // Fallback for browsers that don't support Web Share API
                showToast('info', 'Share this result', `I scored ${scoreText} on the Group 1 Alkali Metals quiz!`);
            }
        }

        function challengeFriend() {
            closeQuiz();
            showChallengeModal();
        }

        // Authentication functions
        function showLoginModal() {
            document.getElementById('loginModal').classList.add('active');
        }

        function closeLoginModal() {
            document.getElementById('loginModal').classList.remove('active');
        }

        function showSignupForm() {
            // This would show a signup form instead of login
            showToast('info', 'Sign up', 'Sign up functionality would be implemented here');
        }

        function signInWithGoogle() {
            const provider = new firebase.auth.GoogleAuthProvider();
            
            auth.signInWithPopup(provider)
                .then((result) => {
                    const user = result.user;
                    showToast('success', 'Welcome!', 'You have been successfully signed in with Google.');
                    closeLoginModal();
                })
                .catch((error) => {
                    const errorCode = error.code;
                    const errorMessage = error.message;
                    showToast('error', 'Sign in failed', errorMessage);
                });
        }

        function signOut() {
            auth.signOut().then(() => {
                showToast('success', 'Signed out', 'You have been successfully signed out.');
            }).catch((error) => {
                console.error("Error signing out:", error);
            });
        }

        // Toast notification function
        function showToast(type, title, message) {
            const toastContainer = document.getElementById('toastContainer');
            
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            
            let icon = 'fa-info-circle';
            if (type === 'success') icon = 'fa-check-circle';
            else if (type === 'error') icon = 'fa-exclamation-circle';
            
            toast.innerHTML = `
                <div class="toast-icon">
                    <i class="fas ${icon}"></i>
                </div>
                <div class="toast-message">
                    <div class="toast-title">${title}</div>
                    <div class="toast-description">${message}</div>
                </div>
            `;
            
            toastContainer.appendChild(toast);
            
            // Show toast
            setTimeout(() => {
                toast.classList.add('show');
            }, 100);
            
            // Hide toast after 3 seconds
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => {
                    toast.remove();
                }, 300);
            }, 3000);
        }

        // Award achievement function
        function awardAchievement(achievementName) {
            if (!currentUser) return;
            
            const userRef = db.collection('users').doc(currentUser.uid);
            
            userRef.update({
                achievements: firebase.firestore.FieldValue.arrayUnion(achievementName)
            }).then(() => {
                if (userData) {
                    userData.achievements.push(achievementName);
                    updateAchievements();
                }
                
                showAchievement(achievementName);
            }).catch((error) => {
                console.error("Error awarding achievement:", error);
            });
        }
    </script>
</body>
</html>
