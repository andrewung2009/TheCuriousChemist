<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chemistry Mastery - Group 1 Alkali Metals</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    
    <style>
        /* Import Google Font */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
        
        /* Global Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        /* Animations - Simplified and more subtle */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes slideIn {
            from { transform: translateX(-100%); }
            to { transform: translateX(0); }
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        @keyframes glow {
            0%, 100% { text-shadow: 0 0 5px rgba(79, 70, 229, 0.7); }
            50% { text-shadow: 0 0 20px rgba(79, 70, 229, 0.9), 0 0 30px rgba(79, 70, 229, 0.7); }
        }
        
        .fade-in {
            animation: fadeIn 0.6s ease-out forwards;
        }
        
        .slide-in {
            animation: slideIn 0.5s ease-out forwards;
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
        
        .glow-text {
            animation: glow 2s infinite;
            font-weight: 700;
            color: #4f46e5;
        }
        
        /* Sidebar Styles - Simplified */
        .sidebar {
            position: fixed;
            top: 0;
            left: 0;
            height: 100vh;
            width: 260px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
            z-index: 100;
            overflow-y: auto;
            transition: transform 0.3s ease;
        }
        
        .sidebar-header {
            padding: 1.5rem;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }
        
        .sidebar-nav {
            padding: 1rem 0;
        }
        
        .nav-item {
            display: flex;
            align-items: center;
            padding: 0.75rem 1.5rem;
            color: #4b5563;
            text-decoration: none;
            transition: all 0.2s ease;
            border-left: 3px solid transparent;
        }
        
        .nav-item:hover {
            background: rgba(79, 70, 229, 0.1);
            color: #4f46e5;
            border-left-color: #4f46e5;
        }
        
        .nav-item.active {
            background: rgba(79, 70, 229, 0.1);
            color: #4f46e5;
            border-left-color: #4f46e5;
            font-weight: 600;
        }
        
        .nav-item i {
            margin-right: 0.75rem;
            width: 20px;
            text-align: center;
        }
        
        .sidebar-footer {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 1rem 1.5rem;
            border-top: 1px solid rgba(0, 0, 0, 0.1);
        }
        
        .main-content {
            margin-left: 260px;
            padding: 2rem;
            min-height: 100vh;
        }
        
        .menu-toggle {
            display: none;
            position: fixed;
            top: 1rem;
            left: 1rem;
            z-index: 101;
            background: rgba(255, 255, 255, 0.9);
            border: none;
            border-radius: 0.5rem;
            padding: 0.5rem;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        
        /* Card Styles - Simplified */
        .content-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 1rem;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            border-left: 5px solid #4f46e5;
        }
        
        .content-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.15);
        }
        
        /* Element Cards */
        .element-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }
        
        .element-card {
            background: white;
            border-radius: 1rem;
            padding: 1.5rem;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .element-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: linear-gradient(90deg, #4f46e5, #7c3aed);
        }
        
        .element-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }
        
        .element-image {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            margin: 0 auto 1rem;
            object-fit: cover;
            border: 3px solid #e5e7eb;
        }
        
        /* Tab Styles - Simplified */
        .tabs {
            display: flex;
            border-bottom: 2px solid #e5e7eb;
            margin-bottom: 1.5rem;
        }
        
        .tab {
            padding: 0.75rem 1.5rem;
            cursor: pointer;
            background: none;
            border: none;
            font-weight: 500;
            color: #6b7280;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .tab::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            right: 0;
            height: 2px;
            background: #4f46e5;
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }
        
        .tab.active {
            color: #4f46e5;
        }
        
        .tab.active::after {
            transform: scaleX(1);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* Quiz Styles - Simplified */
        .quiz-option {
            padding: 1rem;
            border: 2px solid #e5e7eb;
            border-radius: 0.5rem;
            margin: 0.75rem 0;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
            display: flex;
            align-items: center;
        }
        
        .quiz-option:hover {
            border-color: #4f46e5;
            background: #f3f4f6;
        }
        
        .quiz-option.selected {
            border-color: #4f46e5;
            background: #eef2ff;
        }
        
        .quiz-option.correct {
            border-color: #10b981;
            background: #d1fae5;
        }
        
        .quiz-option.incorrect {
            border-color: #ef4444;
            background: #fee2e2;
        }
        
        .quiz-option input {
            margin-right: 0.75rem;
        }
        
        .quiz-option label {
            cursor: pointer;
            flex: 1;
        }
        
        /* Button Styles - Simplified */
        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #4f46e5, #7c3aed);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(79, 70, 229, 0.3);
        }
        
        .btn-secondary {
            background: #f3f4f6;
            color: #4b5563;
        }
        
        .btn-secondary:hover {
            background: #e5e7eb;
        }
        
        .btn-success {
            background: #10b981;
            color: white;
        }
        
        .btn-danger {
            background: #ef4444;
            color: white;
        }
        
        /* Modal Styles - Simplified */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: white;
            border-radius: 1rem;
            padding: 2rem;
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.2);
        }
        
        /* Landing Page Styles - Simplified */
        .landing-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem;
        }
        
        .landing-card {
            background: white;
            border-radius: 2rem;
            padding: 3rem;
            max-width: 800px;
            width: 100%;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.2);
            text-align: center;
        }
        
        .landing-icon {
            font-size: 4rem;
            color: #4f46e5;
            margin-bottom: 1rem;
            animation: pulse 2s infinite;
        }
        
        .landing-title {
            font-size: 2.5rem;
            font-weight: 800;
            color: #1f2937;
            margin-bottom: 1rem;
        }
        
        .landing-subtitle {
            font-size: 1.25rem;
            color: #6b7280;
            margin-bottom: 2rem;
        }
        
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }
        
        .feature-card {
            padding: 1.5rem;
            border-radius: 1rem;
            background: #f9fafb;
            text-align: center;
            transition: all 0.3s ease;
        }
        
        .feature-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }
        
        .feature-icon {
            font-size: 2rem;
            color: #4f46e5;
            margin-bottom: 0.5rem;
            animation: bounce 2s infinite;
        }
        
        /* Learning Path - Simplified */
        .learning-path {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 2rem 0;
            position: relative;
        }
        
        .learning-path::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 4px;
            background: rgba(255, 255, 255, 0.3);
            z-index: 0;
        }
        
        .path-step {
            background: white;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            z-index: 1;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }
        
        .path-step.active {
            background: #4f46e5;
            color: white;
            transform: scale(1.1);
        }
        
        .path-step.completed {
            background: #10b981;
            color: white;
        }
        
        .path-step.locked {
            background: #9ca3af;
            color: white;
        }
        
        .path-label {
            position: absolute;
            bottom: -30px;
            white-space: nowrap;
            font-size: 0.875rem;
            font-weight: 500;
            color: white;
        }
        
        /* Unit and Lesson Styles */
        .unit-container {
            margin-bottom: 2rem;
        }
        
        .unit-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 0.75rem;
            margin-bottom: 0.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .unit-header:hover {
            background: rgba(255, 255, 255, 1);
            transform: translateX(5px);
        }
        
        .unit-title {
            display: flex;
            align-items: center;
            font-weight: 600;
            color: #1f2937;
        }
        
        .unit-title i {
            margin-right: 0.75rem;
            color: #4f46e5;
        }
        
        .unit-progress {
            display: flex;
            align-items: center;
            font-size: 0.875rem;
            color: #6b7280;
        }
        
        .unit-progress-bar {
            width: 100px;
            height: 6px;
            background: #e5e7eb;
            border-radius: 3px;
            margin: 0 0.5rem;
            overflow: hidden;
        }
        
        .unit-progress-fill {
            height: 100%;
            background: #10b981;
            transition: width 0.3s ease;
        }
        
        .lessons-container {
            margin-left: 2.5rem;
            display: none;
        }
        
        .lessons-container.active {
            display: block;
        }
        
        .lesson-item {
            display: flex;
            align-items: center;
            padding: 0.75rem 1rem;
            margin-bottom: 0.5rem;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .lesson-item:hover {
            background: rgba(255, 255, 255, 1);
            transform: translateX(5px);
        }
        
        .lesson-item.active {
            background: rgba(79, 70, 229, 0.1);
            border-left: 3px solid #4f46e5;
        }
        
        .lesson-item.completed {
            background: rgba(16, 185, 129, 0.1);
            border-left: 3px solid #10b981;
        }
        
        .lesson-item.locked {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .lesson-item.locked:hover {
            transform: none;
            background: rgba(255, 255, 255, 0.8);
        }
        
        .lesson-icon {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 0.75rem;
            font-size: 0.875rem;
        }
        
        .lesson-icon.unlocked {
            background: #eef2ff;
            color: #4f46e5;
        }
        
        .lesson-icon.completed {
            background: #d1fae5;
            color: #10b981;
        }
        
        .lesson-icon.locked {
            background: #f3f4f6;
            color: #9ca3af;
        }
        
        .lesson-content {
            flex: 1;
        }
        
        .lesson-title {
            font-weight: 500;
            color: #1f2937;
            margin-bottom: 0.125rem;
        }
        
        .lesson-description {
            font-size: 0.75rem;
            color: #6b7280;
        }
        
        .lesson-duration {
            font-size: 0.75rem;
            color: #9ca3af;
            margin-left: auto;
        }
        
        /* Lesson Content Styles */
        .lesson-content-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 1rem;
            padding: 2rem;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
        }
        
        .lesson-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .lesson-title-large {
            font-size: 1.875rem;
            font-weight: 700;
            color: #1f2937;
        }
        
        .lesson-meta {
            display: flex;
            align-items: center;
            gap: 1rem;
            font-size: 0.875rem;
            color: #6b7280;
        }
        
        .lesson-section {
            margin-bottom: 2rem;
        }
        
        .lesson-section-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
        }
        
        .lesson-section-title i {
            margin-right: 0.5rem;
            color: #4f46e5;
        }
        
        .lesson-navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 2rem;
            padding-top: 1rem;
            border-top: 1px solid #e5e7eb;
        }
        
        .practice-section {
            background: #f9fafb;
            border-radius: 0.75rem;
            padding: 1.5rem;
            margin: 1.5rem 0;
        }
        
        .practice-header {
            display: flex;
            align-items: center;
            margin-bottom: 1rem;
        }
        
        .practice-title {
            font-weight: 600;
            color: #1f2937;
            margin-left: 0.5rem;
        }
        
        /* Highlight Box - Simplified */
        .highlight-box {
            background: #f0f9ff;
            border-left: 4px solid #0ea5e9;
            padding: 1rem;
            border-radius: 0.5rem;
            margin: 1rem 0;
            transition: all 0.3s ease;
        }
        
        .highlight-box:hover {
            transform: translateX(5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }
        
        .highlight-box h4 {
            color: #0c4a6e;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }
        
        .highlight-box p {
            color: #075985;
        }
        
        /* Equation Box */
        .equation-box {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 0.5rem;
            padding: 1rem;
            margin: 1rem 0;
            text-align: center;
            transition: all 0.3s ease;
        }
        
        .equation-box:hover {
            transform: scale(1.02);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }
        
        .equation-box .equation {
            font-family: 'Courier New', monospace;
            font-size: 1.1rem;
            font-weight: 600;
            color: #1e293b;
            margin: 0.5rem 0;
        }
        
        /* Key Point Box */
        .key-point {
            background: #fffbeb;
            border-left: 4px solid #f59e0b;
            padding: 1rem;
            border-radius: 0.5rem;
            margin: 1rem 0;
            transition: all 0.3s ease;
        }
        
        .key-point:hover {
            transform: translateX(5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }
        
        .key-point h4 {
            color: #92400e;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }
        
        .key-point p {
            color: #78350f;
        }
        
        /* Comparison Table */
        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 1.5rem 0;
            background: white;
            border-radius: 0.5rem;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }
        
        .comparison-table th {
            background: #4f46e5;
            color: white;
            padding: 0.75rem;
            text-align: left;
            font-weight: 600;
        }
        
        .comparison-table td {
            padding: 0.75rem;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .comparison-table tr:last-child td {
            border-bottom: none;
        }
        
        .comparison-table tr:nth-child(even) {
            background: #f9fafb;
        }
        
        .comparison-table tr:hover {
            background: #eef2ff;
        }
        
        /* Progress Bar */
        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e5e7eb;
            border-radius: 4px;
            overflow: hidden;
            margin: 1rem 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4f46e5, #7c3aed);
            transition: width 0.3s ease;
        }
        
        /* Toast Notification */
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: white;
            padding: 1rem;
            border-radius: 0.5rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            z-index: 2000;
            display: flex;
            align-items: center;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }
        
        .toast.show {
            transform: translateX(0);
        }
        
        .toast-icon {
            margin-right: 0.75rem;
            font-size: 1.25rem;
        }
        
        .toast.success .toast-icon {
            color: #10b981;
        }
        
        .toast.error .toast-icon {
            color: #ef4444;
        }
        
        .toast.info .toast-icon {
            color: #3b82f6;
        }
        
        /* Loading Spinner */
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #4f46e5;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Study Group Styles */
        .study-group-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 1rem;
            padding: 1.5rem;
            margin-bottom: 1rem;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }
        
        .study-group-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }
        
        .member-avatar {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: linear-gradient(135deg, #4f46e5, #7c3aed);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 0.75rem;
            margin-right: -10px;
            border: 2px solid white;
        }
        
        /* Comment Styles */
        .comment-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 1rem;
            padding: 1.5rem;
            margin-top: 2rem;
        }
        
        .comment {
            background: #f9fafb;
            border-radius: 0.75rem;
            padding: 1rem;
            margin-bottom: 1rem;
            border-left: 4px solid #4f46e5;
            transition: all 0.3s ease;
        }
        
        .comment:hover {
            transform: translateX(5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }
        
        .comment-author {
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 0.25rem;
        }
        
        .comment-text {
            color: #4b5563;
        }
        
        .comment-form {
            display: flex;
            margin-top: 1rem;
            gap: 0.5rem;
        }
        
        .comment-input {
            flex: 1;
            padding: 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            font-size: 0.875rem;
        }
        
        .comment-submit {
            background: #4f46e5;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .comment-submit:hover {
            background: #4338ca;
        }
        
        /* Pre-Quiz Introduction Styles */
        .prequiz-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem;
        }
        
        .prequiz-card {
            background: white;
            border-radius: 2rem;
            padding: 3rem;
            max-width: 800px;
            width: 100%;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.2);
            text-align: center;
        }
        
        .prequiz-icon {
            font-size: 4rem;
            color: #4f46e5;
            margin-bottom: 1rem;
            animation: pulse 2s infinite;
        }
        
        .prequiz-title {
            font-size: 2.5rem;
            font-weight: 800;
            color: #1f2937;
            margin-bottom: 1rem;
        }
        
        .prequiz-subtitle {
            font-size: 1.25rem;
            color: #6b7280;
            margin-bottom: 2rem;
        }
        
        .support-message {
            background: #eff6ff;
            border-left: 4px solid #3b82f6;
            padding: 1rem;
            border-radius: 0.5rem;
            margin: 2rem 0;
            text-align: left;
        }
        
        .support-message h3 {
            font-size: 1.25rem;
            font-weight: 600;
            color: #1e40af;
            margin-bottom: 0.5rem;
        }
        
        .support-message p {
            color: #1e3a8a;
            line-height: 1.6;
        }
        
        /* Auth Modal Styles */
        .auth-tabs {
            display: flex;
            border-bottom: 2px solid #e5e7eb;
            margin-bottom: 1.5rem;
        }
        
        .auth-tab {
            flex: 1;
            padding: 0.75rem;
            text-align: center;
            cursor: pointer;
            font-weight: 500;
            color: #6b7280;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .auth-tab::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            right: 0;
            height: 2px;
            background: #4f46e5;
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }
        
        .auth-tab.active {
            color: #4f46e5;
        }
        
        .auth-tab.active::after {
            transform: scaleX(1);
        }
        
        .auth-content {
            display: none;
        }
        
        .auth-content.active {
            display: block;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }
        
        .modal-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #1f2937;
        }
        
        .close-btn {
            background: none;
            border: none;
            font-size: 1.25rem;
            color: #6b7280;
            cursor: pointer;
            transition: color 0.2s;
        }
        
        .close-btn:hover {
            color: #1f2937;
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
            }
            
            .sidebar.active {
                transform: translateX(0);
            }
            
            .main-content {
                margin-left: 0;
            }
            
            .menu-toggle {
                display: block;
            }
            
            .landing-title, .prequiz-title {
                font-size: 2rem;
            }
            
            .feature-grid {
                grid-template-columns: 1fr;
            }
            
            .element-grid {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            }
            
            .learning-path {
                flex-direction: column;
                gap: 2rem;
            }
            
            .learning-path::before {
                width: 4px;
                height: 100%;
                top: 0;
                left: 50%;
                right: auto;
                transform: translateX(-50%);
            }
            
            .comparison-table {
                font-size: 0.875rem;
            }
            
            .comparison-table th, .comparison-table td {
                padding: 0.5rem;
            }
            
            .lessons-container {
                margin-left: 1rem;
            }
            
            .lesson-navigation {
                flex-direction: column;
                gap: 1rem;
            }
        }
    </style>
</head>
<body>
    <!-- Landing Page (shown when user hasn't signed in) -->
    <div id="landingPage" class="landing-container">
        <div class="landing-card">
            <div class="landing-icon fade-in">
                <i class="fas fa-atom"></i>
            </div>
            <h1 class="landing-title glow-text">Chemistry Mastery</h1>
            <p class="landing-subtitle">
                Master <strong class="text-indigo-600">Group 1 Alkali Metals</strong> through Interactive Learning
            </p>
            
            <div class="feature-grid">
                <div class="feature-card fade-in">
                    <div class="feature-icon">
                        <i class="fas fa-clipboard-check"></i>
                    </div>
                    <h3 class="font-semibold">Step-by-Step Learning</h3>
                    <p class="text-sm text-gray-600">Progress through <strong>structured lessons</strong></p>
                </div>
                <div class="feature-card fade-in">
                    <div class="feature-icon">
                        <i class="fas fa-book-open"></i>
                    </div>
                    <h3 class="font-semibold">Interactive Content</h3>
                    <p class="text-sm text-gray-600">Learn through <strong>engaging materials</strong></p>
                </div>
                <div class="feature-card fade-in">
                    <div class="feature-icon">
                        <i class="fas fa-users"></i>
                    </div>
                    <h3 class="font-semibold">Collaborative Learning</h3>
                    <p class="text-sm text-gray-600">Study with <strong>peers</strong></p>
                </div>
            </div>
            
            <div class="mt-8">
                <p class="text-lg font-semibold text-gray-700 mb-4">Your Learning Journey</p>
                <div class="learning-path">
                    <div class="path-step active">
                        <i class="fas fa-play"></i>
                        <span class="path-label">Pre-Quiz</span>
                    </div>
                    <div class="path-step locked">
                        <i class="fas fa-lock"></i>
                        <span class="path-label">Learn</span>
                    </div>
                    <div class="path-step locked">
                        <i class="fas fa-lock"></i>
                        <span class="path-label">Post-Quiz</span>
                    </div>
                </div>
            </div>
            
            <div class="mt-8 space-y-4">
                <button onclick="showLoginModal()" class="btn btn-primary w-full">
                    <i class="fas fa-sign-in-alt"></i>
                    Sign In to Begin
                </button>
                <button onclick="signInWithGoogle()" class="btn btn-secondary w-full">
                    <i class="fab fa-google"></i>
                    Continue with Google
                </button>
            </div>
        </div>
    </div>
    
    <!-- Pre-Quiz Introduction Page (shown after sign-in) -->
    <div id="prequizPage" class="prequiz-container" style="display: none;">
        <div class="prequiz-card">
            <div class="prequiz-icon">
                <i class="fas fa-clipboard-list"></i>
            </div>
            <h1 class="prequiz-title glow-text">Pre-Assessment Quiz</h1>
            <p class="prequiz-subtitle">
                Let's check your <strong class="text-indigo-600">current knowledge</strong> of Group 1 Alkali Metals
            </p>
            
            <div class="support-message">
                <h3><i class="fas fa-lightbulb mr-2"></i>Before You Begin</h3>
                <p>This quiz helps us understand your <strong>current knowledge level</strong>. Don't worry if you don't know all the answers - this is just a <strong>starting point</strong>! Take your time, read each question carefully, and do your best. Your results will help us <strong>personalize your learning experience</strong>.</p>
            </div>
            
            <div class="bg-blue-50 p-4 rounded-lg mb-6">
                <div class="flex items-center mb-2">
                    <i class="fas fa-info-circle text-blue-500 mr-2"></i>
                    <h3 class="font-semibold text-blue-800">Quiz Details</h3>
                </div>
                <ul class="text-left text-blue-700 space-y-1">
                    <li>• <strong>7 interactive questions</strong></li>
                    <li>• <strong>No time limit</strong></li>
                    <li>• <strong>Immediate feedback</strong> on answers</li>
                    <li>• <strong>Results saved</strong> to your profile</li>
                </ul>
            </div>
            
            <div class="mt-8">
                <button onclick="startPreQuiz()" class="btn btn-primary w-full">
                    <i class="fas fa-play mr-2"></i>
                    Start Pre-Quiz
                </button>
            </div>
        </div>
    </div>
    
    <!-- Main App (shown after pre-quiz completion) -->
    <div id="mainApp" style="display: none;">
        <!-- Menu Toggle Button (Mobile) -->
        <button class="menu-toggle" onclick="toggleSidebar()">
            <i class="fas fa-bars"></i>
        </button>
        
        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="flex items-center">
                    <i class="fas fa-atom text-indigo-600 text-2xl mr-3"></i>
                    <h1 class="text-xl font-bold text-gray-800">Chemistry Mastery</h1>
                </div>
                <p class="text-sm text-gray-600 mt-1">Group 1 - Alkali Metals</p>
            </div>
            
            <div class="sidebar-nav">
                <!-- Learning Units -->
                <div id="unitsContainer">
                    <!-- Units will be loaded here -->
                </div>
                
                <a href="#" class="nav-item" onclick="navigateToSection('study-groups')">
                    <i class="fas fa-users"></i>
                    <span>Study Groups</span>
                </a>
                <a href="#" class="nav-item" onclick="navigateToSection('discussion')">
                    <i class="fas fa-comments"></i>
                    <span>Discussion</span>
                </a>
                <a href="#" class="nav-item" onclick="navigateToSection('quiz')">
                    <i class="fas fa-graduation-cap"></i>
                    <span>Final Quiz</span>
                </a>
            </div>
            
            <div class="sidebar-footer">
                <div class="flex items-center justify-between mb-3">
                    <div class="flex items-center">
                        <div class="bg-indigo-100 rounded-full p-2 mr-2">
                            <i class="fas fa-coins text-indigo-600"></i>
                        </div>
                        <span class="text-sm font-medium text-gray-700"><span id="userPoints">0</span> pts</span>
                    </div>
                    <div class="flex items-center">
                        <div class="bg-orange-100 rounded-full p-2 mr-2">
                            <i class="fas fa-fire text-orange-500"></i>
                        </div>
                        <span class="text-sm font-medium text-gray-700"><span id="userStreak">0</span></span>
                    </div>
                </div>
                <div class="flex items-center justify-between">
                    <span class="text-sm text-gray-600">Signed in as:</span>
                    <span class="text-sm font-medium text-gray-800" id="userName">User</span>
                </div>
                <button onclick="signOut()" class="btn btn-secondary w-full mt-3 text-sm">
                    <i class="fas fa-sign-out-alt mr-1"></i>
                    Logout
                </button>
            </div>
        </div>
        
        <!-- Main Content -->
        <div class="main-content">
            <!-- Learning Path -->
            <div class="mb-6">
                <div class="learning-path">
                    <div class="path-step completed">
                        <i class="fas fa-check"></i>
                        <span class="path-label">Pre-Quiz</span>
                    </div>
                    <div class="path-step active">
                        <i class="fas fa-book-open"></i>
                        <span class="path-label">Learn</span>
                    </div>
                    <div class="path-step">
                        <i class="fas fa-graduation-cap"></i>
                        <span class="path-label">Post-Quiz</span>
                    </div>
                </div>
            </div>
            
            <!-- Lesson Content Area -->
            <div id="lessonContentArea">
                <!-- Lesson content will be loaded here -->
            </div>
            
            <!-- Study Groups Section -->
            <div id="study-groups-section" class="content-section" style="display: none;">
                <div class="content-card">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-bold text-gray-800 flex items-center">
                            <i class="fas fa-users mr-2 text-indigo-600"></i>
                            Study Circles
                        </h3>
                        <button onclick="showCreateStudyGroup()" class="btn btn-primary">
                            <i class="fas fa-plus"></i>
                            Create Group
                        </button>
                    </div>
                    <div id="studyGroupsContainer">
                        <!-- Study groups will be loaded here -->
                    </div>
                </div>
            </div>
            
            <!-- Discussion Section -->
            <div id="discussion-section" class="content-section" style="display: none;">
                <div class="comment-section">
                    <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                        <i class="fas fa-comments mr-2 text-indigo-600"></i>
                        Discussion
                    </h3>
                    <div id="commentsContainer">
                        <!-- Comments will be loaded here -->
                    </div>
                    <div class="comment-form">
                        <input type="text" id="commentInput" class="comment-input" placeholder="Share your thoughts...">
                        <button onclick="addComment()" class="comment-submit">Post</button>
                    </div>
                </div>
            </div>
            
            <!-- Post Quiz Section -->
            <div id="quiz-section" class="content-section" style="display: none;">
                <div class="content-card">
                    <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                        <i class="fas fa-graduation-cap mr-2 text-indigo-600"></i>
                        Final Assessment
                    </h3>
                    <p class="text-gray-600 mb-4">
                        Test your knowledge after completing the learning materials. See how much you've <strong>improved</strong>!
                    </p>
                    <button onclick="startPostQuiz()" class="btn btn-primary">
                        <i class="fas fa-play"></i>
                        Start Post-Quiz
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Login Modal -->
    <div id="loginModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Welcome to Chemistry Mastery</h2>
                <button class="close-btn" onclick="closeLoginModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="auth-tabs">
                <div class="auth-tab active" onclick="switchAuthTab('login')">Sign In</div>
                <div class="auth-tab" onclick="switchAuthTab('signup')">Sign Up</div>
            </div>
            
            <!-- Login Form -->
            <div id="loginForm" class="auth-content active">
                <form id="loginFormElement" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                        <input type="email" id="loginEmail" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" placeholder="your@email.com" required>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                        <input type="password" id="loginPassword" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" placeholder="••••••••" required>
                    </div>
                    
                    <button type="submit" class="btn btn-primary w-full">
                        <i class="fas fa-sign-in-alt"></i>
                        Sign In
                    </button>
                </form>
            </div>
            
            <!-- Signup Form -->
            <div id="signupForm" class="auth-content">
                <form id="signupFormElement" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Full Name</label>
                        <input type="text" id="signupName" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" placeholder="John Doe" required>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                        <input type="email" id="signupEmail" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" placeholder="your@email.com" required>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                        <input type="password" id="signupPassword" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" placeholder="••••••••" required>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Confirm Password</label>
                        <input type="password" id="signupConfirmPassword" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" placeholder="••••••••" required>
                    </div>
                    
                    <button type="submit" class="btn btn-primary w-full">
                        <i class="fas fa-user-plus"></i>
                        Create Account
                    </button>
                </form>
            </div>
            
            <div class="mt-6 text-center">
                <p class="text-gray-600">Or continue with</p>
                <button onclick="signInWithGoogle()" class="btn btn-secondary w-full mt-2">
                    <i class="fab fa-google"></i>
                    Google
                </button>
            </div>
        </div>
    </div>
    
    <!-- Quiz Modal -->
    <div id="quizModal" class="modal">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold text-gray-800" id="quizTitle">Pre-Quiz</h2>
                <button onclick="closeQuiz()" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            
            <div id="quizProgress" class="mb-4">
                <div class="flex justify-between items-center mb-2">
                    <span class="text-sm text-gray-600">Question <span id="currentQuestion">1</span> of <span id="totalQuestions">7</span></span>
                    <span class="text-sm text-gray-600">Score: <span id="currentScore">0</span></span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill" style="width: 14.3%"></div>
                </div>
            </div>
            
            <div id="quizContent">
                <div class="mb-6">
                    <h3 class="text-lg font-semibold mb-4" id="questionText">Loading question...</h3>
                    <div id="optionsContainer"></div>
                </div>
                
                <div id="feedback" class="hidden mb-4 p-3 rounded-lg text-sm"></div>
                
                <div class="flex justify-between items-center">
                    <button id="prevButton" class="btn btn-secondary hidden" onclick="previousQuestion()">
                        <i class="fas fa-arrow-left"></i>
                        Previous
                    </button>
                    <div class="flex gap-2">
                        <button id="submitButton" class="btn btn-primary" onclick="submitAnswer()">
                            Submit Answer
                        </button>
                        <button id="nextButton" class="btn btn-primary hidden" onclick="nextQuestion()">
                            Next
                            <i class="fas fa-arrow-right ml-1"></i>
                        </button>
                    </div>
                </div>
            </div>
            
            <div id="quizResults" class="hidden text-center">
                <i class="fas fa-trophy text-5xl text-yellow-500 mb-4"></i>
                <h3 class="text-2xl font-bold mb-3">Quiz Complete!</h3>
                <div class="text-4xl font-bold text-indigo-600 mb-3" id="finalScore">0/7</div>
                <p class="text-gray-600 mb-6" id="scoreMessage">Great job!</p>
                
                <div id="postQuizActions" class="hidden">
                    <button onclick="completePreQuiz()" class="btn btn-primary">
                        <i class="fas fa-arrow-right"></i>
                        Continue to Learning Materials
                    </button>
                </div>
                
                <div id="finalActions" class="hidden">
                    <button onclick="closeQuiz()" class="btn btn-primary">
                        <i class="fas fa-check"></i>
                        Finish
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Create Study Group Modal -->
    <div id="createStudyGroupModal" class="modal">
        <div class="modal-content">
            <h2 class="text-xl font-bold text-gray-800 mb-4">Create Study Group</h2>
            
            <form id="createStudyGroupForm" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Group Name</label>
                    <input type="text" id="groupName" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" placeholder="Enter group name" required>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Description</label>
                    <textarea id="groupDescription" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" rows="3" placeholder="Describe your study group" required></textarea>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Goal</label>
                    <input type="text" id="groupGoal" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" placeholder="What's the goal of this group?" required>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Max Members</label>
                    <select id="groupMaxMembers" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" required>
                        <option value="5">5 members</option>
                        <option value="10">10 members</option>
                        <option value="15">15 members</option>
                        <option value="20">20 members</option>
                    </select>
                </div>
                
                <button type="submit" class="btn btn-primary w-full">
                    <i class="fas fa-plus"></i>
                    Create Group
                </button>
            </form>
        </div>
    </div>
    
    <!-- Toast Container -->
    <div id="toastContainer"></div>
    
    <!-- Loading Overlay -->
    <div id="loadingOverlay" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.5); z-index: 3000; align-items: center; justify-content: center;">
        <div class="bg-white rounded-lg p-6 text-center">
            <div class="spinner"></div>
            <p class="mt-2 text-gray-600">Loading...</p>
        </div>
    </div>
    
    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBOp4x0lTFvmt2s3MQKBRYmZT9IJ2ZaRi8",
            authDomain: "group-1-alkali-metals.firebaseapp.com",
            databaseURL: "https://group-1-alkali-metals-default-rtdb.firebaseio.com",
            projectId: "group-1-alkali-metals",
            storageBucket: "group-1-alkali-metals.firebasestorage.app",
            messagingSenderId: "806417495419",
            appId: "1:806417495419:web:5b80607e8a23e96da4f9de",
            measurementId: "G-S76E52MQ37"
        };
        
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const database = firebase.database();
        
        // Global variables
        let currentUser = null;
        let userData = null;
        let currentQuiz = [];
        let currentQuestion = 0;
        let score = 0;
        let selectedOption = null;
        let quizType = '';
        let answerSubmitted = false;
        let justSignedIn = false;
        let currentLessonId = null;
        let lessonProgress = {};
        
        // Learning Units and Lessons Structure
        const learningUnits = [
            {
                id: 'unit1',
                title: 'Introduction to Group 1 Alkali Metals',
                icon: 'fa-book-open',
                lessons: [
                    {
                        id: 'lesson1-1',
                        title: 'What are Alkali Metals?',
                        description: 'Introduction to Group 1 elements',
                        duration: '5 min',
                        content: {
                            sections: [
                                {
                                    title: 'Introduction',
                                    content: `
                                        <p>Group 1 elements, known as the <strong>alkali metals</strong>, occupy the first column of the periodic table. They consist of lithium (Li), sodium (Na), potassium (K), rubidium (Rb), cesium (Cs), and francium (Fr).</p>
                                        <p>These elements share similar properties because they all have <strong>one electron in their outer shell</strong>, which they readily lose to form +1 ions.</p>
                                    `
                                },
                                {
                                    title: 'Key Characteristics',
                                    content: `
                                        <ul>
                                            <li><strong>Highly reactive</strong> metals</li>
                                            <li><strong>Soft</strong> and can be cut with a knife</li>
                                            <li><strong>Low density</strong> - lithium floats on water</li>
                                            <li><strong>Low melting points</strong></li>
                                            <li>Form <strong>+1 ions</strong> by losing their valence electron</li>
                                        </ul>
                                    `
                                }
                            ],
                            practice: {
                                type: 'single',
                                question: "Which of the following is NOT a Group 1 alkali metal?",
                                options: ["Lithium", "Sodium", "Potassium", "Calcium"],
                                correct: 3,
                                explanation: "Calcium (Ca) is in Group 2, not Group 1. Group 1 consists of Li, Na, K, Rb, Cs, and Fr."
                            }
                        }
                    },
                    {
                        id: 'lesson1-2',
                        title: 'Electron Configuration',
                        description: 'Understanding valence electrons',
                        duration: '8 min',
                        content: {
                            sections: [
                                {
                                    title: 'Valence Electrons',
                                    content: `
                                        <p>All Group 1 elements have <strong>one electron</strong> in their outermost shell. This single valence electron is <strong>easily lost</strong>, making these elements highly reactive.</p>
                                        <div class="equation-box">
                                            <p>General electron configuration: [Noble Gas] ns¹</p>
                                        </div>
                                    `
                                },
                                {
                                    title: 'Examples',
                                    content: `
                                        <ul>
                                            <li><strong>Lithium (Li)</strong>: 1s² 2s¹ or [He] 2s¹</li>
                                            <li><strong>Sodium (Na)</strong>: 1s² 2s² 2p⁶ 3s¹ or [Ne] 3s¹</li>
                                            <li><strong>Potassium (K)</strong>: [Ar] 4s¹</li>
                                        </ul>
                                    `
                                }
                            ],
                            practice: {
                                type: 'fill-blank',
                                question: "The electron configuration of sodium is ______ or ______.",
                                correct: ["[Ne] 3s¹", "1s² 2s² 2p⁶ 3s¹"],
                                caseSensitive: false,
                                explanation: "Sodium has 11 electrons. Its electron configuration can be written as 1s² 2s² 2p⁶ 3s¹ or abbreviated as [Ne] 3s¹."
                            }
                        }
                    },
                    {
                        id: 'lesson1-3',
                        title: 'Physical Properties',
                        description: 'Exploring physical characteristics',
                        duration: '10 min',
                        content: {
                            sections: [
                                {
                                    title: 'General Physical Properties',
                                    content: `
                                        <div class="comparison-table">
                                            <table>
                                                <thead>
                                                    <tr>
                                                        <th>Property</th>
                                                        <th>Description</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr>
                                                        <td><strong>Appearance</strong></td>
                                                        <td>Silvery-white, shiny metals that tarnish quickly in air</td>
                                                    </tr>
                                                    <tr>
                                                        <td><strong>State</strong></td>
                                                        <td>Solid at room temperature</td>
                                                    </tr>
                                                    <tr>
                                                        <td><strong>Density</strong></td>
                                                        <td>Low - increases down the group (except K < Na)</td>
                                                    </tr>
                                                    <tr>
                                                        <td><strong>Melting Point</strong></td>
                                                        <td>Low - decreases down the group</td>
                                                    </tr>
                                                    <tr>
                                                        <td><strong>Hardness</strong></td>
                                                        <td>Soft - can be cut with a knife</td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    `
                                },
                                {
                                    title: 'Trends in Physical Properties',
                                    content: `
                                        <div class="highlight-box">
                                            <h4>Why do these trends occur?</h4>
                                            <p>As we move down Group 1:</p>
                                            <ul>
                                                <li><strong>Atomic radius increases</strong> due to more electron shells</li>
                                                <li><strong>Metallic bonding weakens</strong> because the distance between atoms increases</li>
                                                <li>This leads to <strong>lower melting points</strong> and <strong>softer metals</strong></li>
                                            </ul>
                                        </div>
                                    `
                                }
                            ],
                            practice: {
                                type: 'multiple',
                                question: "Which of the following are physical properties of Group 1 metals? (Select all that apply)",
                                options: [
                                    "Low density", 
                                    "High melting points", 
                                    "Good conductors of electricity",
                                    "Soft and can be cut with a knife",
                                    "High ionization energy"
                                ],
                                correct: [0, 2, 3],
                                explanation: "Group 1 metals have low density, are good conductors of electricity, and are soft enough to be cut with a knife. They have low melting points and low ionization energy."
                            }
                        }
                    },
                    {
                        id: 'lesson1-4',
                        title: 'Chemical Properties',
                        description: 'Understanding chemical behavior',
                        duration: '12 min',
                        content: {
                            sections: [
                                {
                                    title: 'Reactivity',
                                    content: `
                                        <p>Group 1 elements are the <strong>most reactive metals</strong> in the periodic table. Their reactivity <strong>increases down the group</strong>.</p>
                                        <div class="key-point">
                                            <h4>Why does reactivity increase?</h4>
                                            <p>As we move down the group:</p>
                                            <ul>
                                                <li>Atomic radius increases</li>
                                                <li>The outer electron is further from the nucleus</li>
                                                <li>More inner electron shells shield the outer electron</li>
                                                <li>This makes it <strong>easier to lose the valence electron</strong></li>
                                            </ul>
                                        </div>
                                    `
                                },
                                {
                                    title: 'Common Reactions',
                                    content: `
                                        <p>Group 1 metals react with:</p>
                                        <ul>
                                            <li><strong>Water</strong> to form metal hydroxides and hydrogen gas</li>
                                            <li><strong>Oxygen</strong> to form oxides, peroxides, or superoxides</li>
                                            <li><strong>Halogens</strong> to form ionic halides</li>
                                            <li><strong>Acids</strong> (very violently) to form salts and hydrogen gas</li>
                                        </ul>
                                    `
                                }
                            ],
                            practice: {
                                type: 'single',
                                question: "Which Group 1 metal is the most reactive?",
                                options: ["Lithium", "Sodium", "Potassium", "Francium"],
                                correct: 3,
                                explanation: "Francium is the most reactive Group 1 metal because it has the largest atomic radius and its valence electron is the easiest to lose due to maximum shielding effect."
                            }
                        }
                    }
                ]
            },
            {
                id: 'unit2',
                title: 'Elements of Group 1',
                icon: 'fa-th',
                lessons: [
                    {
                        id: 'lesson2-1',
                        title: 'Lithium',
                        description: 'The lightest metal',
                        duration: '10 min',
                        content: {
                            sections: [
                                {
                                    title: 'Properties of Lithium',
                                    content: `
                                        <div class="element-grid">
                                            <div class="element-card">
                                                <img src="https://upload.wikimedia.org/wikipedia/commons/e/ed/Lithiumcut_cropped.jpg" alt="Lithium" class="element-image">
                                                <h4 class="font-bold text-lg">Lithium (Li)</h4>
                                                <p class="text-sm text-gray-600">Atomic Number: 3</p>
                                                <p class="text-sm text-gray-600">Atomic Mass: 6.94</p>
                                                <p class="text-sm text-gray-600">Density: 0.534 g/cm³</p>
                                                <p class="text-sm text-gray-600">Melting Point: 180.5°C</p>
                                            </div>
                                        </div>
                                        <div class="highlight-box">
                                            <h4>Key Features</h4>
                                            <ul>
                                                <li><strong>Lightest metal</strong> and least dense solid element</li>
                                                <li><strong>Floats on water</strong> (density less than water)</li>
                                                <li><strong>Reacts steadily</strong> with water (not violently)</li>
                                                <li>Forms <strong>normal oxide</strong> (Li₂O) when burned in air</li>
                                            </ul>
                                        </div>
                                    `
                                },
                                {
                                    title: 'Uses of Lithium',
                                    content: `
                                        <div class="grid md:grid-cols-2 gap-4">
                                            <div class="bg-blue-50 p-4 rounded-lg">
                                                <h4 class="font-semibold text-blue-800 mb-2">Batteries</h4>
                                                <p class="text-sm text-blue-600">Lithium-ion batteries power smartphones, laptops, and electric vehicles due to their high energy density and lightweight nature.</p>
                                            </div>
                                            <div class="bg-green-50 p-4 rounded-lg">
                                                <h4 class="font-semibold text-green-800 mb-2">Medicine</h4>
                                                <p class="text-sm text-green-600">Lithium carbonate is used to treat bipolar disorder and depression.</p>
                                            </div>
                                            <div class="bg-purple-50 p-4 rounded-lg">
                                                <h4 class="font-semibold text-purple-800 mb-2">Glass and Ceramics</h4>
                                                <p class="text-sm text-purple-600">Lithium compounds are used to make special types of glass and ceramics.</p>
                                            </div>
                                            <div class="bg-yellow-50 p-4 rounded-lg">
                                                <h4 class="font-semibold text-yellow-800 mb-2">Greases</h4>
                                                <p class="text-sm text-yellow-600">Lithium stearate is used to make high-temperature lubricating greases.</p>
                                            </div>
                                        </div>
                                    `
                                }
                            ],
                            practice: {
                                type: 'single',
                                question: "What makes lithium unique among Group 1 metals?",
                                options: [
                                    "It's the most reactive",
                                    "It forms a normal oxide when burned in air",
                                    "It has the highest density",
                                    "It doesn't react with water"
                                ],
                                correct: 1,
                                explanation: "Lithium is unique among Group 1 metals because it forms the normal oxide (Li₂O) when burned in air, while sodium forms the peroxide (Na₂O₂) and potassium forms the superoxide (KO₂)."
                            }
                        }
                    },
                    {
                        id: 'lesson2-2',
                        title: 'Sodium',
                        description: 'The most abundant alkali metal',
                        duration: '12 min',
                        content: {
                            sections: [
                                {
                                    title: 'Properties of Sodium',
                                    content: `
                                        <div class="element-grid">
                                            <div class="element-card">
                                                <img src="https://upload.wikimedia.org/wikipedia/commons/2/27/Na_%28Sodium%29.jpg" alt="Sodium" class="element-image">
                                                <h4 class="font-bold text-lg">Sodium (Na)</h4>
                                                <p class="text-sm text-gray-600">Atomic Number: 11</p>
                                                <p class="text-sm text-gray-600">Atomic Mass: 22.99</p>
                                                <p class="text-sm text-gray-600">Density: 0.968 g/cm³</p>
                                                <p class="text-sm text-gray-600">Melting Point: 97.8°C</p>
                                            </div>
                                        </div>
                                        <div class="highlight-box">
                                            <h4>Key Features</h4>
                                            <ul>
                                                <li><strong>Most abundant</strong> alkali metal in Earth's crust</li>
                                                <li><strong>Reacts vigorously</strong> with water, melts into a ball</li>
                                                <li>Forms <strong>peroxide</strong> (Na₂O₂) when burned in air</li>
                                                <li><strong>Essential for life</strong> (nerve function, fluid balance)</li>
                                            </ul>
                                        </div>
                                    `
                                },
                                {
                                    title: 'Uses of Sodium',
                                    content: `
                                        <div class="grid md:grid-cols-2 gap-4">
                                            <div class="bg-blue-50 p-4 rounded-lg">
                                                <h4 class="font-semibold text-blue-800 mb-2">Street Lighting</h4>
                                                <p class="text-sm text-blue-600">Sodium vapor lamps produce bright yellow light and are energy-efficient for street lighting.</p>
                                            </div>
                                            <div class="bg-green-50 p-4 rounded-lg">
                                                <h4 class="font-semibold text-green-800 mb-2">Table Salt</h4>
                                                <p class="text-sm text-green-600">Sodium chloride (NaCl) is common table salt, essential for human nutrition.</p>
                                            </div>
                                            <div class="bg-purple-50 p-4 rounded-lg">
                                                <h4 class="font-semibold text-purple-800 mb-2">Soap Production</h4>
                                                <p class="text-sm text-purple-600">Sodium hydroxide (NaOH) is used in soap making and paper production.</p>
                                            </div>
                                            <div class="bg-yellow-50 p-4 rounded-lg">
                                                <h4 class="font-semibold text-yellow-800 mb-2">Food Preservation</h4>
                                                <p class="text-sm text-yellow-600">Sodium nitrate and sodium benzoate are used as food preservatives.</p>
                                            </div>
                                        </div>
                                    `
                                }
                            ],
                            practice: {
                                type: 'single',
                                question: "What happens when sodium reacts with cold water?",
                                options: [
                                    "It fizzes steadily and moves slowly",
                                    "It melts into a ball and moves quickly",
                                    "It explodes with a purple flame",
                                    "It doesn't react at all"
                                ],
                                correct: 1,
                                explanation: "When sodium reacts with cold water, it melts into a ball due to the heat of reaction and moves quickly across the water surface, fizzing vigorously as it produces hydrogen gas."
                            }
                        }
                    },
                    {
                        id: 'lesson2-3',
                        title: 'Potassium',
                        description: 'Essential for plants and animals',
                        duration: '12 min',
                        content: {
                            sections: [
                                {
                                    title: 'Properties of Potassium',
                                    content: `
                                        <div class="element-grid">
                                            <div class="element-card">
                                                <img src="https://cdn.britannica.com/77/131177-050-79292189/fragments-Potassium-metal.jpg" alt="Potassium" class="element-image">
                                                <h4 class="font-bold text-lg">Potassium (K)</h4>
                                                <p class="text-sm text-gray-600">Atomic Number: 19</p>
                                                <p class="text-sm text-gray-600">Atomic Mass: 39.10</p>
                                                <p class="text-sm text-gray-600">Density: 0.89 g/cm³</p>
                                                <p class="text-sm text-gray-600">Melting Point: 63.5°C</p>
                                            </div>
                                        </div>
                                        <div class="highlight-box">
                                            <h4>Key Features</h4>
                                            <ul>
                                                <li><strong>Essential nutrient</strong> for plants and animals</li>
                                                <li><strong>Reacts violently</strong> with water, may ignite with lilac flame</li>
                                                <li>Forms <strong>superoxide</strong> (KO₂) when burned in air</li>
                                                <li><strong>Lower density</strong> than sodium (exception to trend)</li>
                                            </ul>
                                        </div>
                                    `
                                },
                                {
                                    title: 'Uses of Potassium',
                                    content: `
                                        <div class="grid md:grid-cols-2 gap-4">
                                            <div class="bg-green-50 p-4 rounded-lg">
                                                <h4 class="font-semibold text-green-800 mb-2">Fertilizers</h4>
                                                <p class="text-sm text-green-600">Potassium compounds (like KCl) are essential fertilizers that promote plant growth and crop yield.</p>
                                            </div>
                                            <div class="bg-blue-50 p-4 rounded-lg">
                                                <h4 class="font-semibold text-blue-800 mb-2">Food Industry</h4>
                                                <p class="text-sm text-blue-600">Potassium is used as a salt substitute and in food preservation.</p>
                                            </div>
                                            <div class="bg-purple-50 p-4 rounded-lg">
                                                <h4 class="font-semibold text-purple-800 mb-2">Soap Production</h4>
                                                <p class="text-sm text-purple-600">Potassium hydroxide is used to make soft soaps and liquid soaps.</p>
                                            </div>
                                            <div class="bg-yellow-50 p-4 rounded-lg">
                                                <h4 class="font-semibold text-yellow-800 mb-2">Glass Manufacturing</h4>
                                                <p class="text-sm text-yellow-600">Potassium compounds are used to make specialty glass and optical glass.</p>
                                            </div>
                                        </div>
                                    `
                                }
                            ],
                            practice: {
                                type: 'single',
                                question: "Why is potassium less dense than sodium?",
                                options: [
                                    "It has fewer electrons",
                                    "It has a larger atomic volume",
                                    "It has a smaller atomic mass",
                                    "It forms stronger metallic bonds"
                                ],
                                correct: 1,
                                explanation: "Although potassium has a larger atomic mass than sodium, it has a much larger atomic volume due to an extra electron shell. This increase in volume is greater than the increase in mass, resulting in lower density."
                            }
                        }
                    },
                    {
                        id: 'lesson2-4',
                        title: 'Rubidium, Cesium, and Francium',
                        description: 'The heavier alkali metals',
                        duration: '15 min',
                        content: {
                            sections: [
                                {
                                    title: 'Rubidium (Rb)',
                                    content: `
                                        <div class="element-grid">
                                            <div class="element-card">
                                                <img src="https://upload.wikimedia.org/wikipedia/commons/c/c9/Rb5.JPG" alt="Rubidium" class="element-image">
                                                <h4 class="font-bold text-lg">Rubidium (Rb)</h4>
                                                <p class="text-sm text-gray-600">Atomic Number: 37</p>
                                                <p class="text-sm text-gray-600">Atomic Mass: 85.47</p>
                                                <p class="text-sm text-gray-600">Density: 1.532 g/cm³</p>
                                                <p class="text-sm text-gray-600">Melting Point: 39.3°C</p>
                                            </div>
                                        </div>
                                        <div class="highlight-box">
                                            <h4>Key Features</h4>
                                            <ul>
                                                <li><strong>Highly reactive</strong>, ignites spontaneously in air</li>
                                                <li><strong>Explodes violently</strong> in contact with water</li>
                                                <li>Used in <strong>atomic clocks</strong> and photocells</li>
                                                <li>Has <strong>37 isotopes</strong>, more than any other element</li>
                                            </ul>
                                        </div>
                                    `
                                },
                                {
                                    title: 'Cesium (Cs)',
                                    content: `
                                        <div class="element-grid">
                                            <div class="element-card">
                                                <img src="https://upload.wikimedia.org/wikipedia/commons/3/3d/Cesium.jpg" alt="Cesium" class="element-image">
                                                <h4 class="font-bold text-lg">Cesium (Cs)</h4>
                                                <p class="text-sm text-gray-600">Atomic Number: 55</p>
                                                <p class="text-sm text-gray-600">Atomic Mass: 132.91</p>
                                                <p class="text-sm text-gray-600">Density: 1.93 g/cm³</p>
                                                <p class="text-sm text-gray-600">Melting Point: 28.4°C</p>
                                            </div>
                                        </div>
                                        <div class="highlight-box">
                                            <h4>Key Features</h4>
                                            <ul>
                                                <li><strong>Most reactive</strong> stable metal (excluding Fr)</li>
                                                <li><strong>Lowest melting point</strong> of all metals (28.4°C)</li>
                                                <li>Used in <strong>atomic clocks</strong> for precise timekeeping</li>
                                                <li><strong>Photoelectric effect</strong> - used in solar cells</li>
                                            </ul>
                                        </div>
                                    `
                                },
                                {
                                    title: 'Francium (Fr)',
                                    content: `
                                        <div class="highlight-box">
                                            <h4>Francium - The Rarest Alkali Metal</h4>
                                            <ul>
                                                <li><strong>Extremely rare</strong> - less than 30 grams exists on Earth</li>
                                                <li><strong>Highly radioactive</strong> - longest-lived isotope has half-life of 22 minutes</li>
                                                <li><strong>Most reactive</strong> metal (theoretical, as it's too rare to test)</li>
                                                <li><strong>No commercial uses</strong> due to scarcity and radioactivity</li>
                                                <li>Discovered by <strong>Marguerite Perey</strong> in 1939</li>
                                            </ul>
                                        </div>
                                    `
                                }
                            ],
                            practice: {
                                type: 'single',
                                question: "Which alkali metal has the lowest melting point?",
                                options: ["Lithium", "Sodium", "Potassium", "Cesium"],
                                correct: 3,
                                explanation: "Cesium has the lowest melting point of all metals at 28.4°C, which is just above room temperature. This is due to weak metallic bonding resulting from its large atomic size."
                            }
                        }
                    }
                ]
            },
            {
                id: 'unit3',
                title: 'Reactions of Alkali Metals',
                icon: 'fa-flask',
                lessons: [
                    {
                        id: 'lesson3-1',
                        title: 'Reaction with Water',
                        description: 'Understanding metal-water reactions',
                        duration: '15 min',
                        content: {
                            sections: [
                                {
                                    title: 'General Reaction',
                                    content: `
                                        <p>All Group 1 metals react with water to produce <strong>hydrogen gas</strong> and the corresponding <strong>metal hydroxide</strong>.</p>
                                        <div class="equation-box">
                                            <p>General equation:</p>
                                            <p class="equation">2M(s) + 2H₂O(l) → 2MOH(aq) + H₂(g)</p>
                                        </div>
                                        <p>Where M represents a Group 1 metal.</p>
                                    `
                                },
                                {
                                    title: 'Reactivity Trend',
                                    content: `
                                        <p>The reactivity with water <strong>increases down the group</strong>:</p>
                                        <div class="grid md:grid-cols-3 gap-4">
                                            <div class="bg-blue-50 p-4 rounded-lg">
                                                <h5 class="font-semibold text-blue-800 mb-2">Lithium</h5>
                                                <p class="text-sm text-blue-600"><strong>Fizzes steadily</strong></p>
                                                <p class="text-xs text-blue-500 mt-1">Doesn't melt</p>
                                                <p class="text-xs text-blue-500 mt-1">Moves slowly on surface</p>
                                            </div>
                                            <div class="bg-blue-50 p-4 rounded-lg">
                                                <h5 class="font-semibold text-blue-800 mb-2">Sodium</h5>
                                                <p class="text-sm text-blue-600"><strong>Fizzes rapidly</strong></p>
                                                <p class="text-xs text-blue-500 mt-1">Melts into a ball</p>
                                                <p class="text-xs text-blue-500 mt-1">Moves quickly on surface</p>
                                            </div>
                                            <div class="bg-blue-50 p-4 rounded-lg">
                                                <h5 class="font-semibold text-blue-800 mb-2">Potassium</h5>
                                                <p class="text-sm text-blue-600"><strong>Fizzes very rapidly</strong></p>
                                                <p class="text-xs text-blue-500 mt-1">Ignites with lilac flame</p>
                                                <p class="text-xs text-blue-500 mt-1">May explode</p>
                                            </div>
                                        </div>
                                    `
                                },
                                {
                                    title: 'Reaction Mechanism',
                                    content: `
                                        <p>The reaction with water is a <strong>redox reaction</strong>:</p>
                                        <div class="equation-box">
                                            <p><strong>Oxidation:</strong> 2M → 2M⁺ + 2e⁻</p>
                                            <p><strong>Reduction:</strong> 2H₂O + 2e⁻ → 2OH⁻ + H₂</p>
                                            <p><strong>Overall:</strong> 2M + 2H₂O → 2MOH + H₂</p>
                                        </div>
                                        <div class="key-point">
                                            <h4>Why does reactivity increase?</h4>
                                            <p>As we move down the group, the ionization energy decreases, making it easier for the metal to lose its valence electron and react with water.</p>
                                        </div>
                                    `
                                }
                            ],
                            practice: {
                                type: 'drag-drop',
                                question: "Match the metal to its reaction behavior with water:",
                                dragItems: ["Lithium", "Sodium", "Potassium"],
                                dropTargets: ["Fizzes steadily", "Melts into a ball", "Ignites with lilac flame"],
                                correct: { "Lithium": "Fizzes steadily", "Sodium": "Melts into a ball", "Potassium": "Ignites with lilac flame" },
                                explanation: "Lithium reacts steadily with water without melting, sodium melts into a ball due to the heat of reaction, and potassium reacts violently and may ignite with a lilac flame."
                            }
                        }
                    },
                    {
                        id: 'lesson3-2',
                        title: 'Reaction with Oxygen',
                        description: 'Formation of oxides, peroxides, and superoxides',
                        duration: '15 min',
                        content: {
                            sections: [
                                {
                                    title: 'Types of Oxides Formed',
                                    content: `
                                        <p>Group 1 metals form different types of oxides when burned in air, depending on the metal:</p>
                                        <div class="grid md:grid-cols-3 gap-4">
                                            <div class="bg-green-50 p-4 rounded-lg">
                                                <h5 class="font-semibold text-green-800 mb-2">Lithium</h5>
                                                <p class="text-sm text-green-600">Forms <strong>Li₂O</strong> (normal oxide)</p>
                                                <div class="equation-box mt-2">
                                                    <p class="equation text-sm">4Li + O₂ → 2Li₂O</p>
                                                </div>
                                            </div>
                                            <div class="bg-green-50 p-4 rounded-lg">
                                                <h5 class="font-semibold text-green-800 mb-2">Sodium</h5>
                                                <p class="text-sm text-green-600">Forms <strong>Na₂O₂</strong> (peroxide)</p>
                                                <div class="equation-box mt-2">
                                                    <p class="equation text-sm">2Na + O₂ → Na₂O₂</p>
                                                </div>
                                            </div>
                                            <div class="bg-green-50 p-4 rounded-lg">
                                                <h5 class="font-semibold text-green-800 mb-2">Potassium</h5>
                                                <p class="text-sm text-green-600">Forms <strong>KO₂</strong> (superoxide)</p>
                                                <div class="equation-box mt-2">
                                                    <p class="equation text-sm">K + O₂ → KO₂</p>
                                                </div>
                                            </div>
                                        </div>
                                    `
                                },
                                {
                                    title: 'Why the Change in Products?',
                                    content: `
                                        <div class="highlight-box">
                                            <h4>Stability of Different Oxides</h4>
                                            <p>The type of oxide formed depends on the <strong>size of the metal ion</strong>:</p>
                                            <ul>
                                                <li><strong>Small Li⁺</strong> stabilizes the small O²⁻ ion in Li₂O</li>
                                                <li><strong>Medium Na⁺</strong> stabilizes the O₂²⁻ ion in Na₂O₂</li>
                                                <li><strong>Large K⁺, Rb⁺, Cs⁺</strong> stabilize the large O₂⁻ ion in superoxides</li>
                                            </ul>
                                            <p>This is an example of how <strong>cation size affects compound stability</strong>.</p>
                                        </div>
                                    `
                                },
                                {
                                    title: 'Reactions with Water',
                                    content: `
                                        <p>All Group 1 oxides react with water to form <strong>alkaline solutions</strong>:</p>
                                        <div class="grid md:grid-cols-3 gap-4">
                                            <div class="bg-purple-50 p-3 rounded-lg">
                                                <h5 class="font-semibold text-purple-800 mb-2">Normal Oxide</h5>
                                                <div class="equation-box mt-2">
                                                    <p class="equation text-sm">Li₂O + H₂O → 2LiOH</p>
                                                </div>
                                            </div>
                                            <div class="bg-purple-50 p-3 rounded-lg">
                                                <h5 class="font-semibold text-purple-800 mb-2">Peroxide</h5>
                                                <div class="equation-box mt-2">
                                                    <p class="equation text-sm">Na₂O₂ + 2H₂O → 2NaOH + H₂O₂</p>
                                                </div>
                                            </div>
                                            <div class="bg-purple-50 p-3 rounded-lg">
                                                <h5 class="font-semibold text-purple-800 mb-2">Superoxide</h5>
                                                <div class="equation-box mt-2">
                                                    <p class="equation text-sm">2KO₂ + 2H₂O → 2KOH + H₂O₂ + O₂</p>
                                                </div>
                                            </div>
                                        </div>
                                    `
                                }
                            ],
                            practice: {
                                type: 'single',
                                question: "Which Group 1 metal forms a superoxide when burned in oxygen?",
                                options: ["Lithium", "Sodium", "Potassium", "None of the above"],
                                correct: 2,
                                explanation: "Potassium forms the superoxide KO₂ when burned in oxygen. Lithium forms the normal oxide Li₂O, sodium forms the peroxide Na₂O₂, while potassium and heavier metals form superoxides."
                            }
                        }
                    },
                    {
                        id: 'lesson3-3',
                        title: 'Reaction with Halogens',
                        description: 'Formation of ionic halides',
                        duration: '12 min',
                        content: {
                            sections: [
                                {
                                    title: 'General Reaction',
                                    content: `
                                        <p>Group 1 metals react <strong>vigorously</strong> with halogens to form ionic halides. These reactions are <strong>highly exothermic</strong> and often produce bright flames.</p>
                                        <div class="equation-box">
                                            <p>General equation:</p>
                                            <p class="equation">2M(s) + X₂ → 2MX(s)</p>
                                            <p class="text-gray-600 text-sm">Where X = F, Cl, Br, I</p>
                                        </div>
                                    `
                                },
                                {
                                    title: 'Examples with Chlorine',
                                    content: `
                                        <div class="grid md:grid-cols-2 gap-4">
                                            <div class="bg-purple-50 p-4 rounded-lg">
                                                <h5 class="font-semibold text-purple-800 mb-2">Sodium + Chlorine</h5>
                                                <div class="equation-box mt-2">
                                                    <p class="equation text-sm">2Na + Cl₂ → 2NaCl</p>
                                                </div>
                                                <p class="text-sm text-purple-600 mt-2"><strong>Bright yellow flame</strong></p>
                                            </div>
                                            <div class="bg-purple-50 p-4 rounded-lg">
                                                <h5 class="font-semibold text-purple-800 mb-2">Potassium + Chlorine</h5>
                                                <div class="equation-box mt-2">
                                                    <p class="equation text-sm">2K + Cl₂ → 2KCl</p>
                                                </div>
                                                <p class="text-sm text-purple-600 mt-2"><strong>Lilac flame</strong></p>
                                            </div>
                                        </div>
                                    `
                                },
                                {
                                    title: 'Properties of Halides',
                                    content: `
                                        <div class="bg-purple-50 p-4 rounded-lg">
                                            <h5 class="font-semibold text-purple-800 mb-2">Properties of Group 1 Halides</h5>
                                            <ul class="text-sm text-purple-700 space-y-1">
                                                <li>• All are <strong>white crystalline solids</strong> at room temperature</li>
                                                <li>• <strong>High melting and boiling points</strong> due to strong ionic bonding</li>
                                                <li>• <strong>Soluble in water</strong>, forming neutral solutions</li>
                                                <li>• <strong>Conduct electricity</strong> when molten or in aqueous solution</li>
                                            </ul>
                                        </div>
                                    `
                                },
                                {
                                    title: 'Test for Halide Ions',
                                    content: `
                                        <p>The halide ions (Cl⁻, Br⁻, I⁻) can be identified using <strong>silver nitrate solution</strong>:</p>
                                        <div class="grid md:grid-cols-3 gap-4 mt-3">
                                            <div class="bg-yellow-50 p-3 rounded-lg">
                                                <h5 class="font-semibold text-yellow-800">Chloride</h5>
                                                <p class="text-sm text-yellow-600">Forms <strong>white precipitate</strong> of AgCl</p>
                                                <p class="text-xs text-yellow-500 mt-1">Soluble in dilute NH₃</p>
                                            </div>
                                            <div class="bg-yellow-50 p-3 rounded-lg">
                                                <h5 class="font-semibold text-yellow-800">Bromide</h5>
                                                <p class="text-sm text-yellow-600">Forms <strong>cream precipitate</strong> of AgBr</p>
                                                <p class="text-xs text-yellow-500 mt-1">Partially soluble in conc. NH₃</p>
                                            </div>
                                            <div class="bg-yellow-50 p-3 rounded-lg">
                                                <h5 class="font-semibold text-yellow-800">Iodide</h5>
                                                <p class="text-sm text-yellow-600">Forms <strong>yellow precipitate</strong> of AgI</p>
                                                <p class="text-xs text-yellow-500 mt-1">Insoluble in NH₃</p>
                                            </div>
                                        </div>
                                    `
                                }
                            ],
                            practice: {
                                type: 'single',
                                question: "What color is the flame when sodium reacts with chlorine?",
                                options: ["Lilac", "Yellow", "Red", "Green"],
                                correct: 1,
                                explanation: "Sodium produces a characteristic bright yellow flame when it reacts with chlorine. This is due to the excitation of sodium electrons and their subsequent emission of light at specific wavelengths."
                            }
                        }
                    },
                    {
                        id: 'lesson3-4',
                        title: 'Reaction with Acids',
                        description: 'Dangerous reactions with acids',
                        duration: '10 min',
                        content: {
                            sections: [
                                {
                                    title: 'General Reaction',
                                    content: `
                                        <p>Group 1 metals react with acids to produce <strong>hydrogen gas</strong> and the corresponding salt. These reactions are <strong>extremely vigorous and dangerous</strong> due to the high reactivity of the metals.</p>
                                        <div class="equation-box">
                                            <p>General equation:</p>
                                            <p class="equation">2M(s) + 2H⁺(aq) → 2M⁺(aq) + H₂(g)</p>
                                        </div>
                                    `
                                },
                                {
                                    title: 'Safety Warning',
                                    content: `
                                        <div class="bg-red-50 p-4 rounded-lg mb-4">
                                            <h5 class="font-semibold text-red-800 mb-2">⚠️ Safety Warning:</h5>
                                            <p class="text-red-700">
                                                These reactions are <strong>too violent</strong> to be performed safely in a school laboratory. The hydrogen gas produced is <strong>highly flammable</strong> and can explode. 
                                                Never attempt to react Group 1 metals with acids outside of specialized facilities with proper safety equipment.
                                            </p>
                                        </div>
                                    `
                                },
                                {
                                    title: 'Example Reactions',
                                    content: `
                                        <div class="space-y-2">
                                            <div class="bg-gray-50 p-3 rounded-lg">
                                                <p class="text-sm font-mono">2Li(s) + 2HCl(aq) → 2LiCl(aq) + H₂(g)</p>
                                            </div>
                                            <div class="bg-gray-50 p-3 rounded-lg">
                                                <p class="text-sm font-mono">2Na(s) + H₂SO₄(aq) → Na₂SO₄(aq) + H₂(g)</p>
                                            </div>
                                        </div>
                                    `
                                },
                                {
                                    title: 'Reaction Mechanism',
                                    content: `
                                        <p>The reaction with acids is a <strong>redox reaction</strong>:</p>
                                        <div class="equation-box mt-3">
                                            <p><strong>Oxidation:</strong> 2M → 2M⁺ + 2e⁻</p>
                                            <p><strong>Reduction:</strong> 2H⁺ + 2e⁻ → H₂</p>
                                            <p><strong>Overall:</strong> 2M + 2H⁺ → 2M⁺ + H₂</p>
                                        </div>
                                        <div class="key-point mt-3">
                                            <h4>Why So Vigorous?</h4>
                                            <p>The reaction with acids is more vigorous than with water because acids provide a <strong>higher concentration of H⁺ ions</strong> than water, making the reaction more thermodynamically favorable.</p>
                                        </div>
                                    `
                                }
                            ],
                            practice: {
                                type: 'single',
                                question: "Why should Group 1 metals never be reacted with acids in a school laboratory?",
                                options: [
                                    "They don't react with acids",
                                    "The reactions are too violent and dangerous",
                                    "They produce toxic gases",
                                    "The reactions are too slow to observe"
                                ],
                                correct: 1,
                                explanation: "Group 1 metals react extremely violently with acids, producing hydrogen gas which is highly flammable and can explode. These reactions are too dangerous for school laboratories and should only be performed in specialized facilities with proper safety equipment."
                            }
                        }
                    }
                ]
            },
            {
                id: 'unit4',
                title: 'Applications and Safety',
                icon: 'fa-industry',
                lessons: [
                    {
                        id: 'lesson4-1',
                        title: 'Real-world Applications',
                        description: 'Practical uses of alkali metals',
                        duration: '12 min',
                        content: {
                            sections: [
                                {
                                    title: 'Industrial Applications',
                                    content: `
                                        <div class="grid md:grid-cols-2 gap-4">
                                            <div class="bg-blue-50 p-4 rounded-lg">
                                                <h4 class="font-semibold text-blue-800 mb-2">Batteries and Energy Storage</h4>
                                                <p class="text-sm text-blue-600">
                                                    <strong>Lithium-ion batteries</strong> power everything from smartphones to electric vehicles. Their high energy density and lightweight nature make them ideal for portable electronics and electric transportation.
                                                </p>
                                            </div>
                                            <div class="bg-green-50 p-4 rounded-lg">
                                                <h4 class="font-semibold text-green-800 mb-2">Lighting</h4>
                                                <p class="text-sm text-green-600">
                                                    <strong>Sodium vapor lamps</strong> provide efficient street lighting with their characteristic yellow glow. They're energy-efficient and have long lifespans.
                                                </p>
                                            </div>
                                            <div class="bg-purple-50 p-4 rounded-lg">
                                                <h4 class="font-semibold text-purple-800 mb-2">Agriculture</h4>
                                                <p class="text-sm text-purple-600">
                                                    <strong>Potassium compounds</strong> are essential fertilizers that promote plant growth, improve crop yield, and enhance disease resistance in plants.
                                                </p>
                                            </div>
                                            <div class="bg-yellow-50 p-4 rounded-lg">
                                                <h4 class="font-semibold text-yellow-800 mb-2">Medicine</h4>
                                                <p class="text-sm text-yellow-600">
                                                    <strong>Lithium carbonate</strong> is used to treat bipolar disorder and depression. Sodium and potassium ions are crucial for nerve function and fluid balance in the body.
                                                </p>
                                            </div>
                                        </div>
                                    `
                                },
                                {
                                    title: 'Specialized Applications',
                                    content: `
                                        <div class="grid md:grid-cols-2 gap-4">
                                            <div class="bg-indigo-50 p-4 rounded-lg">
                                                <h4 class="font-semibold text-indigo-800 mb-2">Atomic Clocks</h4>
                                                <p class="text-sm text-indigo-600">
                                                    <strong>Cesium atomic clocks</strong> are the most accurate timekeeping devices known, used in GPS systems, telecommunications, and scientific research.
                                                </p>
                                            </div>
                                            <div class="bg-pink-50 p-4 rounded-lg">
                                                <h4 class="font-semibold text-pink-800 mb-2">Solar Cells</h4>
                                                <p class="text-sm text-pink-600">
                                                    <strong>Cesium</strong> and <strong>rubidium</strong> are used in photoelectric cells for solar energy conversion due to their low work function.
                                                </p>
                                            </div>
                                            <div class="bg-teal-50 p-4 rounded-lg">
                                                <h4 class="font-semibold text-teal-800 mb-2">Vacuum Tubes</h4>
                                                <p class="text-sm text-teal-600">
                                                    <strong>Cesium</strong> is used as a getter in vacuum tubes to remove trace gases, maintaining high vacuum conditions.
                                                </p>
                                            </div>
                                            <div class="bg-orange-50 p-4 rounded-lg">
                                                <h4 class="font-semibold text-orange-800 mb-2">Glass Manufacturing</h4>
                                                <p class="text-sm text-orange-600">
                                                    <strong>Lithium compounds</strong> are used to make specialty glass with low thermal expansion, useful for cookware and laboratory glassware.
                                                </p>
                                            </div>
                                        </div>
                                    `
                                }
                            ],
                            practice: {
                                type: 'multiple',
                                question: "Which of the following are applications of Group 1 metals? (Select all that apply)",
                                options: [
                                    "Lithium in batteries",
                                    "Sodium vapor in street lights",
                                    "Potassium in fertilizers",
                                    "Cesium in atomic clocks",
                                    "All of the above"
                                ],
                                correct: [0, 1, 2, 3, 4],
                                explanation: "All Group 1 metals have important applications: Lithium in batteries, sodium vapor in street lights, potassium in fertilizers, and cesium in atomic clocks."
                            }
                        }
                    },
                    {
                        id: 'lesson4-2',
                        title: 'Safety Precautions',
                        description: 'Handling alkali metals safely',
                        duration: '10 min',
                        content: {
                            sections: [
                                {
                                    title: 'General Safety Rules',
                                    content: `
                                        <div class="bg-red-50 p-4 rounded-lg mb-4">
                                            <h5 class="font-semibold text-red-800 mb-2">⚠️ Important Safety Rules</h5>
                                            <ul class="text-sm text-red-700 space-y-1">
                                                <li>• Always wear <strong>safety goggles</strong> and protective clothing</li>
                                                <li>• Work in a <strong>well-ventilated area</strong> or fume hood</li>
                                                <li>• Keep <strong>fire extinguishers</strong> (Class D) nearby</li>
                                                <li>• Never work alone when handling these metals</li>
                                                <li>• Have <strong>emergency procedures</strong> in place</li>
                                            </ul>
                                        </div>
                                    `
                                },
                                {
                                    title: 'Storage',
                                    content: `
                                        <div class="highlight-box">
                                            <h4>Proper Storage</h4>
                                            <p>Group 1 metals must be stored under <strong>inert oil</strong> (usually mineral oil or kerosene) to prevent reaction with air and moisture. The oil should be:</p>
                                            <ul>
                                                <li><strong>Dry and oxygen-free</strong></li>
                                                <li><strong>Changed regularly</strong> to prevent contamination</li>
                                                <li><strong>Stored in cool, dark places</strong> away from heat sources</li>
                                            </ul>
                                            <p class="mt-2">Containers should be <strong>tightly sealed</strong> and clearly labeled with hazard warnings.</p>
                                        </div>
                                    `
                                },
                                {
                                    title: 'Handling Techniques',
                                    content: `
                                        <div class="grid md:grid-cols-2 gap-4">
                                            <div class="bg-yellow-50 p-4 rounded-lg">
                                                <h4 class="font-semibold text-yellow-800 mb-2">Small Pieces</h4>
                                                <p class="text-sm text-yellow-600">
                                                    Use <strong>tweezers or forceps</strong> to handle small pieces. Never use bare hands as oils and moisture can cause reactions.
                                                </p>
                                            </div>
                                            <div class="bg-yellow-50 p-4 rounded-lg">
                                                <h4 class="font-semibold text-yellow-800 mb-2">Large Pieces</h4>
                                                <p class="text-sm text-yellow-600">
                                                    Cut large pieces under <strong>inert atmosphere</strong> (like argon) using specialized tools. Always wear appropriate PPE.
                                                </p>
                                            </div>
                                        </div>
                                    `
                                },
                                {
                                    title: 'Emergency Procedures',
                                    content: `
                                        <div class="bg-orange-50 p-4 rounded-lg">
                                            <h4 class="font-semibold text-orange-800 mb-2">In Case of Fire</h4>
                                            <ul class="text-sm text-orange-700 space-y-1">
                                                <li>• Use <strong>Class D fire extinguishers</strong> (metal fires)</li>
                                                <li>• <strong>NEVER use water</strong> - it will make the fire worse</li>
                                                <li>• <strong>Smother with dry sand</strong> or special metal fire powders</li>
                                                <li>• <strong>Evacuate</strong> if the fire cannot be controlled</li>
                                            </ul>
                                        </div>
                                        <div class="bg-blue-50 p-4 rounded-lg mt-3">
                                            <h4 class="font-semibold text-blue-800 mb-2">Skin Contact</h4>
                                            <ul class="text-sm text-blue-700 space-y-1">
                                                <li>• <strong>Immediately brush off</strong> any metal particles</li>
                                                <li>• <strong>Rinse with large amounts</strong> of water for at least 15 minutes</li>
                                                <li>• <strong>Seek medical attention</strong> immediately</li>
                                            </ul>
                                        </div>
                                    `
                                }
                            ],
                            practice: {
                                type: 'single',
                                question: "What should you NEVER use to extinguish a Group 1 metal fire?",
                                options: ["Class D fire extinguisher", "Dry sand", "Water", "Metal fire powder"],
                                correct: 2,
                                explanation: "Water should NEVER be used to extinguish Group 1 metal fires because it reacts violently with these metals, producing hydrogen gas which can explode. Always use Class D fire extinguishers or dry sand."
                            }
                        }
                    },
                    {
                        id: 'lesson4-3',
                        title: 'Extraction and Uses',
                        description: 'How we obtain and use alkali metals',
                        duration: '12 min',
                        content: {
                            sections: [
                                {
                                    title: 'Occurrence in Nature',
                                    content: `
                                        <div class="highlight-box">
                                            <h4>Natural Occurrence</h4>
                                            <p>Group 1 metals are <strong>never found free</strong> in nature due to their high reactivity. They occur as:</p>
                                            <ul>
                                                <li><strong>Chlorides</strong> (e.g., rock salt - NaCl, sylvite - KCl)</li>
                                                <li><strong>Carbonates</strong> (e.g., limestone impurities, trona - Na₃H(CO₃)₂·2H₂O)</li>
                                                <li><strong>Sulfates</strong> (e.g., Chile saltpeter - NaNO₃, polyhalite - K₂Ca₂Mg(SO₄)₄·2H₂O)</li>
                                                <li><strong>Silicates</strong> in many minerals and rocks</li>
                                            </ul>
                                        </div>
                                    `
                                },
                                {
                                    title: 'Extraction Methods',
                                    content: `
                                        <div class="grid md:grid-cols-2 gap-4">
                                            <div class="bg-green-50 p-4 rounded-lg">
                                                <h4 class="font-semibold text-green-800 mb-2">Electrolysis of Molten Salts</h4>
                                                <p class="text-sm text-green-600 mb-2">
                                                    The main method for extracting Group 1 metals is <strong>electrolysis of their molten chlorides</strong>.
                                                </p>
                                                <div class="equation-box">
                                                    <p class="equation text-sm">At cathode: M⁺ + e⁻ → M</p>
                                                    <p class="equation text-sm">At anode: 2Cl⁻ → Cl₂ + 2e⁻</p>
                                                </div>
                                                <p class="text-sm text-green-600 mt-2">
                                                    This method is used because chemical reduction is not possible - Group 1 metals are too reactive.
                                                </p>
                                            </div>
                                            <div class="bg-blue-50 p-4 rounded-lg">
                                                <h4 class="font-semibold text-blue-800 mb-2">Down's Process (Sodium)</h4>
                                                <p class="text-sm text-blue-600 mb-2">
                                                    Sodium is extracted using the <strong>Down's cell</strong>, which electrolyzes molten NaCl mixed with CaCl₂ to lower the melting point.
                                                </p>
                                                <ul class="text-sm text-blue-600">
                                                    <li>• Operating temperature: ~600°C</li>
                                                    <li>• Steel cathode where Na forms</li>
                                                    <li>• Graphite anode where Cl₂ forms</li>
                                                    <li>• Calcium chloride prevents sodium from rising</li>
                                                </ul>
                                            </div>
                                        </div>
                                    `
                                },
                                {
                                    title: 'Industrial Production',
                                    content: `
                                        <div class="bg-purple-50 p-4 rounded-lg">
                                            <h4 class="font-semibold text-purple-800 mb-2">Production Statistics</h4>
                                            <div class="comparison-table">
                                                <table>
                                                    <thead>
                                                        <tr>
                                                            <th>Metal</th>
                                                            <th>Annual Production</th>
                                                            <th>Main Use</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        <tr>
                                                            <td><strong>Lithium</strong></td>
                                                            <td>~100,000 tons</td>
                                                            <td>Batteries (80%)</td>
                                                        </tr>
                                                        <tr>
                                                            <td><strong>Sodium</strong></td>
                                                            <td>~100,000 tons</td>
                                                            <td>Chemical industry</td>
                                                        </tr>
                                                        <tr>
                                                            <td><strong>Potassium</strong></td>
                                                            <td>~40 million tons (as K₂O)</td>
                                                            <td>Fertilizers (90%)</td>
                                                        </tr>
                                                        <tr>
                                                            <td><strong>Rubidium/Cesium</strong></td>
                                                            <td>Small quantities</td>
                                                            <td>Specialized applications</td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    `
                                },
                                {
                                    title: 'Environmental Impact',
                                    content: `
                                        <div class="bg-yellow-50 p-4 rounded-lg">
                                            <h4 class="font-semibold text-yellow-800 mb-2">Environmental Considerations</h4>
                                            <ul class="text-sm text-yellow-700 space-y-1">
                                                <li>• <strong>Energy intensive</strong> extraction process</li>
                                                <li>• <strong>Chlorine gas</strong> byproduct needs careful handling</li>
                                                <li>• <strong>Lithium mining</strong> can impact water resources</li>
                                                <li>• <strong>Recycling</strong> of lithium batteries is becoming important</li>
                                                <li>• <strong>Sustainable alternatives</strong> being researched</li>
                                            </ul>
                                        </div>
                                    `
                                }
                            ],
                            practice: {
                                type: 'single',
                                question: "Why are Group 1 metals extracted by electrolysis rather than chemical reduction?",
                                options: [
                                    "It's cheaper",
                                    "Chemical reduction is not possible",
                                    "Electrolysis produces purer metals",
                                    "It's faster"
                                ],
                                correct: 1,
                                explanation: "Group 1 metals are too reactive to be extracted by chemical reduction. No reducing agent is strong enough to reduce their compounds to the metal, so electrolysis of their molten salts is the only practical method."
                            }
                        }
                    }
                ]
            }
        ];
        
        // Quiz questions - IGCSE Level with Interactive Types
        const preQuizQuestions = [
            {
                type: 'single',
                question: "Which of the following is the correct electron configuration of sodium?",
                options: ["[He] 2s² 2p⁶ 3s¹", "[Ne] 3s²", "[Ne] 3s¹", "[Ar] 4s¹"],
                correct: 2,
                explanation: "Sodium (Na) has atomic number 11. Its electron configuration is [Ne] 3s¹, meaning it has the same configuration as neon plus one electron in the 3s orbital."
            },
            {
                type: 'drag-drop',
                question: "Match the Group 1 element to its flame test color:",
                dragItems: ["Lithium", "Sodium", "Potassium", "Rubidium"],
                dropTargets: ["Red", "Yellow", "Lilac", "Red-violet"],
                correct: { "Lithium": "Red", "Sodium": "Yellow", "Potassium": "Lilac", "Rubidium": "Red-violet" },
                explanation: "Each Group 1 metal produces a characteristic flame color during flame tests: Lithium (red), Sodium (yellow), Potassium (lilac), and Rubidium (red-violet)."
            },
            {
                type: 'fill-blank',
                question: "Group 1 metals are stored under oil because they react with ______ and ______ in the air.",
                correct: ["oxygen", "moisture"],
                caseSensitive: false,
                explanation: "Group 1 metals are highly reactive and react with both oxygen and moisture in the air. Storing them under oil prevents these reactions."
            },
            {
                type: 'multiple',
                question: "Which of the following are properties of Group 1 metals? (Select all that apply)",
                options: [
                    "Low density", 
                    "High melting points", 
                    "Form +1 ions", 
                    "Good conductors of electricity",
                    "High ionization energy"
                ],
                correct: [0, 2, 3],
                explanation: "Group 1 metals have low density, form +1 ions, and are good conductors of electricity. They have low melting points and low ionization energy."
            },
            {
                type: 'single',
                question: "What is the main product when sodium reacts with cold water?",
                options: ["Sodium oxide and hydrogen", "Sodium hydroxide and hydrogen", "Sodium peroxide and hydrogen", "Sodium and water"],
                correct: 1,
                explanation: "Sodium reacts with cold water to produce sodium hydroxide (NaOH) and hydrogen gas (H₂). The equation is: 2Na + 2H₂O → 2NaOH + H₂."
            },
            {
                type: 'matching',
                question: "Match the reaction to the correct observation:",
                pairs: [
                    { left: "Lithium + water", right: "Fizzes steadily" },
                    { left: "Sodium + water", right: "Melts into a ball" },
                    { left: "Potassium + water", right: "Ignites with lilac flame" }
                ],
                correct: 0,
                explanation: "Lithium fizzes steadily in water, sodium melts into a ball and moves quickly, while potassium reacts violently and may ignite with a lilac flame."
            },
            {
                type: 'single',
                question: "Which Group 1 element has the lowest density and floats on water?",
                options: ["Sodium", "Lithium", "Cesium", "Rubidium"],
                correct: 1,
                explanation: "Lithium has the lowest density (0.534 g/cm³) of all Group 1 metals, which is less than water (1 g/cm³), so it floats on water."
            }
        ];
        
        const postQuizQuestions = [
            {
                type: 'single',
                question: "Which element in Group 1 forms a peroxide when burned in oxygen?",
                options: ["Lithium", "Sodium", "Potassium", "Rubidium"],
                correct: 1,
                explanation: "Sodium primarily forms the peroxide Na₂O₂ when burned in air, unlike lithium which forms the normal oxide Li₂O, and potassium/rubidium which form superoxides."
            },
            {
                type: 'drag-drop',
                question: "Match the reaction to the correct observation:",
                dragItems: [
                    "Lithium + water", 
                    "Sodium + water", 
                    "Potassium + water"
                ],
                dropTargets: [
                    "Fizzes steadily", 
                    "Melts into a ball", 
                    "Ignites with lilac flame"
                ],
                correct: { 
                    "Lithium + water": "Fizzes steadily", 
                    "Sodium + water": "Melts into a ball", 
                    "Potassium + water": "Ignites with lilac flame" 
                },
                explanation: "Lithium fizzes steadily in water, sodium melts into a ball and moves quickly, while potassium reacts violently and may ignite with a lilac flame."
            },
            {
                type: 'fill-blank',
                question: "The reactivity of Group 1 metals ______ down the group.",
                correct: ["increases"],
                caseSensitive: false,
                explanation: "Reactivity increases down Group 1 because the atomic radius increases and the outer electron is further from the nucleus, making it easier to lose."
            },
            {
                type: 'multiple',
                question: "Which of these are uses of Group 1 metals and their compounds? (Select all that apply)",
                options: [
                    "Lithium in batteries",
                    "Sodium vapor in street lights",
                    "Potassium in fertilizers",
                    "Rubidium in atomic clocks",
                    "All of the above"
                ],
                correct: [0, 1, 2, 3, 4],
                explanation: "All Group 1 metals have important uses: Lithium in batteries, sodium vapor in street lights, potassium in fertilizers, and rubidium in atomic clocks."
            },
            {
                type: 'single',
                question: "What is the formula of the superoxide formed by potassium?",
                options: ["KO", "KO₂", "K₂O", "K₂O₂"],
                correct: 1,
                explanation: "Potassium forms the superoxide KO₂ when burned in oxygen, unlike sodium which forms the peroxide Na₂O₂ and lithium which forms the oxide Li₂O."
            },
            {
                type: 'matching',
                question: "Match the element to its primary oxide type:",
                pairs: [
                    { left: "Lithium", right: "Normal oxide (Li₂O)" },
                    { left: "Sodium", right: "Peroxide (Na₂O₂)" },
                    { left: "Potassium", right: "Superoxide (KO₂)" }
                ],
                correct: 0,
                explanation: "Lithium forms the normal oxide Li₂O, sodium forms the peroxide Na₂O₂, and potassium forms the superoxide KO₂ when burned in oxygen."
            },
            {
                type: 'multiple',
                question: "Which statements about the extraction of Group 1 metals are correct? (Select all that apply)",
                options: [
                    "They are extracted by electrolysis of molten chlorides",
                    "They can be extracted by reduction with carbon",
                    "They are found free in nature",
                    "They are extracted from their ores",
                    "The process requires a lot of energy"
                ],
                correct: [0, 3, 4],
                explanation: "Group 1 metals are extracted by electrolysis of their molten chlorides, not by reduction with carbon. They are not found free in nature but in ores, and the process requires a lot of energy."
            }
        ];
        
        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            // Check authentication state on page load
            auth.onAuthStateChanged((user) => {
                if (user) {
                    currentUser = user;
                    console.log("User is signed in:", user.uid);
                    
                    // Check if this is a fresh sign-in (not just page reload)
                    if (justSignedIn) {
                        console.log("User just signed in, showing pre-quiz introduction");
                        // User just signed in, show pre-quiz introduction
                        showPreQuizIntroduction();
                        justSignedIn = false; // Reset the flag
                    } else {
                        // This is a page reload or existing session
                        console.log("Existing session, checking pre-quiz status");
                        checkPreQuizStatus();
                    }
                } else {
                    console.log("No user signed in");
                    // Show landing page
                    document.getElementById('landingPage').style.display = 'flex';
                    document.getElementById('prequizPage').style.display = 'none';
                    document.getElementById('mainApp').style.display = 'none';
                }
            });
            
            // Set up login form
            document.getElementById('loginFormElement').addEventListener('submit', (e) => {
                e.preventDefault();
                const email = document.getElementById('loginEmail').value;
                const password = document.getElementById('loginPassword').value;
                
                if (!isValidEmail(email)) {
                    showToast('error', 'Invalid Email', 'Please enter a valid email address');
                    return;
                }
                
                showLoading();
                
                auth.signInWithEmailAndPassword(email, password)
                    .then((userCredential) => {
                        const user = userCredential.user;
                        console.log("Sign in successful:", user.uid);
                        showToast('success', 'Welcome back!', 'You have been successfully signed in.');
                        closeLoginModal();
                        // Set flag to indicate user just signed in
                        justSignedIn = true;
                        // The onAuthStateChanged listener will handle showing the pre-quiz introduction
                    })
                    .catch((error) => {
                        const errorCode = error.code;
                        const errorMessage = error.message;
                        console.error("Sign in error:", errorCode, errorMessage);
                        
                        if (errorCode === 'auth/unauthorized-domain') {
                            showToast('error', 'Domain not authorized', 
                                'Please add your GitHub Pages domain to the authorized domains in your Firebase project settings.');
                        } else {
                            showToast('error', 'Sign in failed', errorMessage);
                        }
                    })
                    .finally(() => {
                        hideLoading();
                    });
            });
            
            // Set up signup form
            document.getElementById('signupFormElement').addEventListener('submit', (e) => {
                e.preventDefault();
                const name = document.getElementById('signupName').value;
                const email = document.getElementById('signupEmail').value;
                const password = document.getElementById('signupPassword').value;
                const confirmPassword = document.getElementById('signupConfirmPassword').value;
                
                if (!isValidEmail(email)) {
                    showToast('error', 'Invalid Email', 'Please enter a valid email address');
                    return;
                }
                
                if (password !== confirmPassword) {
                    showToast('error', 'Password Mismatch', 'The passwords you entered do not match.');
                    return;
                }
                
                if (password.length < 6) {
                    showToast('error', 'Password Too Short', 'Password must be at least 6 characters long.');
                    return;
                }
                
                showLoading();
                
                auth.createUserWithEmailAndPassword(email, password)
                    .then((userCredential) => {
                        const user = userCredential.user;
                        
                        // Update user profile with display name
                        return user.updateProfile({
                            displayName: name
                        }).then(() => {
                            console.log("Sign up successful:", user.uid);
                            showToast('success', 'Account Created!', 'Your account has been created successfully.');
                            closeLoginModal();
                            
                            // Set flag to indicate user just signed in
                            justSignedIn = true;
                            
                            // Create user data in database
                            const newUser = {
                                uid: user.uid,
                                email: email,
                                displayName: name,
                                points: 0,
                                currentStreak: 1,
                                lastActiveDate: new Date().toDateString(),
                                preQuizCompleted: false,
                                postQuizCompleted: false,
                                createdAt: firebase.database.ServerValue.TIMESTAMP
                            };
                            
                            return database.ref('users/' + user.uid).set(newUser);
                        });
                    })
                    .then(() => {
                        // The onAuthStateChanged listener will handle showing the pre-quiz introduction
                    })
                    .catch((error) => {
                        const errorCode = error.code;
                        const errorMessage = error.message;
                        console.error("Sign up error:", errorCode, errorMessage);
                        
                        if (errorCode === 'auth/email-already-in-use') {
                            showToast('error', 'Email Already In Use', 'This email address is already associated with an account.');
                        } else if (errorCode === 'auth/weak-password') {
                            showToast('error', 'Weak Password', 'Password must be at least 6 characters long.');
                        } else {
                            showToast('error', 'Sign up failed', errorMessage);
                        }
                    })
                    .finally(() => {
                        hideLoading();
                    });
            });
            
            // Set up create study group form
            document.getElementById('createStudyGroupForm').addEventListener('submit', (e) => {
                e.preventDefault();
                createStudyGroup();
            });
            
            // Add click handlers for landing page buttons
            document.addEventListener('click', function(e) {
                if (e.target.matches('#landingPage .btn-primary') || e.target.closest('#landingPage .btn-primary')) {
                    showLoginModal();
                }
                if (e.target.matches('#landingPage .btn-secondary') || e.target.closest('#landingPage .btn-secondary')) {
                    signInWithGoogle();
                }
            });
        });
        
        // Toggle sidebar (mobile)
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('active');
        }
        
        // Navigate to section
        function navigateToSection(sectionName) {
            // Hide all sections
            const sections = document.querySelectorAll('.content-section');
            sections.forEach(section => {
                section.style.display = 'none';
            });
            
            // Show selected section
            document.getElementById(`${sectionName}-section`).style.display = 'block';
            
            // Update active nav item
            const navItems = document.querySelectorAll('.nav-item');
            navItems.forEach(item => {
                item.classList.remove('active');
            });
            event.target.closest('.nav-item').classList.add('active');
            
            // Close sidebar on mobile
            if (window.innerWidth <= 768) {
                toggleSidebar();
            }
        }
        
        // Show pre-quiz introduction page
        function showPreQuizIntroduction() {
            console.log("Showing pre-quiz introduction");
            document.getElementById('landingPage').style.display = 'none';
            document.getElementById('prequizPage').style.display = 'flex';
            document.getElementById('mainApp').style.display = 'none';
        }
        
        // Check if user has completed pre-quiz
        function checkPreQuizStatus() {
            console.log("Checking pre-quiz status for user:", currentUser.uid);
            
            if (!currentUser) {
                console.log("No current user, showing landing page");
                document.getElementById('landingPage').style.display = 'flex';
                document.getElementById('prequizPage').style.display = 'none';
                document.getElementById('mainApp').style.display = 'none';
                return;
            }
            
            const userRef = database.ref('users/' + currentUser.uid);
            
            userRef.once('value').then((snapshot) => {
                console.log("User data snapshot:", snapshot.val());
                
                if (snapshot.exists()) {
                    userData = snapshot.val();
                    console.log("User data loaded:", userData);
                    
                    if (userData.preQuizCompleted) {
                        console.log("Pre-quiz completed, showing main app");
                        showMainApp();
                    } else {
                        console.log("Pre-quiz not completed, showing pre-quiz introduction");
                        showPreQuizIntroduction();
                    }
                } else {
                    console.log("User data doesn't exist, creating new user");
                    // Create new user
                    const newUser = {
                        uid: currentUser.uid,
                        email: currentUser.email,
                        displayName: currentUser.displayName || 'User',
                        points: 0,
                        currentStreak: 1,
                        lastActiveDate: new Date().toDateString(),
                        preQuizCompleted: false,
                        postQuizCompleted: false,
                        createdAt: firebase.database.ServerValue.TIMESTAMP
                    };
                    
                    userRef.set(newUser).then(() => {
                        userData = newUser;
                        console.log("New user created, showing pre-quiz introduction");
                        showPreQuizIntroduction();
                    }).catch((error) => {
                        console.error("Error creating new user:", error);
                        showToast('error', 'Error', 'Failed to create user profile.');
                    });
                }
            }).catch((error) => {
                console.error("Error checking pre-quiz status:", error);
                showToast('error', 'Error', 'Failed to check your progress.');
                document.getElementById('landingPage').style.display = 'flex';
                document.getElementById('prequizPage').style.display = 'none';
                document.getElementById('mainApp').style.display = 'none';
            });
        }
        
        // Show main application
        function showMainApp() {
            console.log("Showing main app");
            document.getElementById('landingPage').style.display = 'none';
            document.getElementById('prequizPage').style.display = 'none';
            document.getElementById('mainApp').style.display = 'block';
            
            // Update user profile
            document.getElementById('userName').textContent = userData.displayName || 'User';
            document.getElementById('userPoints').textContent = userData.points || 0;
            document.getElementById('userStreak').textContent = userData.currentStreak || 0;
            
            // Load learning units
            loadLearningUnits();
            
            // Load data
            loadStudyGroups();
            loadComments();
            
            // Add fade-in animation to elements
            document.querySelectorAll('.fade-in').forEach((el, index) => {
                el.style.animationDelay = `${index * 0.1}s`;
            });
        }
        
        // Load learning units in sidebar
        function loadLearningUnits() {
            const container = document.getElementById('unitsContainer');
            container.innerHTML = '';
            
            // Load user progress
            if (userData && userData.lessonProgress) {
                lessonProgress = userData.lessonProgress;
            }
            
            learningUnits.forEach(unit => {
                const unitDiv = createUnitElement(unit);
                container.appendChild(unitDiv);
            });
            
            // Show first lesson by default
            if (learningUnits.length > 0 && learningUnits[0].lessons.length > 0) {
                showLesson(learningUnits[0].lessons[0].id);
            }
        }
        
        // Create unit element
        function createUnitElement(unit) {
            const unitDiv = document.createElement('div');
            unitDiv.className = 'unit-container';
            
            // Calculate unit progress
            const completedLessons = unit.lessons.filter(lesson => 
                lessonProgress && lessonProgress[lesson.id] && lessonProgress[lesson.id].completed
            ).length;
            const totalLessons = unit.lessons.length;
            const progressPercentage = totalLessons > 0 ? (completedLessons / totalLessons) * 100 : 0;
            
            unitDiv.innerHTML = `
                <div class="unit-header" onclick="toggleUnit('${unit.id}')">
                    <div class="unit-title">
                        <i class="fas ${unit.icon}"></i>
                        <span>${unit.title}</span>
                    </div>
                    <div class="unit-progress">
                        <span>${completedLessons}/${totalLessons}</span>
                        <div class="unit-progress-bar">
                            <div class="unit-progress-fill" style="width: ${progressPercentage}%"></div>
                        </div>
                    </div>
                </div>
                <div class="lessons-container" id="lessons-${unit.id}">
                    ${unit.lessons.map(lesson => createLessonElement(lesson, unit.id)).join('')}
                </div>
            `;
            
            return unitDiv;
        }
        
        // Create lesson element
        function createLessonElement(lesson, unitId) {
            const isCompleted = lessonProgress && lessonProgress[lesson.id] && lessonProgress[lesson.id].completed;
            const isLocked = !isCompleted && !isLessonUnlocked(lesson.id);
            
            return `
                <div class="lesson-item ${isCompleted ? 'completed' : ''} ${isLocked ? 'locked' : ''}" 
                     onclick="${isLocked ? '' : `showLesson('${lesson.id}')`}">
                    <div class="lesson-icon ${isCompleted ? 'completed' : isLocked ? 'locked' : 'unlocked'}">
                        <i class="fas ${isCompleted ? 'fa-check' : isLocked ? 'fa-lock' : 'fa-play'}"></i>
                    </div>
                    <div class="lesson-content">
                        <div class="lesson-title">${lesson.title}</div>
                        <div class="lesson-description">${lesson.description}</div>
                    </div>
                    <div class="lesson-duration">${lesson.duration}</div>
                </div>
            `;
        }
        
        // Check if lesson is unlocked
        function isLessonUnlocked(lessonId) {
            // Find the lesson in the curriculum
            for (const unit of learningUnits) {
                const lessonIndex = unit.lessons.findIndex(l => l.id === lessonId);
                if (lessonIndex !== -1) {
                    // First lesson is always unlocked
                    if (lessonIndex === 0) return true;
                    
                    // Check if previous lesson is completed
                    const previousLesson = unit.lessons[lessonIndex - 1];
                    return lessonProgress && lessonProgress[previousLesson.id] && lessonProgress[previousLesson.id].completed;
                }
            }
            return false;
        }
        
        // Toggle unit visibility
        function toggleUnit(unitId) {
            const lessonsContainer = document.getElementById(`lessons-${unitId}`);
            lessonsContainer.classList.toggle('active');
        }
        
        // Show lesson content
        function showLesson(lessonId) {
            currentLessonId = lessonId;
            
            // Find the lesson in the curriculum
            let lessonData = null;
            for (const unit of learningUnits) {
                lessonData = unit.lessons.find(l => l.id === lessonId);
                if (lessonData) break;
            }
            
            if (!lessonData) return;
            
            // Update active lesson in sidebar
            document.querySelectorAll('.lesson-item').forEach(item => {
                item.classList.remove('active');
            });
            
            const activeLesson = document.querySelector(`.lesson-item[onclick="showLesson('${lessonId}')"]`);
            if (activeLesson) {
                activeLesson.classList.add('active');
            }
            
            // Show lesson content
            const contentArea = document.getElementById('lessonContentArea');
            contentArea.innerHTML = createLessonContent(lessonData);
            
            // Hide other sections
            document.getElementById('study-groups-section').style.display = 'none';
            document.getElementById('discussion-section').style.display = 'none';
            document.getElementById('quiz-section').style.display = 'none';
            
            // Mark lesson as started
            markLessonStarted(lessonId);
        }
        
        // Create lesson content HTML
        function createLessonContent(lessonData) {
            let html = `
                <div class="lesson-content-container fade-in">
                    <div class="lesson-header">
                        <h2 class="lesson-title-large">${lessonData.title}</h2>
                        <div class="lesson-meta">
                            <span><i class="far fa-clock"></i> ${lessonData.duration}</span>
                            <span><i class="fas fa-book-open"></i> ${lessonData.content.sections.length} sections</span>
                        </div>
                    </div>
            `;
            
            // Add lesson sections
            lessonData.content.sections.forEach((section, index) => {
                html += `
                    <div class="lesson-section">
                        <h3 class="lesson-section-title">
                            <i class="fas fa-bookmark"></i>
                            ${section.title}
                        </h3>
                        <div class="text-gray-700">
                            ${section.content}
                        </div>
                    </div>
                `;
            });
            
            // Add practice section
            if (lessonData.content.practice) {
                html += `
                    <div class="practice-section">
                        <div class="practice-header">
                            <i class="fas fa-pencil-alt text-indigo-600"></i>
                            <h4 class="practice-title">Practice Exercise</h4>
                        </div>
                        <div id="practice-container-${lessonData.id}">
                            ${createPracticeExercise(lessonData.content.practice)}
                        </div>
                    </div>
                `;
            }
            
            // Add navigation
            html += `
                <div class="lesson-navigation">
                    <button class="btn btn-secondary" onclick="previousLesson()">
                        <i class="fas fa-arrow-left"></i>
                        Previous Lesson
                    </button>
                    <button class="btn btn-primary" onclick="completeLesson('${lessonData.id}')">
                        Complete Lesson
                        <i class="fas fa-arrow-right ml-1"></i>
                    </button>
                </div>
            `;
            
            html += '</div>';
            
            return html;
        }
        
        // Create practice exercise HTML
        function createPracticeExercise(practice) {
            let html = '';
            
            switch (practice.type) {
                case 'single':
                case 'multiple':
                    html = `
                        <div class="mb-4">
                            <h5 class="font-semibold mb-3">${practice.question}</h5>
                            <div class="space-y-2">
                                ${practice.options.map((option, index) => `
                                    <div class="quiz-option" onclick="selectPracticeOption(${index}, '${practice.type}')">
                                        <input type="${practice.type === 'single' ? 'radio' : 'checkbox'}" name="practice-option" value="${index}">
                                        <label>${option}</label>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        <button class="btn btn-primary" onclick="submitPractice('${practice.type}', ${JSON.stringify(practice).replace(/"/g, '&quot;')})">
                            Submit Answer
                        </button>
                        <div id="practice-feedback" class="hidden mt-3 p-3 rounded-lg text-sm"></div>
                    `;
                    break;
                    
                case 'fill-blank':
                    html = `
                        <div class="mb-4">
                            <h5 class="font-semibold mb-3">${practice.question}</h5>
                            <div class="blank-container">
                                ${practice.question.split('____').map((part, index) => {
                                    if (index < practice.question.split('____').length - 1) {
                                        return `${part}<input type="text" class="blank-input" data-blank-index="${index}">`;
                                    }
                                    return part;
                                }).join('')}
                            </div>
                        </div>
                        <button class="btn btn-primary" onclick="submitFillBlank(${JSON.stringify(practice).replace(/"/g, '&quot;')})">
                            Submit Answer
                        </button>
                        <div id="practice-feedback" class="hidden mt-3 p-3 rounded-lg text-sm"></div>
                    `;
                    break;
                    
                case 'drag-drop':
                    html = `
                        <div class="mb-4">
                            <h5 class="font-semibold mb-3">${practice.question}</h5>
                            <div class="drag-items-container mb-4">
                                ${practice.dragItems.map((item, index) => `
                                    <div class="drag-item" draggable="true" data-index="${index}">${item}</div>
                                `).join('')}
                            </div>
                            <div class="drop-targets-container">
                                ${practice.dropTargets.map((target, index) => `
                                    <div class="drop-target" data-index="${index}">${target}</div>
                                `).join('')}
                            </div>
                        </div>
                        <button class="btn btn-primary" onclick="submitDragDrop(${JSON.stringify(practice).replace(/"/g, '&quot;')})">
                            Submit Answer
                        </button>
                        <div id="practice-feedback" class="hidden mt-3 p-3 rounded-lg text-sm"></div>
                    `;
                    
                    // Add drag and drop event listeners after rendering
                    setTimeout(() => {
                        setupDragDrop();
                    }, 100);
                    break;
            }
            
            return html;
        }
        
        // Setup drag and drop
        function setupDragDrop() {
            const dragItems = document.querySelectorAll('.drag-item');
            const dropTargets = document.querySelectorAll('.drop-target');
            
            dragItems.forEach(item => {
                item.addEventListener('dragstart', handleDragStart);
                item.addEventListener('dragend', handleDragEnd);
            });
            
            dropTargets.forEach(target => {
                target.addEventListener('dragover', handleDragOver);
                target.addEventListener('drop', handleDrop);
            });
            
            window.dragDropAnswers = {};
        }
        
        // Drag and drop handlers
        function handleDragStart(e) {
            e.dataTransfer.setData('text/plain', e.target.dataset.index);
            e.target.classList.add('dragging');
        }
        
        function handleDragEnd(e) {
            e.target.classList.remove('dragging');
        }
        
        function handleDragOver(e) {
            e.preventDefault();
            e.target.classList.add('drag-over');
        }
        
        function handleDrop(e) {
            e.preventDefault();
            e.target.classList.remove('drag-over');
            
            const draggedIndex = e.dataTransfer.getData('text/plain');
            const targetIndex = e.target.dataset.index;
            
            window.dragDropAnswers[draggedIndex] = targetIndex;
            
            e.target.textContent = document.querySelector(`.drag-item[data-index="${draggedIndex}"]`).textContent + 
                          ' → ' + e.target.textContent;
        }
        
        // Select practice option
        let selectedPracticeOptions = [];
        
        function selectPracticeOption(index, type) {
            const option = document.querySelectorAll('.quiz-option')[index];
            const input = option.querySelector('input');
            
            if (type === 'single') {
                // Clear previous selection
                document.querySelectorAll('.quiz-option').forEach(opt => {
                    opt.classList.remove('selected');
                    opt.querySelector('input').checked = false;
                });
                
                option.classList.add('selected');
                input.checked = true;
                selectedPracticeOptions = [index];
            } else {
                // Multiple selection
                input.checked = !input.checked;
                option.classList.toggle('selected');
                
                if (input.checked) {
                    if (!selectedPracticeOptions.includes(index)) {
                        selectedPracticeOptions.push(index);
                    }
                } else {
                    selectedPracticeOptions = selectedPracticeOptions.filter(i => i !== index);
                }
            }
        }
        
        // Submit practice answer
        function submitPractice(type, practiceData) {
            const practice = JSON.parse(practiceData.replace(/&quot;/g, '"'));
            let isCorrect = false;
            const feedback = document.getElementById('practice-feedback');
            
            if (type === 'single') {
                isCorrect = selectedPracticeOptions[0] === practice.correct;
            } else if (type === 'multiple') {
                isCorrect = selectedPracticeOptions.length === practice.correct.length &&
                           selectedPracticeOptions.every(opt => practice.correct.includes(opt));
            }
            
            if (isCorrect) {
                feedback.className = 'mt-3 p-3 rounded-lg bg-green-100 text-green-800 text-sm';
                feedback.textContent = 'Correct! ' + practice.explanation;
                awardPoints(5, 'Practice exercise completed');
            } else {
                feedback.className = 'mt-3 p-3 rounded-lg bg-red-100 text-red-800 text-sm';
                feedback.textContent = 'Incorrect. ' + practice.explanation;
            }
            
            feedback.classList.remove('hidden');
            
            // Disable submit button
            event.target.disabled = true;
            event.target.textContent = 'Submitted';
        }
        
        // Submit fill blank
        function submitFillBlank(practiceData) {
            const practice = JSON.parse(practiceData.replace(/&quot;/g, '"'));
            const blankInputs = document.querySelectorAll('.blank-input');
            const feedback = document.getElementById('practice-feedback');
            
            const userAnswers = Array.from(blankInputs).map(input => input.value.trim().toLowerCase());
            const correctAnswers = Array.isArray(practice.correct) ? 
                practice.correct.map(a => a.toLowerCase()) : 
                [practice.correct.toLowerCase()];
            
            const isCorrect = userAnswers.every((answer, index) => {
                return correctAnswers.includes(answer);
            });
            
            if (isCorrect) {
                feedback.className = 'mt-3 p-3 rounded-lg bg-green-100 text-green-800 text-sm';
                feedback.textContent = 'Correct! ' + practice.explanation;
                awardPoints(5, 'Practice exercise completed');
            } else {
                feedback.className = 'mt-3 p-3 rounded-lg bg-red-100 text-red-800 text-sm';
                feedback.textContent = 'Incorrect. ' + practice.explanation;
            }
            
            feedback.classList.remove('hidden');
            
            // Disable submit button
            event.target.disabled = true;
            event.target.textContent = 'Submitted';
        }
        
        // Submit drag drop
        function submitDragDrop(practiceData) {
            const practice = JSON.parse(practiceData.replace(/&quot;/g, '"'));
            const feedback = document.getElementById('practice-feedback');
            
            const isCorrect = Object.keys(window.dragDropAnswers).length === practice.dragItems.length &&
                             Object.entries(window.dragDropAnswers).every(([dragIndex, dropIndex]) => {
                                 const dragItem = practice.dragItems[dragIndex];
                                 const dropTarget = practice.dropTargets[dropIndex];
                                 return practice.correct[dragItem] === dropTarget;
                             });
            
            if (isCorrect) {
                feedback.className = 'mt-3 p-3 rounded-lg bg-green-100 text-green-800 text-sm';
                feedback.textContent = 'Correct! ' + practice.explanation;
                awardPoints(5, 'Practice exercise completed');
            } else {
                feedback.className = 'mt-3 p-3 rounded-lg bg-red-100 text-red-800 text-sm';
                feedback.textContent = 'Incorrect. ' + practice.explanation;
            }
            
            feedback.classList.remove('hidden');
            
            // Disable submit button
            event.target.disabled = true;
            event.target.textContent = 'Submitted';
        }
        
        // Mark lesson as started
        function markLessonStarted(lessonId) {
            if (!lessonProgress[lessonId]) {
                lessonProgress[lessonId] = {
                    started: true,
                    completed: false,
                    startTime: new Date().toISOString()
                };
                
                // Save to database
                saveLessonProgress();
            }
        }
        
        // Complete lesson
        function completeLesson(lessonId) {
            if (!lessonProgress[lessonId]) {
                lessonProgress[lessonId] = {};
            }
            
            lessonProgress[lessonId].completed = true;
            lessonProgress[lessonId].completedTime = new Date().toISOString();
            
            // Save to database
            saveLessonProgress();
            
            // Award points
            awardPoints(20, 'Lesson completed');
            
            // Show success message
            showToast('success', 'Lesson Completed!', 'Great job! You\'ve completed this lesson.');
            
            // Navigate to next lesson
            setTimeout(() => {
                nextLesson();
            }, 1500);
        }
        
        // Save lesson progress to database
        function saveLessonProgress() {
            if (!currentUser) return;
            
            const userRef = database.ref('users/' + currentUser.uid);
            userRef.update({
                lessonProgress: lessonProgress,
                lastActiveDate: new Date().toDateString()
            }).catch(error => {
                console.error("Error saving lesson progress:", error);
            });
        }
        
        // Navigate to next lesson
        function nextLesson() {
            // Find current lesson index
            let currentUnitIndex = -1;
            let currentLessonIndex = -1;
            
            for (let i = 0; i < learningUnits.length; i++) {
                const lessonIndex = learningUnits[i].lessons.findIndex(l => l.id === currentLessonId);
                if (lessonIndex !== -1) {
                    currentUnitIndex = i;
                    currentLessonIndex = lessonIndex;
                    break;
                }
            }
            
            // Find next lesson
            if (currentUnitIndex !== -1 && currentLessonIndex !== -1) {
                // Check if there's a next lesson in current unit
                if (currentLessonIndex < learningUnits[currentUnitIndex].lessons.length - 1) {
                    const nextLesson = learningUnits[currentUnitIndex].lessons[currentLessonIndex + 1];
                    showLesson(nextLesson.id);
                    return;
                }
                
                // Check if there's a next unit
                if (currentUnitIndex < learningUnits.length - 1) {
                    const nextUnit = learningUnits[currentUnitIndex + 1];
                    if (nextUnit.lessons.length > 0) {
                        showLesson(nextUnit.lessons[0].id);
                        return;
                    }
                }
            }
            
            // No more lessons, show completion message
            showToast('success', 'Course Completed!', 'Congratulations! You\'ve completed all lessons.');
            
            // Update UI to show all units as completed
            loadLearningUnits();
        }
        
        // Navigate to previous lesson
        function previousLesson() {
            // Find current lesson index
            let currentUnitIndex = -1;
            let currentLessonIndex = -1;
            
            for (let i = 0; i < learningUnits.length; i++) {
                const lessonIndex = learningUnits[i].lessons.findIndex(l => l.id === currentLessonId);
                if (lessonIndex !== -1) {
                    currentUnitIndex = i;
                    currentLessonIndex = lessonIndex;
                    break;
                }
            }
            
            // Find previous lesson
            if (currentUnitIndex !== -1 && currentLessonIndex !== -1) {
                // Check if there's a previous lesson in current unit
                if (currentLessonIndex > 0) {
                    const prevLesson = learningUnits[currentUnitIndex].lessons[currentLessonIndex - 1];
                    showLesson(prevLesson.id);
                    return;
                }
                
                // Check if there's a previous unit
                if (currentUnitIndex > 0) {
                    const prevUnit = learningUnits[currentUnitIndex - 1];
                    if (prevUnit.lessons.length > 0) {
                        showLesson(prevUnit.lessons[prevUnit.lessons.length - 1].id);
                        return;
                    }
                }
            }
        }
        
        // Start pre-quiz
        function startPreQuiz() {
            if (!currentUser) {
                showToast('error', 'Sign in required', 'Please sign in to take the quiz.');
                showLoginModal();
                return;
            }
            
            console.log("Starting pre-quiz");
            
            // Hide pre-quiz introduction page
            document.getElementById('prequizPage').style.display = 'none';
            
            currentQuiz = [...preQuizQuestions];
            quizType = 'pre';
            currentQuestion = 0;
            score = 0;
            selectedOption = null;
            answerSubmitted = false;
            showQuiz();
        }
        
        // Start post-quiz
        function startPostQuiz() {
            if (!currentUser) {
                showToast('error', 'Sign in required', 'Please sign in to take the quiz.');
                showLoginModal();
                return;
            }
            
            currentQuiz = [...postQuizQuestions];
            quizType = 'post';
            currentQuestion = 0;
            score = 0;
            selectedOption = null;
            answerSubmitted = false;
            showQuiz();
        }
        
        // Show quiz modal
        function showQuiz() {
            console.log("Showing quiz modal");
            document.getElementById('quizModal').classList.add('active');
            document.getElementById('quizProgress').style.display = 'block';
            document.getElementById('quizContent').style.display = 'block';
            document.getElementById('quizResults').style.display = 'none';
            
            document.getElementById('quizTitle').textContent = quizType === 'pre' ? 'Pre-Quiz' : 'Post-Quiz';
            document.getElementById('currentQuestion').textContent = currentQuestion + 1;
            document.getElementById('totalQuestions').textContent = currentQuiz.length;
            document.getElementById('currentScore').textContent = score;
            document.getElementById('progressFill').style.width = ((currentQuestion + 1) / currentQuiz.length * 100) + '%';
            
            loadQuestion();
        }
        
        // Load question
        function loadQuestion() {
            const question = currentQuiz[currentQuestion];
            document.getElementById('questionText').textContent = question.question;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            
            // Reset buttons and feedback
            document.getElementById('submitButton').style.display = 'inline-flex';
            document.getElementById('submitButton').disabled = true;
            document.getElementById('nextButton').classList.add('hidden');
            document.getElementById('feedback').classList.add('hidden');
            answerSubmitted = false;
            
            // Load options based on question type
            switch (question.type) {
                case 'single':
                case 'multiple':
                    loadMultipleChoiceQuestion(question, optionsContainer);
                    break;
                case 'drag-drop':
                    loadDragDropQuestion(question, optionsContainer);
                    break;
                case 'fill-blank':
                    loadFillBlankQuestion(question, optionsContainer);
                    break;
                case 'matching':
                    loadMatchingQuestion(question, optionsContainer);
                    break;
            }
            
            document.getElementById('prevButton').classList.toggle('hidden', currentQuestion === 0);
            
            selectedOption = null;
        }
        
        // Function to load multiple choice questions (single or multiple)
        function loadMultipleChoiceQuestion(question, container) {
            question.options.forEach((option, index) => {
                const optionDiv = document.createElement('div');
                optionDiv.className = 'quiz-option';
                optionDiv.dataset.index = index;
                
                const input = document.createElement('input');
                input.type = question.type === 'single' ? 'radio' : 'checkbox';
                input.name = 'quiz-option';
                input.id = `option-${index}`;
                input.value = index;
                
                const label = document.createElement('label');
                label.htmlFor = `option-${index}`;
                label.textContent = option;
                
                optionDiv.appendChild(input);
                optionDiv.appendChild(label);
                
                optionDiv.onclick = () => selectOption(index, question.type);
                container.appendChild(optionDiv);
            });
        }
        
        // Function to load drag and drop questions
        function loadDragDropQuestion(question, container) {
            const dragItemsContainer = document.createElement('div');
            dragItemsContainer.className = 'drag-items-container mb-4';
            
            question.dragItems.forEach((item, index) => {
                const dragItem = document.createElement('div');
                dragItem.className = 'drag-item';
                dragItem.draggable = true;
                dragItem.textContent = item;
                dragItem.dataset.index = index;
                
                dragItem.addEventListener('dragstart', handleDragStart);
                dragItem.addEventListener('dragend', handleDragEnd);
                
                dragItemsContainer.appendChild(dragItem);
            });
            
            const dropTargetsContainer = document.createElement('div');
            dropTargetsContainer.className = 'drop-targets-container';
            
            question.dropTargets.forEach((target, index) => {
                const dropTarget = document.createElement('div');
                dropTarget.className = 'drop-target';
                dropTarget.textContent = target;
                dropTarget.dataset.index = index;
                
                dropTarget.addEventListener('dragover', handleDragOver);
                dropTarget.addEventListener('drop', handleDrop);
                
                dropTargetsContainer.appendChild(dropTarget);
            });
            
            container.appendChild(dragItemsContainer);
            container.appendChild(dropTargetsContainer);
            
            // Create a mapping object to store user's answers
            window.dragDropAnswers = {};
        }
        
        // Function to load fill in the blank questions
        function loadFillBlankQuestion(question, container) {
            const blankContainer = document.createElement('div');
            blankContainer.className = 'blank-container';
            
            // Split the question by blanks
            const parts = question.question.split('____');
            
            parts.forEach((part, index) => {
                if (part) {
                    const textSpan = document.createElement('span');
                    textSpan.textContent = part;
                    blankContainer.appendChild(textSpan);
                }
                
                // Add input field for each blank except the last one
                if (index < parts.length - 1) {
                    const input = document.createElement('input');
                    input.type = 'text';
                    input.className = 'blank-input';
                    input.dataset.blankIndex = index;
                    input.addEventListener('input', () => {
                        document.getElementById('submitButton').disabled = false;
                    });
                    blankContainer.appendChild(input);
                }
            });
            
            container.appendChild(blankContainer);
            
            // Create an array to store user's answers
            window.fillBlankAnswers = [];
        }
        
        // Function to load matching questions
        function loadMatchingQuestion(question, container) {
            const matchingContainer = document.createElement('div');
            matchingContainer.className = 'matching-container';
            
            const leftColumn = document.createElement('div');
            leftColumn.className = 'matching-column';
            
            const rightColumn = document.createElement('div');
            rightColumn.className = 'matching-column';
            
            question.pairs.forEach((pair, index) => {
                const leftItem = document.createElement('div');
                leftItem.className = 'matching-item';
                leftItem.textContent = pair.left;
                leftItem.dataset.index = index;
                leftColumn.appendChild(leftItem);
                
                const rightItem = document.createElement('div');
                rightItem.className = 'matching-item';
                rightItem.textContent = pair.right;
                rightItem.dataset.index = index;
                rightColumn.appendChild(rightItem);
            });
            
            matchingContainer.appendChild(leftColumn);
            matchingContainer.appendChild(rightColumn);
            container.appendChild(matchingContainer);
            
            // Create an array to store user's matches
            window.matchingAnswers = [];
            
            // Add event listeners for matching
            const leftItems = leftColumn.querySelectorAll('.matching-item');
            const rightItems = rightColumn.querySelectorAll('.matching-item');
            
            leftItems.forEach(item => {
                item.addEventListener('click', () => handleMatchingSelect(item, 'left'));
            });
            
            rightItems.forEach(item => {
                item.addEventListener('click', () => handleMatchingSelect(item, 'right'));
            });
        }
        
        // Functions to handle drag and drop
        function handleDragStart(e) {
            e.dataTransfer.setData('text/plain', e.target.dataset.index);
            e.target.classList.add('dragging');
        }
        
        function handleDragEnd(e) {
            e.target.classList.remove('dragging');
        }
        
        function handleDragOver(e) {
            e.preventDefault();
            e.target.classList.add('drag-over');
        }
        
        function handleDrop(e) {
            e.preventDefault();
            e.target.classList.remove('drag-over');
            
            const draggedIndex = e.dataTransfer.getData('text/plain');
            const targetIndex = e.target.dataset.index;
            
            // Store the mapping
            window.dragDropAnswers[draggedIndex] = targetIndex;
            
            // Visual feedback
            e.target.textContent = currentQuiz[currentQuestion].dragItems[draggedIndex] + ' → ' + 
                          currentQuiz[currentQuestion].dropTargets[targetIndex];
            
            document.getElementById('submitButton').disabled = false;
        }
        
        // Function to handle matching selection
        let selectedMatchingItem = null;
        
        function handleMatchingSelect(item, column) {
            if (selectedMatchingItem === null) {
                // First selection
                selectedMatchingItem = { item, column };
                item.classList.add('selected');
            } else if (selectedMatchingItem.column === column) {
                // Deselect if clicking same item
                selectedMatchingItem.item.classList.remove('selected');
                selectedMatchingItem = null;
            } else {
                // Match items
                const firstIndex = parseInt(selectedMatchingItem.item.dataset.index);
                const secondIndex = parseInt(item.dataset.index);
                
                // Store the match
                window.matchingAnswers[firstIndex] = secondIndex;
                
                // Visual feedback
                selectedMatchingItem.item.classList.remove('selected');
                selectedMatchingItem.item.classList.add('matched');
                item.classList.add('matched');
                
                selectedMatchingItem = null;
                document.getElementById('submitButton').disabled = false;
            }
        }
        
        // Updated selectOption function to handle multiple selection
        function selectOption(index, type) {
            if (answerSubmitted) return;
            
            const options = document.querySelectorAll('.quiz-option');
            
            if (type === 'single') {
                // Remove previous selection
                options.forEach(option => {
                    option.classList.remove('selected');
                    const input = option.querySelector('input');
                    if (input) input.checked = false;
                });
                
                // Add selection to clicked option
                options[index].classList.add('selected');
                const input = options[index].querySelector('input');
                if (input) input.checked = true;
                
                selectedOption = index;
            } else {
                // Multiple selection
                const input = options[index].querySelector('input');
                input.checked = !input.checked;
                
                if (input.checked) {
                    options[index].classList.add('selected');
                    if (!selectedOption) selectedOption = [];
                    selectedOption.push(index);
                } else {
                    options[index].classList.remove('selected');
                    if (selectedOption && selectedOption.includes(index)) {
                        selectedOption = selectedOption.filter(i => i !== index);
                        if (selectedOption.length === 0) selectedOption = null;
                    }
                }
            }
            
            // Enable submit button
            document.getElementById('submitButton').disabled = false;
        }
        
        // Updated submitAnswer function to handle different question types
        function submitAnswer() {
            if (answerSubmitted) return;
            
            const question = currentQuiz[currentQuestion];
            let isCorrect = false;
            const feedback = document.getElementById('feedback');
            
            switch (question.type) {
                case 'single':
                    isCorrect = selectedOption === question.correct;
                    break;
                case 'multiple':
                    if (!selectedOption || !Array.isArray(selectedOption)) {
                        isCorrect = false;
                    } else {
                        // Check if all selected options are correct and all correct options are selected
                        const correctSet = new Set(question.correct);
                        const selectedSet = new Set(selectedOption);
                        isCorrect = selectedOption.length === question.correct.length && 
                                     selectedOption.every(opt => correctSet.has(opt));
                    }
                    break;
                case 'drag-drop':
                    // Check if all drag items are correctly matched
                    isCorrect = Object.keys(window.dragDropAnswers).length === question.dragItems.length &&
                                 Object.entries(window.dragDropAnswers).every(([dragIndex, dropIndex]) => {
                                     const dragItem = question.dragItems[dragIndex];
                                     const dropTarget = question.dropTargets[dropIndex];
                                     return question.correct[dragItem] === dropTarget;
                                 });
                    break;
                case 'fill-blank':
                    // Check if all blanks are filled correctly
                    const blankInputs = document.querySelectorAll('.blank-input');
                    isCorrect = Array.from(blankInputs).every((input, index) => {
                        const userAnswer = input.value.trim().toLowerCase();
                        const correctAnswers = Array.isArray(question.correct) ? 
                            question.correct.map(a => a.toLowerCase()) : 
                            [question.correct.toLowerCase()];
                        return correctAnswers.includes(userAnswer);
                    });
                    break;
                case 'matching':
                    // Check if all matches are correct
                    isCorrect = window.matchingAnswers.length === question.pairs.length &&
                                 window.matchingAnswers.every((rightIndex, leftIndex) => {
                                     return leftIndex === rightIndex; // Assuming correct pairs are in order
                                 });
                    break;
            }
            
            if (isCorrect) {
                feedback.className = 'mb-4 p-3 rounded-lg bg-green-100 text-green-800 text-sm';
                feedback.textContent = 'Correct! ' + question.explanation;
                score++;
                
                // Award points
                awardPoints(10, 'Correct answer');
            } else {
                feedback.className = 'mb-4 p-3 rounded-lg bg-red-100 text-red-800 text-sm';
                feedback.textContent = 'Incorrect. ' + question.explanation;
            }
            
            feedback.classList.remove('hidden');
            document.getElementById('submitButton').style.display = 'none';
            document.getElementById('nextButton').classList.remove('hidden');
            document.getElementById('currentScore').textContent = score;
            
            // Mark answer as submitted
            answerSubmitted = true;
            
            // Show correct answers for visual feedback
            if (question.type === 'single' || question.type === 'multiple') {
                const options = document.querySelectorAll('.quiz-option');
                
                if (question.type === 'single') {
                    options[question.correct].classList.add('correct');
                    if (selectedOption !== null && selectedOption !== question.correct) {
                        options[selectedOption].classList.add('incorrect');
                    }
                } else {
                    question.correct.forEach(correctIndex => {
                        options[correctIndex].classList.add('correct');
                    });
                    
                    if (selectedOption && Array.isArray(selectedOption)) {
                        selectedOption.forEach(selectedIndex => {
                            if (!question.correct.includes(selectedIndex)) {
                                options[selectedIndex].classList.add('incorrect');
                            }
                        });
                    }
                }
            }
        }
        
        // Next question
        function nextQuestion() {
            currentQuestion++;
            
            if (currentQuestion >= currentQuiz.length) {
                showResults();
                return;
            }
            
            document.getElementById('currentQuestion').textContent = currentQuestion + 1;
            document.getElementById('progressFill').style.width = ((currentQuestion + 1) / currentQuiz.length * 100) + '%';
            loadQuestion();
        }
        
        // Previous question
        function previousQuestion() {
            if (currentQuestion > 0) {
                currentQuestion--;
                document.getElementById('currentQuestion').textContent = currentQuestion + 1;
                document.getElementById('progressFill').style.width = ((currentQuestion + 1) / currentQuiz.length * 100) + '%';
                loadQuestion();
            }
        }
        
        // Show quiz results
        function showResults() {
            document.getElementById('quizProgress').style.display = 'none';
            document.getElementById('quizContent').style.display = 'none';
            document.getElementById('quizResults').style.display = 'block';
            
            const percentage = Math.round((score / currentQuiz.length) * 100);
            document.getElementById('finalScore').textContent = `${score}/${currentQuiz.length}`;
            
            let message = '';
            if (percentage >= 80) {
                message = 'Excellent! You have a strong understanding of Group 1 elements.';
            } else if (percentage >= 60) {
                message = 'Good job! You have a solid foundation to build upon.';
            } else if (percentage >= 40) {
                message = 'Not bad! Pay attention to the learning materials to improve.';
            } else {
                message = 'Keep practicing! Review the materials carefully.';
            }
            
            document.getElementById('scoreMessage').textContent = message;
            
            // Save quiz result
            saveQuizResult(score, currentQuiz.length, quizType);
            
            // Show appropriate actions
            if (quizType === 'pre') {
                document.getElementById('postQuizActions').style.display = 'block';
                document.getElementById('finalActions').style.display = 'none';
            } else {
                document.getElementById('postQuizActions').style.display = 'none';
                document.getElementById('finalActions').style.display = 'block';
            }
        }
        
        // Complete pre-quiz and unlock main content
        function completePreQuiz() {
            if (!currentUser) return;
            
            console.log("Completing pre-quiz for user:", currentUser.uid);
            
            const userRef = database.ref('users/' + currentUser.uid);
            
            userRef.update({
                preQuizCompleted: true,
                preQuizScore: score,
                preQuizDate: firebase.database.ServerValue.TIMESTAMP
            }).then(() => {
                userData.preQuizCompleted = true;
                userData.preQuizScore = score;
                
                console.log("Pre-quiz completed, showing main app");
                
                // Award points for completing pre-quiz
                awardPoints(50, 'Completed pre-quiz');
                
                // Close quiz modal
                closeQuiz();
                
                // Show main app
                showMainApp();
                
                showToast('success', 'Pre-Quiz Complete!', 'You can now access the learning materials.');
            }).catch((error) => {
                console.error("Error updating pre-quiz status:", error);
                showToast('error', 'Error', 'Failed to save pre-quiz results.');
            });
        }
        
        // Save quiz result
        function saveQuizResult(score, totalQuestions, quizType) {
            const resultsRef = database.ref('quizResults').push();
            
            resultsRef.set({
                userId: currentUser.uid,
                userName: userData.displayName,
                score: score,
                totalQuestions: totalQuestions,
                percentage: Math.round((score / totalQuestions) * 100),
                quizType: quizType,
                topic: 'Group 1 - Alkali Metals',
                createdAt: firebase.database.ServerValue.TIMESTAMP
            }).catch((error) => {
                console.error("Error saving quiz result:", error);
            });
        }
        
        // Close quiz
        function closeQuiz() {
            console.log("Closing quiz modal");
            document.getElementById('quizModal').classList.remove('active');
            
            // If user hasn't completed pre-quiz, show pre-quiz introduction
            if (currentUser && userData && !userData.preQuizCompleted) {
                showPreQuizIntroduction();
            }
        }
        
        // Award points to user
        function awardPoints(points, reason) {
            if (!currentUser || !userData) return;
            
            const userRef = database.ref('users/' + currentUser.uid);
            
            const updates = {};
            updates['/points'] = (userData.points || 0) + points;
            updates['/lastActiveDate'] = new Date().toDateString();
            
            // Update streak
            const today = new Date().toDateString();
            const yesterday = new Date();
            yesterday.setDate(yesterday.getDate() - 1);
            const yesterdayString = yesterday.toDateString();
            
            if (userData.lastActiveDate === yesterdayString) {
                updates['/currentStreak'] = (userData.currentStreak || 1) + 1;
            } else if (userData.lastActiveDate !== today) {
                updates['/currentStreak'] = 1;
            }
            
            userRef.update(updates).then(() => {
                userData.points = updates['/points'];
                userData.currentStreak = updates['/currentStreak'];
                userData.lastActiveDate = updates['/lastActiveDate'];
                
                // Update UI
                document.getElementById('userPoints').textContent = userData.points;
                document.getElementById('userStreak').textContent = userData.currentStreak;
                
                showToast('success', 'Points Awarded', `+${points} points for ${reason}`);
            }).catch((error) => {
                console.error("Error awarding points:", error);
            });
        }
        
        // Load study groups
        function loadStudyGroups() {
            const container = document.getElementById('studyGroupsContainer');
            container.innerHTML = '<div class="spinner"></div>';
            
            const groupsRef = database.ref('studyGroups');
            
            groupsRef.orderByChild('createdAt').on('value', (snapshot) => {
                container.innerHTML = '';
                
                if (!snapshot.exists()) {
                    container.innerHTML = '<p class="text-gray-500 text-center">No study groups yet. Create one!</p>';
                    return;
                }
                
                const groupsArray = [];
                snapshot.forEach((childSnapshot) => {
                    groupsArray.push({
                        id: childSnapshot.key,
                        ...childSnapshot.val()
                    });
                });
                
                // Sort by creation date (newest first)
                groupsArray.sort((a, b) => {
                    return new Date(b.createdAt) - new Date(a.createdAt);
                });
                
                groupsArray.forEach(group => {
                    const groupCard = createStudyGroupCard(group);
                    container.appendChild(groupCard);
                });
            }, (error) => {
                console.error("Error loading study groups:", error);
                container.innerHTML = '<p class="text-gray-500 text-center">Error loading study groups.</p>';
            });
        }
        
        // Create study group card
        function createStudyGroupCard(group) {
            const card = document.createElement('div');
            card.className = 'study-group-card';
            
            const isMember = currentUser && group.members && group.members.includes(currentUser.uid);
            
            card.innerHTML = `
                <div class="flex justify-between items-start mb-3">
                    <div>
                        <h4 class="font-bold text-lg text-gray-800">${group.name}</h4>
                        <p class="text-sm text-gray-600">Created by ${group.creatorName}</p>
                    </div>
                    <button onclick="${isMember ? 'leaveStudyGroup' : 'joinStudyGroup'}('${group.id}')" 
                            class="btn ${isMember ? 'btn-danger' : 'btn-primary'} text-sm">
                        ${isMember ? 'Leave' : 'Join'}
                    </button>
                </div>
                
                <p class="text-gray-700 mb-3">${group.description}</p>
                
                <div class="flex justify-between items-center mb-3">
                    <div>
                        <span class="text-sm font-medium text-gray-700">Goal:</span>
                        <span class="text-sm text-gray-600">${group.goal}</span>
                    </div>
                    <div class="text-sm text-gray-600">
                        ${group.memberCount || 0}/${group.maxMembers} members
                    </div>
                </div>
                
                <div class="flex items-center">
                    <div class="flex -space-x-2">
                        ${(group.members || []).slice(0, 5).map(member => 
                            `<div class="member-avatar">${member.charAt(0).toUpperCase()}</div>`
                        ).join('')}
                        ${(group.memberCount || 0) > 5 ? 
                            `<div class="member-avatar">+${(group.memberCount || 0) - 5}</div>` : ''
                        }
                    </div>
                </div>
            `;
            
            return card;
        }
        
        // Create study group
        function createStudyGroup() {
            if (!currentUser) {
                showToast('error', 'Sign in required', 'Please sign in to create study groups.');
                return;
            }
            
            const name = document.getElementById('groupName').value;
            const description = document.getElementById('groupDescription').value;
            const goal = document.getElementById('groupGoal').value;
            const maxMembers = parseInt(document.getElementById('groupMaxMembers').value);
            
            showLoading();
            
            const groupsRef = database.ref('studyGroups').push();
            
            groupsRef.set({
                name: name,
                description: description,
                goal: goal,
                maxMembers: maxMembers,
                creatorId: currentUser.uid,
                creatorName: userData.displayName,
                members: [currentUser.uid],
                memberCount: 1,
                createdAt: firebase.database.ServerValue.TIMESTAMP
            }).then(() => {
                showToast('success', 'Group Created', 'Your study group has been created successfully.');
                closeCreateStudyGroup();
                document.getElementById('createStudyGroupForm').reset();
                
                // Award points
                awardPoints(20, 'Created study group');
            }).catch((error) => {
                console.error("Error creating study group:", error);
                showToast('error', 'Error', 'Failed to create study group.');
            }).finally(() => {
                hideLoading();
            });
        }
        
        // Join study group
        function joinStudyGroup(groupId) {
            if (!currentUser) {
                showToast('error', 'Sign in required', 'Please sign in to join study groups.');
                return;
            }
            
            const groupRef = database.ref('studyGroups/' + groupId);
            
            groupRef.once('value').then((snapshot) => {
                const group = snapshot.val();
                
                if (!group) {
                    showToast('error', 'Error', 'Study group not found.');
                    return;
                }
                
                // Make sure members is an array
                const members = Array.isArray(group.members) ? [...group.members] : [];
                
                if (members.includes(currentUser.uid)) {
                    showToast('info', 'Already Member', 'You are already a member of this group.');
                    return;
                }
                
                if ((group.memberCount || 0) >= (group.maxMembers || 10)) {
                    showToast('error', 'Group Full', 'This study group is already full.');
                    return;
                }
                
                // Add current user to members array
                members.push(currentUser.uid);
                
                const updates = {};
                updates['/members'] = members;
                updates['/memberCount'] = (group.memberCount || 0) + 1;
                
                groupRef.update(updates).then(() => {
                    showToast('success', 'Joined Group', 'You have successfully joined the study group.');
                    
                    // Award points
                    awardPoints(10, 'Joined study group');
                }).catch((error) => {
                    console.error("Error joining study group:", error);
                    showToast('error', 'Error', 'Failed to join study group.');
                });
            }).catch((error) => {
                console.error("Error getting study group:", error);
                showToast('error', 'Error', 'Failed to join study group.');
            });
        }
        
        // Leave study group
        function leaveStudyGroup(groupId) {
            if (!currentUser) {
                showToast('error', 'Sign in required', 'Please sign in to leave study groups.');
                return;
            }
            
            const groupRef = database.ref('studyGroups/' + groupId);
            
            groupRef.once('value').then((snapshot) => {
                const group = snapshot.val();
                
                // Make sure members is an array
                const members = Array.isArray(group.members) ? [...group.members] : [];
                
                // Filter out current user
                const updatedMembers = members.filter(member => member !== currentUser.uid);
                
                const updates = {};
                updates['/members'] = updatedMembers;
                updates['/memberCount'] = Math.max(0, (group.memberCount || 0) - 1);
                
                groupRef.update(updates).then(() => {
                    showToast('success', 'Left Group', 'You have successfully left the study group.');
                }).catch((error) => {
                    console.error("Error leaving study group:", error);
                    showToast('error', 'Error', 'Failed to leave study group.');
                });
            }).catch((error) => {
                console.error("Error getting study group:", error);
                showToast('error', 'Error', 'Failed to leave study group.');
            });
        }
        
        // Load comments
        function loadComments() {
            const container = document.getElementById('commentsContainer');
            container.innerHTML = '<div class="spinner"></div>';
            
            const commentsRef = database.ref('comments');
            
            commentsRef.orderByChild('createdAt').on('value', (snapshot) => {
                container.innerHTML = '';
                
                if (!snapshot.exists()) {
                    container.innerHTML = '<p class="text-gray-500 text-center">No comments yet. Be the first to comment!</p>';
                    return;
                }
                
                const commentsArray = [];
                snapshot.forEach((childSnapshot) => {
                    commentsArray.push({
                        id: childSnapshot.key,
                        ...childSnapshot.val()
                    });
                });
                
                // Sort by creation date (newest first)
                commentsArray.sort((a, b) => {
                    return new Date(b.createdAt) - new Date(a.createdAt);
                });
                
                commentsArray.forEach(comment => {
                    const commentDiv = createCommentElement(comment);
                    container.appendChild(commentDiv);
                });
            }, (error) => {
                console.error("Error loading comments:", error);
                container.innerHTML = '<p class="text-gray-500 text-center">Error loading comments.</p>';
            });
        }
        
        // Create comment element
        function createCommentElement(comment) {
            const commentDiv = document.createElement('div');
            commentDiv.className = 'comment';
            
            const date = comment.createdAt ? new Date(comment.createdAt).toLocaleDateString() : 'Unknown date';
            
            commentDiv.innerHTML = `
                <div class="comment-author">${comment.authorName || 'Anonymous'}</div>
                <div class="text-xs text-gray-500 mb-1">${date}</div>
                <div class="comment-text">${comment.text}</div>
            `;
            
            return commentDiv;
        }
        
        // Add comment
        function addComment() {
            if (!currentUser) {
                showToast('error', 'Sign in required', 'Please sign in to post comments.');
                return;
            }
            
            const commentInput = document.getElementById('commentInput');
            const commentText = commentInput.value.trim();
            
            if (!commentText) {
                showToast('error', 'Empty Comment', 'Please enter a comment before posting.');
                return;
            }
            
            showLoading();
            
            const commentsRef = database.ref('comments').push();
            
            commentsRef.set({
                authorId: currentUser.uid,
                authorName: userData.displayName,
                text: commentText,
                createdAt: firebase.database.ServerValue.TIMESTAMP
            }).then(() => {
                commentInput.value = '';
                showToast('success', 'Comment Posted', 'Your comment has been posted successfully.');
                
                // Award points
                awardPoints(5, 'Comment posted');
            }).catch((error) => {
                console.error("Error adding comment:", error);
                showToast('error', 'Error', 'Failed to post comment.');
            }).finally(() => {
                hideLoading();
            });
        }
        
        // Tab functionality
        function showTab(tabName) {
            // Hide all tab contents
            const tabContents = document.querySelectorAll('.tab-content');
            tabContents.forEach(content => {
                content.classList.remove('active');
            });
            
            // Remove active class from all tabs
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab content
            document.getElementById(tabName).classList.add('active');
            
            // Add active class to clicked tab
            event.target.classList.add('active');
        }
        
        // Auth tab functionality
        function switchAuthTab(tabName) {
            // Hide all auth contents
            const authContents = document.querySelectorAll('.auth-content');
            authContents.forEach(content => {
                content.classList.remove('active');
            });
            
            // Remove active class from all auth tabs
            const authTabs = document.querySelectorAll('.auth-tab');
            authTabs.forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected auth content
            document.getElementById(`${tabName}Form`).classList.add('active');
            
            // Add active class to clicked auth tab
            event.target.classList.add('active');
        }
        
        // Modal functions
        function showLoginModal() {
            document.getElementById('loginModal').classList.add('active');
        }
        
        function closeLoginModal() {
            document.getElementById('loginModal').classList.remove('active');
        }
        
        function showCreateStudyGroup() {
            document.getElementById('createStudyGroupModal').classList.add('active');
        }
        
        function closeCreateStudyGroup() {
            document.getElementById('createStudyGroupModal').classList.remove('active');
        }
        
        // Authentication functions
        function signInWithGoogle() {
            const provider = new firebase.auth.GoogleAuthProvider();
            
            auth.signInWithPopup(provider)
                .then((result) => {
                    const user = result.user;
                    console.log("Google sign in successful:", user.uid);
                    showToast('success', 'Welcome!', 'You have been successfully signed in with Google.');
                    closeLoginModal();
                    // Set flag to indicate user just signed in
                    justSignedIn = true;
                    // The onAuthStateChanged listener will handle showing the pre-quiz introduction
                })
                .catch((error) => {
                    const errorCode = error.code;
                    const errorMessage = error.message;
                    console.error("Google sign in error:", errorCode, errorMessage);
                    
                    if (errorCode === 'auth/unauthorized-domain') {
                        showToast('error', 'Domain not authorized', 
                            'Please add your GitHub Pages domain to the authorized domains in your Firebase project settings.');
                    } else {
                        showToast('error', 'Sign in failed', errorMessage);
                    }
                });
        }
        
        function signOut() {
            auth.signOut().then(() => {
                showToast('success', 'Signed out', 'You have been successfully signed out.');
                document.getElementById('landingPage').style.display = 'flex';
                document.getElementById('prequizPage').style.display = 'none';
                document.getElementById('mainApp').style.display = 'none';
            }).catch((error) => {
                console.error("Error signing out:", error);
            });
        }
        
        // Utility functions
        function isValidEmail(email) {
            return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
        }
        
        function showLoading() {
            document.getElementById('loadingOverlay').style.display = 'flex';
        }
        
        function hideLoading() {
            document.getElementById('loadingOverlay').style.display = 'none';
        }
        
        // Toast notification
        function showToast(type, title, message) {
            const toastContainer = document.getElementById('toastContainer');
            
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            
            let icon = 'fa-info-circle';
            if (type === 'success') icon = 'fa-check-circle';
            else if (type === 'error') icon = 'fa-exclamation-circle';
            
            toast.innerHTML = `
                <div class="toast-icon">
                    <i class="fas ${icon}"></i>
                </div>
                <div class="toast-message">
                    <div class="toast-title">${title}</div>
                    <div class="toast-description">${message}</div>
                </div>
            `;
            
            toastContainer.appendChild(toast);
            
            // Show toast
            setTimeout(() => {
                toast.classList.add('show');
            }, 100);
            
            // Hide toast after 3 seconds
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => {
                    toast.remove();
                }, 300);
            }, 3000);
        }
    </script>
</body>
</html>
