<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chemistry Mastery - Group 1 Alkali Metals</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f5f5f5;
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        /* Khan Academy Color Scheme */
        :root {
            --ka-primary: #0a66c2;
            --ka-secondary: #004182;
            --ka-accent: #00a4bd;
            --ka-light: #f0f9ff;
            --ka-dark: #1a1a1a;
            --ka-gray: #6e6e6e;
            --ka-light-gray: #e5e5e5;
            --ka-white: #ffffff;
            --ka-success: #0f9d58;
            --ka-warning: #f4b400;
            --ka-danger: #db4437;
        }
        
        /* Header Styles */
        .ka-header {
            background-color: var(--ka-white);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .ka-logo {
            display: flex;
            align-items: center;
            font-weight: 700;
            color: var(--ka-primary);
            font-size: 1.5rem;
        }
        
        .ka-logo i {
            margin-right: 8px;
            font-size: 1.8rem;
        }
        
        .ka-nav {
            display: flex;
            gap: 1.5rem;
        }
        
        .ka-nav-item {
            color: var(--ka-dark);
            font-weight: 500;
            text-decoration: none;
            padding: 0.5rem 0;
            border-bottom: 2px solid transparent;
            transition: all 0.2s ease;
        }
        
        .ka-nav-item:hover {
            color: var(--ka-primary);
            border-bottom-color: var(--ka-primary);
        }
        
        .ka-nav-item.active {
            color: var(--ka-primary);
            border-bottom-color: var(--ka-primary);
        }
        
        .ka-user-menu {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .ka-user-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background-color: var(--ka-light);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--ka-primary);
            font-weight: 600;
        }
        
        /* Sidebar Styles */
        .ka-sidebar {
            position: fixed;
            top: 64px;
            left: 0;
            width: 240px;
            height: calc(100vh - 64px);
            background-color: var(--ka-white);
            border-right: 1px solid var(--ka-light-gray);
            overflow-y: auto;
            z-index: 90;
            transition: transform 0.3s ease;
        }
        
        .ka-sidebar-header {
            padding: 1rem;
            border-bottom: 1px solid var(--ka-light-gray);
        }
        
        .ka-sidebar-title {
            font-weight: 600;
            color: var(--ka-dark);
            display: flex;
            align-items: center;
        }
        
        .ka-sidebar-title i {
            margin-right: 8px;
            color: var(--ka-primary);
        }
        
        .ka-sidebar-nav {
            padding: 0.5rem 0;
        }
        
        .ka-sidebar-item {
            display: flex;
            align-items: center;
            padding: 0.75rem 1rem;
            color: var(--ka-gray);
            text-decoration: none;
            transition: all 0.2s ease;
            border-left: 3px solid transparent;
        }
        
        .ka-sidebar-item:hover {
            background-color: var(--ka-light);
            color: var(--ka-primary);
        }
        
        .ka-sidebar-item.active {
            background-color: var(--ka-light);
            color: var(--ka-primary);
            border-left-color: var(--ka-primary);
            font-weight: 600;
        }
        
        .ka-sidebar-item i {
            margin-right: 12px;
            width: 20px;
            text-align: center;
        }
        
        .ka-sidebar-item .ka-badge {
            margin-left: auto;
            background-color: var(--ka-warning);
            color: white;
            font-size: 0.7rem;
            padding: 0.1rem 0.4rem;
            border-radius: 10px;
        }
        
        /* Main Content */
        .ka-main {
            margin-left: 240px;
            padding: 2rem;
            min-height: calc(100vh - 64px);
        }
        
        /* Learning Progress */
        .ka-progress-container {
            background-color: var(--ka-white);
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        
        .ka-progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        
        .ka-progress-title {
            font-weight: 600;
            color: var(--ka-dark);
        }
        
        .ka-progress-percentage {
            font-weight: 600;
            color: var(--ka-primary);
        }
        
        .ka-progress-bar {
            height: 8px;
            background-color: var(--ka-light-gray);
            border-radius: 4px;
            overflow: hidden;
        }
        
        .ka-progress-fill {
            height: 100%;
            background-color: var(--ka-primary);
            transition: width 0.5s ease;
        }
        
        /* Learning Path */
        .ka-learning-path {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 1.5rem 0;
            position: relative;
        }
        
        .ka-learning-path::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 4px;
            background-color: var(--ka-light-gray);
            z-index: 0;
        }
        
        .ka-path-step {
            background: var(--ka-white);
            border: 2px solid var(--ka-light-gray);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            z-index: 1;
            transition: all 0.3s ease;
        }
        
        .ka-path-step.active {
            border-color: var(--ka-primary);
            background-color: var(--ka-primary);
            color: white;
        }
        
        .ka-path-step.completed {
            border-color: var(--ka-success);
            background-color: var(--ka-success);
            color: white;
        }
        
        .ka-path-step.locked {
            border-color: var(--ka-gray);
            color: var(--ka-gray);
        }
        
        .ka-path-label {
            position: absolute;
            bottom: -25px;
            white-space: nowrap;
            font-size: 0.8rem;
            font-weight: 500;
            color: var(--ka-gray);
        }
        
        /* Content Cards */
        .ka-content-card {
            background-color: var(--ka-white);
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            transition: all 0.3s ease;
        }
        
        .ka-content-card:hover {
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .ka-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        
        .ka-card-title {
            font-weight: 600;
            color: var(--ka-dark);
            font-size: 1.25rem;
        }
        
        .ka-card-badge {
            background-color: var(--ka-light);
            color: var(--ka-primary);
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-weight: 500;
        }
        
        /* Video Player Placeholder */
        .ka-video-placeholder {
            background-color: #000;
            border-radius: 8px;
            height: 400px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 1.5rem;
            position: relative;
            overflow: hidden;
        }
        
        .ka-video-thumbnail {
            width: 100%;
            height: 100%;
            object-fit: cover;
            opacity: 0.7;
        }
        
        .ka-play-button {
            position: absolute;
            width: 80px;
            height: 80px;
            background-color: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .ka-play-button:hover {
            background-color: rgba(255, 255, 255, 0.3);
            transform: scale(1.05);
        }
        
        .ka-play-button i {
            color: white;
            font-size: 2rem;
            margin-left: 5px;
        }
        
        .ka-video-duration {
            position: absolute;
            bottom: 1rem;
            right: 1rem;
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.8rem;
        }
        
        /* Article Content */
        .ka-article {
            line-height: 1.6;
            color: var(--ka-dark);
        }
        
        .ka-article h3 {
            font-weight: 600;
            margin: 1.5rem 0 0.75rem;
            color: var(--ka-secondary);
        }
        
        .ka-article p {
            margin-bottom: 1rem;
        }
        
        .ka-article ul, .ka-article ol {
            margin-left: 1.5rem;
            margin-bottom: 1rem;
        }
        
        .ka-article li {
            margin-bottom: 0.5rem;
        }
        
        /* Key Points */
        .ka-key-points {
            background-color: var(--ka-light);
            border-left: 4px solid var(--ka-primary);
            padding: 1rem;
            border-radius: 0 8px 8px 0;
            margin: 1.5rem 0;
        }
        
        .ka-key-points h4 {
            font-weight: 600;
            color: var(--ka-secondary);
            margin-bottom: 0.5rem;
        }
        
        .ka-key-points ul {
            margin-left: 1.5rem;
        }
        
        /* Interactive Elements */
        .ka-interactive {
            background-color: var(--ka-light);
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
        }
        
        .ka-interactive-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        
        .ka-interactive-title {
            font-weight: 600;
            color: var(--ka-secondary);
        }
        
        .ka-try-button {
            background-color: var(--ka-primary);
            color: white;
            border: none;
            border-radius: 4px;
            padding: 0.5rem 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }
        
        .ka-try-button:hover {
            background-color: var(--ka-secondary);
        }
        
        /* Exercise Card */
        .ka-exercise-card {
            background-color: var(--ka-white);
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            border-left: 4px solid var(--ka-accent);
        }
        
        .ka-exercise-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        
        .ka-exercise-title {
            font-weight: 600;
            color: var(--ka-dark);
        }
        
        .ka-exercise-points {
            background-color: var(--ka-light);
            color: var(--ka-accent);
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-weight: 500;
        }
        
        .ka-exercise-content {
            margin-bottom: 1rem;
        }
        
        .ka-exercise-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.75rem;
        }
        
        .ka-option {
            background-color: var(--ka-light);
            border: 1px solid var(--ka-light-gray);
            border-radius: 4px;
            padding: 0.75rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .ka-option:hover {
            border-color: var(--ka-primary);
            background-color: rgba(10, 102, 194, 0.05);
        }
        
        .ka-option.selected {
            border-color: var(--ka-primary);
            background-color: rgba(10, 102, 194, 0.1);
        }
        
        .ka-option.correct {
            border-color: var(--ka-success);
            background-color: rgba(15, 157, 88, 0.1);
        }
        
        .ka-option.incorrect {
            border-color: var(--ka-danger);
            background-color: rgba(219, 68, 55, 0.1);
        }
        
        .ka-explanation {
            margin-top: 1rem;
            padding: 0.75rem;
            background-color: var(--ka-light);
            border-radius: 4px;
            font-size: 0.9rem;
            display: none;
        }
        
        .ka-explanation.show {
            display: block;
        }
        
        /* Discussion Section */
        .ka-discussion-card {
            background-color: var(--ka-white);
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        
        .ka-discussion-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        
        .ka-discussion-title {
            font-weight: 600;
            color: var(--ka-dark);
        }
        
        .ka-new-discussion {
            background-color: var(--ka-primary);
            color: white;
            border: none;
            border-radius: 4px;
            padding: 0.5rem 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }
        
        .ka-new-discussion:hover {
            background-color: var(--ka-secondary);
        }
        
        .ka-comment {
            padding: 1rem;
            border-bottom: 1px solid var(--ka-light-gray);
        }
        
        .ka-comment:last-child {
            border-bottom: none;
        }
        
        .ka-comment-header {
            display: flex;
            align-items: center;
            margin-bottom: 0.5rem;
        }
        
        .ka-comment-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background-color: var(--ka-light);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--ka-primary);
            font-weight: 600;
            margin-right: 0.75rem;
        }
        
        .ka-comment-author {
            font-weight: 600;
            color: var(--ka-dark);
        }
        
        .ka-comment-date {
            color: var(--ka-gray);
            font-size: 0.8rem;
            margin-left: 0.5rem;
        }
        
        .ka-comment-text {
            color: var(--ka-dark);
            line-height: 1.5;
        }
        
        .ka-comment-actions {
            display: flex;
            gap: 1rem;
            margin-top: 0.5rem;
        }
        
        .ka-comment-action {
            color: var(--ka-gray);
            font-size: 0.8rem;
            cursor: pointer;
            display: flex;
            align-items: center;
        }
        
        .ka-comment-action i {
            margin-right: 0.25rem;
        }
        
        .ka-comment-action:hover {
            color: var(--ka-primary);
        }
        
        /* Tips Section */
        .ka-tip-card {
            background-color: var(--ka-light);
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            border-left: 4px solid var(--ka-warning);
        }
        
        .ka-tip-header {
            display: flex;
            align-items: center;
            margin-bottom: 0.75rem;
        }
        
        .ka-tip-icon {
            color: var(--ka-warning);
            font-size: 1.25rem;
            margin-right: 0.5rem;
        }
        
        .ka-tip-title {
            font-weight: 600;
            color: var(--ka-dark);
        }
        
        .ka-tip-content {
            color: var(--ka-dark);
            line-height: 1.5;
        }
        
        /* Mobile Menu Toggle */
        .ka-menu-toggle {
            display: none;
            position: fixed;
            top: 1rem;
            left: 1rem;
            z-index: 101;
            background-color: var(--ka-white);
            border: none;
            border-radius: 4px;
            padding: 0.5rem;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .ka-sidebar {
                transform: translateX(-100%);
            }
            
            .ka-sidebar.active {
                transform: translateX(0);
            }
            
            .ka-main {
                margin-left: 0;
            }
            
            .ka-menu-toggle {
                display: block;
            }
            
            .ka-nav {
                display: none;
            }
            
            .ka-learning-path {
                flex-direction: column;
                gap: 2rem;
            }
            
            .ka-learning-path::before {
                width: 4px;
                height: 100%;
                top: 0;
                left: 50%;
                right: auto;
                transform: translateX(-50%);
            }
            
            .ka-exercise-options {
                grid-template-columns: 1fr;
            }
        }
        
        /* Landing Page Styles */
        .ka-landing {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: var(--ka-white);
        }
        
        .ka-landing-card {
            background-color: var(--ka-white);
            border-radius: 8px;
            padding: 2rem;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            text-align: center;
        }
        
        .ka-landing-logo {
            font-size: 3rem;
            color: var(--ka-primary);
            margin-bottom: 1rem;
        }
        
        .ka-landing-title {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--ka-dark);
            margin-bottom: 1rem;
        }
        
        .ka-landing-subtitle {
            color: var(--ka-gray);
            margin-bottom: 2rem;
        }
        
        .ka-landing-button {
            background-color: var(--ka-primary);
            color: white;
            border: none;
            border-radius: 4px;
            padding: 0.75rem 1.5rem;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s ease;
            width: 100%;
            margin-bottom: 1rem;
        }
        
        .ka-landing-button:hover {
            background-color: var(--ka-secondary);
        }
        
        .ka-landing-button-secondary {
            background-color: transparent;
            color: var(--ka-primary);
            border: 1px solid var(--ka-primary);
        }
        
        .ka-landing-button-secondary:hover {
            background-color: var(--ka-light);
        }
        
        /* Modal Styles */
        .ka-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }
        
        .ka-modal.active {
            display: flex;
        }
        
        .ka-modal-content {
            background-color: var(--ka-white);
            border-radius: 8px;
            max-width: 500px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
        }
        
        .ka-modal-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--ka-light-gray);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .ka-modal-title {
            font-weight: 600;
            color: var(--ka-dark);
            font-size: 1.25rem;
        }
        
        .ka-modal-close {
            background: none;
            border: none;
            font-size: 1.25rem;
            color: var(--ka-gray);
            cursor: pointer;
            transition: color 0.2s ease;
        }
        
        .ka-modal-close:hover {
            color: var(--ka-dark);
        }
        
        .ka-modal-body {
            padding: 1.5rem;
        }
        
        .ka-form-group {
            margin-bottom: 1.5rem;
        }
        
        .ka-form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--ka-dark);
        }
        
        .ka-form-input {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--ka-light-gray);
            border-radius: 4px;
            font-size: 1rem;
            transition: border-color 0.2s ease;
        }
        
        .ka-form-input:focus {
            outline: none;
            border-color: var(--ka-primary);
            box-shadow: 0 0 0 2px rgba(10, 102, 194, 0.2);
        }
        
        .ka-form-button {
            background-color: var(--ka-primary);
            color: white;
            border: none;
            border-radius: 4px;
            padding: 0.75rem 1.5rem;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s ease;
            width: 100%;
        }
        
        .ka-form-button:hover {
            background-color: var(--ka-secondary);
        }
        
        .ka-form-divider {
            text-align: center;
            margin: 1.5rem 0;
            position: relative;
        }
        
        .ka-form-divider::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 1px;
            background-color: var(--ka-light-gray);
        }
        
        .ka-form-divider span {
            background-color: var(--ka-white);
            padding: 0 1rem;
            position: relative;
            color: var(--ka-gray);
        }
        
        .ka-google-button {
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: var(--ka-white);
            color: var(--ka-dark);
            border: 1px solid var(--ka-light-gray);
            border-radius: 4px;
            padding: 0.75rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            width: 100%;
        }
        
        .ka-google-button:hover {
            background-color: var(--ka-light);
        }
        
        .ka-google-button i {
            margin-right: 0.5rem;
            color: var(--ka-danger);
        }
        
        /* Toast Notification */
        .ka-toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: var(--ka-white);
            padding: 1rem;
            border-radius: 4px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 2000;
            display: flex;
            align-items: center;
            transform: translateX(400px);
            transition: transform 0.3s ease;
            max-width: 350px;
        }
        
        .ka-toast.show {
            transform: translateX(0);
        }
        
        .ka-toast-icon {
            margin-right: 0.75rem;
            font-size: 1.25rem;
        }
        
        .ka-toast.success .ka-toast-icon {
            color: var(--ka-success);
        }
        
        .ka-toast.error .ka-toast-icon {
            color: var(--ka-danger);
        }
        
        .ka-toast.info .ka-toast-icon {
            color: var(--ka-primary);
        }
        
        .ka-toast-message {
            flex: 1;
        }
        
        .ka-toast-title {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }
        
        .ka-toast-description {
            font-size: 0.9rem;
            color: var(--ka-gray);
        }
        
        /* Loading Spinner */
        .ka-loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 3000;
        }
        
        .ka-spinner {
            border: 4px solid var(--ka-light-gray);
            border-top: 4px solid var(--ka-primary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Quiz Styles */
        .ka-quiz-container {
            background-color: var(--ka-white);
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        
        .ka-quiz-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }
        
        .ka-quiz-title {
            font-weight: 600;
            color: var(--ka-dark);
            font-size: 1.25rem;
        }
        
        .ka-quiz-progress {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--ka-gray);
            font-size: 0.9rem;
        }
        
        .ka-quiz-progress-bar {
            width: 150px;
            height: 6px;
            background-color: var(--ka-light-gray);
            border-radius: 3px;
            overflow: hidden;
        }
        
        .ka-quiz-progress-fill {
            height: 100%;
            background-color: var(--ka-primary);
            transition: width 0.3s ease;
        }
        
        .ka-question {
            font-weight: 500;
            color: var(--ka-dark);
            margin-bottom: 1.5rem;
            font-size: 1.1rem;
        }
        
        .ka-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        
        .ka-option {
            background-color: var(--ka-light);
            border: 1px solid var(--ka-light-gray);
            border-radius: 4px;
            padding: 1rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .ka-option:hover {
            border-color: var(--ka-primary);
            background-color: rgba(10, 102, 194, 0.05);
        }
        
        .ka-option.selected {
            border-color: var(--ka-primary);
            background-color: rgba(10, 102, 194, 0.1);
        }
        
        .ka-option.correct {
            border-color: var(--ka-success);
            background-color: rgba(15, 157, 88, 0.1);
        }
        
        .ka-option.incorrect {
            border-color: var(--ka-danger);
            background-color: rgba(219, 68, 55, 0.1);
        }
        
        .ka-explanation {
            padding: 1rem;
            background-color: var(--ka-light);
            border-radius: 4px;
            margin-bottom: 1.5rem;
            display: none;
        }
        
        .ka-explanation.show {
            display: block;
        }
        
        .ka-explanation-title {
            font-weight: 600;
            color: var(--ka-dark);
            margin-bottom: 0.5rem;
        }
        
        .ka-quiz-actions {
            display: flex;
            justify-content: space-between;
        }
        
        .ka-quiz-button {
            background-color: var(--ka-primary);
            color: white;
            border: none;
            border-radius: 4px;
            padding: 0.75rem 1.5rem;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }
        
        .ka-quiz-button:hover {
            background-color: var(--ka-secondary);
        }
        
        .ka-quiz-button-secondary {
            background-color: transparent;
            color: var(--ka-primary);
            border: 1px solid var(--ka-primary);
        }
        
        .ka-quiz-button-secondary:hover {
            background-color: var(--ka-light);
        }
        
        .ka-quiz-results {
            text-align: center;
            padding: 2rem;
        }
        
        .ka-quiz-score {
            font-size: 3rem;
            font-weight: 700;
            color: var(--ka-primary);
            margin-bottom: 1rem;
        }
        
        .ka-quiz-message {
            font-size: 1.1rem;
            color: var(--ka-dark);
            margin-bottom: 2rem;
        }
        
        /* Study Groups */
        .ka-study-group {
            background-color: var(--ka-white);
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        
        .ka-study-group-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        
        .ka-study-group-title {
            font-weight: 600;
            color: var(--ka-dark);
        }
        
        .ka-study-group-members {
            display: flex;
            align-items: center;
            margin-bottom: 1rem;
        }
        
        .ka-member-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background-color: var(--ka-light);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--ka-primary);
            font-weight: 600;
            font-size: 0.8rem;
            margin-right: -10px;
            border: 2px solid white;
        }
        
        .ka-study-group-description {
            color: var(--ka-dark);
            margin-bottom: 1rem;
        }
        
        .ka-study-group-goal {
            display: flex;
            align-items: center;
            margin-bottom: 1rem;
        }
        
        .ka-study-group-goal i {
            color: var(--ka-primary);
            margin-right: 0.5rem;
        }
        
        .ka-study-group-actions {
            display: flex;
            justify-content: flex-end;
        }
        
        .ka-join-button {
            background-color: var(--ka-primary);
            color: white;
            border: none;
            border-radius: 4px;
            padding: 0.5rem 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }
        
        .ka-join-button:hover {
            background-color: var(--ka-secondary);
        }
        
        .ka-leave-button {
            background-color: transparent;
            color: var(--ka-danger);
            border: 1px solid var(--ka-danger);
        }
        
        .ka-leave-button:hover {
            background-color: rgba(219, 68, 55, 0.1);
        }
        
        /* Element Cards */
        .ka-element-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }
        
        .ka-element-card {
            background-color: var(--ka-white);
            border-radius: 8px;
            padding: 1.5rem;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            transition: all 0.3s ease;
        }
        
        .ka-element-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .ka-element-image {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            margin: 0 auto 1rem;
            object-fit: cover;
            border: 3px solid var(--ka-light-gray);
        }
        
        .ka-element-name {
            font-weight: 600;
            color: var(--ka-dark);
            margin-bottom: 0.25rem;
        }
        
        .ka-element-symbol {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--ka-primary);
            margin-bottom: 0.5rem;
        }
        
        .ka-element-atomic {
            color: var(--ka-gray);
            font-size: 0.9rem;
        }
        
        /* Comparison Table */
        .ka-comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 1.5rem 0;
            background-color: var(--ka-white);
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        
        .ka-comparison-table th {
            background-color: var(--ka-primary);
            color: white;
            padding: 0.75rem;
            text-align: left;
            font-weight: 500;
        }
        
        .ka-comparison-table td {
            padding: 0.75rem;
            border-bottom: 1px solid var(--ka-light-gray);
        }
        
        .ka-comparison-table tr:last-child td {
            border-bottom: none;
        }
        
        .ka-comparison-table tr:nth-child(even) {
            background-color: var(--ka-light);
        }
        
        .ka-comparison-table tr:hover {
            background-color: rgba(10, 102, 194, 0.05);
        }
    </style>
</head>
<body>
    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="ka-loading" style="display: none;">
        <div class="ka-spinner"></div>
    </div>
    
    <!-- Landing Page (shown when user hasn't signed in) -->
    <div id="landingPage" class="ka-landing">
        <div class="ka-landing-card">
            <div class="ka-landing-logo">
                <i class="fas fa-atom"></i>
            </div>
            <h1 class="ka-landing-title">Chemistry Mastery</h1>
            <p class="ka-landing-subtitle">Master Group 1 Alkali Metals through Interactive Learning</p>
            
            <div class="ka-learning-path">
                <div class="ka-path-step active">
                    <i class="fas fa-play"></i>
                    <span class="ka-path-label">Pre-Quiz</span>
                </div>
                <div class="ka-path-step locked">
                    <i class="fas fa-lock"></i>
                    <span class="ka-path-label">Learn</span>
                </div>
                <div class="ka-path-step locked">
                    <i class="fas fa-lock"></i>
                    <span class="ka-path-label">Post-Quiz</span>
                </div>
            </div>
            
            <button onclick="showLoginModal()" class="ka-landing-button">
                Sign In to Begin
            </button>
            <button onclick="signInWithGoogle()" class="ka-landing-button ka-landing-button-secondary">
                <i class="fab fa-google"></i>
                Continue with Google
            </button>
        </div>
    </div>
    
    <!-- Pre-Quiz Introduction Page (shown after sign-in) -->
    <div id="prequizPage" style="display: none;">
        <div class="ka-main">
            <div class="ka-content-card">
                <div class="ka-card-header">
                    <h2 class="ka-card-title">Pre-Assessment Quiz</h2>
                    <span class="ka-card-badge">7 questions</span>
                </div>
                
                <div class="ka-article">
                    <p>Before we begin learning about Group 1 Alkali Metals, let's check your current knowledge. This quiz will help us understand your starting point and personalize your learning experience.</p>
                    
                    <div class="ka-key-points">
                        <h4>What to expect:</h4>
                        <ul>
                            <li>7 interactive questions covering basic concepts</li>
                            <li>No time limit - take your time to think through each question</li>
                            <li>Immediate feedback on your answers</li>
                            <li>Results will be saved to your profile</li>
                        </ul>
                    </div>
                    
                    <p>Don't worry if you don't know all the answers - this is just a starting point! The goal is to measure your progress as you learn.</p>
                </div>
                
                <button onclick="startPreQuiz()" class="ka-try-button" style="width: 100%; margin-top: 1.5rem;">
                    Start Pre-Quiz
                </button>
            </div>
        </div>
    </div>
    
    <!-- Main App (shown after pre-quiz completion) -->
    <div id="mainApp" style="display: none;">
        <!-- Header -->
        <header class="ka-header">
            <div class="container mx-auto px-4 py-3 flex justify-between items-center">
                <div class="ka-logo">
                    <i class="fas fa-atom"></i>
                    <span>Chemistry Mastery</span>
                </div>
                
                <nav class="ka-nav">
                    <a href="#" class="ka-nav-item active">Dashboard</a>
                    <a href="#" class="ka-nav-item">Courses</a>
                    <a href="#" class="ka-nav-item">Resources</a>
                    <a href="#" class="ka-nav-item">Discussion</a>
                </nav>
                
                <div class="ka-user-menu">
                    <div class="flex items-center gap-3">
                        <div class="flex items-center">
                            <i class="fas fa-coins text-yellow-500 mr-1"></i>
                            <span id="userPoints">0</span>
                        </div>
                        <div class="flex items-center">
                            <i class="fas fa-fire text-orange-500 mr-1"></i>
                            <span id="userStreak">0</span>
                        </div>
                        <div class="ka-user-avatar" id="userAvatar">U</div>
                    </div>
                </div>
            </div>
        </header>
        
        <!-- Sidebar -->
        <aside class="ka-sidebar" id="sidebar">
            <div class="ka-sidebar-header">
                <div class="ka-sidebar-title">
                    <i class="fas fa-book"></i>
                    <span>Group 1: Alkali Metals</span>
                </div>
            </div>
            
            <nav class="ka-sidebar-nav">
                <a href="#" class="ka-sidebar-item active" onclick="navigateToSection('overview')">
                    <i class="fas fa-home"></i>
                    <span>Overview</span>
                </a>
                <a href="#" class="ka-sidebar-item" onclick="navigateToSection('elements')">
                    <i class="fas fa-th"></i>
                    <span>Elements</span>
                    <span class="ka-badge">6</span>
                </a>
                <a href="#" class="ka-sidebar-item" onclick="navigateToSection('properties')">
                    <i class="fas fa-flask"></i>
                    <span>Properties</span>
                </a>
                <a href="#" class="ka-sidebar-item" onclick="navigateToSection('reactions')">
                    <i class="fas fa-vial"></i>
                    <span>Reactions</span>
                </a>
                <a href="#" class="ka-sidebar-item" onclick="navigateToSection('study-groups')">
                    <i class="fas fa-users"></i>
                    <span>Study Groups</span>
                </a>
                <a href="#" class="ka-sidebar-item" onclick="navigateToSection('discussion')">
                    <i class="fas fa-comments"></i>
                    <span>Discussion</span>
                </a>
                <a href="#" class="ka-sidebar-item" onclick="navigateToSection('quiz')">
                    <i class="fas fa-graduation-cap"></i>
                    <span>Final Quiz</span>
                </a>
            </nav>
        </aside>
        
        <!-- Menu Toggle Button (Mobile) -->
        <button class="ka-menu-toggle" onclick="toggleSidebar()">
            <i class="fas fa-bars"></i>
        </button>
        
        <!-- Main Content -->
        <main class="ka-main">
            <!-- Learning Progress -->
            <div class="ka-progress-container">
                <div class="ka-progress-header">
                    <div class="ka-progress-title">Your Learning Progress</div>
                    <div class="ka-progress-percentage">0%</div>
                </div>
                <div class="ka-progress-bar">
                    <div class="ka-progress-fill" style="width: 0%"></div>
                </div>
            </div>
            
            <!-- Learning Path -->
            <div class="ka-learning-path">
                <div class="ka-path-step completed">
                    <i class="fas fa-check"></i>
                    <span class="ka-path-label">Pre-Quiz</span>
                </div>
                <div class="ka-path-step active">
                    <i class="fas fa-book-open"></i>
                    <span class="ka-path-label">Learn</span>
                </div>
                <div class="ka-path-step">
                    <i class="fas fa-graduation-cap"></i>
                    <span class="ka-path-label">Post-Quiz</span>
                </div>
            </div>
            
            <!-- Overview Section -->
            <div id="overview-section" class="content-section">
                <!-- Video Lesson -->
                <div class="ka-video-placeholder">
                    <img src="https://images.unsplash.com/photo-1532094349884-543bc11b234d?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1170&q=80" alt="Chemistry lesson" class="ka-video-thumbnail">
                    <div class="ka-play-button">
                        <i class="fas fa-play"></i>
                    </div>
                    <div class="ka-video-duration">12:45</div>
                </div>
                
                <!-- Article Content -->
                <div class="ka-content-card">
                    <div class="ka-card-header">
                        <h2 class="ka-card-title">Introduction to Group 1: Alkali Metals</h2>
                        <span class="ka-card-badge">Beginner</span>
                    </div>
                    
                    <div class="ka-article">
                        <p>Group 1 elements, known as the <strong>alkali metals</strong>, occupy the first column of the periodic table. They consist of lithium (Li), sodium (Na), potassium (K), rubidium (Rb), cesium (Cs), and francium (Fr). These elements share similar properties because they all have <strong>one electron in their outer shell</strong>, which they readily lose to form +1 ions.</p>
                        
                        <h3>Key Characteristics</h3>
                        <p>Alkali metals are <strong>soft, shiny metals</strong> with low densities and low melting points. Their reactivity increases as you move down the group. Due to their <strong>high reactivity</strong>, they are never found free in nature but always occur in compounds, often as chlorides, carbonates, or sulfates.</p>
                        
                        <div class="ka-key-points">
                            <h4>Remember</h4>
                            <p>Group 1 metals are so reactive they must be stored under oil to prevent reaction with air and moisture!</p>
                        </div>
                        
                        <h3>Real-World Applications</h3>
                        <p>Alkali metals have numerous practical applications in our daily lives:</p>
                        <ul>
                            <li><strong>Lithium</strong> is used in batteries for electronic devices and electric vehicles</li>
                            <li><strong>Sodium</strong> is essential for biological processes and used in street lighting</li>
                            <li><strong>Potassium</strong> is a vital nutrient for plants and used in fertilizers</li>
                        </ul>
                    </div>
                    
                    <button class="ka-try-button">Mark as Complete</button>
                </div>
                
                <!-- Interactive Exercise -->
                <div class="ka-exercise-card">
                    <div class="ka-exercise-header">
                        <h3 class="ka-exercise-title">Quick Check</h3>
                        <span class="ka-exercise-points">+5 XP</span>
                    </div>
                    
                    <div class="ka-exercise-content">
                        <p>Which of the following is NOT a property of Group 1 alkali metals?</p>
                    </div>
                    
                    <div class="ka-exercise-options">
                        <div class="ka-option" onclick="selectOption(this, false)">
                            Low density
                        </div>
                        <div class="ka-option" onclick="selectOption(this, false)">
                            Form +1 ions
                        </div>
                        <div class="ka-option" onclick="selectOption(this, true)">
                            High melting points
                        </div>
                        <div class="ka-option" onclick="selectOption(this, false)">
                            Good conductors of electricity
                        </div>
                    </div>
                    
                    <div class="ka-explanation" id="explanation1">
                        <h4 class="ka-explanation-title">Explanation</h4>
                        <p>Group 1 metals actually have very low melting points compared to most other metals. For example, sodium melts at just 97.8°C, which is below the boiling point of water.</p>
                    </div>
                    
                    <button class="ka-try-button" onclick="checkAnswer()">Submit Answer</button>
                </div>
                
                <!-- Tips Section -->
                <div class="ka-tip-card">
                    <div class="ka-tip-header">
                        <i class="fas fa-lightbulb ka-tip-icon"></i>
                        <h3 class="ka-tip-title">Study Tip</h3>
                    </div>
                    <div class="ka-tip-content">
                        <p>When studying the reactivity trend of Group 1 metals, remember that as you go down the group, the atomic radius increases and the outer electron is further from the nucleus. This makes it easier to lose the electron, increasing reactivity.</p>
                    </div>
                </div>
            </div>
            
            <!-- Elements Section -->
            <div id="elements-section" class="content-section" style="display: none;">
                <div class="ka-content-card">
                    <div class="ka-card-header">
                        <h2 class="ka-card-title">Meet the Elements</h2>
                        <span class="ka-card-badge">Interactive</span>
                    </div>
                    
                    <div class="ka-element-grid">
                        <div class="ka-element-card">
                            <img src="https://upload.wikimedia.org/wikipedia/commons/e/ed/Lithiumcut_cropped.jpg" alt="Lithium" class="ka-element-image">
                            <div class="ka-element-name">Lithium</div>
                            <div class="ka-element-symbol">Li</div>
                            <div class="ka-element-atomic">Atomic Number: 3</div>
                        </div>
                        <div class="ka-element-card">
                            <img src="https://upload.wikimedia.org/wikipedia/commons/2/27/Na_%28Sodium%29.jpg" alt="Sodium" class="ka-element-image">
                            <div class="ka-element-name">Sodium</div>
                            <div class="ka-element-symbol">Na</div>
                            <div class="ka-element-atomic">Atomic Number: 11</div>
                        </div>
                        <div class="ka-element-card">
                            <img src="https://cdn.britannica.com/77/131177-050-79292189/fragments-Potassium-metal.jpg" alt="Potassium" class="ka-element-image">
                            <div class="ka-element-name">Potassium</div>
                            <div class="ka-element-symbol">K</div>
                            <div class="ka-element-atomic">Atomic Number: 19</div>
                        </div>
                        <div class="ka-element-card">
                            <img src="https://upload.wikimedia.org/wikipedia/commons/c/c9/Rb5.JPG" alt="Rubidium" class="ka-element-image">
                            <div class="ka-element-name">Rubidium</div>
                            <div class="ka-element-symbol">Rb</div>
                            <div class="ka-element-atomic">Atomic Number: 37</div>
                        </div>
                        <div class="ka-element-card">
                            <img src="https://upload.wikimedia.org/wikipedia/commons/3/3d/Cesium.jpg" alt="Cesium" class="ka-element-image">
                            <div class="ka-element-name">Cesium</div>
                            <div class="ka-element-symbol">Cs</div>
                            <div class="ka-element-atomic">Atomic Number: 55</div>
                        </div>
                        <div class="ka-element-card">
                            <img src="https://i0.wp.com/periodic-table.com/wp-content/uploads/2018/11/Francium.jpg?fit=238%2C212&ssl=1" alt="Francium" class="ka-element-image">
                            <div class="ka-element-name">Francium</div>
                            <div class="ka-element-symbol">Fr</div>
                            <div class="ka-element-atomic">Atomic Number: 87</div>
                        </div>
                    </div>
                </div>
                
                <!-- Element Details -->
                <div class="ka-content-card">
                    <div class="ka-card-header">
                        <h2 class="ka-card-title">Element Properties</h2>
                        <span class="ka-card-badge">Reference</span>
                    </div>
                    
                    <div class="ka-comparison-table">
                        <table>
                            <thead>
                                <tr>
                                    <th>Element</th>
                                    <th>Symbol</th>
                                    <th>Atomic Number</th>
                                    <th>Density (g/cm³)</th>
                                    <th>Melting Point (°C)</th>
                                    <th>Key Uses</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Lithium</td>
                                    <td>Li</td>
                                    <td>3</td>
                                    <td>0.534</td>
                                    <td>180.5</td>
                                    <td>Batteries, ceramics</td>
                                </tr>
                                <tr>
                                    <td>Sodium</td>
                                    <td>Na</td>
                                    <td>11</td>
                                    <td>0.968</td>
                                    <td>97.8</td>
                                    <td>Street lights, salt</td>
                                </tr>
                                <tr>
                                    <td>Potassium</td>
                                    <td>K</td>
                                    <td>19</td>
                                    <td>0.89</td>
                                    <td>63.5</td>
                                    <td>Fertilizers, soap</td>
                                </tr>
                                <tr>
                                    <td>Rubidium</td>
                                    <td>Rb</td>
                                    <td>37</td>
                                    <td>1.532</td>
                                    <td>39.3</td>
                                    <td>Atomic clocks</td>
                                </tr>
                                <tr>
                                    <td>Cesium</td>
                                    <td>Cs</td>
                                    <td>55</td>
                                    <td>1.93</td>
                                    <td>28.4</td>
                                    <td>Atomic clocks</td>
                                </tr>
                                <tr>
                                    <td>Francium</td>
                                    <td>Fr</td>
                                    <td>87</td>
                                    <td>~1.87</td>
                                    <td>~27</td>
                                    <td>Research only</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="ka-key-points">
                        <h4>Did You Know?</h4>
                        <p>Francium is extremely rare and radioactive. It's estimated that there's less than 30 grams of francium in the Earth's crust at any given time!</p>
                    </div>
                </div>
            </div>
            
            <!-- Properties Section -->
            <div id="properties-section" class="content-section" style="display: none;">
                <div class="ka-content-card">
                    <div class="ka-card-header">
                        <h2 class="ka-card-title">Physical & Chemical Properties</h2>
                        <span class="ka-card-badge">Core Concept</span>
                    </div>
                    
                    <div class="ka-article">
                        <p>Group 1 elements share many similar properties due to their single valence electron. Understanding these properties is key to predicting their behavior in chemical reactions.</p>
                        
                        <h3>Physical Properties</h3>
                        <ul>
                            <li><strong>Soft metals</strong> that can be cut with a knife</li>
                            <li><strong>Low density</strong> - lithium floats on water</li>
                            <li><strong>Low melting and boiling points</strong> that decrease down the group</li>
                            <li><strong>Good conductors</strong> of heat and electricity</li>
                            <li><strong>Silvery-white appearance</strong> when freshly cut</li>
                        </ul>
                        
                        <h3>Chemical Properties</h3>
                        <ul>
                            <li><strong>Highly reactive</strong> with one valence electron</li>
                            <li>Form <strong>+1 ions</strong> by losing their valence electron</li>
                            <li><strong>Reactivity increases</strong> down the group</li>
                            <li><strong>Never found free</strong> in nature</li>
                            <li>React with <strong>water to produce hydrogen gas</strong> and metal hydroxides</li>
                        </ul>
                        
                        <div class="ka-interactive">
                            <div class="ka-interactive-header">
                                <h3 class="ka-interactive-title">Interactive Simulation</h3>
                                <button class="ka-try-button">Try It</button>
                            </div>
                            <p>Explore how alkali metals react with water in this interactive simulation.</p>
                        </div>
                    </div>
                </div>
                
                <!-- Trends in Properties -->
                <div class="ka-content-card">
                    <div class="ka-card-header">
                        <h2 class="ka-card-title">Trends Down the Group</h2>
                        <span class="ka-card-badge">Important</span>
                    </div>
                    
                    <div class="ka-comparison-table">
                        <table>
                            <thead>
                                <tr>
                                    <th>Property</th>
                                    <th>Trend</th>
                                    <th>Reason</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Atomic radius</td>
                                    <td>Increases</td>
                                    <td>More electron shells</td>
                                </tr>
                                <tr>
                                    <td>First ionization energy</td>
                                    <td>Decreases</td>
                                    <td>Outer electron further from nucleus</td>
                                </tr>
                                <tr>
                                    <td>Reactivity</td>
                                    <td>Increases</td>
                                    <td>Easier to lose valence electron</td>
                                </tr>
                                <tr>
                                    <td>Melting/boiling point</td>
                                    <td>Decreases</td>
                                    <td>Weaker metallic bonding</td>
                                </tr>
                                <tr>
                                    <td>Density</td>
                                    <td>Increases</td>
                                    <td>Exception: K < Na</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="ka-tip-card">
                        <div class="ka-tip-header">
                            <i class="fas fa-lightbulb ka-tip-icon"></i>
                            <h3 class="ka-tip-title">Exception to Remember</h3>
                        </div>
                        <div class="ka-tip-content">
                            <p>While density generally increases down Group 1, potassium (K) is less dense than sodium (Na). This is because the increase in atomic mass is offset by a larger increase in atomic volume.</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Reactions Section -->
            <div id="reactions-section" class="content-section" style="display: none;">
                <div class="ka-content-card">
                    <div class="ka-card-header">
                        <h2 class="ka-card-title">Chemical Reactions</h2>
                        <span class="ka-card-badge">Interactive</span>
                    </div>
                    
                    <div class="ka-article">
                        <p>Group 1 metals undergo characteristic reactions with various substances. Understanding these reactions is essential for predicting their behavior in different environments.</p>
                        
                        <h3>Reaction with Water</h3>
                        <p>All Group 1 metals react with water to produce hydrogen gas and the corresponding metal hydroxide. The general equation is:</p>
                        
                        <div class="ka-key-points">
                            <p>2M(s) + 2H₂O(l) → 2MOH(aq) + H₂(g)</p>
                        </div>
                        
                        <p>The reactivity increases down the group:</p>
                        <ul>
                            <li><strong>Lithium</strong> fizzes steadily</li>
                            <li><strong>Sodium</strong> melts into a ball and moves quickly</li>
                            <li><strong>Potassium</strong> reacts violently and may ignite with a lilac flame</li>
                        </ul>
                        
                        <h3>Reaction with Oxygen</h3>
                        <p>Group 1 metals react with oxygen to form different types of oxides depending on the metal:</p>
                        <ul>
                            <li><strong>Lithium</strong> forms the normal oxide (Li₂O)</li>
                            <li><strong>Sodium</strong> forms the peroxide (Na₂O₂)</li>
                            <li><strong>Potassium, Rubidium, Cesium</strong> form superoxides (KO₂, RbO₂, CsO₂)</li>
                        </ul>
                    </div>
                </div>
                
                <!-- Interactive Reaction Simulation -->
                <div class="ka-interactive">
                    <div class="ka-interactive-header">
                        <h3 class="ka-interactive-title">Reaction Simulator</h3>
                        <button class="ka-try-button">Start Simulation</button>
                    </div>
                    <p>Visualize how different Group 1 metals react with water in this interactive simulation.</p>
                </div>
                
                <!-- Reaction Exercise -->
                <div class="ka-exercise-card">
                    <div class="ka-exercise-header">
                        <h3 class="ka-exercise-title">Practice Exercise</h3>
                        <span class="ka-exercise-points">+10 XP</span>
                    </div>
                    
                    <div class="ka-exercise-content">
                        <p>What gas is produced when sodium reacts with water?</p>
                    </div>
                    
                    <div class="ka-exercise-options">
                        <div class="ka-option" onclick="selectOption(this, false)">
                            Oxygen (O₂)
                        </div>
                        <div class="ka-option" onclick="selectOption(this, true)">
                            Hydrogen (H₂)
                        </div>
                        <div class="ka-option" onclick="selectOption(this, false)">
                            Carbon dioxide (CO₂)
                        </div>
                        <div class="ka-option" onclick="selectOption(this, false)">
                            Nitrogen (N₂)
                        </div>
                    </div>
                    
                    <div class="ka-explanation" id="explanation2">
                        <h4 class="ka-explanation-title">Explanation</h4>
                        <p>When sodium reacts with water, it produces hydrogen gas (H₂) and sodium hydroxide (NaOH). The balanced equation is: 2Na + 2H₂O → 2NaOH + H₂</p>
                    </div>
                    
                    <button class="ka-try-button" onclick="checkAnswer()">Submit Answer</button>
                </div>
            </div>
            
            <!-- Study Groups Section -->
            <div id="study-groups-section" class="content-section" style="display: none;">
                <div class="ka-content-card">
                    <div class="ka-card-header">
                        <h2 class="ka-card-title">Study Groups</h2>
                        <button onclick="showCreateStudyGroup()" class="ka-new-discussion">
                            Create Group
                        </button>
                    </div>
                    
                    <div id="studyGroupsContainer">
                        <!-- Study groups will be loaded here -->
                    </div>
                </div>
            </div>
            
            <!-- Discussion Section -->
            <div id="discussion-section" class="content-section" style="display: none;">
                <div class="ka-discussion-card">
                    <div class="ka-discussion-header">
                        <h2 class="ka-discussion-title">Discussion</h2>
                        <button class="ka-new-discussion">
                            New Discussion
                        </button>
                    </div>
                    
                    <div id="commentsContainer">
                        <!-- Comments will be loaded here -->
                    </div>
                </div>
            </div>
            
            <!-- Post Quiz Section -->
            <div id="quiz-section" class="content-section" style="display: none;">
                <div class="ka-content-card">
                    <div class="ka-card-header">
                        <h2 class="ka-card-title">Final Assessment</h2>
                        <span class="ka-card-badge">7 questions</span>
                    </div>
                    
                    <div class="ka-article">
                        <p>Test your knowledge after completing the learning materials. See how much you've improved!</p>
                    </div>
                    
                    <button onclick="startPostQuiz()" class="ka-try-button" style="width: 100%; margin-top: 1rem;">
                        Start Post-Quiz
                    </button>
                </div>
            </div>
        </main>
    </div>
    
    <!-- Login Modal -->
    <div id="loginModal" class="ka-modal">
        <div class="ka-modal-content">
            <div class="ka-modal-header">
                <h2 class="ka-modal-title">Welcome to Chemistry Mastery</h2>
                <button class="ka-modal-close" onclick="closeLoginModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="ka-modal-body">
                <form id="loginFormElement" class="space-y-4">
                    <div class="ka-form-group">
                        <label class="ka-form-label">Email</label>
                        <input type="email" id="loginEmail" class="ka-form-input" placeholder="your@email.com" required>
                    </div>
                    
                    <div class="ka-form-group">
                        <label class="ka-form-label">Password</label>
                        <input type="password" id="loginPassword" class="ka-form-input" placeholder="••••••••" required>
                    </div>
                    
                    <button type="submit" class="ka-form-button">
                        Sign In
                    </button>
                </form>
                
                <div class="ka-form-divider">
                    <span>or</span>
                </div>
                
                <button onclick="signInWithGoogle()" class="ka-google-button">
                    <i class="fab fa-google"></i>
                    Continue with Google
                </button>
                
                <div class="text-center mt-4">
                    <p class="text-gray-600">Don't have an account? <a href="#" onclick="switchToSignup()" class="text-blue-600 hover:underline">Sign up</a></p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Signup Modal -->
    <div id="signupModal" class="ka-modal">
        <div class="ka-modal-content">
            <div class="ka-modal-header">
                <h2 class="ka-modal-title">Create Your Account</h2>
                <button class="ka-modal-close" onclick="closeSignupModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="ka-modal-body">
                <form id="signupFormElement" class="space-y-4">
                    <div class="ka-form-group">
                        <label class="ka-form-label">Full Name</label>
                        <input type="text" id="signupName" class="ka-form-input" placeholder="John Doe" required>
                    </div>
                    
                    <div class="ka-form-group">
                        <label class="ka-form-label">Email</label>
                        <input type="email" id="signupEmail" class="ka-form-input" placeholder="your@email.com" required>
                    </div>
                    
                    <div class="ka-form-group">
                        <label class="ka-form-label">Password</label>
                        <input type="password" id="signupPassword" class="ka-form-input" placeholder="••••••••" required>
                    </div>
                    
                    <div class="ka-form-group">
                        <label class="ka-form-label">Confirm Password</label>
                        <input type="password" id="signupConfirmPassword" class="ka-form-input" placeholder="••••••••" required>
                    </div>
                    
                    <button type="submit" class="ka-form-button">
                        Create Account
                    </button>
                </form>
                
                <div class="ka-form-divider">
                    <span>or</span>
                </div>
                
                <button onclick="signInWithGoogle()" class="ka-google-button">
                    <i class="fab fa-google"></i>
                    Continue with Google
                </button>
                
                <div class="text-center mt-4">
                    <p class="text-gray-600">Already have an account? <a href="#" onclick="switchToLogin()" class="text-blue-600 hover:underline">Sign in</a></p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Create Study Group Modal -->
    <div id="createStudyGroupModal" class="ka-modal">
        <div class="ka-modal-content">
            <div class="ka-modal-header">
                <h2 class="ka-modal-title">Create Study Group</h2>
                <button class="ka-modal-close" onclick="closeCreateStudyGroup()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="ka-modal-body">
                <form id="createStudyGroupForm" class="space-y-4">
                    <div class="ka-form-group">
                        <label class="ka-form-label">Group Name</label>
                        <input type="text" id="groupName" class="ka-form-input" placeholder="Enter group name" required>
                    </div>
                    
                    <div class="ka-form-group">
                        <label class="ka-form-label">Description</label>
                        <textarea id="groupDescription" class="ka-form-input" rows="3" placeholder="Describe your study group" required></textarea>
                    </div>
                    
                    <div class="ka-form-group">
                        <label class="ka-form-label">Goal</label>
                        <input type="text" id="groupGoal" class="ka-form-input" placeholder="What's the goal of this group?" required>
                    </div>
                    
                    <div class="ka-form-group">
                        <label class="ka-form-label">Max Members</label>
                        <select id="groupMaxMembers" class="ka-form-input" required>
                            <option value="5">5 members</option>
                            <option value="10">10 members</option>
                            <option value="15">15 members</option>
                            <option value="20">20 members</option>
                        </select>
                    </div>
                    
                    <button type="submit" class="ka-form-button">
                        Create Group
                    </button>
                </form>
            </div>
        </div>
    </div>
    
    <!-- Quiz Modal -->
    <div id="quizModal" class="ka-modal">
        <div class="ka-modal-content">
            <div class="ka-modal-header">
                <h2 class="ka-modal-title" id="quizTitle">Pre-Quiz</h2>
                <button class="ka-modal-close" onclick="closeQuiz()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="ka-modal-body">
                <div id="quizProgress" class="ka-quiz-header">
                    <div class="ka-quiz-progress">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">7</span>
                        <div class="ka-quiz-progress-bar">
                            <div class="ka-quiz-progress-fill" id="progressFill" style="width: 14.3%"></div>
                        </div>
                    </div>
                    <div class="ka-quiz-progress">
                        Score: <span id="currentScore">0</span>
                    </div>
                </div>
                
                <div id="quizContent">
                    <div class="ka-question" id="questionText">Loading question...</div>
                    
                    <div id="optionsContainer" class="ka-options"></div>
                    
                    <div id="feedback" class="ka-explanation" style="display: none;"></div>
                    
                    <div class="ka-quiz-actions">
                        <button id="prevButton" class="ka-quiz-button ka-quiz-button-secondary" onclick="previousQuestion()" style="display: none;">
                            Previous
                        </button>
                        <button id="submitButton" class="ka-quiz-button" onclick="submitAnswer()">
                            Submit Answer
                        </button>
                        <button id="nextButton" class="ka-quiz-button" onclick="nextQuestion()" style="display: none;">
                            Next
                        </button>
                    </div>
                </div>
                
                <div id="quizResults" class="ka-quiz-results" style="display: none;">
                    <div class="ka-quiz-score" id="finalScore">0/7</div>
                    <div class="ka-quiz-message" id="scoreMessage">Great job!</div>
                    
                    <div id="postQuizActions" style="display: none;">
                        <button onclick="completePreQuiz()" class="ka-quiz-button">
                            Continue to Learning Materials
                        </button>
                    </div>
                    
                    <div id="finalActions" style="display: none;">
                        <button onclick="closeQuiz()" class="ka-quiz-button">
                            Finish
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Toast Container -->
    <div id="toastContainer"></div>
    
    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBOp4x0lTFvmt2s3MQKBRYmZT9IJ2ZaRi8",
            authDomain: "group-1-alkali-metals.firebaseapp.com",
            databaseURL: "https://group-1-alkali-metals-default-rtdb.firebaseio.com",
            projectId: "group-1-alkali-metals",
            storageBucket: "group-1-alkali-metals.firebasestorage.app",
            messagingSenderId: "806417495419",
            appId: "1:806417495419:web:5b80607e8a23e96da4f9de",
            measurementId: "G-S76E52MQ37"
        };
        
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const database = firebase.database();
        
        // Global variables
        let currentUser = null;
        let userData = null;
        let currentQuiz = [];
        let currentQuestion = 0;
        let score = 0;
        let selectedOption = null;
        let quizType = '';
        let answerSubmitted = false;
        let justSignedIn = false;
        
        // Quiz questions - IGCSE Level
        const preQuizQuestions = [
            {
                type: 'single',
                question: "Which of the following is the correct electron configuration of sodium?",
                options: ["[He] 2s² 2p⁶ 3s¹", "[Ne] 3s²", "[Ne] 3s¹", "[Ar] 4s¹"],
                correct: 2,
                explanation: "Sodium (Na) has atomic number 11. Its electron configuration is [Ne] 3s¹, meaning it has the same configuration as neon plus one electron in the 3s orbital."
            },
            {
                type: 'single',
                question: "What is the main product when sodium reacts with cold water?",
                options: ["Sodium oxide and hydrogen", "Sodium hydroxide and hydrogen", "Sodium peroxide and hydrogen", "Sodium and water"],
                correct: 1,
                explanation: "Sodium reacts with cold water to produce sodium hydroxide (NaOH) and hydrogen gas (H₂). The equation is: 2Na + 2H₂O → 2NaOH + H₂."
            },
            {
                type: 'single',
                question: "Which Group 1 element has the lowest density and floats on water?",
                options: ["Sodium", "Lithium", "Cesium", "Rubidium"],
                correct: 1,
                explanation: "Lithium has the lowest density (0.534 g/cm³) of all Group 1 metals, which is less than water (1 g/cm³), so it floats on water."
            },
            {
                type: 'single',
                question: "Which element in Group 1 forms a peroxide when burned in oxygen?",
                options: ["Lithium", "Sodium", "Potassium", "Rubidium"],
                correct: 1,
                explanation: "Sodium primarily forms the peroxide Na₂O₂ when burned in air, unlike lithium which forms the normal oxide Li₂O, and potassium/rubidium which form superoxides."
            },
            {
                type: 'single',
                question: "What is the formula of the superoxide formed by potassium?",
                options: ["KO", "KO₂", "K₂O", "K₂O₂"],
                correct: 1,
                explanation: "Potassium forms the superoxide KO₂ when burned in oxygen, unlike sodium which forms the peroxide Na₂O₂ and lithium which forms the oxide Li₂O."
            },
            {
                type: 'single',
                question: "Which of the following statements about Group 1 metals is correct?",
                options: [
                    "They have high melting points",
                    "They form +2 ions",
                    "Reactivity decreases down the group",
                    "They are good conductors of electricity"
                ],
                correct: 3,
                explanation: "Group 1 metals are good conductors of electricity. They have low melting points, form +1 ions, and reactivity increases down the group."
            },
            {
                type: 'single',
                question: "How are Group 1 metals extracted from their ores?",
                options: [
                    "Reduction with carbon",
                    "Electrolysis of molten compounds",
                    "Reduction with hydrogen",
                    "Decomposition by heating"
                ],
                correct: 1,
                explanation: "Group 1 metals are extracted by electrolysis of their molten chlorides because they are too reactive to be extracted by chemical reduction."
            }
        ];
        
        const postQuizQuestions = [
            {
                type: 'single',
                question: "Which of the following explains why the reactivity of Group 1 metals increases down the group?",
                options: [
                    "Increasing atomic radius",
                    "Decreasing atomic radius",
                    "Increasing nuclear charge",
                    "Decreasing number of electron shells"
                ],
                correct: 0,
                explanation: "The reactivity increases down the group because the atomic radius increases, making the outer electron further from the nucleus and easier to lose."
            },
            {
                type: 'single',
                question: "What is the trend in melting points of Group 1 metals down the group?",
                options: [
                    "Increases",
                    "Decreases",
                    "Remains constant",
                    "No clear trend"
                ],
                correct: 1,
                explanation: "The melting points of Group 1 metals decrease down the group due to weakening metallic bonds as the atomic size increases."
            },
            {
                type: 'single',
                question: "Which of the following oxides is formed when lithium burns in oxygen?",
                options: ["Li₂O", "Li₂O₂", "LiO₂", "LiO"],
                correct: 0,
                explanation: "Lithium forms the normal oxide Li₂O when burned in oxygen, unlike sodium which forms the peroxide Na₂O₂ and potassium which forms the superoxide KO₂."
            },
            {
                type: 'single',
                question: "What is observed when potassium reacts with water?",
                options: [
                    "Fizzes steadily",
                    "Melts into a ball and moves quickly",
                    "Reacts violently and may ignite with a lilac flame",
                    "No visible reaction"
                ],
                correct: 2,
                explanation: "Potassium reacts violently with water, producing hydrogen gas that may ignite with a lilac flame due to the heat of the reaction."
            },
            {
                type: 'single',
                question: "Which of the following is a use of sodium?",
                options: [
                    "Batteries",
                    "Street lighting",
                    "Fertilizers",
                    "Atomic clocks"
                ],
                correct: 1,
                explanation: "Sodium vapor lamps are commonly used for street lighting due to their efficient yellow light. Lithium is used in batteries, potassium in fertilizers, and rubidium/cesium in atomic clocks."
            },
            {
                type: 'single',
                question: "What color flame is produced by sodium in a flame test?",
                options: ["Red", "Yellow", "Lilac", "Green"],
                correct: 1,
                explanation: "Sodium produces a characteristic yellow flame in flame tests due to the excitation of its electrons."
            },
            {
                type: 'single',
                question: "Why are Group 1 metals stored under oil?",
                options: [
                    "To prevent oxidation",
                    "To increase their reactivity",
                    "To reduce their density",
                    "To improve their conductivity"
                ],
                correct: 0,
                explanation: "Group 1 metals are stored under oil to prevent them from reacting with oxygen and moisture in the air, which would cause oxidation and corrosion."
            }
        ];
        
        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            // Check authentication state on page load
            auth.onAuthStateChanged((user) => {
                if (user) {
                    currentUser = user;
                    console.log("User is signed in:", user.uid);
                    
                    // Check if this is a fresh sign-in
                    if (justSignedIn) {
                        console.log("User just signed in, showing pre-quiz introduction");
                        showPreQuizIntroduction();
                        justSignedIn = false;
                    } else {
                        // This is a page reload or existing session
                        console.log("Existing session, checking pre-quiz status");
                        checkPreQuizStatus();
                    }
                } else {
                    console.log("No user signed in");
                    // Show landing page
                    document.getElementById('landingPage').style.display = 'flex';
                    document.getElementById('prequizPage').style.display = 'none';
                    document.getElementById('mainApp').style.display = 'none';
                }
            });
            
            // Set up login form
            document.getElementById('loginFormElement').addEventListener('submit', (e) => {
                e.preventDefault();
                const email = document.getElementById('loginEmail').value;
                const password = document.getElementById('loginPassword').value;
                
                if (!isValidEmail(email)) {
                    showToast('error', 'Invalid Email', 'Please enter a valid email address');
                    return;
                }
                
                showLoading();
                
                auth.signInWithEmailAndPassword(email, password)
                    .then((userCredential) => {
                        const user = userCredential.user;
                        console.log("Sign in successful:", user.uid);
                        showToast('success', 'Welcome back!', 'You have been successfully signed in.');
                        closeLoginModal();
                        justSignedIn = true;
                    })
                    .catch((error) => {
                        const errorCode = error.code;
                        const errorMessage = error.message;
                        console.error("Sign in error:", errorCode, errorMessage);
                        
                        if (errorCode === 'auth/unauthorized-domain') {
                            showToast('error', 'Domain not authorized', 
                                'Please add your GitHub Pages domain to the authorized domains in your Firebase project settings.');
                        } else {
                            showToast('error', 'Sign in failed', errorMessage);
                        }
                    })
                    .finally(() => {
                        hideLoading();
                    });
            });
            
            // Set up signup form
            document.getElementById('signupFormElement').addEventListener('submit', (e) => {
                e.preventDefault();
                const name = document.getElementById('signupName').value;
                const email = document.getElementById('signupEmail').value;
                const password = document.getElementById('signupPassword').value;
                const confirmPassword = document.getElementById('signupConfirmPassword').value;
                
                if (!isValidEmail(email)) {
                    showToast('error', 'Invalid Email', 'Please enter a valid email address');
                    return;
                }
                
                if (password !== confirmPassword) {
                    showToast('error', 'Password Mismatch', 'The passwords you entered do not match.');
                    return;
                }
                
                if (password.length < 6) {
                    showToast('error', 'Password Too Short', 'Password must be at least 6 characters long.');
                    return;
                }
                
                showLoading();
                
                auth.createUserWithEmailAndPassword(email, password)
                    .then((userCredential) => {
                        const user = userCredential.user;
                        
                        // Update user profile with display name
                        return user.updateProfile({
                            displayName: name
                        }).then(() => {
                            console.log("Sign up successful:", user.uid);
                            showToast('success', 'Account Created!', 'Your account has been created successfully.');
                            closeSignupModal();
                            justSignedIn = true;
                            
                            // Create user data in database
                            const newUser = {
                                uid: user.uid,
                                email: email,
                                displayName: name,
                                points: 0,
                                currentStreak: 1,
                                lastActiveDate: new Date().toDateString(),
                                preQuizCompleted: false,
                                postQuizCompleted: false,
                                createdAt: firebase.database.ServerValue.TIMESTAMP
                            };
                            
                            return database.ref('users/' + user.uid).set(newUser);
                        });
                    })
                    .then(() => {
                        // The onAuthStateChanged listener will handle showing the pre-quiz introduction
                    })
                    .catch((error) => {
                        const errorCode = error.code;
                        const errorMessage = error.message;
                        console.error("Sign up error:", errorCode, errorMessage);
                        
                        if (errorCode === 'auth/email-already-in-use') {
                            showToast('error', 'Email Already In Use', 'This email address is already associated with an account.');
                        } else if (errorCode === 'auth/weak-password') {
                            showToast('error', 'Weak Password', 'Password must be at least 6 characters long.');
                        } else {
                            showToast('error', 'Sign up failed', errorMessage);
                        }
                    })
                    .finally(() => {
                        hideLoading();
                    });
            });
            
            // Set up create study group form
            document.getElementById('createStudyGroupForm').addEventListener('submit', (e) => {
                e.preventDefault();
                createStudyGroup();
            });
        });
        
        // Toggle sidebar (mobile)
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('active');
        }
        
        // Navigate to section
        function navigateToSection(sectionName) {
            // Hide all sections
            const sections = document.querySelectorAll('.content-section');
            sections.forEach(section => {
                section.style.display = 'none';
            });
            
            // Show selected section
            document.getElementById(`${sectionName}-section`).style.display = 'block';
            
            // Update active nav item
            const navItems = document.querySelectorAll('.ka-sidebar-item');
            navItems.forEach(item => {
                item.classList.remove('active');
            });
            event.target.closest('.ka-sidebar-item').classList.add('active');
            
            // Close sidebar on mobile
            if (window.innerWidth <= 768) {
                toggleSidebar();
            }
        }
        
        // Show pre-quiz introduction page
        function showPreQuizIntroduction() {
            console.log("Showing pre-quiz introduction");
            document.getElementById('landingPage').style.display = 'none';
            document.getElementById('prequizPage').style.display = 'block';
            document.getElementById('mainApp').style.display = 'none';
        }
        
        // Check if user has completed pre-quiz
        function checkPreQuizStatus() {
            console.log("Checking pre-quiz status for user:", currentUser.uid);
            
            if (!currentUser) {
                console.log("No current user, showing landing page");
                document.getElementById('landingPage').style.display = 'flex';
                document.getElementById('prequizPage').style.display = 'none';
                document.getElementById('mainApp').style.display = 'none';
                return;
            }
            
            const userRef = database.ref('users/' + currentUser.uid);
            
            userRef.once('value').then((snapshot) => {
                console.log("User data snapshot:", snapshot.val());
                
                if (snapshot.exists()) {
                    userData = snapshot.val();
                    console.log("User data loaded:", userData);
                    
                    if (userData.preQuizCompleted) {
                        console.log("Pre-quiz completed, showing main app");
                        showMainApp();
                    } else {
                        console.log("Pre-quiz not completed, showing pre-quiz introduction");
                        showPreQuizIntroduction();
                    }
                } else {
                    console.log("User data doesn't exist, creating new user");
                    // Create new user
                    const newUser = {
                        uid: currentUser.uid,
                        email: currentUser.email,
                        displayName: currentUser.displayName || 'User',
                        points: 0,
                        currentStreak: 1,
                        lastActiveDate: new Date().toDateString(),
                        preQuizCompleted: false,
                        postQuizCompleted: false,
                        createdAt: firebase.database.ServerValue.TIMESTAMP
                    };
                    
                    userRef.set(newUser).then(() => {
                        userData = newUser;
                        console.log("New user created, showing pre-quiz introduction");
                        showPreQuizIntroduction();
                    }).catch((error) => {
                        console.error("Error creating new user:", error);
                        showToast('error', 'Error', 'Failed to create user profile.');
                    });
                }
            }).catch((error) => {
                console.error("Error checking pre-quiz status:", error);
                showToast('error', 'Error', 'Failed to check your progress.');
                document.getElementById('landingPage').style.display = 'flex';
                document.getElementById('prequizPage').style.display = 'none';
                document.getElementById('mainApp').style.display = 'none';
            });
        }
        
        // Show main application
        function showMainApp() {
            console.log("Showing main app");
            document.getElementById('landingPage').style.display = 'none';
            document.getElementById('prequizPage').style.display = 'none';
            document.getElementById('mainApp').style.display = 'block';
            
            // Update user profile
            document.getElementById('userAvatar').textContent = (userData.displayName || 'User').charAt(0).toUpperCase();
            document.getElementById('userPoints').textContent = userData.points || 0;
            document.getElementById('userStreak').textContent = userData.currentStreak || 0;
            
            // Load data
            loadStudyGroups();
            loadComments();
        }
        
        // Start pre-quiz
        function startPreQuiz() {
            if (!currentUser) {
                showToast('error', 'Sign in required', 'Please sign in to take the quiz.');
                showLoginModal();
                return;
            }
            
            console.log("Starting pre-quiz");
            
            // Hide pre-quiz introduction page
            document.getElementById('prequizPage').style.display = 'none';
            
            currentQuiz = [...preQuizQuestions];
            quizType = 'pre';
            currentQuestion = 0;
            score = 0;
            selectedOption = null;
            answerSubmitted = false;
            showQuiz();
        }
        
        // Start post-quiz
        function startPostQuiz() {
            if (!currentUser) {
                showToast('error', 'Sign in required', 'Please sign in to take the quiz.');
                showLoginModal();
                return;
            }
            
            currentQuiz = [...postQuizQuestions];
            quizType = 'post';
            currentQuestion = 0;
            score = 0;
            selectedOption = null;
            answerSubmitted = false;
            showQuiz();
        }
        
        // Show quiz modal
        function showQuiz() {
            console.log("Showing quiz modal");
            document.getElementById('quizModal').classList.add('active');
            document.getElementById('quizProgress').style.display = 'flex';
            document.getElementById('quizContent').style.display = 'block';
            document.getElementById('quizResults').style.display = 'none';
            
            document.getElementById('quizTitle').textContent = quizType === 'pre' ? 'Pre-Quiz' : 'Post-Quiz';
            document.getElementById('currentQuestion').textContent = currentQuestion + 1;
            document.getElementById('totalQuestions').textContent = currentQuiz.length;
            document.getElementById('currentScore').textContent = score;
            document.getElementById('progressFill').style.width = ((currentQuestion + 1) / currentQuiz.length * 100) + '%';
            
            loadQuestion();
        }
        
        // Load question
        function loadQuestion() {
            const question = currentQuiz[currentQuestion];
            document.getElementById('questionText').textContent = question.question;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            
            // Reset buttons and feedback
            document.getElementById('submitButton').style.display = 'inline-flex';
            document.getElementById('submitButton').disabled = true;
            document.getElementById('nextButton').style.display = 'none';
            document.getElementById('feedback').style.display = 'none';
            answerSubmitted = false;
            
            // Load options based on question type
            switch (question.type) {
                case 'single':
                    loadMultipleChoiceQuestion(question, optionsContainer);
                    break;
                default:
                    loadMultipleChoiceQuestion(question, optionsContainer);
            }
            
            document.getElementById('prevButton').style.display = currentQuestion === 0 ? 'none' : 'inline-flex';
            
            selectedOption = null;
        }
        
        // Function to load multiple choice questions
        function loadMultipleChoiceQuestion(question, container) {
            question.options.forEach((option, index) => {
                const optionDiv = document.createElement('div');
                optionDiv.className = 'ka-option';
                optionDiv.dataset.index = index;
                
                optionDiv.textContent = option;
                
                optionDiv.onclick = () => selectQuizOption(index);
                container.appendChild(optionDiv);
            });
        }
        
        // Select quiz option
        function selectQuizOption(index) {
            if (answerSubmitted) return;
            
            const options = document.querySelectorAll('.ka-option');
            
            // Remove previous selection
            options.forEach(option => {
                option.classList.remove('selected');
            });
            
            // Add selection to clicked option
            options[index].classList.add('selected');
            
            selectedOption = index;
            
            // Enable submit button
            document.getElementById('submitButton').disabled = false;
        }
        
        // Submit answer
        function submitAnswer() {
            if (answerSubmitted) return;
            
            const question = currentQuiz[currentQuestion];
            let isCorrect = false;
            const feedback = document.getElementById('feedback');
            
            isCorrect = selectedOption === question.correct;
            
            if (isCorrect) {
                feedback.className = 'ka-explanation show';
                feedback.innerHTML = `
                    <h4 class="ka-explanation-title">Correct!</h4>
                    <p>${question.explanation}</p>
                `;
                score++;
                
                // Award points
                awardPoints(10, 'Correct answer');
            } else {
                feedback.className = 'ka-explanation show';
                feedback.innerHTML = `
                    <h4 class="ka-explanation-title">Incorrect</h4>
                    <p>${question.explanation}</p>
                `;
            }
            
            // Show correct/incorrect styling
            const options = document.querySelectorAll('.ka-option');
            options[question.correct].classList.add('correct');
            
            if (selectedOption !== null && selectedOption !== question.correct) {
                options[selectedOption].classList.add('incorrect');
            }
            
            document.getElementById('submitButton').style.display = 'none';
            document.getElementById('nextButton').style.display = 'inline-flex';
            document.getElementById('currentScore').textContent = score;
            
            // Mark answer as submitted
            answerSubmitted = true;
        }
        
        // Next question
        function nextQuestion() {
            currentQuestion++;
            
            if (currentQuestion >= currentQuiz.length) {
                showResults();
                return;
            }
            
            document.getElementById('currentQuestion').textContent = currentQuestion + 1;
            document.getElementById('progressFill').style.width = ((currentQuestion + 1) / currentQuiz.length * 100) + '%';
            loadQuestion();
        }
        
        // Previous question
        function previousQuestion() {
            if (currentQuestion > 0) {
                currentQuestion--;
                document.getElementById('currentQuestion').textContent = currentQuestion + 1;
                document.getElementById('progressFill').style.width = ((currentQuestion + 1) / currentQuiz.length * 100) + '%';
                loadQuestion();
            }
        }
        
        // Show quiz results
        function showResults() {
            document.getElementById('quizProgress').style.display = 'none';
            document.getElementById('quizContent').style.display = 'none';
            document.getElementById('quizResults').style.display = 'block';
            
            const percentage = Math.round((score / currentQuiz.length) * 100);
            document.getElementById('finalScore').textContent = `${score}/${currentQuiz.length}`;
            
            let message = '';
            if (percentage >= 80) {
                message = 'Excellent! You have a strong understanding of Group 1 elements.';
            } else if (percentage >= 60) {
                message = 'Good job! You have a solid foundation to build upon.';
            } else if (percentage >= 40) {
                message = 'Not bad! Pay attention to the learning materials to improve.';
            } else {
                message = 'Keep practicing! Review the materials carefully.';
            }
            
            document.getElementById('scoreMessage').textContent = message;
            
            // Save quiz result
            saveQuizResult(score, currentQuiz.length, quizType);
            
            // Show appropriate actions
            if (quizType === 'pre') {
                document.getElementById('postQuizActions').style.display = 'block';
                document.getElementById('finalActions').style.display = 'none';
            } else {
                document.getElementById('postQuizActions').style.display = 'none';
                document.getElementById('finalActions').style.display = 'block';
            }
        }
        
        // Complete pre-quiz and unlock main content
        function completePreQuiz() {
            if (!currentUser) return;
            
            console.log("Completing pre-quiz for user:", currentUser.uid);
            
            const userRef = database.ref('users/' + currentUser.uid);
            
            userRef.update({
                preQuizCompleted: true,
                preQuizScore: score,
                preQuizDate: firebase.database.ServerValue.TIMESTAMP
            }).then(() => {
                userData.preQuizCompleted = true;
                userData.preQuizScore = score;
                
                console.log("Pre-quiz completed, showing main app");
                
                // Award points for completing pre-quiz
                awardPoints(50, 'Completed pre-quiz');
                
                // Close quiz modal
                closeQuiz();
                
                // Show main app
                showMainApp();
                
                showToast('success', 'Pre-Quiz Complete!', 'You can now access the learning materials.');
            }).catch((error) => {
                console.error("Error updating pre-quiz status:", error);
                showToast('error', 'Error', 'Failed to save pre-quiz results.');
            });
        }
        
        // Save quiz result
        function saveQuizResult(score, totalQuestions, quizType) {
            const resultsRef = database.ref('quizResults').push();
            
            resultsRef.set({
                userId: currentUser.uid,
                userName: userData.displayName,
                score: score,
                totalQuestions: totalQuestions,
                percentage: Math.round((score / totalQuestions) * 100),
                quizType: quizType,
                topic: 'Group 1 - Alkali Metals',
                createdAt: firebase.database.ServerValue.TIMESTAMP
            }).catch((error) => {
                console.error("Error saving quiz result:", error);
            });
        }
        
        // Close quiz
        function closeQuiz() {
            console.log("Closing quiz modal");
            document.getElementById('quizModal').classList.remove('active');
            
            // If user hasn't completed pre-quiz, show pre-quiz introduction
            if (currentUser && userData && !userData.preQuizCompleted) {
                showPreQuizIntroduction();
            }
        }
        
        // Award points to user
        function awardPoints(points, reason) {
            if (!currentUser || !userData) return;
            
            const userRef = database.ref('users/' + currentUser.uid);
            
            const updates = {};
            updates['/points'] = (userData.points || 0) + points;
            updates['/lastActiveDate'] = new Date().toDateString();
            
            // Update streak
            const today = new Date().toDateString();
            const yesterday = new Date();
            yesterday.setDate(yesterday.getDate() - 1);
            const yesterdayString = yesterday.toDateString();
            
            if (userData.lastActiveDate === yesterdayString) {
                updates['/currentStreak'] = (userData.currentStreak || 1) + 1;
            } else if (userData.lastActiveDate !== today) {
                updates['/currentStreak'] = 1;
            }
            
            userRef.update(updates).then(() => {
                userData.points = updates['/points'];
                userData.currentStreak = updates['/currentStreak'];
                userData.lastActiveDate = updates['/lastActiveDate'];
                
                // Update UI
                document.getElementById('userPoints').textContent = userData.points;
                document.getElementById('userStreak').textContent = userData.currentStreak;
                
                showToast('success', 'Points Awarded', `+${points} points for ${reason}`);
            }).catch((error) => {
                console.error("Error awarding points:", error);
            });
        }
        
        // Load study groups
        function loadStudyGroups() {
            const container = document.getElementById('studyGroupsContainer');
            container.innerHTML = '<div class="ka-spinner"></div>';
            
            const groupsRef = database.ref('studyGroups');
            
            groupsRef.orderByChild('createdAt').on('value', (snapshot) => {
                container.innerHTML = '';
                
                if (!snapshot.exists()) {
                    container.innerHTML = '<p class="text-gray-500 text-center">No study groups yet. Create one!</p>';
                    return;
                }
                
                const groupsArray = [];
                snapshot.forEach((childSnapshot) => {
                    groupsArray.push({
                        id: childSnapshot.key,
                        ...childSnapshot.val()
                    });
                });
                
                // Sort by creation date (newest first)
                groupsArray.sort((a, b) => {
                    return new Date(b.createdAt) - new Date(a.createdAt);
                });
                
                groupsArray.forEach(group => {
                    const groupCard = createStudyGroupCard(group);
                    container.appendChild(groupCard);
                });
            }, (error) => {
                console.error("Error loading study groups:", error);
                container.innerHTML = '<p class="text-gray-500 text-center">Error loading study groups.</p>';
            });
        }
        
        // Create study group card
        function createStudyGroupCard(group) {
            const card = document.createElement('div');
            card.className = 'ka-study-group';
            
            const isMember = currentUser && group.members && group.members.includes(currentUser.uid);
            
            card.innerHTML = `
                <div class="ka-study-group-header">
                    <h3 class="ka-study-group-title">${group.name}</h3>
                    <button onclick="${isMember ? 'leaveStudyGroup' : 'joinStudyGroup'}('${group.id}')" 
                            class="ka-join-button ${isMember ? 'ka-leave-button' : ''}">
                        ${isMember ? 'Leave' : 'Join'}
                    </button>
                </div>
                
                <div class="ka-study-group-members">
                    ${(group.members || []).slice(0, 5).map(member => 
                        `<div class="ka-member-avatar">${member.charAt(0).toUpperCase()}</div>`
                    ).join('')}
                    ${(group.memberCount || 0) > 5 ? 
                        `<div class="ka-member-avatar">+${(group.memberCount || 0) - 5}</div>` : ''
                    }
                </div>
                
                <div class="ka-study-group-description">${group.description}</div>
                
                <div class="ka-study-group-goal">
                    <i class="fas fa-bullseye"></i>
                    <span>${group.goal}</span>
                </div>
            `;
            
            return card;
        }
        
        // Create study group
        function createStudyGroup() {
            if (!currentUser) {
                showToast('error', 'Sign in required', 'Please sign in to create study groups.');
                return;
            }
            
            const name = document.getElementById('groupName').value;
            const description = document.getElementById('groupDescription').value;
            const goal = document.getElementById('groupGoal').value;
            const maxMembers = parseInt(document.getElementById('groupMaxMembers').value);
            
            showLoading();
            
            const groupsRef = database.ref('studyGroups').push();
            
            groupsRef.set({
                name: name,
                description: description,
                goal: goal,
                maxMembers: maxMembers,
                creatorId: currentUser.uid,
                creatorName: userData.displayName,
                members: [currentUser.uid],
                memberCount: 1,
                createdAt: firebase.database.ServerValue.TIMESTAMP
            }).then(() => {
                showToast('success', 'Group Created', 'Your study group has been created successfully.');
                closeCreateStudyGroup();
                document.getElementById('createStudyGroupForm').reset();
                
                // Award points
                awardPoints(20, 'Created study group');
            }).catch((error) => {
                console.error("Error creating study group:", error);
                showToast('error', 'Error', 'Failed to create study group.');
            }).finally(() => {
                hideLoading();
            });
        }
        
        // Join study group
        function joinStudyGroup(groupId) {
            if (!currentUser) {
                showToast('error', 'Sign in required', 'Please sign in to join study groups.');
                return;
            }
            
            const groupRef = database.ref('studyGroups/' + groupId);
            
            groupRef.once('value').then((snapshot) => {
                const group = snapshot.val();
                
                if (!group) {
                    showToast('error', 'Error', 'Study group not found.');
                    return;
                }
                
                // Make sure members is an array
                const members = Array.isArray(group.members) ? [...group.members] : [];
                
                if (members.includes(currentUser.uid)) {
                    showToast('info', 'Already Member', 'You are already a member of this group.');
                    return;
                }
                
                if ((group.memberCount || 0) >= (group.maxMembers || 10)) {
                    showToast('error', 'Group Full', 'This study group is already full.');
                    return;
                }
                
                // Add current user to members array
                members.push(currentUser.uid);
                
                const updates = {};
                updates['/members'] = members;
                updates['/memberCount'] = (group.memberCount || 0) + 1;
                
                groupRef.update(updates).then(() => {
                    showToast('success', 'Joined Group', 'You have successfully joined the study group.');
                    
                    // Award points
                    awardPoints(10, 'Joined study group');
                }).catch((error) => {
                    console.error("Error joining study group:", error);
                    showToast('error', 'Error', 'Failed to join study group.');
                });
            }).catch((error) => {
                console.error("Error getting study group:", error);
                showToast('error', 'Error', 'Failed to join study group.');
            });
        }
        
        // Leave study group
        function leaveStudyGroup(groupId) {
            if (!currentUser) {
                showToast('error', 'Sign in required', 'Please sign in to leave study groups.');
                return;
            }
            
            const groupRef = database.ref('studyGroups/' + groupId);
            
            groupRef.once('value').then((snapshot) => {
                const group = snapshot.val();
                
                // Make sure members is an array
                const members = Array.isArray(group.members) ? [...group.members] : [];
                
                // Filter out current user
                const updatedMembers = members.filter(member => member !== currentUser.uid);
                
                const updates = {};
                updates['/members'] = updatedMembers;
                updates['/memberCount'] = Math.max(0, (group.memberCount || 0) - 1);
                
                groupRef.update(updates).then(() => {
                    showToast('success', 'Left Group', 'You have successfully left the study group.');
                }).catch((error) => {
                    console.error("Error leaving study group:", error);
                    showToast('error', 'Error', 'Failed to leave study group.');
                });
            }).catch((error) => {
                console.error("Error getting study group:", error);
                showToast('error', 'Error', 'Failed to leave study group.');
            });
        }
        
        // Load comments
        function loadComments() {
            const container = document.getElementById('commentsContainer');
            container.innerHTML = '<div class="ka-spinner"></div>';
            
            const commentsRef = database.ref('comments');
            
            commentsRef.orderByChild('createdAt').on('value', (snapshot) => {
                container.innerHTML = '';
                
                if (!snapshot.exists()) {
                    container.innerHTML = '<p class="text-gray-500 text-center">No comments yet. Be the first to comment!</p>';
                    return;
                }
                
                const commentsArray = [];
                snapshot.forEach((childSnapshot) => {
                    commentsArray.push({
                        id: childSnapshot.key,
                        ...childSnapshot.val()
                    });
                });
                
                // Sort by creation date (newest first)
                commentsArray.sort((a, b) => {
                    return new Date(b.createdAt) - new Date(a.createdAt);
                });
                
                commentsArray.forEach(comment => {
                    const commentDiv = createCommentElement(comment);
                    container.appendChild(commentDiv);
                });
            }, (error) => {
                console.error("Error loading comments:", error);
                container.innerHTML = '<p class="text-gray-500 text-center">Error loading comments.</p>';
            });
        }
        
        // Create comment element
        function createCommentElement(comment) {
            const commentDiv = document.createElement('div');
            commentDiv.className = 'ka-comment';
            
            const date = comment.createdAt ? new Date(comment.createdAt).toLocaleDateString() : 'Unknown date';
            
            commentDiv.innerHTML = `
                <div class="ka-comment-header">
                    <div class="ka-comment-avatar">${(comment.authorName || 'A').charAt(0).toUpperCase()}</div>
                    <div class="ka-comment-author">${comment.authorName || 'Anonymous'}</div>
                    <div class="ka-comment-date">${date}</div>
                </div>
                <div class="ka-comment-text">${comment.text}</div>
                <div class="ka-comment-actions">
                    <div class="ka-comment-action">
                        <i class="fas fa-thumbs-up"></i>
                        <span>Like</span>
                    </div>
                    <div class="ka-comment-action">
                        <i class="fas fa-reply"></i>
                        <span>Reply</span>
                    </div>
                </div>
            `;
            
            return commentDiv;
        }
        
        // Modal functions
        function showLoginModal() {
            document.getElementById('loginModal').classList.add('active');
        }
        
        function closeLoginModal() {
            document.getElementById('loginModal').classList.remove('active');
        }
        
        function switchToSignup() {
            closeLoginModal();
            document.getElementById('signupModal').classList.add('active');
        }
        
        function closeSignupModal() {
            document.getElementById('signupModal').classList.remove('active');
        }
        
        function switchToLogin() {
            closeSignupModal();
            document.getElementById('loginModal').classList.add('active');
        }
        
        function showCreateStudyGroup() {
            document.getElementById('createStudyGroupModal').classList.add('active');
        }
        
        function closeCreateStudyGroup() {
            document.getElementById('createStudyGroupModal').classList.remove('active');
        }
        
        // Authentication functions
        function signInWithGoogle() {
            const provider = new firebase.auth.GoogleAuthProvider();
            
            auth.signInWithPopup(provider)
                .then((result) => {
                    const user = result.user;
                    console.log("Google sign in successful:", user.uid);
                    showToast('success', 'Welcome!', 'You have been successfully signed in with Google.');
                    closeLoginModal();
                    justSignedIn = true;
                })
                .catch((error) => {
                    const errorCode = error.code;
                    const errorMessage = error.message;
                    console.error("Google sign in error:", errorCode, errorMessage);
                    
                    if (errorCode === 'auth/unauthorized-domain') {
                        showToast('error', 'Domain not authorized', 
                            'Please add your GitHub Pages domain to the authorized domains in your Firebase project settings.');
                    } else {
                        showToast('error', 'Sign in failed', errorMessage);
                    }
                });
        }
        
        function signOut() {
            auth.signOut().then(() => {
                showToast('success', 'Signed out', 'You have been successfully signed out.');
                document.getElementById('landingPage').style.display = 'flex';
                document.getElementById('prequizPage').style.display = 'none';
                document.getElementById('mainApp').style.display = 'none';
            }).catch((error) => {
                console.error("Error signing out:", error);
            });
        }
        
        // Utility functions
        function isValidEmail(email) {
            return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
        }
        
        function showLoading() {
            document.getElementById('loadingOverlay').style.display = 'flex';
        }
        
        function hideLoading() {
            document.getElementById('loadingOverlay').style.display = 'none';
        }
        
        // Toast notification
        function showToast(type, title, message) {
            const toastContainer = document.getElementById('toastContainer');
            
            const toast = document.createElement('div');
            toast.className = `ka-toast ${type}`;
            
            let icon = 'fa-info-circle';
            if (type === 'success') icon = 'fa-check-circle';
            else if (type === 'error') icon = 'fa-exclamation-circle';
            
            toast.innerHTML = `
                <div class="ka-toast-icon">
                    <i class="fas ${icon}"></i>
                </div>
                <div class="ka-toast-message">
                    <div class="ka-toast-title">${title}</div>
                    <div class="ka-toast-description">${message}</div>
                </div>
            `;
            
            toastContainer.appendChild(toast);
            
            // Show toast
            setTimeout(() => {
                toast.classList.add('show');
            }, 100);
            
            // Hide toast after 3 seconds
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => {
                    toast.remove();
                }, 300);
            }, 3000);
        }
        
        // Exercise functions
        function selectOption(element, isCorrect) {
            if (answerSubmitted) return;
            
            const options = document.querySelectorAll('.ka-option');
            
            // Remove previous selection
            options.forEach(option => {
                option.classList.remove('selected');
            });
            
            // Add selection to clicked option
            element.classList.add('selected');
            
            selectedOption = isCorrect;
            
            // Enable submit button
            document.querySelector('.ka-try-button').disabled = false;
        }
        
        function checkAnswer() {
            if (answerSubmitted) return;
            
            const options = document.querySelectorAll('.ka-option');
            const explanation = document.getElementById('explanation1') || document.getElementById('explanation2');
            
            if (selectedOption) {
                // Correct answer
                options.forEach(option => {
                    if (option.classList.contains('selected')) {
                        option.classList.add('correct');
                    }
                });
                
                explanation.classList.add('show');
                
                // Award points
                awardPoints(5, 'Correct answer');
                
                // Change button text
                document.querySelector('.ka-try-button').textContent = 'Continue';
                document.querySelector('.ka-try-button').onclick = function() {
                    explanation.classList.remove('show');
                    options.forEach(option => {
                        option.classList.remove('correct', 'selected');
                    });
                    this.textContent = 'Submit Answer';
                    this.disabled = true;
                    answerSubmitted = false;
                    selectedOption = null;
                };
            } else {
                // Incorrect answer
                options.forEach(option => {
                    if (option.classList.contains('selected')) {
                        option.classList.add('incorrect');
                    }
                });
                
                // Show correct answer
                options.forEach(option => {
                    if (!option.classList.contains('selected')) {
                        option.classList.add('correct');
                    }
                });
                
                explanation.classList.add('show');
                
                // Change button text
                document.querySelector('.ka-try-button').textContent = 'Continue';
                document.querySelector('.ka-try-button').onclick = function() {
                    explanation.classList.remove('show');
                    options.forEach(option => {
                        option.classList.remove('correct', 'incorrect', 'selected');
                    });
                    this.textContent = 'Submit Answer';
                    this.disabled = true;
                    answerSubmitted = false;
                    selectedOption = null;
                };
            }
            
            answerSubmitted = true;
        }
    </script>
</body>
</html>
