<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Elements Explorer - Alkali & Alkaline Earth Metals</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@500;700&display=swap');
        
        :root {
            --primary: #3b82f6;
            --secondary: #10b981;
            --accent: #8b5cf6;
            --dark: #1e293b;
            --light: #f8fafc;
            --gray: #e2e8f0;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #ffffff;
            color: var(--dark);
            overflow-x: hidden;
            position: relative;
        }
        
        /* Landing Page Styles */
        .landing-page {
            height: 100vh;
            width: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            position: relative;
            overflow: hidden;
        }
        
        .bg-pattern {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            opacity: 0.05;
            background-image: 
                radial-gradient(circle at 20% 30%, var(--primary) 0%, transparent 25%),
                radial-gradient(circle at 80% 70%, var(--secondary) 0%, transparent 25%),
                radial-gradient(circle at 40% 80%, var(--accent) 0%, transparent 20%);
            background-size: 100% 100%;
            animation: bgMove 30s infinite alternate ease-in-out;
        }
        
        @keyframes bgMove {
            0% { background-position: 0% 0%, 100% 100%, 50% 50%; }
            100% { background-position: 100% 100%, 0% 0%, 0% 100%; }
        }
        
        .floating-element {
            position: absolute;
            border-radius: 50%;
            opacity: 0.1;
            animation: float 15s infinite ease-in-out;
        }
        
        .element-1 {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            top: 10%;
            left: 10%;
            animation-delay: 0s;
        }
        
        .element-2 {
            width: 120px;
            height: 120px;
            background: linear-gradient(135deg, var(--secondary), var(--accent));
            top: 70%;
            left: 5%;
            animation-delay: 2s;
        }
        
        .element-3 {
            width: 100px;
            height: 100px;
            background: linear-gradient(135deg, var(--accent), var(--primary));
            top: 20%;
            right: 10%;
            animation-delay: 4s;
        }
        
        .element-4 {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            top: 60%;
            right: 15%;
            animation-delay: 1s;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(5deg); }
        }
        
        .landing-content {
            text-align: center;
            z-index: 10;
            max-width: 800px;
            padding: 0 20px;
            animation: fadeInUp 1s ease-out;
        }
        
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .app-title {
            font-family: 'Poppins', sans-serif;
            font-size: 4rem;
            font-weight: 700;
            margin-bottom: 1rem;
            background: linear-gradient(135deg, var(--primary), var(--secondary), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            line-height: 1.2;
        }
        
        .app-subtitle {
            font-size: 1.5rem;
            color: #64748b;
            margin-bottom: 2rem;
            font-weight: 300;
        }
        
        .app-description {
            font-size: 1.1rem;
            color: #64748b;
            margin-bottom: 3rem;
            line-height: 1.6;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .enter-button {
            padding: 1rem 3rem;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            border-radius: 50px;
            font-size: 1.2rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 10px 20px rgba(59, 130, 246, 0.3);
            position: relative;
            overflow: hidden;
        }
        
        .enter-button:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(59, 130, 246, 0.4);
        }
        
        .enter-button::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.2);
            transform: translateX(-100%);
            transition: transform 0.6s;
        }
        
        .enter-button:hover::before {
            transform: translateX(0);
        }
        
        .features {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin-top: 4rem;
            flex-wrap: wrap;
        }
        
        .feature {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 150px;
        }
        
        .feature-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 1rem;
            color: white;
            font-size: 1.5rem;
        }
        
        .feature-text {
            text-align: center;
            color: #64748b;
            font-size: 0.9rem;
        }
        
        /* Animated background elements */
        .bg-pattern {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            opacity: 0.05;
            background-image: 
                radial-gradient(circle at 20% 30%, var(--primary) 0%, transparent 25%),
                radial-gradient(circle at 80% 70%, var(--secondary) 0%, transparent 25%),
                radial-gradient(circle at 40% 80%, var(--accent) 0%, transparent 20%);
            background-size: 100% 100%;
            animation: bgMove 30s infinite alternate ease-in-out;
        }
        
        @keyframes bgMove {
            0% { background-position: 0% 0%, 100% 100%, 50% 50%; }
            100% { background-position: 100% 100%, 0% 0%, 0% 100%; }
        }
        
        /* Header styles */
        .header {
            background-color: white;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
            padding: 1.5rem 0;
            position: sticky;
            top: 0;
            z-index: 100;
            animation: slideDown 0.8s ease-out;
        }
        
        @keyframes slideDown {
            from { transform: translateY(-100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .logo {
            font-family: 'Poppins', sans-serif;
            font-size: 1.8rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .nav-button {
            position: relative;
            overflow: hidden;
            padding: 0.75rem 1.5rem;
            border-radius: 50px;
            font-weight: 500;
            transition: all 0.3s ease;
            border: 1px solid transparent;
        }
        
        .nav-button::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 50px;
            opacity: 0;
            z-index: -1;
            transition: opacity 0.3s ease;
        }
        
        .nav-button:hover::before {
            opacity: 0.1;
        }
        
        .nav-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.05);
        }
        
        .nav-button.active {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
        }
        
        /* Main content container */
        .main-container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 1.5rem;
            animation: fadeIn 1s ease-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Panel styles */
        .panel {
            background-color: white;
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.05);
            padding: 2rem;
            margin-bottom: 2rem;
            animation: slideUp 0.8s ease-out;
            position: relative;
            overflow: hidden;
        }
        
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .panel::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: linear-gradient(90deg, var(--primary), var(--secondary), var(--accent));
        }
        
        .panel-title {
            font-family: 'Poppins', sans-serif;
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 1.5rem;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        /* Element grid */
        .element-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 1.5rem;
            margin-top: 1.5rem;
        }
        
        .element-card {
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            padding: 1.25rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            border: 1px solid var(--gray);
        }
        
        .element-card::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            transform: translateY(-100%);
            transition: transform 0.3s ease;
        }
        
        .element-card:hover::before {
            transform: translateY(0);
        }
        
        .element-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.1);
        }
        
        .element-image {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            margin: 0 auto 0.75rem;
            object-fit: cover;
            border: 3px solid var(--gray);
            transition: all 0.3s ease;
        }
        
        .element-card:hover .element-image {
            border-color: var(--primary);
            transform: scale(1.05);
        }
        
        .element-symbol {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            color: var(--dark);
        }
        
        .element-name {
            font-size: 0.9rem;
            color: #64748b;
        }
        
        .element-group {
            position: absolute;
            top: 0.75rem;
            right: 0.75rem;
            font-size: 0.7rem;
            font-weight: 600;
            padding: 0.25rem 0.5rem;
            border-radius: 20px;
            background-color: var(--light);
        }
        
        .group-1 {
            color: var(--primary);
        }
        
        .group-2 {
            color: var(--secondary);
        }
        
        /* Atom viewer */
        .atom-viewer {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1.5rem;
        }
        
        #atom-canvas {
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            border: 1px solid var(--gray);
            max-width: 100%;
            height: 400px;
        }
        
        .atom-key {
            display: flex;
            justify-content: center;
            gap: 2rem;
            flex-wrap: wrap;
        }
        
        .atom-key-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
        }
        
        .color-circle {
            width: 1rem;
            height: 1rem;
            border-radius: 50%;
        }
        
        /* Facts panel */
        .facts-content {
            background-color: var(--light);
            border-radius: 12px;
            padding: 1.5rem;
            min-height: 400px;
            overflow-y: auto;
            line-height: 1.6;
        }
        
        .fact-item {
            margin-bottom: 1rem;
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
        }
        
        .fact-label {
            font-weight: 600;
            color: var(--primary);
            min-width: 160px;
        }
        
        /* Learn section */
        .tab-container {
            display: flex;
            border-bottom: 1px solid var(--gray);
            margin-bottom: 1.5rem;
        }
        
        .tab {
            padding: 0.75rem 1.5rem;
            font-weight: 500;
            cursor: pointer;
            position: relative;
            transition: all 0.3s ease;
        }
        
        .tab:hover {
            color: var(--primary);
        }
        
        .tab.active {
            color: var(--primary);
        }
        
        .tab.active::after {
            content: "";
            position: absolute;
            bottom: -1px;
            left: 0;
            width: 100%;
            height: 3px;
            background-color: var(--primary);
            border-radius: 3px 3px 0 0;
        }
        
        .tab-content {
            animation: fadeIn 0.5s ease-out;
        }
        
        /* Quiz styles */
        .quiz-question {
            margin-bottom: 2rem;
            padding: 1.5rem;
            background-color: var(--light);
            border-radius: 12px;
            border-left: 4px solid var(--accent);
        }
        
        .quiz-options {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            margin-top: 1rem;
        }
        
        .quiz-option {
            padding: 0.75rem 1rem;
            background-color: white;
            border: 1px solid var(--gray);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .quiz-option:hover {
            border-color: var(--primary);
            background-color: rgba(59, 130, 246, 0.05);
        }
        
        .quiz-option.selected {
            background-color: var(--primary);
            color: white;
            border-color: var(--primary);
        }
        
        .quiz-option.correct {
            background-color: var(--secondary);
            color: white;
            border-color: var(--secondary);
        }
        
        .quiz-option.incorrect {
            background-color: #ef4444;
            color: white;
            border-color: #ef4444;
        }
        
        /* Message box */
        .message-box {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: white;
            border-radius: 16px;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.15);
            padding: 2rem;
            max-width: 500px;
            width: 90%;
            z-index: 1000;
            text-align: center;
            animation: popIn 0.5s ease-out;
        }
        
        @keyframes popIn {
            from { transform: translate(-50%, -50%) scale(0.8); opacity: 0; }
            to { transform: translate(-50%, -50%) scale(1); opacity: 1; }
        }
        
        .message-title {
            font-family: 'Poppins', sans-serif;
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
            color: var(--dark);
        }
        
        .message-text {
            margin-bottom: 1.5rem;
            color: #64748b;
        }
        
        .message-button {
            padding: 0.75rem 2rem;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            border-radius: 50px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .message-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }
        
        /* Loading spinner */
        .loader {
            border: 3px solid var(--gray);
            border-top: 3px solid var(--primary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Responsive adjustments */
        @media (max-width: 768px) {
            .app-title {
                font-size: 3rem;
            }
            
            .app-subtitle {
                font-size: 1.2rem;
            }
            
            .features {
                gap: 1rem;
            }
            
            .feature {
                width: 120px;
            }
            
            .element-grid {
                grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            }
            
            .atom-key {
                gap: 1rem;
            }
            
            .fact-label {
                min-width: 120px;
            }
        }
        
        @media (max-width: 480px) {
            .app-title {
                font-size: 2.5rem;
            }
            
            .app-subtitle {
                font-size: 1rem;
            }
            
            .app-description {
                font-size: 1rem;
            }
            
            .enter-button {
                padding: 0.8rem 2rem;
                font-size: 1rem;
            }
            
            .features {
                flex-direction: column;
                align-items: center;
                gap: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <!-- Landing Page -->
    <div id="landing-page" class="landing-page">
        <div class="bg-pattern"></div>
        
        <!-- Floating elements -->
        <div class="floating-element element-1"></div>
        <div class="floating-element element-2"></div>
        <div class="floating-element element-3"></div>
        <div class="floating-element element-4"></div>
        
        <div class="landing-content">
            <h1 class="app-title">Elements Explorer</h1>
            <h2 class="app-subtitle">Discover Alkali & Alkaline Earth Metals</h2>
            <p class="app-description">
                An interactive learning experience that brings the periodic table to life. Explore the properties, reactions, and real-world applications of Group 1 and Group 2 elements through engaging visuals and interactive content.
            </p>
            
            <button id="enter-app-btn" class="enter-button">
                Enter Explorer <i class="fas fa-arrow-right ml-2"></i>
            </button>
            
            <div class="features">
                <div class="feature">
                    <div class="feature-icon">
                        <i class="fas fa-atom"></i>
                    </div>
                    <div class="feature-text">Interactive Atom Models</div>
                </div>
                <div class="feature">
                    <div class="feature-icon">
                        <i class="fas fa-flask"></i>
                    </div>
                    <div class="feature-text">Element Database</div>
                </div>
                <div class="feature">
                    <div class="feature-icon">
                        <i class="fas fa-book-open"></i>
                    </div>
                    <div class="feature-text">Learning Resources</div>
                </div>
                <div class="feature">
                    <div class="feature-icon">
                        <i class="fas fa-question-circle"></i>
                    </div>
                    <div class="feature-text">Interactive Quizzes</div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Main App (Hidden initially) -->
    <div id="main-app" class="hidden">
        <div class="bg-pattern"></div>
        
        <!-- Header -->
        <header class="header">
            <div class="container mx-auto px-4 flex flex-col md:flex-row justify-between items-center">
                <div class="logo mb-4 md:mb-0">
                    <i class="fas fa-atom"></i>
                    Elements Explorer
                </div>
                <nav class="flex flex-wrap justify-center gap-2">
                    <button id="nav-hub-btn" class="nav-button active">
                        <i class="fas fa-home mr-2"></i>Hub
                    </button>
                    <button id="nav-learn-btn" class="nav-button">
                        <i class="fas fa-book mr-2"></i>Learn
                    </button>
                    <button id="nav-prequiz-btn" class="nav-button">
                        <i class="fas fa-question-circle mr-2"></i>Pre-Quiz
                    </button>
                    <button id="nav-postquiz-btn" class="nav-button">
                        <i class="fas fa-graduation-cap mr-2"></i>Post-Quiz
                    </button>
                    <button id="nav-leaderboard-btn" class="nav-button">
                        <i class="fas fa-trophy mr-2"></i>Leaderboard
                    </button>
                </nav>
            </div>
        </header>
        
        <!-- Main Content -->
        <main class="main-container">
            <!-- Hub Section -->
            <div id="hub-section" class="panel">
                <h2 class="panel-title">
                    <i class="fas fa-flask"></i>
                    Elements Database
                </h2>
                
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <!-- Elements Panel -->
                    <div class="lg:col-span-1">
                        <h3 class="text-xl font-semibold mb-4 text-blue-600">Group I (Alkali Metals)</h3>
                        <div id="group-i-elements" class="element-grid"></div>
                        
                        <h3 class="text-xl font-semibold mt-6 mb-4 text-green-600">Group II (Alkaline Earth Metals)</h3>
                        <div id="group-ii-elements" class="element-grid"></div>
                    </div>
                    
                    <!-- Atom Viewer -->
                    <div class="lg:col-span-1">
                        <h3 class="text-xl font-semibold mb-4 text-purple-600">Interactive Atom Viewer</h3>
                        <div class="atom-viewer">
                            <canvas id="atom-canvas"></canvas>
                            <div class="atom-key">
                                <div class="atom-key-item">
                                    <span class="color-circle" style="background-color: #ef4444;"></span>
                                    <span>Nucleus</span>
                                </div>
                                <div class="atom-key-item">
                                    <span class="color-circle" style="background-color: #10b981;"></span>
                                    <span>Inner Electrons</span>
                                </div>
                                <div class="atom-key-item">
                                    <span class="color-circle" style="background-color: #f59e0b;"></span>
                                    <span>Valence Electrons</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Facts Panel -->
                    <div class="lg:col-span-1">
                        <h3 class="text-xl font-semibold mb-4 text-indigo-600">Element Data</h3>
                        <div id="facts-content" class="facts-content">
                            <p class="text-center text-gray-500 mt-8">Select an element to view its properties</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Learn Section -->
            <div id="learn-section" class="panel hidden">
                <button id="back-to-hub-btn" class="mb-6 px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg text-gray-700 font-medium transition-colors">
                    <i class="fas fa-arrow-left mr-2"></i>Back to Hub
                </button>
                
                <h2 class="panel-title">
                    <i class="fas fa-book-open"></i>
                    Learn about Alkali & Alkaline Earth Metals
                </h2>
                
                <div class="tab-container">
                    <div id="group-1-tab" class="tab active">Group 1: Alkali Metals</div>
                    <div id="group-2-tab" class="tab">Group 2: Alkaline Earth Metals</div>
                </div>
                
                <div id="learn-content">
                    <div id="group-1-content" class="tab-content"></div>
                    <div id="group-2-content" class="tab-content hidden"></div>
                </div>
                
                <div id="safety-notes" class="mt-8"></div>
            </div>
            
            <!-- Pre-Quiz Section -->
            <div id="prequiz-section" class="panel hidden">
                <button id="back-to-hub-btn-quiz" class="mb-6 px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg text-gray-700 font-medium transition-colors">
                    <i class="fas fa-arrow-left mr-2"></i>Back to Hub
                </button>
                
                <h2 class="panel-title">
                    <i class="fas fa-question-circle"></i>
                    Pre-Quiz (7 Questions)
                </h2>
                
                <div id="prequiz-content"></div>
                
                <div class="mt-6 text-center">
                    <button id="prequiz-submit-btn" class="px-6 py-3 bg-gradient-to-r from-blue-500 to-purple-500 text-white font-medium rounded-lg hover:opacity-90 transition-opacity">
                        Submit Answers
                    </button>
                    <div id="prequiz-results" class="mt-4 text-xl font-semibold"></div>
                </div>
            </div>
            
            <!-- Post-Quiz Section -->
            <div id="postquiz-section" class="panel hidden">
                <button id="back-to-hub-btn-postquiz" class="mb-6 px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg text-gray-700 font-medium transition-colors">
                    <i class="fas fa-arrow-left mr-2"></i>Back to Hub
                </button>
                
                <h2 class="panel-title">
                    <i class="fas fa-graduation-cap"></i>
                    Post-Quiz: Final Assessment
                </h2>
                
                <div id="postquiz-content"></div>
                
                <div class="mt-6 text-center">
                    <button id="postquiz-submit-btn" class="px-6 py-3 bg-gradient-to-r from-purple-500 to-pink-500 text-white font-medium rounded-lg hover:opacity-90 transition-opacity">
                        Submit Answers
                    </button>
                    <div id="postquiz-results" class="mt-4 text-xl font-semibold"></div>
                </div>
            </div>
        </main>
        
        <!-- Message Box -->
        <div id="message-box" class="message-box hidden">
            <h3 class="message-title">Feature Coming Soon!</h3>
            <p class="message-text">This feature is still under construction. Please check back later!</p>
            <button id="close-message-btn" class="message-button">Close</button>
        </div>
        
        <!-- User ID display -->
        <div class="text-center text-sm text-gray-500 mt-4 mb-2">
            User ID: <span id="user-id-display">Connecting...</span>
        </div>
    </div>
    
    <!-- Firebase SDKs and all application logic in a single module script -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInWithCustomToken, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, onSnapshot, collection, query } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        
        // Firebase Global Variables (Provided by Canvas Environment)
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
        
        let db, auth, userId;
        let isAuthReady = false;
        let typingAnimationRunning = false;
        let animationTimeout;
        
        // --- Data for all elements and quizzes ---
        const elementsData = {
            "Lithium": { 
                group: 'I', 
                atomicNumber: 3, 
                protons: 3, 
                neutrons: 4, 
                electrons: 3, 
                symbol: 'Li', 
                electronConfiguration: "2,1",
                meltingPoint: "181 °C", 
                boilingPoint: "1342 °C",
                period: 2,
                funFact: "The least reactive alkali metal, used in rechargeable batteries.",
                image: "https://images.unsplash.com/photo-1633412802994-5c058f151b66?w=100&h=100&fit=crop&crop=entropy"
            },
            "Sodium": { 
                group: 'I', 
                atomicNumber: 11, 
                protons: 11, 
                neutrons: 12, 
                electrons: 11, 
                symbol: 'Na', 
                electronConfiguration: "2,8,1",
                meltingPoint: "98 °C", 
                boilingPoint: "883 °C",
                period: 3,
                funFact: "Reacts vigorously with water, producing hydrogen gas and sodium hydroxide.",
                image: "https://images.unsplash.com/photo-1633412802994-5c058f151b66?w=100&h=100&fit=crop&crop=entropy"
            },
            "Potassium": { 
                group: 'I', 
                atomicNumber: 19, 
                protons: 19, 
                neutrons: 20, 
                electrons: 19, 
                symbol: 'K', 
                electronConfiguration: "2,8,8,1",
                meltingPoint: "63 °C", 
                boilingPoint: "759 °C",
                period: 4,
                funFact: "More reactive than sodium, burns with a lilac flame.",
                image: "https://images.unsplash.com/photo-1633412802994-5c058f151b66?w=100&h=100&fit=crop&crop=entropy"
            },
            "Rubidium": { 
                group: 'I', 
                atomicNumber: 37, 
                protons: 37, 
                neutrons: 48, 
                electrons: 37, 
                symbol: 'Rb', 
                electronConfiguration: "2,8,18,8,1",
                meltingPoint: "39 °C", 
                boilingPoint: "688 °C",
                period: 5,
                funFact: "Very reactive, ignites spontaneously in air.",
                image: "https://images.unsplash.com/photo-1633412802994-5c058f151b66?w=100&h=100&fit=crop&crop=entropy"
            },
            "Cesium": { 
                group: 'I', 
                atomicNumber: 55, 
                protons: 55, 
                neutrons: 78, 
                electrons: 55, 
                symbol: 'Cs', 
                electronConfiguration: "2,8,18,18,8,1",
                meltingPoint: "28.5 °C", 
                boilingPoint: "671 °C",
                period: 6,
                funFact: "Used in atomic clocks, the most reactive alkali metal studied in school labs.",
                image: "https://images.unsplash.com/photo-1633412802994-5c058f151b66?w=100&h=100&fit=crop&crop=entropy"
            },
            "Francium": { 
                group: 'I', 
                atomicNumber: 87, 
                protons: 87, 
                neutrons: 136, 
                electrons: 87, 
                symbol: 'Fr', 
                electronConfiguration: "2,8,18,32,18,8,1",
                meltingPoint: "27 °C", 
                boilingPoint: "677 °C",
                period: 7,
                funFact: "So radioactive it's almost never seen; the most reactive alkali metal.",
                image: "https://images.unsplash.com/photo-1633412802994-5c058f151b66?w=100&h=100&fit=crop&crop=entropy"
            },
            "Beryllium": { 
                group: 'II', 
                atomicNumber: 4, 
                protons: 4, 
                neutrons: 5, 
                electrons: 4, 
                symbol: 'Be', 
                electronConfiguration: "2,2",
                meltingPoint: "1287 °C", 
                boilingPoint: "2471 °C",
                period: 2,
                funFact: "Lightweight and very strong, used in aerospace materials.",
                image: "https://images.unsplash.com/photo-1633412802994-5c058f151b66?w=100&h=100&fit=crop&crop=entropy"
            },
            "Magnesium": { 
                group: 'II', 
                atomicNumber: 12, 
                protons: 12, 
                neutrons: 12, 
                electrons: 12, 
                symbol: 'Mg', 
                electronConfiguration: "2,8,2",
                meltingPoint: "650 °C", 
                boilingPoint: "1090 °C",
                period: 3,
                funFact: "Burns with a brilliant white flame, used in fireworks.",
                image: "https://images.unsplash.com/photo-1633412802994-5c058f151b66?w=100&h=100&fit=crop&crop=entropy"
            },
            "Calcium": { 
                group: 'II', 
                atomicNumber: 20, 
                protons: 20, 
                neutrons: 20, 
                electrons: 20, 
                symbol: 'Ca', 
                electronConfiguration: "2,8,8,2",
                meltingPoint: "842 °C", 
                boilingPoint: "1484 °C",
                period: 4,
                funFact: "Important for bones and teeth, reacts with water to form calcium hydroxide.",
                image: "https://images.unsplash.com/photo-1633412802994-5c058f151b66?w=100&h=100&fit=crop&crop=entropy"
            },
            "Strontium": { 
                group: 'II', 
                atomicNumber: 38, 
                protons: 38, 
                neutrons: 50, 
                electrons: 38, 
                symbol: 'Sr', 
                electronConfiguration: "2,8,18,8,2",
                meltingPoint: "777 °C", 
                boilingPoint: "1382 °C",
                period: 5,
                funFact: "Produces a bright red flame, used in fireworks and flares.",
                image: "https://images.unsplash.com/photo-1633412802994-5c058f151b66?w=100&h=100&fit=crop&crop=entropy"
            },
            "Barium": { 
                group: 'II', 
                atomicNumber: 56, 
                protons: 56, 
                neutrons: 81, 
                electrons: 56, 
                symbol: 'Ba', 
                electronConfiguration: "2,8,18,18,8,2",
                meltingPoint: "727 °C", 
                boilingPoint: "1870 °C",
                period: 6,
                funFact: "Gives a green flame, used in fireworks.",
                image: "https://images.unsplash.com/photo-1633412802994-5c058f151b66?w=100&h=100&fit=crop&crop=entropy"
            },
            "Radium": { 
                group: 'II', 
                atomicNumber: 88, 
                protons: 88, 
                neutrons: 138, 
                electrons: 88, 
                symbol: 'Ra', 
                electronConfiguration: "2,8,18,32,18,8,2",
                meltingPoint: "700 °C", 
                boilingPoint: "1737 °C",
                period: 7,
                funFact: "Highly radioactive, once used in glow-in-the-dark paint but now considered too dangerous.",
                image: "https://images.unsplash.com/photo-1633412802994-5c058f151b66?w=100&h=100&fit=crop&crop=entropy"
            }
        };
        
        const learnContent = {
            group1: `
                <h3 class="text-2xl font-semibold mt-6 mb-4 text-blue-600">Group 1: Alkali Metals (Li, Na, K, Rb, Cs, Fr)</h3>
                
                <h4 class="text-xl font-semibold mt-6 mb-3 text-blue-600">1. General Properties</h4>
                <ul class="list-disc pl-6 space-y-2">
                    <li><strong>Shiny and soft:</strong> Fresh metals have a metallic luster but are soft and can be cut with a knife.</li>
                    <li><strong>Low density:</strong> Li, Na, and K are less dense than water (they float!).</li>
                    <li><strong>Low melting and boiling points:</strong> Decrease down the group (Li highest, Cs lowest).</li>
                    <li><strong>Form basic oxides and hydroxides:</strong> React with water to produce alkaline solutions.</li>
                    <li><strong>Highly reactive:</strong> Reactivity increases down the group (Li < Na < K < Rb < Cs).</li>
                </ul>
                
                <h4 class="text-xl font-semibold mt-6 mb-3 text-blue-600">2. Physical Properties</h4>
                <div class="overflow-x-auto">
                    <table class="min-w-full bg-white rounded-lg overflow-hidden border border-gray-200">
                        <thead>
                            <tr class="bg-gray-50">
                                <th class="py-2 px-4 text-left">Property</th>
                                <th class="py-2 px-4 text-left">Trend Down the Group</th>
                                <th class="py-2 px-4 text-left">Example</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="border-b border-gray-200">
                                <td class="py-2 px-4">Density</td>
                                <td class="py-2 px-4">Increases (except K < Na)</td>
                                <td class="py-2 px-4">Li: 0.53 g/cm³, Na: 0.97 g/cm³, K: 0.86 g/cm³</td>
                            </tr>
                            <tr class="border-b border-gray-200">
                                <td class="py-2 px-4">Melting/Boiling point</td>
                                <td class="py-2 px-4">Decreases</td>
                                <td class="py-2 px-4">Li: 180°C, Na: 98°C, K: 63°C</td>
                            </tr>
                            <tr class="border-b border-gray-200">
                                <td class="py-2 px-4">Hardness</td>
                                <td class="py-2 px-4">Decreases</td>
                                <td class="py-2 px-4">Li: hard, Cs: very soft</td>
                            </tr>
                            <tr>
                                <td class="py-2 px-4">Appearance</td>
                                <td class="py-2 px-4">Shiny when freshly cut, dulls quickly</td>
                                <td class="py-2 px-4">Na tarnishes faster than Li</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <h4 class="text-xl font-semibold mt-6 mb-3 text-blue-600">3. Chemical Properties</h4>
                
                <h5 class="text-lg font-semibold mt-4 mb-2 text-blue-500">a) Reaction with Water</h5>
                <p class="mb-3">Produces hydrogen gas and an alkaline solution of metal hydroxide.</p>
                <p class="mb-3"><strong>Equation example:</strong></p>
                <p class="mb-3 bg-gray-50 p-3 rounded-lg">2Na + 2H₂O → 2NaOH + H₂↑</p>
                <p class="mb-3"><strong>Observation:</strong></p>
                <ul class="list-disc pl-6 space-y-1 mb-3">
                    <li>Effervescence (bubbles of H₂)</li>
                    <li>Metal moves on water surface</li>
                    <li>Heat released (sometimes ignites H₂, especially K, Rb, Cs)</li>
                </ul>
                
                <h5 class="text-lg font-semibold mt-4 mb-2 text-blue-500">b) Reaction with Oxygen</h5>
                <p class="mb-3">Forms metal oxides:</p>
                <div class="bg-gray-50 p-3 rounded-lg mb-3">
                    <p>4Li + O₂ → 2Li₂O (lithium oxide)</p>
                    <p>2Na + O₂ → Na₂O₂ (sodium peroxide)</p>
                    <p>K + O₂ → KO₂ (potassium superoxide)</p>
                </div>
                
                <h5 class="text-lg font-semibold mt-4 mb-2 text-blue-500">c) Reaction with Halogens</h5>
                <p class="mb-3">Forms ionic halides (white solids, soluble in water):</p>
                <div class="bg-gray-50 p-3 rounded-lg mb-3">
                    <p>2Na + Cl₂ → 2NaCl</p>
                </div>
                
                <h5 class="text-lg font-semibold mt-4 mb-2 text-blue-500">d) Reaction with Acids</h5>
                <p class="mb-3">React vigorously with dilute acids, releasing H₂:</p>
                <div class="bg-gray-50 p-3 rounded-lg mb-3">
                    <p>2K + 2HCl → 2KCl + H₂↑</p>
                </div>
                
                <h4 class="text-xl font-semibold mt-6 mb-3 text-blue-600">4. Trends Down the Group</h4>
                <div class="overflow-x-auto">
                    <table class="min-w-full bg-white rounded-lg overflow-hidden border border-gray-200">
                        <thead>
                            <tr class="bg-gray-50">
                                <th class="py-2 px-4 text-left">Property</th>
                                <th class="py-2 px-4 text-left">Trend</th>
                                <th class="py-2 px-4 text-left">Reason</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="border-b border-gray-200">
                                <td class="py-2 px-4">Reactivity</td>
                                <td class="py-2 px-4">Increases</td>
                                <td class="py-2 px-4">Outer electron is further from nucleus → easier to lose</td>
                            </tr>
                            <tr class="border-b border-gray-200">
                                <td class="py-2 px-4">Melting/Boiling point</td>
                                <td class="py-2 px-4">Decreases</td>
                                <td class="py-2 px-4">Weaker metallic bonds down the group</td>
                            </tr>
                            <tr class="border-b border-gray-200">
                                <td class="py-2 px-4">Density</td>
                                <td class="py-2 px-4">Generally increases</td>
                                <td class="py-2 px-4">Atomic mass increases</td>
                            </tr>
                            <tr>
                                <td class="py-2 px-4">Oxides formed</td>
                                <td class="py-2 px-4">Li → Li₂O, Na → Na₂O₂, K → KO₂</td>
                                <td class="py-2 px-4">More complex oxides as atom gets bigger</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <h4 class="text-xl font-semibold mt-6 mb-3 text-blue-600">5. Safety Notes</h4>
                <ul class="list-disc pl-6 space-y-2">
                    <li>Alkali metals are very reactive, especially with water.</li>
                    <li>Store under oil to prevent reaction with air/moisture.</li>
                    <li>Handle with tongs and protective equipment in labs.</li>
                </ul>
                
                <h4 class="text-xl font-semibold mt-6 mb-3 text-blue-600">6. Key Observations in Experiments</h4>
                <ul class="list-disc pl-6 space-y-2">
                    <li><strong>Li + Water:</strong> Fizzes slowly, floats, may move.</li>
                    <li><strong>Na + Water:</strong> Fizzes faster, floats, may melt into a ball.</li>
                    <li><strong>K + Water:</strong> Fizzes vigorously, floats, may ignite hydrogen gas.</li>
                </ul>
            `,
            group2: `
                <h3 class="text-2xl font-semibold mt-6 mb-4 text-green-600">Group 2: Alkaline Earth Metals (Be, Mg, Ca, Sr, Ba, Ra)</h3>
                
                <h4 class="text-xl font-semibold mt-6 mb-3 text-green-600">1. General Properties</h4>
                <ul class="list-disc pl-6 space-y-2">
                    <li><strong>Shiny and metallic:</strong> Fresh metals have a metallic luster; slightly harder than Group 1 metals.</li>
                    <li><strong>Reactive, but less than Group 1:</strong> Reactivity increases down the group.</li>
                    <li><strong>Form basic oxides and hydroxides:</strong> Produce alkaline solutions in water.</li>
                    <li><strong>Divalent metals:</strong> Form ions with a +2 charge (e.g., Ca²⁺, Mg²⁺).</li>
                </ul>
                
                <h4 class="text-xl font-semibold mt-6 mb-3 text-green-600">2. Physical Properties</h4>
                <div class="overflow-x-auto">
                    <table class="min-w-full bg-white rounded-lg overflow-hidden border border-gray-200">
                        <thead>
                            <tr class="bg-gray-50">
                                <th class="py-2 px-4 text-left">Property</th>
                                <th class="py-2 px-4 text-left">Trend Down the Group</th>
                                <th class="py-2 px-4 text-left">Example</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="border-b border-gray-200">
                                <td class="py-2 px-4">Density</td>
                                <td class="py-2 px-4">Increases</td>
                                <td class="py-2 px-4">Be: 1.85 g/cm³, Mg: 1.74 g/cm³, Ca: 1.55 g/cm³</td>
                            </tr>
                            <tr class="border-b border-gray-200">
                                <td class="py-2 px-4">Melting/Boiling point</td>
                                <td class="py-2 px-4">Decreases</td>
                                <td class="py-2 px-4">Be: 1287°C, Mg: 650°C, Ba: 725°C</td>
                            </tr>
                            <tr class="border-b border-gray-200">
                                <td class="py-2 px-4">Hardness</td>
                                <td class="py-2 px-4">Decreases</td>
                                <td class="py-2 px-4">Be: hard, Ba: soft</td>
                            </tr>
                            <tr>
                                <td class="py-2 px-4">Appearance</td>
                                <td class="py-2 px-4">Shiny when freshly cut, dulls quickly</td>
                                <td class="py-2 px-4">Similar to Group 1 but slightly harder</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <h4 class="text-xl font-semibold mt-6 mb-3 text-green-600">3. Chemical Properties</h4>
                
                <h5 class="text-lg font-semibold mt-4 mb-2 text-green-500">a) Reaction with Water</h5>
                <p class="mb-3">Be and Mg: Do not react with cold water; react slowly with steam.</p>
                <p class="mb-3">Ca, Sr, Ba: React with cold water to form hydroxides and hydrogen gas.</p>
                <p class="mb-3"><strong>Equation examples:</strong></p>
                <div class="bg-gray-50 p-3 rounded-lg mb-3">
                    <p>Ca + 2H₂O → Ca(OH)₂ + H₂↑</p>
                    <p>Mg + H₂O(steam) → MgO + H₂↑</p>
                </div>
                <p class="mb-3"><strong>Observation:</strong></p>
                <ul class="list-disc pl-6 space-y-1 mb-3">
                    <li>Effervescence (bubbles of H₂)</li>
                    <li>Metal dissolves slowly or floats on water</li>
                </ul>
                
                <h5 class="text-lg font-semibold mt-4 mb-2 text-green-500">b) Reaction with Oxygen</h5>
                <p class="mb-3">Forms oxides:</p>
                <div class="bg-gray-50 p-3 rounded-lg mb-3">
                    <p>2Mg + O₂ → 2MgO</p>
                    <p>Ca + O₂ → 2CaO</p>
                </div>
                
                <h5 class="text-lg font-semibold mt-4 mb-2 text-green-500">c) Reaction with Halogens</h5>
                <p class="mb-3">Forms ionic halides (white solids, soluble in water):</p>
                <div class="bg-gray-50 p-3 rounded-lg mb-3">
                    <p>Mg + Cl₂ → MgCl₂</p>
                </div>
                
                <h5 class="text-lg font-semibold mt-4 mb-2 text-green-500">d) Reaction with Acids</h5>
                <p class="mb-3">Reacts with dilute acids to release hydrogen gas:</p>
                <div class="bg-gray-50 p-3 rounded-lg mb-3">
                    <p>Mg + 2HCl → MgCl₂ + H₂↑</p>
                </div>
                
                <h4 class="text-xl font-semibold mt-6 mb-3 text-green-600">4. Trends Down the Group</h4>
                <div class="overflow-x-auto">
                    <table class="min-w-full bg-white rounded-lg overflow-hidden border border-gray-200">
                        <thead>
                            <tr class="bg-gray-50">
                                <th class="py-2 px-4 text-left">Property</th>
                                <th class="py-2 px-4 text-left">Trend</th>
                                <th class="py-2 px-4 text-left">Reason</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="border-b border-gray-200">
                                <td class="py-2 px-4">Reactivity</td>
                                <td class="py-2 px-4">Increases</td>
                                <td class="py-2 px-4">Outer electrons are further from nucleus → easier to lose</td>
                            </tr>
                            <tr class="border-b border-gray-200">
                                <td class="py-2 px-4">Melting/Boiling point</td>
                                <td class="py-2 px-4">Decreases</td>
                                <td class="py-2 px-4">Metallic bonding becomes weaker down the group</td>
                            </tr>
                            <tr class="border-b border-gray-200">
                                <td class="py-2 px-4">Density</td>
                                <td class="py-2 px-4">Increases</td>
                                <td class="py-2 px-4">Atomic mass increases</td>
                            </tr>
                            <tr class="border-b border-gray-200">
                                <td class="py-2 px-4">Solubility of hydroxides</td>
                                <td class="py-2 px-4">Increases</td>
                                <td class="py-2 px-4">Mg(OH)₂ least soluble, Ba(OH)₂ most soluble</td>
                            </tr>
                            <tr>
                                <td class="py-2 px-4">Solubility of sulfates</td>
                                <td class="py-2 px-4">Decreases</td>
                                <td class="py-2 px-4">MgSO₄ soluble, BaSO₄ insoluble</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <h4 class="text-xl font-semibold mt-6 mb-3 text-green-600">5. Uses of Group 2 Metals</h4>
                <ul class="list-disc pl-6 space-y-2">
                    <li><strong>Mg:</strong> Aircraft parts, fireworks (bright white flame)</li>
                    <li><strong>Ca:</strong> Cement, building materials, neutralizing soil acidity</li>
                    <li><strong>Ba:</strong> Barium meals (X-ray imaging)</li>
                    <li><strong>MgO / CaO:</strong> Refractory materials, neutralizing acids</li>
                </ul>
                
                <h4 class="text-xl font-semibold mt-6 mb-3 text-green-600">6. Safety Notes</h4>
                <ul class="list-disc pl-6 space-y-2">
                    <li>Store metals away from moisture to prevent unwanted reactions.</li>
                    <li>Ba compounds (except BaSO₄) are toxic – handle with care.</li>
                    <li>Use protective equipment during experiments.</li>
                </ul>
                
                <h4 class="text-xl font-semibold mt-6 mb-3 text-green-600">7. Key Observations in Experiments</h4>
                <ul class="list-disc pl-6 space-y-2">
                    <li><strong>Mg + Water:</strong> Very slow, only reacts with steam. Forms white MgO.</li>
                    <li><strong>Ca + Water:</strong> Effervescence, slight heat, forms cloudy Ca(OH)₂ solution.</li>
                    <li><strong>Ba + Water:</strong> Vigorous reaction, more heat, forms alkaline solution.</li>
                </ul>
            `,
            safetyNotes: `
                <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 rounded">
                    <h3 class="text-xl font-semibold mb-2 text-yellow-800">Safety Notes for both Groups</h3>
                    <ul class="list-disc pl-6 space-y-1">
                        <li>Store under oil to prevent reaction with air/moisture</li>
                        <li>Wear goggles, lab coat, gloves</li>
                        <li>Use small pieces for reactions</li>
                        <li>Never touch with bare hands</li>
                        <li>Rb, Cs, Ba are too reactive for most school demonstrations</li>
                    </ul>
                </div>
            `
        };
        
        const preQuizQuestions = [
            {
                type: 'multiple-choice',
                question: "Which Group 1 metal floats on water?",
                options: ["Lithium", "Sodium", "Potassium", "Cesium"],
                answer: "Lithium"
            },
            {
                type: 'multiple-choice',
                question: "Which metal reacts most vigorously with water?",
                options: ["Sodium", "Potassium", "Lithium", "Magnesium"],
                answer: "Potassium"
            },
            {
                type: 'drag-and-drop',
                question: "Match the metal to the gas released when reacting with water:",
                items: ["Li", "Na", "K", "Ca", "Mg"],
                answer: ["Li → H₂", "Na → H₂", "K → H₂", "Ca → H₂", "Mg → H₂"]
            },
            {
                type: 'multiple-choice',
                question: "Which Group 2 metal reacts very slowly with cold water but faster with steam?",
                options: ["Calcium", "Magnesium", "Barium", "Strontium"],
                answer: "Magnesium"
            },
            {
                type: 'click-to-select',
                question: "Which oxide is formed when potassium reacts with oxygen?",
                options: ["KO", "K₂O", "K₂O₂", "KO₂"],
                answer: "KO₂"
            },
            {
                type: 'multiple-choice',
                question: "Which hydroxide is most soluble in water?",
                options: ["Mg(OH)₂", "Ca(OH)₂", "Ba(OH)₂", "Be(OH)₂"],
                answer: "Ba(OH)₂"
            },
            {
                type: 'drag-and-drop',
                question: "Arrange these metals from least reactive to most reactive with water:",
                items: ["Li", "Na", "K", "Ca"],
                answer: ["Li", "Ca", "Na", "K"]
            }
        ];
        
        const postQuizQuestions = [
            {
                type: 'multiple-choice',
                question: "Which statement correctly describes the outer electron configuration?",
                options: ["A. Group 1 → ns², Group 2 → ns¹", "B. Group 1 → ns¹, Group 2 → ns²", "C. Both → ns¹", "D. Both → ns²"],
                answer: "B. Group 1 → ns¹, Group 2 → ns²"
            },
            {
                type: 'fill-in-the-blank',
                question: "Complete the equation for calcium reacting with water:",
                textBefore: "Equation: ",
                equation: "Ca + 2H₂O → ",
                blanks: [
                    { name: 'product', answer: 'Ca(OH)₂' },
                    { name: 'gas', answer: 'H₂' }
                ]
            },
            {
                type: 'drag-and-drop',
                question: "Place the metals in order of increasing reactivity:",
                items: ["Lithium (Li)", "Sodium (Na)", "Potassium (K)", "Cesium (Cs)"],
                answer: ["Lithium (Li)", "Sodium (Na)", "Potassium (K)", "Cesium (Cs)"]
            },
            {
                type: 'mcq-flame-colours',
                question: "Match the correct flame colour to each:",
                subQuestions: [
                    { label: "Lithium", options: ["Crimson red", "Lilac", "Brick red", "Apple green"], answer: "Crimson red" },
                    { label: "Potassium", options: ["Crimson red", "Lilac", "Brick red", "Apple green"], answer: "Lilac" },
                    { label: "Calcium", options: ["Crimson red", "Lilac", "Brick red", "Apple green"], answer: "Brick red" },
                    { label: "Barium", options: ["Crimson red", "Lilac", "Brick red", "Apple green"], answer: "Apple green" },
                ]
            },
            {
                type: 'short-answer',
                question: "What is the charge on the ion formed by:",
                subQuestions: [
                    { label: "Magnesium", answer: "+2" },
                    { label: "Sodium", answer: "+1" },
                ]
            },
            {
                type: 'true-or-false',
                question: "Group 1 density increases steadily with atomic number.",
                answer: "False",
                explanation: "(Irregular trend)"
            },
            {
                type: 'true-or-false',
                question: "Group 2 hydroxides become more soluble down the group.",
                answer: "True"
            },
            {
                type: 'multiple-choice',
                question: "Why is potassium stored under oil?",
                options: ["A. To reduce melting point", "B. To prevent contact with oxygen and moisture in air", "C. To make it more reactive", "D. To slow tarnishing only"],
                answer: "B. To prevent contact with oxygen and moisture in air"
            },
            {
                type: 'equation-balancing',
                question: "Balance the equation for the decomposition of magnesium carbonate:",
                equation: "MgCO₃ → MgO + CO₂",
                blanks: [
                    { name: 'MgCO₃', answer: '1' },
                    { name: 'MgO', answer: '1' },
                    { name: 'CO₂', answer: '1' }
                ]
            },
            {
                type: 'match-the-pair',
                question: "Match the observation to the metal:",
                items: [
                    { observation: "Fizzes gently, moves slowly", metal: "Lithium" },
                    { observation: "Lilac flame during reaction", metal: "Potassium" },
                    { observation: "Brick red flame, steady bubbling", metal: "Calcium" }
                ],
                matches: {
                    "Fizzes gently, moves slowly": "Lithium",
                    "Lilac flame during reaction": "Potassium",
                    "Brick red flame, steady bubbling": "Calcium"
                }
            },
            {
                type: 'extended-response',
                question: "Explain two differences in chemical reactivity between Group 1 and Group 2 metals, relating your answer to their electronic structures.",
                answer: "Group 1 metals have one outer electron, Group 2 have two; Group 1 metals lose their outer electron more easily, so they are more reactive; Group 2 metals form hydroxides that are less soluble than those of Group 1."
            }
        ];
        
        // UI References
        const ui = {
            landingPage: document.getElementById('landing-page'),
            mainApp: document.getElementById('main-app'),
            hubSection: document.getElementById('hub-section'),
            learnSection: document.getElementById('learn-section'),
            prequizSection: document.getElementById('prequiz-section'),
            postquizSection: document.getElementById('postquiz-section'),
            group1Tab: document.getElementById('group-1-tab'),
            group2Tab: document.getElementById('group-2-tab'),
            group1Content: document.getElementById('group-1-content'),
            group2Content: document.getElementById('group-2-content'),
            safetyNotes: document.getElementById('safety-notes'),
            prequizContent: document.getElementById('prequiz-content'),
            prequizResults: document.getElementById('prequiz-results'),
            postquizContent: document.getElementById('postquiz-content'),
            postquizResults: document.getElementById('postquiz-results'),
            factsContent: document.getElementById('facts-content'),
            group1Elements: document.getElementById('group-i-elements'),
            group2Elements: document.getElementById('group-ii-elements'),
            messageBox: document.getElementById('message-box'),
            messageText: document.querySelector('.message-text'),
            closeMessageBtn: document.getElementById('close-message-btn'),
            prequizSubmitBtn: document.getElementById('prequiz-submit-btn'),
            postquizSubmitBtn: document.getElementById('postquiz-submit-btn'),
            userIdDisplay: document.getElementById('user-id-display'),
            enterAppBtn: document.getElementById('enter-app-btn')
        };
        
        // --- Utility functions ---
        function showMessage(message) {
            ui.messageText.textContent = message;
            ui.messageBox.classList.remove('hidden');
        }
        
        function hideMessage() {
            ui.messageBox.classList.add('hidden');
        }
        
        // --- 2D Atom Viewer (Canvas) ---
        let canvas, ctx;
        let animationFrameId;
        let atom = null;
        let currentElement = null;
        let scale = 1;
        let translateX = 0;
        let translateY = 0;
        let isDragging = false;
        let lastMouseX = 0;
        let lastMouseY = 0;
        
        function init2DViewer() {
            canvas = document.getElementById('atom-canvas');
            ctx = canvas.getContext('2d');
            
            const resizeCanvas = () => {
                const parent = canvas.parentElement;
                const size = Math.min(parent.clientWidth, parent.clientHeight);
                if (size > 0) {
                    canvas.width = size;
                    canvas.height = size;
                    
                    if (currentElement) {
                        updateAtomViewer(currentElement);
                    } else {
                        drawDefaultMessage();
                    }
                }
            };
            window.addEventListener('resize', resizeCanvas);
            
            // Add mouse events for pan and zoom
            canvas.addEventListener('wheel', handleWheel);
            canvas.addEventListener('mousedown', handleMouseDown);
            canvas.addEventListener('mousemove', handleMouseMove);
            canvas.addEventListener('mouseup', handleMouseUp);
            canvas.addEventListener('mouseleave', handleMouseUp);
        }
        
        function handleWheel(e) {
            e.preventDefault();
            const zoomSpeed = 0.1;
            const mouseX = e.clientX - canvas.getBoundingClientRect().left;
            const mouseY = e.clientY - canvas.getBoundingClientRect().top;
            
            const oldScale = scale;
            const newScale = e.deltaY < 0 ? oldScale * (1 + zoomSpeed) : oldScale / (1 + zoomSpeed);
            
            scale = Math.max(0.5, Math.min(newScale, 3)); 
            translateX = mouseX - (mouseX - translateX) * (scale / oldScale);
            translateY = mouseY - (mouseY - translateY) * (scale / oldScale);
        }
        
        function handleMouseDown(e) {
            isDragging = true;
            lastMouseX = e.clientX;
            lastMouseY = e.clientY;
        }
        
        function handleMouseMove(e) {
            if (!isDragging) return;
            const deltaX = e.clientX - lastMouseX;
            const deltaY = e.clientY - lastMouseY;
            translateX += deltaX;
            translateY += deltaY;
            lastMouseX = e.clientX;
            lastMouseY = e.clientY;
        }
        
        function handleMouseUp() {
            isDragging = false;
        }
        
        function animate() {
            if (atom) {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                atom.electronOrbits.forEach(orbit => {
                    orbit.angle += orbit.speed;
                });
                drawAtom(currentElement, atom);
            }
            animationFrameId = requestAnimationFrame(animate);
        }
        
        function drawDefaultMessage() {
            if (!ctx || !canvas) return;
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.save();
            ctx.fillStyle = '#64748b';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.font = '18px "Inter", sans-serif';
            ctx.fillText("Select an element to view its atom", canvas.width / 2, canvas.height / 2);
            ctx.restore();
            
            // Stop any previous animation
            if (animationFrameId) {
                cancelAnimationFrame(animationFrameId);
            }
        }
        
        function drawAtom(element, atomData) {
            if (!ctx || !element || !atomData) return;
            ctx.save();
            ctx.translate(canvas.width / 2 + translateX, canvas.height / 2 + translateY);
            ctx.scale(scale, scale);
            
            // Draw nucleus
            ctx.beginPath();
            ctx.arc(0, 0, 30, 0, Math.PI * 2);
            ctx.fillStyle = '#ef4444';
            ctx.shadowColor = '#ef4444';
            ctx.shadowBlur = 10;
            ctx.fill();
            ctx.shadowBlur = 0;
            
            // Draw element symbol and atomic number
            ctx.fillStyle = '#ffffff';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.font = 'bold 18px "Inter", sans-serif';
            ctx.fillText(element.symbol, 0, -10);
            ctx.font = '12px "Inter", sans-serif';
            ctx.fillText(element.atomicNumber, 0, 10);
            
            // Draw electron orbits and electrons
            atomData.electronOrbits.forEach(orbit => {
                ctx.beginPath();
                ctx.arc(0, 0, orbit.radius, 0, Math.PI * 2);
                ctx.strokeStyle = 'rgba(203, 213, 225, 0.3)';
                ctx.lineWidth = 2;
                ctx.stroke();
                
                orbit.electrons.forEach((electron, index) => {
                    const electronX = 0 + orbit.radius * Math.cos(orbit.angle + (index * ((Math.PI * 2) / orbit.electrons.length)));
                    const electronY = 0 + orbit.radius * Math.sin(orbit.angle + (index * ((Math.PI * 2) / orbit.electrons.length)));
                    
                    ctx.beginPath();
                    ctx.arc(electronX, electronY, 8, 0, Math.PI * 2);
                    ctx.fillStyle = electron.isValence ? '#f59e0b' : '#10b981';
                    ctx.shadowColor = electron.isValence ? '#f59e0b' : '#10b981';
                    ctx.shadowBlur = 8;
                    ctx.fill();
                    ctx.shadowBlur = 0;
                });
            });
            
            ctx.restore();
        }
        
        function updateAtomViewer(element) {
            if (animationFrameId) {
                cancelAnimationFrame(animationFrameId);
            }
            currentElement = element;
            const { electrons: numElectrons, group } = element;
            
            const numValenceElectrons = (group === 'I' || group === 'i') ? 1 : 2;
            const numInnerElectrons = numElectrons - numValenceElectrons;
            const shellCapacities = [2, 8, 18, 32, 18, 8, 2];
            let remainingInnerElectrons = numInnerElectrons;
            let currentRadius = 50;
            const orbits = [];
            
            for (let i = 0; i < shellCapacities.length && remainingInnerElectrons > 0; i++) {
                const electronsInShell = Math.min(shellCapacities[i], remainingInnerElectrons);
                
                const electronArray = [];
                for (let j = 0; j < electronsInShell; j++) {
                    electronArray.push({ isValence: false });
                }
                
                orbits.push({
                    radius: currentRadius,
                    electrons: electronArray,
                    angle: Math.random() * Math.PI * 2,
                    speed: 0.01 / (i + 1)
                });
                remainingInnerElectrons -= electronsInShell;
                currentRadius += 40;
            }
            
            const valenceElectronArray = [];
            for (let j = 0; j < numValenceElectrons; j++) {
                valenceElectronArray.push({ isValence: true });
            }
            
            orbits.push({
                radius: currentRadius,
                electrons: valenceElectronArray,
                angle: Math.random() * Math.PI * 2,
                speed: 0.01 / (orbits.length + 1)
            });
            
            atom = {
                electronOrbits: orbits
            };
            
            const largestRadius = orbits.length > 0 ? orbits[orbits.length - 1].radius : 0;
            const atomDiameter = (largestRadius + 8) * 2;
            const padding = 100;
            
            // Re-calculate canvas dimensions and scale just before drawing
            const parent = canvas.parentElement;
            const size = Math.min(parent.clientWidth, parent.clientHeight);
            canvas.width = size;
            canvas.height = size;
            
            const minDimension = Math.min(canvas.width, canvas.height);
            if (atomDiameter > 0) {
                scale = minDimension / (atomDiameter + padding);
            } else {
                scale = 1;
            }
            translateX = 0;
            translateY = 0;
            
            animate();
        }
        
        // --- End 2D Atom Viewer ---
        
        // --- UI & Event Handlers ---
        function updateFactsPanel(elementName) {
            const element = elementsData[elementName];
            if (!element) return;
            
            ui.factsContent.innerHTML = '';
            
            const facts = [
                { label: 'Atomic Number', value: element.atomicNumber },
                { label: 'Protons', value: element.protons },
                { label: 'Neutrons', value: element.neutrons },
                { label: 'Electrons', value: element.electrons },
                { label: 'Electron Configuration', value: element.electronConfiguration },
                { label: 'Symbol', value: `${element.symbol} - ${elementName}` },
                { label: 'Melting Point', value: element.meltingPoint },
                { label: 'Boiling Point', value: element.boilingPoint },
                { label: 'Period', value: element.period },
                { label: 'Fun Fact', value: element.funFact }
            ];
            
            facts.forEach(fact => {
                const factItem = document.createElement('div');
                factItem.className = 'fact-item';
                factItem.innerHTML = `
                    <div class="fact-label">${fact.label}:</div>
                    <div>${fact.value}</div>
                `;
                ui.factsContent.appendChild(factItem);
            });
        }
        
        function showLearnSection(group) {
            // Deactivate all tabs and content panels first
            ui.group1Tab.classList.remove('active');
            ui.group2Tab.classList.remove('active');
            ui.group1Content.classList.add('hidden');
            ui.group2Content.classList.add('hidden');
            
            // Activate the selected tab and content panel
            if (group === 'group1') {
                ui.group1Tab.classList.add('active');
                ui.group1Content.classList.remove('hidden');
                ui.group1Content.innerHTML = learnContent.group1;
            } else if (group === 'group2') {
                ui.group2Tab.classList.add('active');
                ui.group2Content.classList.remove('hidden');
                ui.group2Content.innerHTML = learnContent.group2;
            }
            
            ui.safetyNotes.innerHTML = learnContent.safetyNotes;
        }
        
        function openHubPanel() {
            ui.learnSection.classList.add('hidden');
            ui.prequizSection.classList.add('hidden');
            ui.postquizSection.classList.add('hidden');
            ui.hubSection.classList.remove('hidden');
            
            // Update active nav button
            document.querySelectorAll('.nav-button').forEach(btn => btn.classList.remove('active'));
            document.getElementById('nav-hub-btn').classList.add('active');
            
            // Force the canvas to resize now that its parent is visible
            const parent = canvas.parentElement;
            const size = Math.min(parent.clientWidth, parent.clientHeight);
            canvas.width = size;
            canvas.height = size;
            
            if (currentElement) {
                updateAtomViewer(currentElement);
            } else {
                drawDefaultMessage();
            }
        }
        
        function openLearnPanel() {
            ui.hubSection.classList.add('hidden');
            ui.prequizSection.classList.add('hidden');
            ui.postquizSection.classList.add('hidden');
            ui.learnSection.classList.remove('hidden');
            
            // Update active nav button
            document.querySelectorAll('.nav-button').forEach(btn => btn.classList.remove('active'));
            document.getElementById('nav-learn-btn').classList.add('active');
            
            // Default to showing Group 1 when the panel opens
            showLearnSection('group1');
        }
        
        function openPrequizPanel() {
            ui.hubSection.classList.add('hidden');
            ui.learnSection.classList.add('hidden');
            ui.postquizSection.classList.add('hidden');
            ui.prequizSection.classList.remove('hidden');
            
            // Update active nav button
            document.querySelectorAll('.nav-button').forEach(btn => btn.classList.remove('active'));
            document.getElementById('nav-prequiz-btn').classList.add('active');
            
            generateQuizUI(preQuizQuestions, ui.prequizContent);
        }
        
        function openPostquizPanel() {
            const preQuizCompleted = localStorage.getItem(`${appId}-preQuizCompleted`);
            if (!preQuizCompleted) {
                showMessage("You must complete the pre-quiz before attempting the post-quiz.");
                return;
            }
            
            ui.hubSection.classList.add('hidden');
            ui.learnSection.classList.add('hidden');
            ui.prequizSection.classList.add('hidden');
            ui.postquizSection.classList.remove('hidden');
            
            // Update active nav button
            document.querySelectorAll('.nav-button').forEach(btn => btn.classList.remove('active'));
            document.getElementById('nav-postquiz-btn').classList.add('active');
            
            generatePostQuizUI();
        }
        
        function generateQuizUI(questions, container) {
            container.innerHTML = '';
            
            questions.forEach((q, index) => {
                const questionDiv = document.createElement('div');
                questionDiv.className = 'quiz-question';
                questionDiv.innerHTML = `<p class="font-semibold mb-3">${index + 1}. ${q.question}</p>`;
                
                if (q.type === 'multiple-choice' || q.type === 'click-to-select') {
                    const optionsDiv = document.createElement('div');
                    optionsDiv.className = 'quiz-options';
                    
                    q.options.forEach(option => {
                        const optionBtn = document.createElement('button');
                        optionBtn.className = 'quiz-option';
                        optionBtn.textContent = option;
                        optionBtn.dataset.questionIndex = index;
                        optionBtn.dataset.answer = option;
                        
                        optionBtn.addEventListener('click', function() {
                            // Remove selected class from all options for this question
                            container.querySelectorAll(`.quiz-option[data-question-index="${index}"]`).forEach(btn => {
                                btn.classList.remove('selected');
                            });
                            
                            // Add selected class to clicked option
                            this.classList.add('selected');
                        });
                        
                        optionsDiv.appendChild(optionBtn);
                    });
                    
                    questionDiv.appendChild(optionsDiv);
                } else if (q.type === 'drag-and-drop') {
                    const shuffledItems = [...q.items].sort(() => Math.random() - 0.5);
                    
                    const dragContainer = document.createElement('div');
                    dragContainer.className = 'flex flex-col space-y-4';
                    
                    // Source container
                    const sourceContainer = document.createElement('div');
                    sourceContainer.className = 'flex flex-wrap justify-center gap-3 p-4 bg-gray-100 rounded-lg';
                    sourceContainer.dataset.type = 'source';
                    
                    shuffledItems.forEach(item => {
                        const dragItem = document.createElement('div');
                        dragItem.className = 'draggable-item px-4 py-2 bg-white rounded-lg shadow cursor-move';
                        dragItem.draggable = true;
                        dragItem.dataset.value = item;
                        dragItem.textContent = item;
                        
                        dragItem.addEventListener('dragstart', handleDragStart);
                        dragItem.addEventListener('dragend', handleDragEnd);
                        
                        sourceContainer.appendChild(dragItem);
                    });
                    
                    dragContainer.appendChild(sourceContainer);
                    
                    // Target container
                    const targetContainer = document.createElement('div');
                    targetContainer.className = 'flex flex-wrap justify-center gap-2';
                    
                    Array(q.answer.length).fill(0).forEach((_, i) => {
                        const dropzone = document.createElement('div');
                        dropzone.className = 'dropzone w-24 h-12 border-2 border-dashed border-gray-300 rounded-lg flex items-center justify-center';
                        dropzone.dataset.type = 'target';
                        dropzone.dataset.index = i;
                        dropzone.textContent = 'Drop Here';
                        
                        dropzone.addEventListener('dragover', handleDragOver);
                        dropzone.addEventListener('drop', handleDrop);
                        
                        targetContainer.appendChild(dropzone);
                        
                        if (i < q.answer.length - 1) {
                            const arrow = document.createElement('span');
                            arrow.className = 'text-2xl text-gray-400';
                            arrow.textContent = '→';
                            targetContainer.appendChild(arrow);
                        }
                    });
                    
                    dragContainer.appendChild(targetContainer);
                    questionDiv.appendChild(dragContainer);
                }
                
                container.appendChild(questionDiv);
            });
        }
        
        function generatePostQuizUI() {
            ui.postquizContent.innerHTML = '';
            ui.postquizResults.textContent = '';
            
            postQuizQuestions.forEach((q, index) => {
                const questionDiv = document.createElement('div');
                questionDiv.className = 'quiz-question';
                questionDiv.innerHTML = `<p class="font-semibold mb-3">${index + 1}. ${q.question}</p>`;
                
                if (q.type === 'multiple-choice') {
                    const optionsDiv = document.createElement('div');
                    optionsDiv.className = 'quiz-options';
                    
                    q.options.forEach(option => {
                        const optionBtn = document.createElement('button');
                        optionBtn.className = 'quiz-option';
                        optionBtn.textContent = option;
                        optionBtn.dataset.questionIndex = index;
                        optionBtn.dataset.answer = option;
                        
                        optionBtn.addEventListener('click', function() {
                            // Remove selected class from all options for this question
                            ui.postquizContent.querySelectorAll(`.quiz-option[data-question-index="${index}"]`).forEach(btn => {
                                btn.classList.remove('selected');
                            });
                            
                            // Add selected class to clicked option
                            this.classList.add('selected');
                        });
                        
                        optionsDiv.appendChild(optionBtn);
                    });
                    
                    questionDiv.appendChild(optionsDiv);
                } else if (q.type === 'fill-in-the-blank') {
                    const inputContainer = document.createElement('div');
                    inputContainer.className = 'flex items-center space-x-2';
                    inputContainer.innerHTML = `
                        <span>Ca + 2H₂O → </span>
                        <input type="text" id="blank-product-${index}" class="px-3 py-2 border border-gray-300 rounded-lg w-32" placeholder="...">
                        <span> + </span>
                        <input type="text" id="blank-gas-${index}" class="px-3 py-2 border border-gray-300 rounded-lg w-32" placeholder="...">
                    `;
                    questionDiv.appendChild(inputContainer);
                } else if (q.type === 'drag-and-drop') {
                    const shuffledItems = [...q.items].sort(() => Math.random() - 0.5);
                    
                    const dragContainer = document.createElement('div');
                    dragContainer.className = 'flex flex-col space-y-4';
                    
                    // Source container
                    const sourceContainer = document.createElement('div');
                    sourceContainer.className = 'flex flex-wrap justify-center gap-3 p-4 bg-gray-100 rounded-lg';
                    sourceContainer.dataset.type = 'source';
                    
                    shuffledItems.forEach(item => {
                        const dragItem = document.createElement('div');
                        dragItem.className = 'draggable-item px-4 py-2 bg-white rounded-lg shadow cursor-move';
                        dragItem.draggable = true;
                        dragItem.dataset.value = item;
                        dragItem.textContent = item;
                        
                        dragItem.addEventListener('dragstart', handleDragStart);
                        dragItem.addEventListener('dragend', handleDragEnd);
                        
                        sourceContainer.appendChild(dragItem);
                    });
                    
                    dragContainer.appendChild(sourceContainer);
                    
                    // Reactivity indicators
                    const reactivityContainer = document.createElement('div');
                    reactivityContainer.className = 'flex items-center justify-center space-x-4 my-2';
                    reactivityContainer.innerHTML = `
                        <span class="text-sm text-gray-500">Least Reactive</span>
                        <span class="text-3xl text-gray-400">→</span>
                        <span class="text-sm text-gray-500">Most Reactive</span>
                    `;
                    dragContainer.appendChild(reactivityContainer);
                    
                    // Target container
                    const targetContainer = document.createElement('div');
                    targetContainer.className = 'flex flex-wrap justify-center gap-2';
                    
                    Array(q.answer.length).fill(0).forEach((_, i) => {
                        const dropzone = document.createElement('div');
                        dropzone.className = 'dropzone w-32 h-12 border-2 border-dashed border-gray-300 rounded-lg flex items-center justify-center';
                        dropzone.dataset.type = 'target';
                        dropzone.dataset.index = i;
                        dropzone.textContent = 'Drop Here';
                        
                        dropzone.addEventListener('dragover', handleDragOver);
                        dropzone.addEventListener('drop', handleDrop);
                        
                        targetContainer.appendChild(dropzone);
                        
                        if (i < q.answer.length - 1) {
                            const arrow = document.createElement('span');
                            arrow.className = 'text-3xl text-gray-400';
                            arrow.textContent = '→';
                            targetContainer.appendChild(arrow);
                        }
                    });
                    
                    dragContainer.appendChild(targetContainer);
                    questionDiv.appendChild(dragContainer);
                } else if (q.type === 'mcq-flame-colours') {
                    q.subQuestions.forEach(sq => {
                        const subQuestionDiv = document.createElement('div');
                        subQuestionDiv.className = 'mb-4';
                        subQuestionDiv.innerHTML = `<p class="font-medium">${sq.label}:</p>`;
                        
                        const optionsDiv = document.createElement('div');
                        optionsDiv.className = 'flex flex-wrap gap-2 mt-2';
                        
                        sq.options.forEach(option => {
                            const optionBtn = document.createElement('button');
                            optionBtn.className = 'quiz-option';
                            optionBtn.textContent = option;
                            optionBtn.dataset.questionIndex = index;
                            optionBtn.dataset.subLabel = sq.label;
                            optionBtn.dataset.answer = option;
                            
                            optionBtn.addEventListener('click', function() {
                                // Remove selected class from all options for this sub-question
                                ui.postquizContent.querySelectorAll(`.quiz-option[data-question-index="${index}"][data-sub-label="${sq.label}"]`).forEach(btn => {
                                    btn.classList.remove('selected');
                                });
                                
                                // Add selected class to clicked option
                                this.classList.add('selected');
                            });
                            
                            optionsDiv.appendChild(optionBtn);
                        });
                        
                        subQuestionDiv.appendChild(optionsDiv);
                        questionDiv.appendChild(subQuestionDiv);
                    });
                } else if (q.type === 'short-answer') {
                    q.subQuestions.forEach(sq => {
                        const answerDiv = document.createElement('div');
                        answerDiv.className = 'flex items-center space-x-2 mb-3';
                        answerDiv.innerHTML = `
                            <span class="font-medium">${sq.label}:</span>
                            <input type="text" id="short-answer-${sq.label.toLowerCase()}-${index}" class="px-3 py-2 border border-gray-300 rounded-lg w-24" placeholder="...">
                        `;
                        questionDiv.appendChild(answerDiv);
                    });
                } else if (q.type === 'true-or-false') {
                    const optionsDiv = document.createElement('div');
                    optionsDiv.className = 'flex space-x-4';
                    
                    ['True', 'False'].forEach(option => {
                        const optionBtn = document.createElement('button');
                        optionBtn.className = 'quiz-option';
                        optionBtn.textContent = option;
                        optionBtn.dataset.questionIndex = index;
                        optionBtn.dataset.answer = option;
                        
                        optionBtn.addEventListener('click', function() {
                            // Remove selected class from all options for this question
                            ui.postquizContent.querySelectorAll(`.quiz-option[data-question-index="${index}"]`).forEach(btn => {
                                btn.classList.remove('selected');
                            });
                            
                            // Add selected class to clicked option
                            this.classList.add('selected');
                        });
                        
                        optionsDiv.appendChild(optionBtn);
                    });
                    
                    questionDiv.appendChild(optionsDiv);
                } else if (q.type === 'equation-balancing') {
                    const equationDiv = document.createElement('div');
                    equationDiv.className = 'flex items-center space-x-2';
                    equationDiv.innerHTML = `
                        <input type="text" id="coeff-1-${index}" class="px-3 py-2 border border-gray-300 rounded-lg w-16 text-center" placeholder="1">
                        <span>MgCO₃ → </span>
                        <input type="text" id="coeff-2-${index}" class="px-3 py-2 border border-gray-300 rounded-lg w-16 text-center" placeholder="1">
                        <span>MgO + </span>
                        <input type="text" id="coeff-3-${index}" class="px-3 py-2 border border-gray-300 rounded-lg w-16 text-center" placeholder="1">
                        <span>CO₂</span>
                    `;
                    questionDiv.appendChild(equationDiv);
                } else if (q.type === 'match-the-pair') {
                    const matchContainer = document.createElement('div');
                    matchContainer.className = 'grid grid-cols-1 md:grid-cols-2 gap-6 mt-2';
                    
                    // Observations column
                    const observationsCol = document.createElement('div');
                    observationsCol.innerHTML = '<h4 class="font-semibold mb-3">Observations</h4>';
                    
                    const observationsContainer = document.createElement('div');
                    observationsContainer.className = 'space-y-3';
                    
                    const shuffledObservations = [...q.items.map(i => i.observation)].sort(() => Math.random() - 0.5);
                    
                    shuffledObservations.forEach(obs => {
                        const matchItem = document.createElement('div');
                        matchItem.className = 'match-item p-3 bg-white rounded-lg shadow cursor-move';
                        matchItem.draggable = true;
                        matchItem.dataset.value = obs;
                        matchItem.textContent = obs;
                        
                        matchItem.addEventListener('dragstart', handleDragStart);
                        matchItem.addEventListener('dragend', handleDragEnd);
                        
                        observationsContainer.appendChild(matchItem);
                    });
                    
                    observationsCol.appendChild(observationsContainer);
                    matchContainer.appendChild(observationsCol);
                    
                    // Metals column
                    const metalsCol = document.createElement('div');
                    metalsCol.innerHTML = '<h4 class="font-semibold mb-3">Metals</h4>';
                    
                    const metalsContainer = document.createElement('div');
                    metalsContainer.className = 'space-y-3';
                    
                    q.items.forEach(item => {
                        const dropzone = document.createElement('div');
                        dropzone.className = 'dropzone-match p-3 bg-gray-100 rounded-lg border-2 border-dashed border-gray-300';
                        dropzone.dataset.value = item.metal;
                        dropzone.textContent = item.metal;
                        
                        dropzone.addEventListener('dragover', handleDragOver);
                        dropzone.addEventListener('drop', handleDrop);
                        
                        metalsContainer.appendChild(dropzone);
                    });
                    
                    metalsCol.appendChild(metalsContainer);
                    matchContainer.appendChild(metalsCol);
                    
                    questionDiv.appendChild(matchContainer);
                } else if (q.type === 'extended-response') {
                    const textarea = document.createElement('textarea');
                    textarea.id = `extended-response-${index}`;
                    textarea.className = 'w-full h-32 p-3 border border-gray-300 rounded-lg resize-none';
                    textarea.placeholder = 'Type your answer here...';
                    questionDiv.appendChild(textarea);
                }
                
                ui.postquizContent.appendChild(questionDiv);
            });
        }
        
        // Drag and drop handlers
        function handleDragStart(e) {
            const data = {
                value: e.target.dataset.value,
                originType: e.target.parentElement.dataset.type,
                originId: e.target.parentElement.id
            };
            e.dataTransfer.setData('text/plain', JSON.stringify(data));
            e.target.classList.add('dragging');
        }
        
        function handleDragEnd(e) {
            e.target.classList.remove('dragging');
        }
        
        function handleDragOver(e) {
            e.preventDefault();
            e.currentTarget.classList.add('drag-over');
        }
        
        function handleDrop(e) {
            e.preventDefault();
            e.currentTarget.classList.remove('drag-over');
            
            const data = JSON.parse(e.dataTransfer.getData('text/plain'));
            const draggedElement = document.querySelector(`.draggable-item[data-value="${data.value}"], .match-item[data-value="${data.value}"]`);
            
            // If dropping on source container
            if (e.currentTarget.dataset.type === 'source') {
                // Only move if not already in source
                if (data.originType !== 'source') {
                    e.currentTarget.appendChild(draggedElement);
                }
            } 
            // If dropping on target dropzone
            else {
                // Check if dropzone already has an item
                const existingItem = e.currentTarget.querySelector('.draggable-item, .match-item');
                
                if (existingItem) {
                    // If dragged from source container
                    if (data.originType === 'source') {
                        // Move existing item back to source
                        const sourceContainer = document.getElementById(data.originId);
                        sourceContainer.appendChild(existingItem);
                        // Move dragged element to current dropzone
                        e.currentTarget.appendChild(draggedElement);
                    } 
                    // If dragged from another dropzone
                    else {
                        // Swap items
                        const originDropzone = document.getElementById(data.originId);
                        originDropzone.appendChild(existingItem);
                        e.currentTarget.appendChild(draggedElement);
                    }
                } else {
                    // Dropzone is empty, just append
                    e.currentTarget.appendChild(draggedElement);
                }
                
                // Clear "Drop Here" text if it exists
                if (e.currentTarget.textContent.trim() === 'Drop Here') {
                    e.currentTarget.textContent = '';
                }
            }
        }
        
        function checkAnswers(questions, container, resultsDiv, isPostQuiz = false) {
            let score = 0;
            let totalScore = 0;
            
            questions.forEach((q, index) => {
                const questionDiv = container.children[index];
                let isCorrect = false;
                
                if (q.type === 'multiple-choice' || q.type === 'click-to-select') {
                    const selectedOption = questionDiv.querySelector('.quiz-option.selected');
                    if (selectedOption && selectedOption.dataset.answer === q.answer) {
                        isCorrect = true;
                    }
                    
                    const allOptions = questionDiv.querySelectorAll('.quiz-option');
                    allOptions.forEach(option => {
                        option.disabled = true;
                        if (option.dataset.answer === q.answer) {
                            option.classList.add('correct');
                        } else if (option.classList.contains('selected')) {
                            option.classList.add('incorrect');
                        }
                    });
                } else if (q.type === 'drag-and-drop') {
                    const orderedItems = [...questionDiv.querySelectorAll('.dropzone[data-type="target"]')].map(zone => {
                        const item = zone.querySelector('.draggable-item');
                        return item ? item.dataset.value : null;
                    });
                    
                    if (orderedItems.every(item => item !== null) && JSON.stringify(orderedItems) === JSON.stringify(q.answer)) {
                        isCorrect = true;
                    }
                    
                    const dropzones = questionDiv.querySelectorAll('.dropzone[data-type="target"]');
                    dropzones.forEach((zone, itemIndex) => {
                        const item = zone.querySelector('.draggable-item');
                        if (item) {
                            if (item.dataset.value === q.answer[itemIndex]) {
                                item.classList.add('bg-green-100', 'border-green-500');
                            } else {
                                item.classList.add('bg-red-100', 'border-red-500');
                            }
                            item.draggable = false;
                            item.style.cursor = 'default';
                        }
                        zone.style.borderColor = 'transparent';
                        zone.style.cursor = 'default';
                    });
                    
                    const dragItemsContainer = questionDiv.querySelector('[data-type="source"]');
                    if (dragItemsContainer) {
                         [...dragItemsContainer.children].forEach(item => {
                            if (item.classList.contains('draggable-item')) {
                                item.draggable = false;
                                item.style.cursor = 'default';
                            }
                        });
                    }
                    
                    if (!isCorrect) {
                        const correctOrderDiv = document.createElement('p');
                        correctOrderDiv.className = "mt-2 text-sm text-green-600";
                        correctOrderDiv.textContent = `Correct Order: ${q.answer.join(' → ')}`;
                        questionDiv.appendChild(correctOrderDiv);
                    }
                } else if (q.type === 'fill-in-the-blank') {
                    const productInput = questionDiv.querySelector(`#blank-product-${index}`);
                    const gasInput = questionDiv.querySelector(`#blank-gas-${index}`);
                    if (productInput.value.trim() === q.blanks[0].answer && gasInput.value.trim() === q.blanks[1].answer) {
                        isCorrect = true;
                    }
                    productInput.disabled = true;
                    gasInput.disabled = true;
                    const resultP = document.createElement('p');
                    resultP.className = "mt-2 text-sm";
                    if (isCorrect) {
                        resultP.textContent = `Correct!`;
                        resultP.classList.add('text-green-600');
                    } else {
                        resultP.textContent = `Incorrect. Correct answer: Ca + 2H₂O → Ca(OH)₂ + H₂`;
                        resultP.classList.add('text-red-600');
                    }
                    questionDiv.appendChild(resultP);
                } else if (q.type === 'mcq-flame-colours') {
                    const subQuestions = q.subQuestions;
                    let allCorrect = true;
                    subQuestions.forEach(sq => {
                        const selectedOption = questionDiv.querySelector(`.quiz-option.selected[data-sub-label="${sq.label}"]`);
                        if (!selectedOption || selectedOption.dataset.answer !== sq.answer) {
                            allCorrect = false;
                        }
                        questionDiv.querySelectorAll(`.quiz-option[data-sub-label="${sq.label}"]`).forEach(btn => {
                            btn.disabled = true;
                            if (btn.dataset.answer === sq.answer) {
                                btn.classList.add('correct');
                            } else if (btn.classList.contains('selected')) {
                                btn.classList.add('incorrect');
                            }
                        });
                    });
                    isCorrect = allCorrect;
                } else if (q.type === 'short-answer') {
                    const saInputs = questionDiv.querySelectorAll('input[type="text"]');
                    let saCorrect = true;
                    saInputs.forEach((input, saIndex) => {
                        const label = q.subQuestions[saIndex].label.toLowerCase();
                        const answer = q.subQuestions[saIndex].answer;
                        if (input.value.trim() !== answer) {
                            saCorrect = false;
                        }
                        input.disabled = true;
                        const resultSpan = document.createElement('span');
                        resultSpan.className = "ml-2 text-sm";
                        if (input.value.trim() === answer) {
                            resultSpan.textContent = `✅`;
                            resultSpan.classList.add('text-green-600');
                        } else {
                            resultSpan.textContent = `❌ (Correct: ${answer})`;
                            resultSpan.classList.add('text-red-600');
                        }
                        input.parentElement.appendChild(resultSpan);
                    });
                    isCorrect = saCorrect;
                } else if (q.type === 'true-or-false') {
                    const selectedOption = questionDiv.querySelector('.quiz-option.selected');
                    if (selectedOption && selectedOption.dataset.answer === q.answer) {
                        isCorrect = true;
                    }
                    const allOptions = questionDiv.querySelectorAll('.quiz-option');
                    allOptions.forEach(option => {
                        option.disabled = true;
                        if (option.dataset.answer === q.answer) {
                            option.classList.add('correct');
                        } else if (option.classList.contains('selected')) {
                            option.classList.add('incorrect');
                        }
                    });
                } else if (q.type === 'equation-balancing') {
                    const coeffInputs = questionDiv.querySelectorAll('input[type="text"]');
                    let eqCorrect = true;
                    coeffInputs.forEach((input, eqIndex) => {
                        if (input.value.trim() !== q.blanks[eqIndex].answer) {
                            eqCorrect = false;
                        }
                        input.disabled = true;
                        if (input.value.trim() === q.blanks[eqIndex].answer) {
                            input.classList.add('bg-green-100', 'border-green-500');
                        } else {
                            input.classList.add('bg-red-100', 'border-red-500');
                        }
                    });
                    isCorrect = eqCorrect;
                } else if (q.type === 'match-the-pair') {
                    let mpCorrect = true;
                    const dropzones = questionDiv.querySelectorAll('.dropzone-match');
                    dropzones.forEach(zone => {
                        const metal = zone.dataset.value;
                        const observationElement = zone.querySelector('.match-item');
                        if (!observationElement || q.matches[observationElement.dataset.value] !== metal) {
                            mpCorrect = false;
                            if (observationElement) {
                                observationElement.classList.add('bg-red-100', 'border-red-500');
                            }
                        } else {
                            observationElement.classList.add('bg-green-100', 'border-green-500');
                        }
                    });
                    isCorrect = mpCorrect;
                    const unmatchedItems = questionDiv.querySelectorAll('.match-item:not(.bg-green-100)');
                    unmatchedItems.forEach(item => {
                        item.draggable = false;
                        item.classList.add('bg-red-100', 'border-red-500');
                    });
                } else if (q.type === 'extended-response') {
                    const responseArea = questionDiv.querySelector('textarea');
                    responseArea.disabled = true;
                    const correctResponse = document.createElement('div');
                    correctResponse.className = "mt-3 p-3 bg-blue-50 rounded-lg text-sm text-blue-700";
                    correctResponse.innerHTML = `<b>Model Answer:</b> ${q.answer}`;
                    questionDiv.appendChild(correctResponse);
                    isCorrect = true; // Don't penalize score for this.
                }
                
                if (isCorrect) {
                    score++;
                }
                totalScore++;
            });
            
            resultsDiv.textContent = `You scored ${score} out of ${totalScore}!`;
            resultsDiv.classList.add('text-blue-600', 'font-semibold');
            
            if (!isPostQuiz) {
                localStorage.setItem(`${appId}-preQuizCompleted`, 'true');
            }
            
            setTimeout(() => {
                openHubPanel();
            }, isPostQuiz ? 5000 : 3000);
        }
        
        // --- Main App Initialization ---
        async function firebaseInit() {
            try {
                const app = initializeApp(firebaseConfig);
                auth = getAuth(app);
                db = getFirestore(app);
                
                if (initialAuthToken) {
                    await signInWithCustomToken(auth, initialAuthToken);
                } else {
                    await signInAnonymously(auth);
                }
                
                onAuthStateChanged(auth, (user) => {
                    if (user) {
                        userId = user.uid;
                        ui.userIdDisplay.textContent = userId;
                        isAuthReady = true;
                        console.log("Firebase initialized and user authenticated:", userId);
                    } else {
                        console.log("Firebase initialized, no user authenticated.");
                    }
                });
            } catch (error) {
                console.error("Firebase initialization failed:", error);
            }
        }
        
        document.addEventListener('DOMContentLoaded', async () => {
            await firebaseInit();
            init2DViewer();
            
            // Landing page enter button
            ui.enterAppBtn.addEventListener('click', () => {
                ui.landingPage.classList.add('hidden');
                ui.mainApp.classList.remove('hidden');
                openHubPanel();
            });
            
            // Create element cards
            Object.entries(elementsData).forEach(([name, data]) => {
                const card = document.createElement('div');
                card.className = 'element-card';
                card.dataset.element = name;
                
                const groupClass = data.group === 'I' ? 'group-1' : 'group-2';
                
                card.innerHTML = `
                    <img src="${data.image}" alt="${name}" class="element-image">
                    <div class="element-symbol">${data.symbol}</div>
                    <div class="element-name">${name}</div>
                    <div class="element-group ${groupClass}">Group ${data.group}</div>
                `;
                
                card.addEventListener('click', () => {
                    updateFactsPanel(name);
                    updateAtomViewer(data);
                });
                
                if (data.group === 'I') {
                    ui.group1Elements.appendChild(card);
                } else {
                    ui.group2Elements.appendChild(card);
                }
            });
            
            // Navigation event listeners
            document.getElementById('nav-hub-btn').addEventListener('click', openHubPanel);
            document.getElementById('nav-learn-btn').addEventListener('click', openLearnPanel);
            document.getElementById('nav-prequiz-btn').addEventListener('click', () => {
                ui.prequizResults.textContent = '';
                ui.prequizSubmitBtn.disabled = false;
                openPrequizPanel();
            });
            document.getElementById('nav-postquiz-btn').addEventListener('click', () => {
                ui.postquizResults.textContent = '';
                ui.postquizSubmitBtn.disabled = false;
                openPostquizPanel();
            });
            
            // Back to hub buttons
            document.getElementById('back-to-hub-btn').addEventListener('click', openHubPanel);
            document.getElementById('back-to-hub-btn-quiz').addEventListener('click', openHubPanel);
            document.getElementById('back-to-hub-btn-postquiz').addEventListener('click', openHubPanel);
            
            // Quiz submit buttons
            ui.prequizSubmitBtn.addEventListener('click', () => checkAnswers(preQuizQuestions, ui.prequizContent, ui.prequizResults));
            ui.postquizSubmitBtn.addEventListener('click', () => checkAnswers(postQuizQuestions, ui.postquizContent, ui.postquizResults, true));
            
            // Leaderboard button
            document.getElementById('nav-leaderboard-btn').addEventListener('click', () => {
                showMessage("This feature is still under construction. Please check back later!");
            });
            
            // Close message button
            ui.closeMessageBtn.addEventListener('click', hideMessage);
            
            // Tab switching for learn section
            ui.group1Tab.addEventListener('click', () => showLearnSection('group1'));
            ui.group2Tab.addEventListener('click', () => showLearnSection('group2'));
        });
    </script>
</body>
</html>
