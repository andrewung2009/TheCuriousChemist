<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Group 1 Alkali Metals - IGCSE Chemistry</title>
    <meta name="description" content="Interactive learning platform for mastering Group 1 Alkali Metals in chemistry">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Google Sheets API -->
    <script src="https://apis.google.com/js/api.js"></script>
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=GA_MEASUREMENT_ID"></script>
    <!-- jsPDF for PDF export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <style>
        :root {
            --primary: #4f46e5;
            --primary-dark: #4338ca;
            --secondary: #8b5cf6;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --gray-100: #f3f4f6;
            --gray-200: #e5e7eb;
            --gray-300: #d1d5db;
            --gray-400: #9ca3af;
            --gray-500: #6b7280;
            --gray-600: #4b5563;
            --gray-700: #374151;
            --gray-800: #1f2937;
            --gray-900: #111827;
            --dark-bg: #1a202c;
            --dark-card: #2d3748;
            --dark-text: #e2e8f0;
            --dark-border: #4a5568;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            min-height: 100vh;
            color: var(--gray-900);
            overflow-x: hidden;
            transition: background 0.3s ease, color 0.3s ease;
        }
        
        body.dark-mode {
            background: linear-gradient(135deg, #1a202c 0%, #2d3748 100%);
            color: var(--dark-text);
        }
        
        .content-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 1rem;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            border-left: 5px solid var(--primary);
        }
        
        body.dark-mode .content-card {
            background: rgba(45, 55, 72, 0.95);
            color: var(--dark-text);
        }
        
        .content-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.15);
        }
        
        .sidebar {
            position: fixed;
            top: 0;
            left: 0;
            height: 100vh;
            width: 260px;
            background: rgba(255, 255, 255, 0.95);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            z-index: 100;
            overflow-y: auto;
            transition: transform 0.3s ease;
        }
        
        body.dark-mode .sidebar {
            background: rgba(26, 32, 44, 0.95);
        }
        
        .nav-item {
            display: flex;
            align-items: center;
            padding: 0.75rem 1.5rem;
            color: var(--gray-600);
            text-decoration: none;
            transition: all 0.15s ease;
            border-left: 3px solid transparent;
        }
        
        body.dark-mode .nav-item {
            color: var(--dark-text);
        }
        
        .nav-item:hover {
            background: rgba(79, 70, 229, 0.1);
            color: var(--primary);
            border-left-color: var(--primary);
        }
        
        .nav-item.active {
            background: rgba(79, 70, 229, 0.1);
            color: var(--primary);
            border-left-color: var(--primary);
            font-weight: 600;
        }
        
        .nav-item.locked {
            color: var(--gray-400);
            cursor: not-allowed;
        }
        
        body.dark-mode .nav-item.locked {
            color: var(--gray-500);
        }
        
        .main-content {
            margin-left: 260px;
            padding: 1.5rem;
            min-height: 100vh;
        }
        
        .element-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin: 1.5rem 0;
        }
        
        .element-card {
            background: white;
            border-radius: 1rem;
            padding: 1.5rem;
            text-align: center;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        body.dark-mode .element-card {
            background: var(--dark-card);
            color: var(--dark-text);
        }
        
        .element-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
        }
        
        .element-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }
        
        .element-image {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            margin: 0 auto 1rem;
            object-fit: cover;
            border: 3px solid var(--gray-200);
        }
        
        .tabs {
            display: flex;
            border-bottom: 2px solid var(--gray-200);
            margin-bottom: 1.5rem;
        }
        
        body.dark-mode .tabs {
            border-bottom: 2px solid var(--dark-border);
        }
        
        .tab {
            padding: 0.75rem 1.5rem;
            cursor: pointer;
            background: none;
            border: none;
            font-weight: 500;
            color: var(--gray-500);
            transition: all 0.3s ease;
            position: relative;
        }
        
        body.dark-mode .tab {
            color: var(--dark-text);
        }
        
        .tab::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--primary);
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }
        
        .tab.active {
            color: var(--primary);
        }
        
        .tab.active::after {
            transform: scaleX(1);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .trend-table {
            width: 100%;
            border-collapse: collapse;
            margin: 1.5rem 0;
            background: white;
            border-radius: 0.5rem;
            overflow: hidden;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        
        body.dark-mode .trend-table {
            background: var(--dark-card);
            color: var(--dark-text);
        }
        
        .trend-table th {
            background: var(--primary);
            color: white;
            padding: 0.75rem;
            text-align: left;
            font-weight: 600;
        }
        
        .trend-table td {
            padding: 0.75rem;
            border-bottom: 1px solid var(--gray-200);
        }
        
        body.dark-mode .trend-table td {
            border-bottom: 1px solid var(--dark-border);
        }
        
        .trend-table tr:last-child td {
            border-bottom: none;
        }
        
        .trend-table tr:nth-child(even) {
            background: var(--gray-100);
        }
        
        body.dark-mode .trend-table tr:nth-child(even) {
            background: rgba(74, 85, 104, 0.3);
        }
        
        .trend-table tr:hover {
            background: rgba(79, 70, 229, 0.1);
        }
        
        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            font-family: 'Inter', sans-serif;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }
        
        .btn-success {
            background: var(--success);
            color: white;
        }
        
        .btn-success:hover {
            background: #059669;
        }
        
        .btn-secondary {
            background: var(--gray-100);
            color: var(--gray-700);
        }
        
        body.dark-mode .btn-secondary {
            background: var(--dark-border);
            color: var(--dark-text);
        }
        
        .btn-secondary:hover {
            background: var(--gray-200);
        }
        
        body.dark-mode .btn-secondary:hover {
            background: rgba(74, 85, 104, 0.5);
        }
        
        .btn-danger {
            background: var(--danger);
            color: white;
        }
        
        .btn-danger:hover {
            background: #dc2626;
        }
        
        .btn-sm {
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
        }
        
        .highlight-box {
            background: rgba(79, 70, 229, 0.1);
            border-left: 4px solid var(--primary);
            padding: 1rem;
            border-radius: 0.5rem;
            margin: 1rem 0;
            transition: all 0.3s ease;
        }
        
        body.dark-mode .highlight-box {
            background: rgba(79, 70, 229, 0.2);
        }
        
        .highlight-box:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        
        .highlight-box h4 {
            color: var(--primary);
            font-weight: 600;
            margin-bottom: 0.5rem;
        }
        
        .highlight-box p {
            color: var(--gray-700);
        }
        
        body.dark-mode .highlight-box p {
            color: var(--dark-text);
        }
        
        .equation-box {
            background: var(--gray-100);
            border: 1px solid var(--gray-200);
            border-radius: 0.5rem;
            padding: 1rem;
            margin: 1rem 0;
            text-align: center;
            transition: all 0.3s ease;
        }
        
        body.dark-mode .equation-box {
            background: var(--dark-border);
            border: 1px solid var(--dark-border);
        }
        
        .equation-box:hover {
            transform: scale(1.02);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        
        .equation-box .equation {
            font-family: 'Courier New', monospace;
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--gray-800);
            margin: 0.5rem 0;
        }
        
        body.dark-mode .equation-box .equation {
            color: var(--dark-text);
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: var(--gray-200);
            border-radius: 0.25rem;
            overflow: hidden;
            margin: 1rem 0;
        }
        
        body.dark-mode .progress-bar {
            background: var(--dark-border);
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            transition: width 0.3s ease;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: white;
            border-radius: 1rem;
            padding: 2rem;
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }
        
        body.dark-mode .modal-content {
            background: var(--dark-card);
            color: var(--dark-text);
        }
        
        .modal-lg {
            max-width: 800px;
        }
        
        .quiz-option {
            padding: 1rem;
            border: 2px solid var(--gray-200);
            border-radius: 0.5rem;
            margin: 0.75rem 0;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
            display: flex;
            align-items: center;
        }
        
        body.dark-mode .quiz-option {
            background: var(--dark-card);
            border: 2px solid var(--dark-border);
            color: var(--dark-text);
        }
        
        .quiz-option:hover {
            border-color: var(--primary);
            background: rgba(79, 70, 229, 0.1);
        }
        
        .quiz-option.selected {
            border-color: var(--primary);
            background: rgba(79, 70, 229, 0.1);
        }
        
        .quiz-option.correct {
            border-color: var(--success);
            background: rgba(16, 185, 129, 0.1);
        }
        
        .quiz-option.incorrect {
            border-color: var(--danger);
            background: rgba(239, 68, 68, 0.1);
        }
        
        .quiz-option.disabled {
            pointer-events: none;
            opacity: 0.7;
        }
        
        .quiz-option input {
            margin-right: 1rem;
        }
        
        .quiz-option label {
            cursor: pointer;
            flex: 1;
        }
        
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: white;
            padding: 16px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            z-index: 2000;
            display: flex;
            align-items: center;
            transform: translateX(400px);
            transition: transform 0.3s ease;
            max-width: 400px;
        }
        
        body.dark-mode .toast {
            background: var(--dark-card);
            color: var(--dark-text);
        }
        
        .toast.show {
            transform: translateX(0);
        }
        
        .toast.success {
            border-left: 4px solid var(--success);
        }
        
        .toast.error {
            border-left: 4px solid var(--danger);
        }
        
        .toast.info {
            border-left: 4px solid var(--primary);
        }
        
        .toast-icon {
            margin-right: 12px;
            font-size: 1.25rem;
        }
        
        .toast.success .toast-icon {
            color: var(--success);
        }
        
        .toast.error .toast-icon {
            color: var(--danger);
        }
        
        .toast.info .toast-icon {
            color: var(--primary);
        }
        
        .toast-message {
            flex: 1;
        }
        
        .toast-title {
            font-weight: 600;
            margin-bottom: 4px;
        }
        
        .toast-description {
            font-size: 0.875rem;
            color: var(--gray-600);
        }
        
        body.dark-mode .toast-description {
            color: var(--dark-text);
        }
        
        /* Feedback System Styles */
        .feedback-system {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: white;
            border-radius: 0.5rem;
            padding: 1rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            z-index: 500;
            width: 300px;
            transition: all 0.3s ease;
        }
        
        body.dark-mode .feedback-system {
            background: var(--dark-card);
            color: var(--dark-text);
        }
        
        .feedback-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }
        
        .feedback-title {
            font-weight: 600;
            color: var(--primary);
        }
        
        .feedback-close {
            cursor: pointer;
            color: var(--gray-500);
        }
        
        body.dark-mode .feedback-close {
            color: var(--dark-text);
        }
        
        .feedback-content {
            margin-bottom: 0.75rem;
        }
        
        .feedback-reactions {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.75rem;
        }
        
        .reaction-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .reaction-btn:hover {
            transform: scale(1.1);
        }
        
        .reaction-btn.active {
            color: var(--primary);
        }
        
        .reaction-btn i {
            font-size: 1.5rem;
            margin-bottom: 0.25rem;
        }
        
        .reaction-count {
            font-size: 0.875rem;
        }
        
        .feedback-textarea {
            width: 100%;
            min-height: 80px;
            padding: 0.5rem;
            border: 1px solid var(--gray-300);
            border-radius: 0.25rem;
            resize: vertical;
            font-family: 'Inter', sans-serif;
        }
        
        body.dark-mode .feedback-textarea {
            background: var(--dark-border);
            border: 1px solid var(--dark-border);
            color: var(--dark-text);
        }
        
        .feedback-submit {
            margin-top: 0.5rem;
            width: 100%;
        }
        
        /* XP Points and Badges */
        .xp-container {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }
        
        .xp-points {
            background: linear-gradient(135deg, #f59e0b, #f97316);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-weight: 600;
            font-size: 0.875rem;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }
        
        .badges-container {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }
        
        .badge {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            position: relative;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .badge:hover {
            transform: scale(1.1);
        }
        
        .badge-tooltip {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: var(--gray-800);
            color: white;
            padding: 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }
        
        body.dark-mode .badge-tooltip {
            background: var(--gray-700);
        }
        
        .badge:hover .badge-tooltip {
            opacity: 1;
        }
        
        /* Search and Filter */
        .search-container {
            position: relative;
            margin-bottom: 1rem;
        }
        
        .search-input {
            width: 100%;
            padding: 0.75rem 1rem 0.75rem 2.5rem;
            border: 1px solid var(--gray-300);
            border-radius: 0.5rem;
            font-size: 1rem;
        }
        
        body.dark-mode .search-input {
            background: var(--dark-border);
            border: 1px solid var(--dark-border);
            color: var(--dark-text);
        }
        
        .search-icon {
            position: absolute;
            left: 0.75rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray-400);
        }
        
        body.dark-mode .search-icon {
            color: var(--dark-text);
        }
        
        .filter-container {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }
        
        .filter-tag {
            padding: 0.5rem 1rem;
            border-radius: 9999px;
            background: var(--gray-100);
            color: var(--gray-700);
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        body.dark-mode .filter-tag {
            background: var(--dark-border);
            color: var(--dark-text);
        }
        
        .filter-tag:hover {
            background: var(--primary);
            color: white;
        }
        
        .filter-tag.active {
            background: var(--primary);
            color: white;
        }
        
        /* Leaderboard */
        .leaderboard {
            background: white;
            border-radius: 1rem;
            padding: 1.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 1.5rem;
        }
        
        body.dark-mode .leaderboard {
            background: var(--dark-card);
            color: var(--dark-text);
        }
        
        .leaderboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        
        .leaderboard-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--primary);
        }
        
        .leaderboard-refresh {
            cursor: pointer;
            color: var(--gray-500);
            transition: color 0.2s ease;
        }
        
        body.dark-mode .leaderboard-refresh {
            color: var(--dark-text);
        }
        
        .leaderboard-refresh:hover {
            color: var(--primary);
        }
        
        .leaderboard-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        
        .leaderboard-item {
            display: flex;
            align-items: center;
            padding: 0.75rem;
            border-bottom: 1px solid var(--gray-200);
            transition: background 0.2s ease;
        }
        
        body.dark-mode .leaderboard-item {
            border-bottom: 1px solid var(--dark-border);
        }
        
        .leaderboard-item:hover {
            background: var(--gray-100);
        }
        
        body.dark-mode .leaderboard-item:hover {
            background: rgba(74, 85, 104, 0.3);
        }
        
        .leaderboard-rank {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: var(--gray-200);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            margin-right: 1rem;
        }
        
        body.dark-mode .leaderboard-rank {
            background: var(--dark-border);
        }
        
        .leaderboard-rank.gold {
            background: linear-gradient(135deg, #f59e0b, #f97316);
            color: white;
        }
        
        .leaderboard-rank.silver {
            background: linear-gradient(135deg, #9ca3af, #6b7280);
            color: white;
        }
        
        .leaderboard-rank.bronze {
            background: linear-gradient(135deg, #b45309, #92400e);
            color: white;
        }
        
        .leaderboard-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            margin-right: 1rem;
        }
        
        .leaderboard-info {
            flex: 1;
        }
        
        .leaderboard-name {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }
        
        .leaderboard-score {
            font-size: 0.875rem;
            color: var(--gray-500);
        }
        
        body.dark-mode .leaderboard-score {
            color: var(--dark-text);
        }
        
        .leaderboard-xp {
            font-weight: 600;
            color: var(--warning);
        }
        
        /* Daily Challenge */
        .daily-challenge {
            background: linear-gradient(135deg, #f59e0b, #f97316);
            color: white;
            border-radius: 1rem;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            position: relative;
            overflow: hidden;
        }
        
        .daily-challenge::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0) 70%);
            animation: pulse 4s ease-in-out infinite;
        }
        
        @keyframes pulse {
            0%, 100% {
                transform: scale(0.8);
                opacity: 0.5;
            }
            50% {
                transform: scale(1.2);
                opacity: 0.8;
            }
        }
        
        .daily-challenge-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            position: relative;
            z-index: 1;
        }
        
        .daily-challenge-title {
            font-size: 1.25rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .daily-challenge-timer {
            background: rgba(255, 255, 255, 0.2);
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.875rem;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }
        
        .daily-challenge-content {
            position: relative;
            z-index: 1;
        }
        
        .daily-challenge-question {
            font-size: 1.125rem;
            margin-bottom: 1rem;
        }
        
        .daily-challenge-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.75rem;
        }
        
        .daily-challenge-option {
            background: rgba(255, 255, 255, 0.2);
            padding: 0.75rem;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: center;
        }
        
        .daily-challenge-option:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }
        
        .daily-challenge-option.correct {
            background: rgba(16, 185, 129, 0.3);
        }
        
        .daily-challenge-option.incorrect {
            background: rgba(239, 68, 68, 0.3);
        }
        
        .daily-challenge-reward {
            margin-top: 1rem;
            text-align: center;
            font-size: 0.875rem;
            opacity: 0.9;
        }
        
        /* Valence Electrons Emphasis */
        .valence-electron {
            display: inline-block;
            position: relative;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .valence-electron::after {
            content: '';
            position: absolute;
            top: -5px;
            left: -5px;
            right: -5px;
            bottom: -5px;
            border-radius: 50%;
            border: 2px solid var(--primary);
            opacity: 0;
            animation: pulse-ring 2s ease-in-out infinite;
        }
        
        .valence-electron:hover::after {
            opacity: 1;
        }
        
        @keyframes pulse-ring {
            0% {
                transform: scale(0.8);
                opacity: 0.8;
            }
            50% {
                transform: scale(1.2);
                opacity: 0.4;
            }
            100% {
                transform: scale(0.8);
                opacity: 0.8;
            }
        }
        
        /* GIF on Hover */
        .term-hover {
            position: relative;
            display: inline-block;
            cursor: help;
            border-bottom: 1px dashed var(--primary);
            transition: all 0.2s ease;
        }
        
        .term-hover:hover {
            border-bottom-style: solid;
        }
        
        .gif-popup {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: white;
            border-radius: 0.5rem;
            padding: 0.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            z-index: 100;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
            width: 200px;
            height: 150px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }
        
        body.dark-mode .gif-popup {
            background: var(--dark-card);
        }
        
        .term-hover:hover .gif-popup {
            opacity: 1;
        }
        
        .gif-popup img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }
        
        /* Interactive Periodic Table */
        .periodic-table {
            display: grid;
            grid-template-columns: repeat(18, 1fr);
            gap: 2px;
            margin: 1rem 0;
            background: var(--gray-200);
            padding: 0.5rem;
            border-radius: 0.5rem;
        }
        
        body.dark-mode .periodic-table {
            background: var(--dark-border);
        }
        
        .element {
            aspect-ratio: 1;
            background: white;
            border-radius: 0.25rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.75rem;
            position: relative;
            overflow: hidden;
        }
        
        body.dark-mode .element {
            background: var(--dark-card);
            color: var(--dark-text);
        }
        
        .element:hover {
            transform: scale(1.1);
            z-index: 10;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .element.group1 {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
        }
        
        .element-symbol {
            font-weight: 600;
            font-size: 1rem;
        }
        
        .element-number {
            position: absolute;
            top: 2px;
            left: 2px;
            font-size: 0.5rem;
        }
        
        .element-name {
            font-size: 0.5rem;
            margin-top: 2px;
        }
        
        .element-tooltip {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: var(--gray-800);
            color: white;
            padding: 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
            z-index: 20;
        }
        
        .element:hover .element-tooltip {
            opacity: 1;
        }
        
        /* Mini Simulations */
        .simulation-container {
            background: linear-gradient(to bottom, #e0f2fe, #f0f9ff);
            border-radius: 1rem;
            padding: 1.5rem;
            margin-bottom: 1rem;
            position: relative;
            min-height: 300px;
            border: 2px solid #bae6fd;
            overflow: hidden;
        }
        
        .simulation-bench {
            background: #9ca3af;
            height: 80px;
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            border-top: 3px solid #6b7280;
        }
        
        .simulation-equipment {
            position: absolute;
            cursor: pointer;
            transition: transform 0.3s ease;
        }
        
        .simulation-equipment:hover {
            transform: translateY(-5px);
        }
        
        .beaker {
            width: 80px;
            height: 100px;
            background: rgba(255, 255, 255, 0.7);
            border: 2px solid #9ca3af;
            border-radius: 0 0 20px 20px;
            bottom: 80px;
            left: 50px;
            overflow: hidden;
        }
        
        .beaker-water {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 60%;
            background: rgba(59, 130, 246, 0.3);
            border-radius: 0 0 18px 18px;
        }
        
        .metal-sample {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            position: absolute;
            bottom: 180px;
            left: 150px;
            cursor: grab;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }
        
        .metal-sample.lithium {
            background: linear-gradient(135deg, #ef4444, #dc2626);
        }
        
        .metal-sample.sodium {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
        }
        
        .metal-sample.potassium {
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
        }
        
        .reaction-bubble {
            position: absolute;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 50%;
            animation: bubble 2s infinite ease-in-out;
        }
        
        @keyframes bubble {
            0% {
                transform: translateY(0) scale(0.5);
                opacity: 0.7;
            }
            100% {
                transform: translateY(-100px) scale(1.2);
                opacity: 0;
            }
        }
        
        .simulation-controls {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .simulation-instruction {
            background: rgba(255, 255, 255, 0.9);
            padding: 0.75rem;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
            text-align: center;
            font-weight: 500;
        }
        
        .observation-panel {
            background: white;
            border-radius: 0.5rem;
            padding: 1rem;
            margin-top: 1rem;
            border: 1px solid #e5e7eb;
        }
        
        body.dark-mode .observation-panel {
            background: var(--dark-card);
            border: 1px solid var(--dark-border);
        }
        
        .observation-title {
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--gray-800);
        }
        
        body.dark-mode .observation-title {
            color: var(--dark-text);
        }
        
        .observation-text {
            color: var(--gray-600);
            font-style: italic;
        }
        
        body.dark-mode .observation-text {
            color: var(--dark-text);
        }
        
        /* Story Mode */
        .story-container {
            background: linear-gradient(135deg, #1e3a8a, #312e81);
            color: white;
            border-radius: 1rem;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            position: relative;
            overflow: hidden;
        }
        
        .story-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        
        .story-title {
            font-size: 1.5rem;
            font-weight: 600;
        }
        
        .story-progress {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .story-chapter {
            background: rgba(255, 255, 255, 0.2);
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.875rem;
        }
        
        .story-content {
            position: relative;
            z-index: 1;
        }
        
        .story-text {
            font-size: 1.125rem;
            line-height: 1.6;
            margin-bottom: 1rem;
        }
        
        .story-choices {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }
        
        .story-choice {
            background: rgba(255, 255, 255, 0.1);
            padding: 0.75rem;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 1px solid transparent;
        }
        
        .story-choice:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.5);
        }
        
        .story-character {
            position: absolute;
            bottom: -20px;
            right: -20px;
            width: 150px;
            height: 150px;
            opacity: 0.3;
            z-index: 0;
        }
        
        /* What If Scenarios */
        .whatif-container {
            background: linear-gradient(135deg, #ec4899, #be185d);
            color: white;
            border-radius: 1rem;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            position: relative;
            overflow: hidden;
        }
        
        .whatif-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }
        
        .whatif-title {
            font-size: 1.25rem;
            font-weight: 600;
        }
        
        .whatif-content {
            position: relative;
            z-index: 1;
        }
        
        .whatif-scenario {
            font-size: 1.125rem;
            margin-bottom: 1rem;
        }
        
        .whatif-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.75rem;
        }
        
        .whatif-option {
            background: rgba(255, 255, 255, 0.1);
            padding: 0.75rem;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .whatif-option:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }
        
        .whatif-result {
            margin-top: 1rem;
            padding: 0.75rem;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 0.5rem;
            display: none;
        }
        
        .whatif-result.show {
            display: block;
        }
        
        /* Unlockable Fun Facts */
        .fun-fact {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            border-radius: 1rem;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            position: relative;
            overflow: hidden;
        }
        
        .fun-fact-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }
        
        .fun-fact-title {
            font-size: 1.25rem;
            font-weight: 600;
        }
        
        .fun-fact-content {
            position: relative;
            z-index: 1;
        }
        
        .fun-fact-text {
            font-size: 1.125rem;
            line-height: 1.6;
        }
        
        .fun-fact-icon {
            position: absolute;
            top: -20px;
            right: -20px;
            font-size: 5rem;
            opacity: 0.1;
            transform: rotate(15deg);
        }
        
        /* Settings Panel */
        .settings-panel {
            position: fixed;
            top: 0;
            right: -300px;
            width: 300px;
            height: 100vh;
            background: white;
            box-shadow: -4px 0 6px -1px rgba(0, 0, 0, 0.1);
            z-index: 200;
            transition: right 0.3s ease;
            overflow-y: auto;
        }
        
        body.dark-mode .settings-panel {
            background: var(--dark-card);
            color: var(--dark-text);
        }
        
        .settings-panel.active {
            right: 0;
        }
        
        .settings-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--gray-200);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        body.dark-mode .settings-header {
            border-bottom: 1px solid var(--dark-border);
        }
        
        .settings-title {
            font-size: 1.25rem;
            font-weight: 600;
        }
        
        .settings-close {
            cursor: pointer;
            color: var(--gray-500);
            font-size: 1.25rem;
        }
        
        body.dark-mode .settings-close {
            color: var(--dark-text);
        }
        
        .settings-content {
            padding: 1.5rem;
        }
        
        .setting-item {
            margin-bottom: 1.5rem;
        }
        
        .setting-label {
            display: block;
            font-weight: 500;
            margin-bottom: 0.5rem;
        }
        
        .setting-toggle {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }
        
        .setting-toggle input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .setting-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--gray-300);
            transition: .4s;
            border-radius: 24px;
        }
        
        body.dark-mode .setting-slider {
            background-color: var(--dark-border);
        }
        
        .setting-slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .setting-slider {
            background-color: var(--primary);
        }
        
        input:checked + .setting-slider:before {
            transform: translateX(26px);
        }
        
        .setting-volume {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .volume-slider {
            flex: 1;
            height: 6px;
            background: var(--gray-300);
            border-radius: 3px;
            outline: none;
            -webkit-appearance: none;
        }
        
        body.dark-mode .volume-slider {
            background: var(--dark-border);
        }
        
        .volume-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 16px;
            height: 16px;
            background: var(--primary);
            cursor: pointer;
            border-radius: 50%;
        }
        
        .export-options {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        
        /* Offline Mode Indicator */
        .offline-indicator {
            position: fixed;
            top: 10px;
            right: 10px;
            background: var(--warning);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-size: 0.875rem;
            display: none;
            z-index: 300;
        }
        
        .offline-indicator.show {
            display: block;
        }
        
        /* Sound Effects */
        .sound-toggle {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            z-index: 100;
            transition: all 0.3s ease;
        }
        
        .sound-toggle:hover {
            transform: scale(1.1);
        }
        
        .sound-toggle.muted {
            background: var(--gray-500);
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
            }
            
            .sidebar.active {
                transform: translateX(0);
            }
            
            .main-content {
                margin-left: 0;
            }
            
            .element-grid {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            }
            
            .daily-challenge-options {
                grid-template-columns: 1fr;
            }
            
            .whatif-options {
                grid-template-columns: 1fr;
            }
            
            .periodic-table {
                grid-template-columns: repeat(9, 1fr);
            }
            
            .feedback-system {
                width: 250px;
            }
        }
    </style>
</head>
<body>
    <!-- Landing Page -->
    <div id="landingPage" class="min-h-screen flex items-center justify-center p-6">
        <div class="bg-white rounded-2xl p-8 max-w-2xl w-full text-center shadow-2xl">
            <div class="text-6xl mb-6 text-indigo-600">
                <i class="fas fa-atom"></i>
            </div>
            <h1 class="text-4xl font-bold text-gray-800 mb-4">Group 1 Alkali Metals</h1>
            <p class="text-lg text-gray-600 mb-8">Master IGCSE Chemistry through Interactive Learning</p>
            
            <div class="grid grid-cols-3 gap-6 mb-8">
                <div class="bg-blue-50 p-6 rounded-xl">
                    <i class="fas fa-book-open text-3xl text-blue-600 mb-3"></i>
                    <h3 class="font-semibold">Learn</h3>
                    <p class="text-sm text-gray-600">Interactive content</p>
                </div>
                <div class="bg-green-50 p-6 rounded-xl">
                    <i class="fas fa-chart-line text-3xl text-green-600 mb-3"></i>
                    <h3 class="font-semibold">Track</h3>
                    <p class="text-sm text-gray-600">Progress monitoring</p>
                </div>
                <div class="bg-purple-50 p-6 rounded-xl">
                    <i class="fas fa-graduation-cap text-3xl text-purple-600 mb-3"></i>
                    <h3 class="font-semibold">Test</h3>
                    <p class="text-sm text-gray-600">Innovative quiz</p>
                </div>
            </div>
            
            <div class="space-y-4">
                <button onclick="showLoginModal()" class="btn btn-primary w-full">
                    <i class="fas fa-sign-in-alt mr-2"></i>
                    Sign In to Begin
                </button>
                <button onclick="signInWithGoogle()" class="btn btn-secondary w-full">
                    <i class="fab fa-google mr-2"></i>
                    Continue with Google
                </button>
            </div>
        </div>
    </div>
    
    <!-- Main App -->
    <div id="mainApp" style="display: none;">
        <!-- Sidebar -->
        <nav class="sidebar" id="sidebar">
            <div class="p-6 border-b border-gray-200">
                <div class="flex items-center">
                    <i class="fas fa-atom text-indigo-600 text-2xl mr-3"></i>
                    <h1 class="text-xl font-bold text-gray-800">Group 1 Alkali Metals</h1>
                </div>
                <p class="text-sm text-gray-600 mt-1">IGCSE Chemistry</p>
            </div>
            <div class="py-4">
                <a href="#" class="nav-item active" id="nav-overview" onclick="navigateToSection('overview')">
                    <i class="fas fa-home mr-3"></i>
                    <span>Overview</span>
                </a>
                <a href="#" class="nav-item locked" id="nav-elements" onclick="navigateToSection('elements')">
                    <i class="fas fa-th mr-3"></i>
                    <span>Elements</span>
                </a>
                <a href="#" class="nav-item locked" id="nav-properties" onclick="navigateToSection('properties')">
                    <i class="fas fa-chart-line mr-3"></i>
                    <span>Properties</span>
                </a>
                <a href="#" class="nav-item locked" id="nav-reactions" onclick="navigateToSection('reactions')">
                    <i class="fas fa-flask mr-3"></i>
                    <span>Reactions</span>
                </a>
                <a href="#" class="nav-item locked" id="nav-quiz" onclick="navigateToSection('quiz')">
                    <i class="fas fa-graduation-cap mr-3"></i>
                    <span>Quiz</span>
                </a>
                <a href="#" class="nav-item" id="nav-discussion" onclick="navigateToSection('discussion')">
                    <i class="fas fa-comments mr-3"></i>
                    <span>Discussion</span>
                </a>
                <a href="#" class="nav-item" id="nav-study-groups" onclick="navigateToSection('study-groups')">
                    <i class="fas fa-users mr-3"></i>
                    <span>Study Groups</span>
                </a>
                <a href="#" class="nav-item" id="nav-leaderboard" onclick="navigateToSection('leaderboard')">
                    <i class="fas fa-trophy mr-3"></i>
                    <span>Leaderboard</span>
                </a>
                <a href="#" class="nav-item" id="nav-story-mode" onclick="navigateToSection('story-mode')">
                    <i class="fas fa-book mr-3"></i>
                    <span>Story Mode</span>
                </a>
            </div>
            <div class="absolute bottom-0 left-0 right-0 p-4 border-t border-gray-200">
                <div class="flex items-center justify-between mb-3">
                    <span class="text-sm text-gray-600">Signed in as:</span>
                    <span class="text-sm font-medium text-gray-800" id="userName">User</span>
                </div>
                <div class="flex items-center justify-between mb-3">
                    <span class="text-sm text-gray-600">XP Points:</span>
                    <div class="xp-points">
                        <i class="fas fa-star mr-1"></i>
                        <span id="userXP">0</span>
                    </div>
                </div>
                <button onclick="signOut()" class="btn btn-secondary w-full text-sm">
                    <i class="fas fa-sign-out-alt mr-1"></i>
                    Logout
                </button>
            </div>
        </nav>
        
        <!-- Main Content -->
        <main class="main-content">
            <!-- Settings Button -->
            <button onclick="toggleSettings()" class="fixed top-4 right-4 z-50 w-10 h-10 rounded-full bg-white shadow-md flex items-center justify-center">
                <i class="fas fa-cog text-gray-600"></i>
            </button>
            
            <!-- Settings Panel -->
            <div class="settings-panel" id="settingsPanel">
                <div class="settings-header">
                    <h3 class="settings-title">Settings</h3>
                    <span class="settings-close" onclick="toggleSettings()">
                        <i class="fas fa-times"></i>
                    </span>
                </div>
                <div class="settings-content">
                    <div class="setting-item">
                        <label class="setting-label">Dark Mode</label>
                        <label class="setting-toggle">
                            <input type="checkbox" id="darkModeToggle" onchange="toggleDarkMode()">
                            <span class="setting-slider"></span>
                        </label>
                    </div>
                    <div class="setting-item">
                        <label class="setting-label">Sound Effects</label>
                        <label class="setting-toggle">
                            <input type="checkbox" id="soundToggle" checked onchange="toggleSound()">
                            <span class="setting-slider"></span>
                        </label>
                    </div>
                    <div class="setting-item">
                        <label class="setting-label">Sound Volume</label>
                        <div class="setting-volume">
                            <i class="fas fa-volume-down"></i>
                            <input type="range" min="0" max="100" value="50" class="volume-slider" id="volumeSlider">
                            <i class="fas fa-volume-up"></i>
                        </div>
                    </div>
                    <div class="setting-item">
                        <label class="setting-label">Export Notes</label>
                        <div class="export-options">
                            <button onclick="exportToPDF()" class="btn btn-primary w-full">
                                <i class="fas fa-file-pdf mr-2"></i>
                                Export as PDF
                            </button>
                            <button onclick="exportToJSON()" class="btn btn-secondary w-full">
                                <i class="fas fa-file-code mr-2"></i>
                                Export as JSON
                            </button>
                        </div>
                    </div>
                    <div class="setting-item">
                        <label class="setting-label">Offline Mode</label>
                        <label class="setting-toggle">
                            <input type="checkbox" id="offlineToggle" onchange="toggleOfflineMode()">
                            <span class="setting-slider"></span>
                        </label>
                    </div>
                </div>
            </div>
            
            <!-- XP Points and Badges -->
            <div class="content-card">
                <div class="flex justify-between items-center mb-4">
                    <div class="xp-container">
                        <div class="xp-points">
                            <i class="fas fa-star mr-1"></i>
                            <span id="totalXP">0</span> XP
                        </div>
                        <div class="badges-container" id="badgesContainer">
                            <!-- Badges will be added here dynamically -->
                        </div>
                    </div>
                    <button onclick="showDailyChallenge()" class="btn btn-warning">
                        <i class="fas fa-calendar-day mr-2"></i>
                        Daily Challenge
                    </button>
                </div>
                
                <!-- Progress Tracker -->
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-bold text-gray-800">Your Progress</h3>
                    <div class="text-lg font-bold text-indigo-600" id="progressPercentage">0%</div>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="overallProgressFill" style="width: 0%"></div>
                </div>
                <div class="grid grid-cols-4 gap-4 mt-4">
                    <div class="text-center p-3 bg-gray-100 rounded-lg" id="progress-overview">
                        <i class="fas fa-home text-gray-600 mb-2"></i>
                        <div class="text-sm font-medium text-gray-700">Overview</div>
                        <div class="text-xs text-gray-500 mt-1">Not Started</div>
                    </div>
                    <div class="text-center p-3 bg-gray-100 rounded-lg" id="progress-elements">
                        <i class="fas fa-th text-gray-600 mb-2"></i>
                        <div class="text-sm font-medium text-gray-700">Elements</div>
                        <div class="text-xs text-gray-500 mt-1">Locked</div>
                    </div>
                    <div class="text-center p-3 bg-gray-100 rounded-lg" id="progress-properties">
                        <i class="fas fa-chart-line text-gray-600 mb-2"></i>
                        <div class="text-sm font-medium text-gray-700">Properties</div>
                        <div class="text-xs text-gray-500 mt-1">Locked</div>
                    </div>
                    <div class="text-center p-3 bg-gray-100 rounded-lg" id="progress-quiz">
                        <i class="fas fa-graduation-cap text-gray-600 mb-2"></i>
                        <div class="text-sm font-medium text-gray-700">Quiz</div>
                        <div class="text-xs text-gray-500 mt-1">Locked</div>
                    </div>
                </div>
            </div>
            
            <!-- Search and Filter -->
            <div class="content-card">
                <div class="search-container">
                    <i class="fas fa-search search-icon"></i>
                    <input type="text" class="search-input" placeholder="Search topics..." id="searchInput" onkeyup="searchContent()">
                </div>
                <div class="filter-container">
                    <div class="filter-tag active" onclick="filterContent('all')">All</div>
                    <div class="filter-tag" onclick="filterContent('basics')">Basics</div>
                    <div class="filter-tag" onclick="filterContent('properties')">Properties</div>
                    <div class="filter-tag" onclick="filterContent('reactions')">Reactions</div>
                    <div class="filter-tag" onclick="filterContent('applications')">Applications</div>
                </div>
            </div>
            
            <!-- Overview Section -->
            <section id="overview-section" class="content-section">
                <div class="content-card">
                    <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                        <i class="fas fa-info-circle mr-2 text-indigo-600"></i>
                        Introduction to Group 1 Alkali Metals
                    </h3>
                    <p class="text-gray-700 mb-4">
                        Group 1 elements, known as the <strong>alkali metals</strong>, include lithium (Li), sodium (Na), potassium (K), rubidium (Rb), cesium (Cs), and francium (Fr). They are <strong>relatively soft metals</strong> with <strong>low melting points</strong> and <strong>low densities</strong>.
                    </p>
                    <div class="highlight-box">
                        <h4>Key Characteristics</h4>
                        <ul class="list-disc pl-5 space-y-1">
                            <li>One <span class="valence-electron">electron</span> in their outer shell</li>
                            <li>Form +1 ions by losing this electron</li>
                            <li>Highly reactive metals</li>
                            <li>Stored under oil to prevent reaction with air</li>
                        </ul>
                    </div>
                    
                    <!-- YouTube Video -->
                    <div class="mt-6">
                        <h4 class="text-lg font-semibold mb-3">Learn More from This Video</h4>
                        <div class="video-container">
                            <iframe width="100%" height="315" src="https://www.youtube.com/embed/6p2J32kkw5o" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                        </div>
                    </div>
                    
                    <!-- Interactive Periodic Table -->
                    <div class="mt-6">
                        <h4 class="text-lg font-semibold mb-3">Interactive Periodic Table</h4>
                        <div class="periodic-table" id="periodicTable">
                            <!-- Periodic table will be generated here -->
                        </div>
                    </div>
                    
                    <button class="btn btn-success w-full mt-4" onclick="completeSection('overview')">
                        <i class="fas fa-check mr-2"></i>
                        Mark as Complete
                    </button>
                </div>
                
                <!-- Unlockable Fun Fact -->
                <div class="fun-fact" id="funFactOverview" style="display: none;">
                    <div class="fun-fact-header">
                        <i class="fas fa-lightbulb"></i>
                        <h3 class="fun-fact-title">Fun Fact Unlocked!</h3>
                    </div>
                    <div class="fun-fact-content">
                        <p class="fun-fact-text">Did you know? Lithium is the lightest metal element and is so light that it can float on water! It's also used in batteries for smartphones and electric vehicles.</p>
                    </div>
                    <i class="fas fa-lightbulb fun-fact-icon"></i>
                </div>
            </section>
            
            <!-- Elements Section -->
            <section id="elements-section" class="content-section" style="display: none;">
                <div class="content-card">
                    <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                        <i class="fas fa-th mr-2 text-indigo-600"></i>
                        Group 1 Elements
                    </h3>
                    <div class="element-grid">
                        <div class="element-card">
                            <img src="https://upload.wikimedia.org/wikipedia/commons/e/ed/Lithiumcut_cropped.jpg" alt="Lithium" class="element-image">
                            <h4 class="font-bold text-lg">Lithium (Li)</h4>
                            <p class="text-sm text-gray-600">Atomic: 3</p>
                            <p class="text-sm text-gray-600">Electron: 2,<span class="valence-electron">1</span></p>
                        </div>
                        <div class="element-card">
                            <img src="https://upload.wikimedia.org/wikipedia/commons/2/27/Na_%28Sodium%29.jpg" alt="Sodium" class="element-image">
                            <h4 class="font-bold text-lg">Sodium (Na)</h4>
                            <p class="text-sm text-gray-600">Atomic: 11</p>
                            <p class="text-sm text-gray-600">Electron: 2,8,<span class="valence-electron">1</span></p>
                        </div>
                        <div class="element-card">
                            <img src="https://cdn.britannica.com/77/131177-050-79292189/fragments-Potassium-metal.jpg" alt="Potassium" class="element-image">
                            <h4 class="font-bold text-lg">Potassium (K)</h4>
                            <p class="text-sm text-gray-600">Atomic: 19</p>
                            <p class="text-sm text-gray-600">Electron: 2,8,8,<span class="valence-electron">1</span></p>
                        </div>
                        <div class="element-card">
                            <img src="https://upload.wikimedia.org/wikipedia/commons/c/c9/Rb5.JPG" alt="Rubidium" class="element-image">
                            <h4 class="font-bold text-lg">Rubidium (Rb)</h4>
                            <p class="text-sm text-gray-600">Atomic: 37</p>
                            <p class="text-sm text-gray-600">Electron: 2,8,18,8,<span class="valence-electron">1</span></p>
                        </div>
                        <div class="element-card">
                            <img src="https://upload.wikimedia.org/wikipedia/commons/3/3d/Cesium.jpg" alt="Cesium" class="element-image">
                            <h4 class="font-bold text-lg">Cesium (Cs)</h4>
                            <p class="text-sm text-gray-600">Atomic: 55</p>
                            <p class="text-sm text-gray-600">Electron: 2,8,18,18,8,<span class="valence-electron">1</span></p>
                        </div>
                        <div class="element-card">
                            <img src="https://i0.wp.com/periodic-table.com/wp-content/uploads/2018/11/Francium.jpg?fit=238%2C212&ssl=1" alt="Francium" class="element-image">
                            <h4 class="font-bold text-lg">Francium (Fr)</h4>
                            <p class="text-sm text-gray-600">Atomic: 87</p>
                            <p class="text-sm text-gray-600">Electron: 2,8,18,32,18,8,<span class="valence-electron">1</span></p>
                        </div>
                    </div>
                    
                    <!-- Mini Simulation -->
                    <div class="mt-6">
                        <h4 class="text-lg font-semibold mb-3">Interactive Simulation: Reactivity with Water</h4>
                        <div class="simulation-container">
                            <div class="simulation-instruction">Drag and drop the metals into the water to see their reactions!</div>
                            
                            <div class="beaker">
                                <div class="beaker-water"></div>
                            </div>
                            
                            <div class="metal-sample lithium" draggable="true" ondragstart="drag(event)" data-metal="lithium">
                                Li
                            </div>
                            <div class="metal-sample sodium" draggable="true" ondragstart="drag(event)" data-metal="sodium" style="left: 200px;">
                                Na
                            </div>
                            <div class="metal-sample potassium" draggable="true" ondragstart="drag(event)" data-metal="potassium" style="left: 250px;">
                                K
                            </div>
                            
                            <div class="simulation-bench" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
                            
                            <div id="reactionBubbles"></div>
                        </div>
                        
                        <div class="observation-panel">
                            <div class="observation-title">Observation:</div>
                            <div class="observation-text" id="observationText">Drag a metal into the water to see its reaction.</div>
                        </div>
                    </div>
                    
                    <button class="btn btn-success w-full mt-4" onclick="completeSection('elements')">
                        <i class="fas fa-check mr-2"></i>
                        Mark as Complete
                    </button>
                </div>
                
                <!-- Unlockable Fun Fact -->
                <div class="fun-fact" id="funFactElements" style="display: none;">
                    <div class="fun-fact-header">
                        <i class="fas fa-lightbulb"></i>
                        <h3 class="fun-fact-title">Fun Fact Unlocked!</h3>
                    </div>
                    <div class="fun-fact-content">
                        <p class="fun-fact-text">Sodium is so reactive that it must be stored under oil to prevent it from reacting with moisture in the air. When it reacts with water, it produces hydrogen gas that can ignite!</p>
                    </div>
                    <i class="fas fa-fire fun-fact-icon"></i>
                </div>
            </section>
            
            <!-- Properties Section -->
            <section id="properties-section" class="content-section" style="display: none;">
                <div class="content-card">
                    <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                        <i class="fas fa-chart-line mr-2 text-indigo-600"></i>
                        Trends in Group 1
                    </h3>
                    <div class="tabs">
                        <button class="tab active" onclick="showTab('melting-point')">Melting Point</button>
                        <button class="tab" onclick="showTab('density')">Density</button>
                        <button class="tab" onclick="showTab('reactivity')">Reactivity</button>
                    </div>
                    <div id="melting-point" class="tab-content active">
                        <p class="text-gray-700 mb-4">
                            The melting point <strong>decreases</strong> down Group 1 due to increasing atomic size and weaker metallic bonding.
                        </p>
                        <table class="trend-table">
                            <thead>
                                <tr>
                                    <th>Element</th>
                                    <th>Melting Point (C)</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Lithium</td>
                                    <td>180.5</td>
                                </tr>
                                <tr>
                                    <td>Sodium</td>
                                    <td>97.8</td>
                                </tr>
                                <tr>
                                    <td>Potassium</td>
                                    <td>63.5</td>
                                </tr>
                                <tr>
                                    <td>Rubidium</td>
                                    <td>39.3</td>
                                </tr>
                                <tr>
                                    <td>Cesium</td>
                                    <td>28.4</td>
                                </tr>
                            </tbody>
                        </table>
                        
                        <!-- Interactive Quiz -->
                        <div class="mt-6 p-4 bg-blue-50 rounded-lg">
                            <h4 class="font-semibold mb-2">Quick Quiz</h4>
                            <p>Did you realize the melting point decreases down the group? Why do you think this happens?</p>
                            <div class="mt-3 space-y-2">
                                <div class="quiz-option" onclick="selectQuizOption(this, 'A')">
                                    <input type="radio" name="melting-point-quiz" id="option-a">
                                    <label for="option-a">A. Atoms get smaller down the group</label>
                                </div>
                                <div class="quiz-option" onclick="selectQuizOption(this, 'B')">
                                    <input type="radio" name="melting-point-quiz" id="option-b">
                                    <label for="option-b">B. Metallic bonding gets weaker down the group</label>
                                </div>
                                <div class="quiz-option" onclick="selectQuizOption(this, 'C')">
                                    <input type="radio" name="melting-point-quiz" id="option-c">
                                    <label for="option-c">C. Atoms have more electrons down the group</label>
                                </div>
                            </div>
                            <button onclick="checkMeltingPointQuiz()" class="btn btn-primary mt-3">Check Answer</button>
                            <div id="melting-point-quiz-feedback" class="mt-3 hidden"></div>
                        </div>
                    </div>
                    <div id="density" class="tab-content">
                        <p class="text-gray-700 mb-4">
                            The density generally <strong>increases</strong> down Group 1, with the exception of potassium which is less dense than sodium.
                        </p>
                        <table class="trend-table">
                            <thead>
                                <tr>
                                    <th>Element</th>
                                    <th>Density (g/cm)</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Lithium</td>
                                    <td>0.534</td>
                                </tr>
                                <tr>
                                    <td>Sodium</td>
                                    <td>0.968</td>
                                </tr>
                                <tr>
                                    <td>Potassium</td>
                                    <td>0.89</td>
                                </tr>
                                <tr>
                                    <td>Rubidium</td>
                                    <td>1.532</td>
                                </tr>
                                <tr>
                                    <td>Cesium</td>
                                    <td>1.93</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div id="reactivity" class="tab-content">
                        <p class="text-gray-700 mb-4">
                            Reactivity <strong>increases</strong> down Group 1 because the outer electron is further from the nucleus and easier to lose.
                        </p>
                        <div class="highlight-box">
                            <h4>Reactivity Series</h4>
                            <p>Most Reactive: Cesium > Rubidium > Potassium > Sodium > Lithium :Least Reactive</p>
                        </div>
                        
                        <!-- GIF on Hover -->
                        <div class="mt-6">
                            <h4 class="text-lg font-semibold mb-3">Visual Guide</h4>
                            <p>Hover over the terms below to see animations:</p>
                            <div class="mt-3 space-x-4">
                                <span class="term-hover">
                                    Reactivity
                                    <div class="gif-popup">
                                        <img src="https://media.giphy.com/media/3o7aCTPPm4OHfRLSH6/giphy.gif" alt="Reactivity animation">
                                    </div>
                                </span>
                                <span class="term-hover">
                                    Electron
                                    <div class="gif-popup">
                                        <img src="https://media.giphy.com/media/3o7aD2saalBwwftBIY/giphy.gif" alt="Electron animation">
                                    </div>
                                </span>
                                <span class="term-hover">
                                    Ionization
                                    <div class="gif-popup">
                                        <img src="https://media.giphy.com/media/l0HlKQbRi6wZI9F6E/giphy.gif" alt="Ionization animation">
                                    </div>
                                </span>
                            </div>
                        </div>
                    </div>
                    <button class="btn btn-success w-full mt-4" onclick="completeSection('properties')">
                        <i class="fas fa-check mr-2"></i>
                        Mark as Complete
                    </button>
                </div>
                
                <!-- Unlockable Fun Fact -->
                <div class="fun-fact" id="funFactProperties" style="display: none;">
                    <div class="fun-fact-header">
                        <i class="fas fa-lightbulb"></i>
                        <h3 class="fun-fact-title">Fun Fact Unlocked!</h3>
                    </div>
                    <div class="fun-fact-content">
                        <p class="fun-fact-text">Cesium is so reactive that it explodes on contact with water! It's also used in atomic clocks because of its extremely consistent vibration frequency.</p>
                    </div>
                    <i class="fas fa-clock fun-fact-icon"></i>
                </div>
            </section>
            
            <!-- Reactions Section -->
            <section id="reactions-section" class="content-section" style="display: none;">
                <div class="content-card">
                    <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                        <i class="fas fa-flask mr-2 text-indigo-600"></i>
                        Reactions of Group 1 Metals
                    </h3>
                    <div class="tabs">
                        <button class="tab active" onclick="showTab('water')">With Water</button>
                        <button class="tab" onclick="showTab('oxygen')">With Oxygen</button>
                    </div>
                    <div id="water" class="tab-content active">
                        <p class="text-gray-700 mb-4">
                            All Group 1 metals react with water to produce hydrogen gas and metal hydroxides. Reactivity increases down the group.
                        </p>
                        <div class="equation-box">
                            <p class="text-gray-700 mb-2">General equation:</p>
                            <p class="equation">2M(s) + 2HO(l)  2MOH(aq) + H(g)</p>
                        </div>
                        <div class="highlight-box">
                            <h4>Observations</h4>
                            <ul class="list-disc pl-5 space-y-1">
                                <li><strong>Lithium:</strong> Fizzes steadily</li>
                                <li><strong>Sodium:</strong> Fizzes rapidly, melts into a ball</li>
                                <li><strong>Potassium:</strong> Fizzes violently, ignites with lilac flame</li>
                            </ul>
                        </div>
                        
                        <!-- What If Scenario -->
                        <div class="mt-6">
                            <h4 class="text-lg font-semibold mb-3">What If Scenario</h4>
                            <div class="whatif-container">
                                <div class="whatif-header">
                                    <i class="fas fa-question-circle"></i>
                                    <h3 class="whatif-title">What If Potassium Was in Your Drinking Water?</h3>
                                </div>
                                <div class="whatif-content">
                                    <p class="whatif-scenario">Potassium is an essential mineral for human health, but what would happen if elemental potassium (the metal) was in your drinking water?</p>
                                    <div class="whatif-options">
                                        <div class="whatif-option" onclick="showWhatIfResult('A')">
                                            A. It would be beneficial for your health
                                        </div>
                                        <div class="whatif-option" onclick="showWhatIfResult('B')">
                                            B. It would react violently and be dangerous
                                        </div>
                                        <div class="whatif-option" onclick="showWhatIfResult('C')">
                                            C. It would dissolve harmlessly
                                        </div>
                                        <div class="whatif-option" onclick="showWhatIfResult('D')">
                                            D. It would make the water taste better
                                        </div>
                                    </div>
                                    <div id="whatIfResult" class="whatif-result">
                                        <!-- Result will be shown here -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="oxygen" class="tab-content">
                        <p class="text-gray-700 mb-4">
                            Group 1 metals react with oxygen to form oxides, peroxides, or superoxides depending on the metal.
                        </p>
                        <div class="grid grid-cols-3 gap-4">
                            <div class="bg-blue-50 p-3 rounded-lg">
                                <h5 class="font-semibold text-blue-800">Lithium</h5>
                                <p class="text-sm text-blue-600">Forms LiO (oxide)</p>
                            </div>
                            <div class="bg-green-50 p-3 rounded-lg">
                                <h5 class="font-semibold text-green-800">Sodium</h5>
                                <p class="text-sm text-green-600">Forms NaO (peroxide)</p>
                            </div>
                            <div class="bg-purple-50 p-3 rounded-lg">
                                <h5 class="font-semibold text-purple-800">Potassium</h5>
                                <p class="text-sm text-purple-600">Forms KO (superoxide)</p>
                            </div>
                        </div>
                        
                        <!-- Case Studies / Real-life Applications -->
                        <div class="mt-6">
                            <h4 class="text-lg font-semibold mb-3">Real-life Applications</h4>
                            <div class="space-y-3">
                                <div class="bg-yellow-50 p-4 rounded-lg">
                                    <h5 class="font-semibold text-yellow-800 mb-1">Fireworks</h5>
                                    <p class="text-sm text-yellow-700">Lithium and potassium compounds are used to create red and violet colors in fireworks.</p>
                                </div>
                                <div class="bg-blue-50 p-4 rounded-lg">
                                    <h5 class="font-semibold text-blue-800 mb-1">Batteries</h5>
                                    <p class="text-sm text-blue-700">Lithium-ion batteries power smartphones, laptops, and electric vehicles due to lithium's light weight and high electrochemical potential.</p>
                                </div>
                                <div class="bg-green-50 p-4 rounded-lg">
                                    <h5 class="font-semibold text-green-800 mb-1">Soap Making</h5>
                                    <p class="text-sm text-green-700">Sodium hydroxide (from sodium reacting with water) is a key ingredient in soap production.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <button class="btn btn-success w-full mt-4" onclick="completeSection('reactions')">
                        <i class="fas fa-check mr-2"></i>
                        Mark as Complete
                    </button>
                </div>
                
                <!-- Unlockable Fun Fact -->
                <div class="fun-fact" id="funFactReactions" style="display: none;">
                    <div class="fun-fact-header">
                        <i class="fas fa-lightbulb"></i>
                        <h3 class="fun-fact-title">Fun Fact Unlocked!</h3>
                    </div>
                    <div class="fun-fact-content">
                        <p class="fun-fact-text">The reaction between potassium and water is so violent that it can ignite the hydrogen gas produced, creating a lilac-colored flame. This is why potassium is stored under oil and handled with extreme caution!</p>
                    </div>
                    <i class="fas fa-fire fun-fact-icon"></i>
                </div>
            </section>
            
            <!-- Quiz Section -->
            <section id="quiz-section" class="content-section" style="display: none;">
                <div class="content-card">
                    <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                        <i class="fas fa-graduation-cap mr-2 text-indigo-600"></i>
                        Test Your Knowledge
                    </h3>
                    <p class="text-gray-600 mb-6">
                        Take this innovative quiz to test your understanding of Group 1 Alkali Metals.
                    </p>
                    <button onclick="startQuiz()" class="btn btn-primary w-full">
                        <i class="fas fa-play mr-2"></i>
                        Start Quiz
                    </button>
                </div>
            </section>
            
            <!-- Leaderboard Section -->
            <section id="leaderboard-section" class="content-section" style="display: none;">
                <div class="leaderboard">
                    <div class="leaderboard-header">
                        <h3 class="leaderboard-title">
                            <i class="fas fa-trophy mr-2"></i>
                            Leaderboard
                        </h3>
                        <i class="fas fa-sync-alt leaderboard-refresh" onclick="refreshLeaderboard()"></i>
                    </div>
                    <ul class="leaderboard-list" id="leaderboardList">
                        <!-- Leaderboard items will be added here -->
                    </ul>
                </div>
            </section>
            
            <!-- Story Mode Section -->
            <section id="story-mode-section" class="content-section" style="display: none;">
                <div class="story-container">
                    <div class="story-header">
                        <h3 class="story-title">The Alkali Adventure</h3>
                        <div class="story-progress">
                            <span class="story-chapter">Chapter <span id="currentChapter">1</span> of 5</span>
                        </div>
                    </div>
                    <div class="story-content">
                        <div class="story-text" id="storyText">
                            Welcome to The Alkali Adventure! You are a young chemist tasked with discovering the properties of Group 1 elements. Your journey begins in the laboratory where you'll encounter these reactive metals for the first time...
                        </div>
                        <div class="story-choices" id="storyChoices">
                            <div class="story-choice" onclick="makeStoryChoice('A')">
                                Start with Lithium - the lightest metal
                            </div>
                            <div class="story-choice" onclick="makeStoryChoice('B')">
                                Start with Sodium - the most familiar
                            </div>
                            <div class="story-choice" onclick="makeStoryChoice('C')">
                                Start with Potassium - the most reactive
                            </div>
                        </div>
                    </div>
                    <i class="fas fa-flask story-character"></i>
                </div>
            </section>
            
            <!-- Daily Challenge Modal -->
            <div id="dailyChallengeModal" class="modal">
                <div class="modal-content">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold text-gray-800">Daily Challenge</h2>
                        <button onclick="closeDailyChallenge()" class="text-gray-500 hover:text-gray-700">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                    
                    <div class="daily-challenge">
                        <div class="daily-challenge-header">
                            <h3 class="daily-challenge-title">
                                <i class="fas fa-calendar-day mr-2"></i>
                                Daily Challenge
                            </h3>
                            <div class="daily-challenge-timer">
                                <i class="fas fa-clock mr-1"></i>
                                <span id="challengeTimer">23:45:12</span>
                            </div>
                        </div>
                        <div class="daily-challenge-content">
                            <p class="daily-challenge-question" id="dailyChallengeQuestion">
                                Which Group 1 metal has the lowest melting point?
                            </p>
                            <div class="daily-challenge-options" id="dailyChallengeOptions">
                                <div class="daily-challenge-option" onclick="answerDailyChallenge('A')">Lithium</div>
                                <div class="daily-challenge-option" onclick="answerDailyChallenge('B')">Sodium</div>
                                <div class="daily-challenge-option" onclick="answerDailyChallenge('C')">Potassium</div>
                                <div class="daily-challenge-option" onclick="answerDailyChallenge('D')">Cesium</div>
                            </div>
                            <div class="daily-challenge-reward">
                                <i class="fas fa-star mr-1"></i>
                                Reward: 50 XP Points
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Quiz Modal -->
            <div id="quizModal" class="modal quiz-modal">
                <div class="modal-content">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-xl font-bold text-gray-800">Group 1 Quiz</h2>
                        <button onclick="closeQuiz()" class="text-gray-500 hover:text-gray-700">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                    <div id="quizProgress" class="mb-4">
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-sm text-gray-600">Question <span id="currentQuestion">1</span> of <span id="totalQuestions">8</span></span>
                            <span class="text-sm text-gray-600">Score: <span id="currentScore">0</span></span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="progressFill" style="width: 12.5%"></div>
                        </div>
                    </div>
                    <div id="quizContent">
                        <div class="mb-6">
                            <h3 class="text-lg font-semibold mb-4" id="questionText">Loading question...</h3>
                            <div id="optionsContainer"></div>
                        </div>
                        <div id="feedback" class="hidden mb-4 p-3 rounded-lg text-sm"></div>
                        <div class="flex justify-between items-center">
                            <button id="prevButton" class="btn btn-secondary hidden" onclick="previousQuestion()">
                                <i class="fas fa-arrow-left"></i>
                                Previous
                            </button>
                            <div class="flex gap-2">
                                <button id="submitButton" class="btn btn-primary" onclick="submitAnswer()">
                                    Submit Answer
                                </button>
                                <button id="nextButton" class="btn btn-primary hidden" onclick="nextQuestion()">
                                    Next
                                    <i class="fas fa-arrow-right ml-1"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    <div id="quizResults" class="hidden text-center">
                        <i class="fas fa-trophy text-5xl text-yellow-500 mb-4"></i>
                        <h3 class="text-2xl font-bold mb-3">Quiz Complete!</h3>
                        <div class="text-4xl font-bold text-indigo-600 mb-3" id="finalScore">0/8</div>
                        <p class="text-gray-600 mb-6" id="scoreMessage">Great job!</p>
                        <button onclick="closeQuiz()" class="btn btn-primary">
                            <i class="fas fa-check"></i>
                            Finish
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Toast Container -->
            <div id="toastContainer"></div>
            
            <!-- Feedback System -->
            <div class="feedback-system" id="feedbackSystem">
                <div class="feedback-header">
                    <h4 class="feedback-title">Feedback</h4>
                    <span class="feedback-close" onclick="toggleFeedback()">
                        <i class="fas fa-times"></i>
                    </span>
                </div>
                <div class="feedback-content">
                    <div class="feedback-reactions">
                        <div class="reaction-btn" id="thumbsUp" onclick="toggleReaction('thumbsUp')">
                            <i class="fas fa-thumbs-up"></i>
                            <span class="reaction-count" id="thumbsUpCount">0</span>
                        </div>
                        <div class="reaction-btn" id="thumbsDown" onclick="toggleReaction('thumbsDown')">
                            <i class="fas fa-thumbs-down"></i>
                            <span class="reaction-count" id="thumbsDownCount">0</span>
                        </div>
                    </div>
                    <textarea class="feedback-textarea" placeholder="Share your feedback..." id="feedbackText"></textarea>
                    <button class="btn btn-primary feedback-submit" onclick="submitFeedback()">Submit Feedback</button>
                </div>
            </div>
            
            <!-- Sound Toggle -->
            <div class="sound-toggle" id="soundToggle" onclick="toggleSound()">
                <i class="fas fa-volume-up"></i>
            </div>
            
            <!-- Offline Mode Indicator -->
            <div class="offline-indicator" id="offlineIndicator">
                <i class="fas fa-wifi-slash mr-2"></i>
                Offline Mode
            </div>
        </main>
    </div>
    
    <!-- Login Modal -->
    <div id="loginModal" class="modal">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-gray-800">Welcome to Chemistry Mastery</h2>
                <button onclick="closeLoginModal()" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            
            <div class="mb-6">
                <button onclick="signInWithGoogle()" class="btn btn-primary w-full">
                    <i class="fab fa-google mr-2"></i>
                    Sign in with Google
                </button>
            </div>
            
            <div class="text-center text-gray-600">
                <p>Or continue with email</p>
            </div>
            
            <form id="loginForm" class="mt-6 space-y-4" onsubmit="handleEmailLogin(event)">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                    <input type="email" id="loginEmail" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" placeholder="your@email.com" required>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                    <input type="password" id="loginPassword" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" placeholder="" required>
                </div>
                <button type="submit" class="btn btn-primary w-full">
                    <i class="fas fa-sign-in-alt mr-2"></i>
                    Sign In
                </button>
            </form>
            
            <div class="mt-6 text-center">
                <p class="text-sm text-gray-600">Don't have an account? <a href="#" onclick="showSignup()" class="text-indigo-600 hover:text-indigo-800">Sign up</a></p>
            </div>
        </div>
    </div>
    
    <!-- Signup Modal -->
    <div id="signupModal" class="modal">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-gray-800">Create Account</h2>
                <button onclick="closeSignupModal()" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            
            <form id="signupForm" class="space-y-4" onsubmit="handleSignup(event)">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Full Name</label>
                    <input type="text" id="signupName" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" placeholder="John Doe" required>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                    <input type="email" id="signupEmail" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" placeholder="your@email.com" required>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                    <input type="password" id="signupPassword" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" placeholder="" required>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Confirm Password</label>
                    <input type="password" id="signupConfirmPassword" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" placeholder="" required>
                </div>
                <button type="submit" class="btn btn-primary w-full">
                    <i class="fas fa-user-plus mr-2"></i>
                    Create Account
                </button>
            </form>
            
            <div class="mt-6 text-center">
                <p class="text-sm text-gray-600">Already have an account? <a href="#" onclick="showLogin()" class="text-indigo-600 hover:text-indigo-800">Sign in</a></p>
            </div>
        </div>
    </div>
    
    <script>
        // Global variables
        let currentUser = null;
        let userData = null;
        let currentSection = 'overview';
        let completedSections = [];
        let xpPoints = 0;
        let badges = [];
        let soundEnabled = true;
        let darkMode = false;
        let offlineMode = false;
        let feedbackVisible = true;
        let userReaction = null;
        let dailyChallengeCompleted = false;
        let storyChapter = 1;
        let quizQuestions = [];
        let currentQuestion = 0;
        let score = 0;
        let selectedOption = null;
        let answerSubmitted = false;
        let quizAnswers = [];
        
        // Quiz Questions with Multiple Types
        quizQuestions = [
            // MCQ Questions
            {
                type: 'mcq',
                question: "What is the electron configuration of the outer shell of all Group 1 elements?",
                options: ["1 electron", "2 electrons", "8 electrons", "Variable number of electrons"],
                correct: 0,
                explanation: "All Group 1 elements have one electron in their outer shell, which they readily lose to form +1 ions."
            },
            {
                type: 'mcq',
                question: "Which of the following statements about the reactivity of Group 1 metals is correct?",
                options: ["Reactivity decreases down the group", "Reactivity increases down the group", "Reactivity stays the same down the group", "Reactivity is highest for lithium"],
                correct: 1,
                explanation: "Reactivity increases down Group 1 because the outer electron is further from the nucleus and easier to lose."
            },
            
            // Drag and Drop
            {
                type: 'dragdrop',
                question: "Drag and drop the elements in order of increasing reactivity (least reactive first):",
                items: ["Lithium", "Sodium", "Potassium", "Rubidium", "Cesium"],
                correct: [0, 1, 2, 3, 4],
                explanation: "Reactivity increases down Group 1: Lithium < Sodium < Potassium < Rubidium < Cesium"
            },
            
            // Fill in the Blanks
            {
                type: 'fillblank',
                question: "When Group 1 metals react with water, they produce [blank1] gas and metal [blank2].",
                blanks: [
                    { id: 'blank1', answer: 'hydrogen', options: ['hydrogen', 'oxygen', 'nitrogen', 'carbon dioxide'] },
                    { id: 'blank2', answer: 'hydroxides', options: ['hydroxides', 'oxides', 'peroxides', 'carbonates'] }
                ],
                explanation: "The general equation is: 2M(s) + 2HO(l)  2MOH(aq) + H(g)"
            },
            
            // Matching Question
            {
                type: 'matching',
                question: "Match each element to the oxide it forms when burned in oxygen:",
                leftItems: ["Lithium", "Sodium", "Potassium"],
                rightItems: ["LiO (oxide)", "NaO (peroxide)", "KO (superoxide)"],
                correct: [0, 1, 2], // Index mapping
                explanation: "Lithium forms normal oxide, sodium forms peroxide, and potassium forms superoxide."
            },
            
            // True/False with Explanation
            {
                type: 'truefalse',
                question: "The melting point of Group 1 metals increases as you go down the group.",
                correct: false,
                explanation: "False. The melting point decreases down Group 1 due to increasing atomic size and weaker metallic bonding."
            },
            
            // Chemical Equation Balancer
            {
                type: 'equation-balancer',
                question: "Balance the following chemical equation for the reaction of sodium with water:",
                equation: {
                    left: [
                        { symbol: "Na", coefficient: 1 },
                        { symbol: "HO", coefficient: 1 }
                    ],
                    right: [
                        { symbol: "NaOH", coefficient: 1 },
                        { symbol: "H", coefficient: 1 }
                    ]
                },
                correct: [2, 2, 2, 1], // Correct coefficients for Na, HO, NaOH, H
                explanation: "The balanced equation is: 2Na + 2HO  2NaOH + H"
            },
            
            // Interactive Lab Simulation
            {
                type: 'lab-simulation',
                question: "Simulate the reaction of alkali metals with water by clicking on the metals and observing their reactivity:",
                metals: [
                    { name: "Lithium", symbol: "Li", color: "lithium", reactivity: "low", observation: "Fizzes steadily" },
                    { name: "Sodium", symbol: "Na", color: "sodium", reactivity: "medium", observation: "Fizzes rapidly, melts into a ball" },
                    { name: "Potassium", symbol: "K", color: "potassium", reactivity: "high", observation: "Fizzes violently, ignites with lilac flame" }
                ],
                correct: ["potassium", "sodium", "lithium"], // Order of reactivity (most to least)
                explanation: "Reactivity increases down Group 1: Potassium > Sodium > Lithium"
            }
        ];
        
        // Daily Challenge Questions
        const dailyChallengeQuestions = [
            {
                question: "Which Group 1 metal has the lowest melting point?",
                options: ["Lithium", "Sodium", "Potassium", "Cesium"],
                correct: 3,
                explanation: "Cesium has the lowest melting point of all Group 1 metals at 28.4C."
            },
            {
                question: "What gas is produced when Group 1 metals react with water?",
                options: ["Oxygen", "Hydrogen", "Nitrogen", "Carbon Dioxide"],
                correct: 1,
                explanation: "Group 1 metals react with water to produce hydrogen gas: 2M + 2HO  2MOH + H"
            },
            {
                question: "Which Group 1 metal is used in batteries for smartphones?",
                options: ["Sodium", "Potassium", "Lithium", "Rubidium"],
                correct: 2,
                explanation: "Lithium is used in lithium-ion batteries due to its light weight and high electrochemical potential."
            },
            {
                question: "What color flame does potassium produce when burned?",
                options: ["Red", "Blue", "Green", "Lilac"],
                correct: 3,
                explanation: "Potassium produces a characteristic lilac (light purple) flame when burned."
            },
            {
                question: "Which Group 1 metal is the most reactive?",
                options: ["Lithium", "Sodium", "Potassium", "Cesium"],
                correct: 3,
                explanation: "Cesium is the most reactive Group 1 metal due to its large atomic size and low ionization energy."
            }
        ];
        
        // Story Mode Content
        const storyChapters = [
            {
                chapter: 1,
                text: "Welcome to The Alkali Adventure! You are a young chemist tasked with discovering the properties of Group 1 elements. Your journey begins in the laboratory where you'll encounter these reactive metals for the first time...",
                choices: [
                    { text: "Start with Lithium - the lightest metal", next: 2 },
                    { text: "Start with Sodium - the most familiar", next: 3 },
                    { text: "Start with Potassium - the most reactive", next: 4 }
                ]
            },
            {
                chapter: 2,
                text: "You choose to start with Lithium. As you carefully place a small piece in water, it fizzes steadily. You notice it's less reactive than you expected. What do you do next?",
                choices: [
                    { text: "Try a larger piece of Lithium", next: 5 },
                    { text: "Compare it with Sodium", next: 6 },
                    { text: "Test its reaction with oxygen", next: 7 }
                ]
            },
            {
                chapter: 3,
                text: "You choose to start with Sodium. As you drop a small piece into water, it fizzes rapidly and melts into a ball. The reaction is more vigorous than you anticipated. What's your next step?",
                choices: [
                    { text: "Observe the reaction more closely", next: 8 },
                    { text: "Try a smaller piece of Sodium", next: 9 },
                    { text: "Compare it with Lithium", next: 6 }
                ]
            },
            {
                chapter: 4,
                text: "You choose to start with Potassium. As you carefully place a tiny piece in water, it reacts violently, igniting with a lilac flame! This is much more reactive than you expected. What do you do?",
                choices: [
                    { text: "Try an even smaller piece", next: 10 },
                    { text: "Compare it with Sodium", next: 11 },
                    { text: "Test its reaction with oxygen", next: 12 }
                ]
            },
            {
                chapter: 5,
                text: "You try a larger piece of Lithium. The reaction is more vigorous but still relatively mild. You're starting to understand the reactivity trend. What's your next experiment?",
                choices: [
                    { text: "Test Lithium's reaction with oxygen", next: 7 },
                    { text: "Compare with Sodium", next: 6 },
                    { text: "Test all Group 1 metals together", next: 13 }
                ]
            }
        ];
        
        // Initialize app
        function initApp() {
            // Check authentication state
            checkAuthState();
            
            // Initialize periodic table
            generatePeriodicTable();
            
            // Initialize daily challenge timer
            updateDailyChallengeTimer();
            setInterval(updateDailyChallengeTimer, 1000);
            
            // Load user preferences
            loadUserPreferences();
            
            // Initialize Google Analytics
            initGoogleAnalytics();
            
            // Check online/offline status
            checkOnlineStatus();
            window.addEventListener('online', checkOnlineStatus);
            window.addEventListener('offline', checkOnlineStatus);
            
            // Load daily challenge
            loadDailyChallenge();
            
            // Load leaderboard
            loadLeaderboard();
            
            // Show feedback system
            setTimeout(() => {
                if (feedbackVisible) {
                    document.getElementById('feedbackSystem').style.display = 'block';
                }
            }, 5000);
        }
        
        // Authentication functions
        function checkAuthState() {
            // Check if user is logged in (simplified for demo)
            const savedUser = localStorage.getItem('currentUser');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                userData = JSON.parse(localStorage.getItem('userData') || '{}');
                loadUserData();
            } else {
                showLandingPage();
            }
        }
        
        function showLandingPage() {
            document.getElementById('landingPage').style.display = 'flex';
            document.getElementById('mainApp').style.display = 'none';
        }
        
        function showMainApp() {
            document.getElementById('landingPage').style.display = 'none';
            document.getElementById('mainApp').style.display = 'block';
            
            // Update user info
            document.getElementById('userName').textContent = userData.displayName || 'User';
            document.getElementById('userXP').textContent = userData.xpPoints || 0;
            document.getElementById('totalXP').textContent = userData.xpPoints || 0;
            
            // Update progress
            updateProgressTracker();
            updateSectionCompletionStatus();
            
            // Update badges
            updateBadges();
        }
        
        function loadUserData() {
            // Load user data from localStorage (simplified for demo)
            completedSections = userData.completedSections || [];
            xpPoints = userData.xpPoints || 0;
            badges = userData.badges || [];
            dailyChallengeCompleted = userData.dailyChallengeCompleted || false;
            storyChapter = userData.storyChapter || 1;
            
            showMainApp();
        }
        
        function saveUserData() {
            // Save user data to localStorage (simplified for demo)
            userData = {
                ...userData,
                completedSections: completedSections,
                xpPoints: xpPoints,
                badges: badges,
                dailyChallengeCompleted: dailyChallengeCompleted,
                storyChapter: storyChapter
            };
            
            localStorage.setItem('userData', JSON.stringify(userData));
        }
        
        function showLoginModal() {
            document.getElementById('loginModal').classList.add('active');
        }
        
        function closeLoginModal() {
            document.getElementById('loginModal').classList.remove('active');
        }
        
        function showSignup() {
            closeLoginModal();
            document.getElementById('signupModal').classList.add('active');
        }
        
        function showLogin() {
            closeSignupModal();
            document.getElementById('loginModal').classList.add('active');
        }
        
        function closeSignupModal() {
            document.getElementById('signupModal').classList.remove('active');
        }
        
        function signInWithGoogle() {
            // Simplified Google sign-in for demo
            const user = {
                uid: 'google-user-' + Date.now(),
                email: 'user@example.com',
                displayName: 'Google User'
            };
            
            currentUser = user;
            localStorage.setItem('currentUser', JSON.stringify(user));
            
            // Create user profile if not exists
            if (!localStorage.getItem('userData')) {
                userData = {
                    uid: user.uid,
                    email: user.email,
                    displayName: user.displayName,
                    completedSections: [],
                    xpPoints: 0,
                    badges: [],
                    savedPosts: [],
                    dailyChallengeCompleted: false,
                    storyChapter: 1,
                    createdAt: new Date().toISOString()
                };
                localStorage.setItem('userData', JSON.stringify(userData));
            }
            
            loadUserData();
            showToast('success', 'Welcome!', 'You have been successfully signed in.');
            closeLoginModal();
        }
        
        function handleEmailLogin(event) {
            event.preventDefault();
            
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            // Simplified email login for demo
            const user = {
                uid: 'email-user-' + Date.now(),
                email: email,
                displayName: email.split('@')[0]
            };
            
            currentUser = user;
            localStorage.setItem('currentUser', JSON.stringify(user));
            
            // Create user profile if not exists
            if (!localStorage.getItem('userData')) {
                userData = {
                    uid: user.uid,
                    email: user.email,
                    displayName: user.displayName,
                    completedSections: [],
                    xpPoints: 0,
                    badges: [],
                    savedPosts: [],
                    dailyChallengeCompleted: false,
                    storyChapter: 1,
                    createdAt: new Date().toISOString()
                };
                localStorage.setItem('userData', JSON.stringify(userData));
            }
            
            loadUserData();
            showToast('success', 'Welcome back!', 'You have been successfully signed in.');
            closeLoginModal();
        }
        
        function handleSignup(event) {
            event.preventDefault();
            
            const name = document.getElementById('signupName').value;
            const email = document.getElementById('signupEmail').value;
            const password = document.getElementById('signupPassword').value;
            const confirmPassword = document.getElementById('signupConfirmPassword').value;
            
            if (password !== confirmPassword) {
                showToast('error', 'Password Mismatch', 'The passwords you entered do not match.');
                return;
            }
            
            // Simplified signup for demo
            const user = {
                uid: 'email-user-' + Date.now(),
                email: email,
                displayName: name
            };
            
            currentUser = user;
            localStorage.setItem('currentUser', JSON.stringify(user));
            
            userData = {
                uid: user.uid,
                email: user.email,
                displayName: user.displayName,
                completedSections: [],
                xpPoints: 0,
                badges: [],
                savedPosts: [],
                dailyChallengeCompleted: false,
                storyChapter: 1,
                createdAt: new Date().toISOString()
            };
            
            localStorage.setItem('userData', JSON.stringify(userData));
            
            loadUserData();
            showToast('success', 'Account Created!', 'Your account has been created successfully.');
            closeSignupModal();
        }
        
        function signOut() {
            currentUser = null;
            userData = null;
            localStorage.removeItem('currentUser');
            showToast('info', 'Goodbye!', 'You have been successfully signed out.');
            showLandingPage();
        }
        
        // Navigation functions
        function navigateToSection(sectionName) {
            // Check if section is locked
            const navItem = document.getElementById(`nav-${sectionName}`);
            if (navItem.classList.contains('locked')) {
                showToast('info', 'Section Locked', 'Please complete previous sections first.');
                return;
            }
            
            // Hide all sections
            const sections = document.querySelectorAll('.content-section');
            sections.forEach(section => {
                section.style.display = 'none';
            });
            
            // Show selected section
            document.getElementById(`${sectionName}-section`).style.display = 'block';
            
            // Update active nav item
            const navItems = document.querySelectorAll('.nav-item');
            navItems.forEach(item => {
                item.classList.remove('active');
            });
            navItem.classList.add('active');
            
            currentSection = sectionName;
            
            // Track navigation with Google Analytics
            if (typeof gtag !== 'undefined') {
                gtag('event', 'page_view', {
                    page_title: sectionName,
                    page_location: window.location.href
                });
            }
        }
        
        function showTab(tabName) {
            // Hide all tab contents
            const tabContents = document.querySelectorAll('.tab-content');
            tabContents.forEach(content => {
                content.classList.remove('active');
            });
            
            // Remove active class from all tabs
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab content
            document.getElementById(tabName).classList.add('active');
            
            // Add active class to clicked tab
            const activeTab = document.querySelector(`[onclick="showTab('${tabName}')"]`);
            activeTab.classList.add('active');
        }
        
        function completeSection(sectionName) {
            if (completedSections.includes(sectionName)) {
                showToast('info', 'Already Completed', 'This section is already marked as complete.');
                return;
            }
            
            completedSections.push(sectionName);
            
            // Award XP points
            const xpAwarded = 50;
            xpPoints += xpAwarded;
            
            // Save to localStorage
            saveUserData();
            
            showToast('success', 'Section Complete!', `Great job! You've earned ${xpAwarded} XP points.`);
            updateSectionCompletionStatus();
            updateProgressTracker();
            updateBadges();
            
            // Show unlockable fun fact
            showFunFact(sectionName);
            
            // Play sound effect
            playSound('complete');
            
            // Navigate to next section if available
            const sectionOrder = ['overview', 'elements', 'properties', 'reactions', 'quiz'];
            const currentIndex = sectionOrder.indexOf(sectionName);
            if (currentIndex < sectionOrder.length - 1) {
                const nextSection = sectionOrder[currentIndex + 1];
                navigateToSection(nextSection);
            }
        }
        
        function updateSectionCompletionStatus() {
            // Update nav items
            const navItems = document.querySelectorAll('.nav-item');
            navItems.forEach(item => {
                const section = item.id.replace('nav-', '');
                if (completedSections.includes(section)) {
                    item.classList.remove('locked');
                    item.classList.add('completed');
                }
            });
            
            // Unlock next sections
            const sectionOrder = ['overview', 'elements', 'properties', 'reactions', 'quiz'];
            sectionOrder.forEach((section, index) => {
                if (completedSections.includes(section) && index < sectionOrder.length - 1) {
                    const nextSection = sectionOrder[index + 1];
                    const nextNavItem = document.getElementById(`nav-${nextSection}`);
                    if (nextNavItem) {
                        nextNavItem.classList.remove('locked');
                    }
                }
            });
            
            // Check if all sections are completed to unlock quiz
            const allSectionsCompleted = ['overview', 'elements', 'properties', 'reactions'].every(section => 
                completedSections.includes(section)
            );
            
            if (allSectionsCompleted) {
                const quizNavItem = document.getElementById('nav-quiz');
                if (quizNavItem) {
                    quizNavItem.classList.remove('locked');
                }
            }
        }
        
        function updateProgressTracker() {
            const totalSections = 4; // overview, elements, properties, reactions
            const completedCount = completedSections.length;
            const percentage = Math.round((completedCount / totalSections) * 100);
            
            document.getElementById('progressPercentage').textContent = `${percentage}%`;
            document.getElementById('overallProgressFill').style.width = `${percentage}%`;
            
            // Update progress items
            const sections = ['overview', 'elements', 'properties', 'quiz'];
            sections.forEach(section => {
                const progressItem = document.getElementById(`progress-${section}`);
                const statusElement = progressItem.querySelector('.text-xs');
                
                if (completedSections.includes(section)) {
                    progressItem.classList.add('bg-green-100');
                    statusElement.textContent = 'Completed';
                    statusElement.classList.remove('text-gray-500');
                    statusElement.classList.add('text-green-600');
                } else if (section === 'quiz' && completedSections.length === 4) {
                    progressItem.classList.remove('bg-gray-100');
                    progressItem.classList.add('bg-blue-100');
                    statusElement.textContent = 'Available';
                    statusElement.classList.remove('text-gray-500');
                    statusElement.classList.add('text-blue-600');
                }
            });
        }
        
        function updateBadges() {
            const badgesContainer = document.getElementById('badgesContainer');
            badgesContainer.innerHTML = '';
            
            // Define available badges
            const availableBadges = [
                { id: 'first-steps', name: 'First Steps', icon: 'fa-baby', requirement: () => completedSections.length > 0 },
                { id: 'quick-learner', name: 'Quick Learner', icon: 'fa-bolt', requirement: () => completedSections.length >= 2 },
                { id: 'metal-master', name: 'Metal Master', icon: 'fa-award', requirement: () => completedSections.length >= 4 },
                { id: 'xp-collector', name: 'XP Collector', icon: 'fa-coins', requirement: () => xpPoints >= 200 },
                { id: 'daily-champion', name: 'Daily Champion', icon: 'fa-calendar-check', requirement: () => dailyChallengeCompleted },
                { id: 'story-explorer', name: 'Story Explorer', icon: 'fa-book-open', requirement: () => storyChapter > 1 }
            ];
            
            // Check and award badges
            availableBadges.forEach(badge => {
                if (badge.requirement() && !badges.includes(badge.id)) {
                    badges.push(badge.id);
                    showToast('success', 'Badge Unlocked!', `You've earned the "${badge.name}" badge!`);
                    playSound('badge');
                }
                
                if (badges.includes(badge.id)) {
                    const badgeElement = document.createElement('div');
                    badgeElement.className = 'badge';
                    badgeElement.innerHTML = `
                        <i class="fas ${badge.icon}"></i>
                        <div class="badge-tooltip">${badge.name}</div>
                    `;
                    badgesContainer.appendChild(badgeElement);
                }
            });
            
            // Save updated badges
            saveUserData();
        }
        
        function showFunFact(sectionName) {
            const funFactElement = document.getElementById(`funFact${sectionName.charAt(0).toUpperCase() + sectionName.slice(1)}`);
            if (funFactElement) {
                funFactElement.style.display = 'block';
                
                // Scroll to fun fact
                funFactElement.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }
        }
        
        // Search and Filter functions
        function searchContent() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const sections = document.querySelectorAll('.content-section');
            
            sections.forEach(section => {
                if (section.style.display === 'none') return;
                
                const text = section.textContent.toLowerCase();
                if (text.includes(searchTerm) || searchTerm === '') {
                    section.style.display = 'block';
                } else {
                    section.style.display = 'none';
                }
            });
        }
        
        function filterContent(filterType) {
            // Update active filter
            const filterTags = document.querySelectorAll('.filter-tag');
            filterTags.forEach(tag => {
                tag.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Filter content based on type
            const sections = document.querySelectorAll('.content-section');
            
            sections.forEach(section => {
                if (section.style.display === 'none') return;
                
                if (filterType === 'all') {
                    section.style.display = 'block';
                } else {
                    // This is a simplified filter - in a real app, you'd have more sophisticated filtering
                    section.style.display = 'block';
                }
            });
        }
        
        // Periodic Table functions
        function generatePeriodicTable() {
            const periodicTable = document.getElementById('periodicTable');
            if (!periodicTable) return;
            
            // Simplified periodic table with just Group 1 elements highlighted
            const elements = [
                { symbol: 'H', name: 'Hydrogen', number: 1, group: 1 },
                { symbol: 'He', name: 'Helium', number: 2 },
                { symbol: 'Li', name: 'Lithium', number: 3, group: 1 },
                { symbol: 'Be', name: 'Beryllium', number: 4 },
                { symbol: 'B', name: 'Boron', number: 5 },
                { symbol: 'C', name: 'Carbon', number: 6 },
                { symbol: 'N', name: 'Nitrogen', number: 7 },
                { symbol: 'O', name: 'Oxygen', number: 8 },
                { symbol: 'F', name: 'Fluorine', number: 9 },
                { symbol: 'Ne', name: 'Neon', number: 10 },
                { symbol: 'Na', name: 'Sodium', number: 11, group: 1 },
                { symbol: 'Mg', name: 'Magnesium', number: 12 },
                { symbol: 'Al', name: 'Aluminum', number: 13 },
                { symbol: 'Si', name: 'Silicon', number: 14 },
                { symbol: 'P', name: 'Phosphorus', number: 15 },
                { symbol: 'S', name: 'Sulfur', number: 16 },
                { symbol: 'Cl', name: 'Chlorine', number: 17 },
                { symbol: 'Ar', name: 'Argon', number: 18 },
                { symbol: 'K', name: 'Potassium', number: 19, group: 1 },
                { symbol: 'Ca', name: 'Calcium', number: 20 },
                { symbol: 'Sc', name: 'Scandium', number: 21 },
                { symbol: 'Ti', name: 'Titanium', number: 22 },
                { symbol: 'V', name: 'Vanadium', number: 23 },
                { symbol: 'Cr', name: 'Chromium', number: 24 },
                { symbol: 'Mn', name: 'Manganese', number: 25 },
                { symbol: 'Fe', name: 'Iron', number: 26 },
                { symbol: 'Co', name: 'Cobalt', number: 27 },
                { symbol: 'Ni', name: 'Nickel', number: 28 },
                { symbol: 'Cu', name: 'Copper', number: 29 },
                { symbol: 'Zn', name: 'Zinc', number: 30 },
                { symbol: 'Ga', name: 'Gallium', number: 31 },
                { symbol: 'Ge', name: 'Germanium', number: 32 },
                { symbol: 'As', name: 'Arsenic', number: 33 },
                { symbol: 'Se', name: 'Selenium', number: 34 },
                { symbol: 'Br', name: 'Bromine', number: 35 },
                { symbol: 'Kr', name: 'Krypton', number: 36 },
                { symbol: 'Rb', name: 'Rubidium', number: 37, group: 1 },
                { symbol: 'Sr', name: 'Strontium', number: 38 },
                { symbol: 'Y', name: 'Yttrium', number: 39 },
                { symbol: 'Zr', name: 'Zirconium', number: 40 },
                { symbol: 'Nb', name: 'Niobium', number: 41 },
                { symbol: 'Mo', name: 'Molybdenum', number: 42 },
                { symbol: 'Tc', name: 'Technetium', number: 43 },
                { symbol: 'Ru', name: 'Ruthenium', number: 44 },
                { symbol: 'Rh', name: 'Rhodium', number: 45 },
                { symbol: 'Pd', name: 'Palladium', number: 46 },
                { symbol: 'Ag', name: 'Silver', number: 47 },
                { symbol: 'Cd', name: 'Cadmium', number: 48 },
                { symbol: 'In', name: 'Indium', number: 49 },
                { symbol: 'Sn', name: 'Tin', number: 50 },
                { symbol: 'Sb', name: 'Antimony', number: 51 },
                { symbol: 'Te', name: 'Tellurium', number: 52 },
                { symbol: 'I', name: 'Iodine', number: 53 },
                { symbol: 'Xe', name: 'Xenon', number: 54 },
                { symbol: 'Cs', name: 'Cesium', number: 55, group: 1 },
                { symbol: 'Ba', name: 'Barium', number: 56 },
                { symbol: 'La', name: 'Lanthanum', number: 57 },
                { symbol: 'Ce', name: 'Cerium', number: 58 },
                { symbol: 'Pr', name: 'Praseodymium', number: 59 },
                { symbol: 'Nd', name: 'Neodymium', number: 60 },
                { symbol: 'Pm', name: 'Promethium', number: 61 },
                { symbol: 'Sm', name: 'Samarium', number: 62 },
                { symbol: 'Eu', name: 'Europium', number: 63 },
                { symbol: 'Gd', name: 'Gadolinium', number: 64 },
                { symbol: 'Tb', name: 'Terbium', number: 65 },
                { symbol: 'Dy', name: 'Dysprosium', number: 66 },
                { symbol: 'Ho', name: 'Holmium', number: 67 },
                { symbol: 'Er', name: 'Erbium', number: 68 },
                { symbol: 'Tm', name: 'Thulium', number: 69 },
                { symbol: 'Yb', name: 'Ytterbium', number: 70 },
                { symbol: 'Lu', name: 'Lutetium', number: 71 },
                { symbol: 'Hf', name: 'Hafnium', number: 72 },
                { symbol: 'Ta', name: 'Tantalum', number: 73 },
                { symbol: 'W', name: 'Tungsten', number: 74 },
                { symbol: 'Re', name: 'Rhenium', number: 75 },
                { symbol: 'Os', name: 'Osmium', number: 76 },
                { symbol: 'Ir', name: 'Iridium', number: 77 },
                { symbol: 'Pt', name: 'Platinum', number: 78 },
                { symbol: 'Au', name: 'Gold', number: 79 },
                { symbol: 'Hg', name: 'Mercury', number: 80 },
                { symbol: 'Tl', name: 'Thallium', number: 81 },
                { symbol: 'Pb', name: 'Lead', number: 82 },
                { symbol: 'Bi', name: 'Bismuth', number: 83 },
                { symbol: 'Po', name: 'Polonium', number: 84 },
                { symbol: 'At', name: 'Astatine', number: 85 },
                { symbol: 'Rn', name: 'Radon', number: 86 },
                { symbol: 'Fr', name: 'Francium', number: 87, group: 1 },
                { symbol: 'Ra', name: 'Radium', number: 88 },
                { symbol: 'Ac', name: 'Actinium', number: 89 },
                { symbol: 'Th', name: 'Thorium', number: 90 },
                { symbol: 'Pa', name: 'Protactinium', number: 91 },
                { symbol: 'U', name: 'Uranium', number: 92 },
                { symbol: 'Np', name: 'Neptunium', number: 93 },
                { symbol: 'Pu', name: 'Plutonium', number: 94 },
                { symbol: 'Am', name: 'Americium', number: 95 },
                { symbol: 'Cm', name: 'Curium', number: 96 },
                { symbol: 'Bk', name: 'Berkelium', number: 97 },
                { symbol: 'Cf', name: 'Californium', number: 98 },
                { symbol: 'Es', name: 'Einsteinium', number: 99 },
                { symbol: 'Fm', name: 'Fermium', number: 100 },
                { symbol: 'Md', name: 'Mendelevium', number: 101 },
                { symbol: 'No', name: 'Nobelium', number: 102 },
                { symbol: 'Lr', name: 'Lawrencium', number: 103 },
                { symbol: 'Rf', name: 'Rutherfordium', number: 104 },
                { symbol: 'Db', name: 'Dubnium', number: 105 },
                { symbol: 'Sg', name: 'Seaborgium', number: 106 },
                { symbol: 'Bh', name: 'Bohrium', number: 107 },
                { symbol: 'Hs', name: 'Hassium', number: 108 },
                { symbol: 'Mt', name: 'Meitnerium', number: 109 },
                { symbol: 'Ds', name: 'Darmstadtium', number: 110 },
                { symbol: 'Rg', name: 'Roentgenium', number: 111 },
                { symbol: 'Cn', name: 'Copernicium', number: 112 },
                { symbol: 'Nh', name: 'Nihonium', number: 113 },
                { symbol: 'Fl', name: 'Flerovium', number: 114 },
                { symbol: 'Mc', name: 'Moscovium', number: 115 },
                { symbol: 'Lv', name: 'Livermorium', number: 116 },
                { symbol: 'Ts', name: 'Tennessine', number: 117 },
                { symbol: 'Og', name: 'Oganesson', number: 118 }
            ];
            
            periodicTable.innerHTML = '';
            
            elements.forEach(element => {
                const elementDiv = document.createElement('div');
                elementDiv.className = 'element';
                if (element.group === 1) {
                    elementDiv.classList.add('group1');
                }
                
                elementDiv.innerHTML = `
                    <div class="element-number">${element.number}</div>
                    <div class="element-symbol">${element.symbol}</div>
                    <div class="element-name">${element.name}</div>
                    <div class="element-tooltip">Atomic number: ${element.number}</div>
                `;
                
                elementDiv.onclick = () => showElementDetails(element);
                periodicTable.appendChild(elementDiv);
            });
        }
        
        function showElementDetails(element) {
            showToast('info', element.name, `Atomic number: ${element.number}, Symbol: ${element.symbol}`);
            
            // Easter egg: Play sound when clicking on Group 1 elements
            if (element.group === 1) {
                playSound('element');
            }
        }
        
        // Mini Simulation functions
        function allowDrop(ev) {
            ev.preventDefault();
        }
        
        function drag(ev) {
            ev.dataTransfer.setData("metal", ev.target.dataset.metal);
        }
        
        function drop(ev) {
            ev.preventDefault();
            const metal = ev.dataTransfer.getData("metal");
            const observationText = document.getElementById('observationText');
            const reactionBubbles = document.getElementById('reactionBubbles');
            
            // Clear previous bubbles
            reactionBubbles.innerHTML = '';
            
            // Show observation based on metal
            switch(metal) {
                case 'lithium':
                    observationText.textContent = 'Lithium fizzes steadily when added to water.';
                    createReactionBubbles(5);
                    break;
                case 'sodium':
                    observationText.textContent = 'Sodium fizzes rapidly and melts into a ball when added to water.';
                    createReactionBubbles(10);
                    break;
                case 'potassium':
                    observationText.textContent = 'Potassium fizzes violently and may ignite with a lilac flame when added to water.';
                    createReactionBubbles(15);
                    break;
            }
            
            // Play sound effect
            playSound('reaction');
            
            // Award XP for interaction
            awardXP(5);
        }
        
        function createReactionBubbles(count) {
            const reactionBubbles = document.getElementById('reactionBubbles');
            
            for (let i = 0; i < count; i++) {
                setTimeout(() => {
                    const bubble = document.createElement('div');
                    bubble.className = 'reaction-bubble';
                    
                    // Random size and position
                    const size = Math.random() * 20 + 10;
                    bubble.style.width = `${size}px`;
                    bubble.style.height = `${size}px`;
                    bubble.style.left = `${Math.random() * 80 + 10}%`;
                    bubble.style.bottom = '80px';
                    bubble.style.animationDelay = `${Math.random() * 2}s`;
                    
                    reactionBubbles.appendChild(bubble);
                    
                    // Remove bubble after animation
                    setTimeout(() => {
                        if (bubble.parentNode) {
                            bubble.parentNode.removeChild(bubble);
                        }
                    }, 2000);
                }, i * 100);
            }
        }
        
        // Quiz functions
        function selectQuizOption(element, option) {
            // Remove selected class from all options
            const options = element.parentElement.querySelectorAll('.quiz-option');
            options.forEach(opt => {
                opt.classList.remove('selected');
                opt.querySelector('input').checked = false;
            });
            
            // Add selected class to clicked option
            element.classList.add('selected');
            element.querySelector('input').checked = true;
        }
        
        function checkMeltingPointQuiz() {
            const selectedOption = document.querySelector('input[name="melting-point-quiz"]:checked');
            const feedback = document.getElementById('melting-point-quiz-feedback');
            
            if (!selectedOption) {
                showToast('error', 'No Selection', 'Please select an answer.');
                return;
            }
            
            if (selectedOption.value === 'B') {
                feedback.className = 'mt-3 p-3 rounded-lg bg-green-100 text-green-800';
                feedback.textContent = 'Correct! Metallic bonding gets weaker down the group because the atomic radius increases and the delocalized electrons are further from the positive nuclei, reducing the electrostatic forces of attraction.';
                awardXP(10);
            } else {
                feedback.className = 'mt-3 p-3 rounded-lg bg-red-100 text-red-800';
                feedback.textContent = 'Incorrect. The correct answer is B. Metallic bonding gets weaker down the group because the atomic radius increases and the delocalized electrons are further from the positive nuclei, reducing the electrostatic forces of attraction.';
            }
            
            feedback.classList.remove('hidden');
            
            // Disable options after answering
            const options = document.querySelectorAll('.quiz-option');
            options.forEach(opt => {
                opt.style.pointerEvents = 'none';
            });
        }
        
        // What If Scenario functions
        function showWhatIfResult(option) {
            const resultDiv = document.getElementById('whatIfResult');
            
            switch(option) {
                case 'A':
                    resultDiv.innerHTML = `
                        <h4 class="font-semibold mb-2">Incorrect</h4>
                        <p>Elemental potassium is highly reactive and would react violently with water in your body, causing severe chemical burns. It would definitely not be beneficial for your health!</p>
                    `;
                    break;
                case 'B':
                    resultDiv.innerHTML = `
                        <h4 class="font-semibold mb-2">Correct!</h4>
                        <p>Elemental potassium is extremely reactive and would react violently with the water in your body, producing hydrogen gas and potassium hydroxide. This would cause severe chemical burns and could be fatal. This is why potassium is never found in its elemental form in nature and is always stored under oil.</p>
                    `;
                    awardXP(15);
                    break;
                case 'C':
                    resultDiv.innerHTML = `
                        <h4 class="font-semibold mb-2">Incorrect</h4>
                        <p>Elemental potassium would not dissolve harmlessly. It would react violently with water, producing hydrogen gas and potassium hydroxide, which could cause severe chemical burns.</p>
                    `;
                    break;
                case 'D':
                    resultDiv.innerHTML = `
                        <h4 class="font-semibold mb-2">Incorrect</h4>
                        <p>Elemental potassium would react violently with water, potentially causing an explosion. It would definitely not make the water taste better!</p>
                    `;
                    break;
            }
            
            resultDiv.classList.add('show');
            
            // Disable options after answering
            const options = document.querySelectorAll('.whatif-option');
            options.forEach(opt => {
                opt.style.pointerEvents = 'none';
            });
        }
        
        // Story Mode functions
        function makeStoryChoice(choice) {
            const currentChapterData = storyChapters.find(chapter => chapter.chapter === storyChapter);
            if (!currentChapterData) return;
            
            const selectedChoice = currentChapterData.choices.find(c => c.text.startsWith(choice));
            if (!selectedChoice) return;
            
            // Update story chapter
            storyChapter = selectedChoice.next;
            saveUserData();
            
            // Load next chapter
            loadStoryChapter();
            
            // Award XP for story progress
            awardXP(20);
        }
        
        function loadStoryChapter() {
            const chapterData = storyChapters.find(chapter => chapter.chapter === storyChapter);
            if (!chapterData) {
                // Story completed
                document.getElementById('storyText').textContent = 'Congratulations! You have completed The Alkali Adventure and mastered the properties of Group 1 elements!';
                document.getElementById('storyChoices').innerHTML = `
                    <div class="story-choice" onclick="resetStory()">
                        Start New Adventure
                    </div>
                `;
                awardXP(100);
                return;
            }
            
            // Update chapter number
            document.getElementById('currentChapter').textContent = storyChapter;
            
            // Update story text
            document.getElementById('storyText').textContent = chapterData.text;
            
            // Update choices
            const choicesContainer = document.getElementById('storyChoices');
            choicesContainer.innerHTML = '';
            
            chapterData.choices.forEach(choice => {
                const choiceElement = document.createElement('div');
                choiceElement.className = 'story-choice';
                choiceElement.textContent = choice.text;
                choiceElement.onclick = () => makeStoryChoice(choice.text.charAt(0));
                choicesContainer.appendChild(choiceElement);
            });
        }
        
        function resetStory() {
            storyChapter = 1;
            saveUserData();
            loadStoryChapter();
        }
        
        // Daily Challenge functions
        function showDailyChallenge() {
            if (dailyChallengeCompleted) {
                showToast('info', 'Already Completed', 'You have already completed today\'s challenge. Come back tomorrow for a new one!');
                return;
            }
            
            document.getElementById('dailyChallengeModal').classList.add('active');
        }
        
        function closeDailyChallenge() {
            document.getElementById('dailyChallengeModal').classList.remove('active');
        }
        
        function loadDailyChallenge() {
            // Get today's date as a string
            const today = new Date().toDateString();
            const lastChallengeDate = localStorage.getItem('lastChallengeDate');
            
            // Reset daily challenge if it's a new day
            if (lastChallengeDate !== today) {
                dailyChallengeCompleted = false;
                localStorage.setItem('lastChallengeDate', today);
                saveUserData();
            }
            
            // Load a random challenge question
            const randomIndex = Math.floor(Math.random() * dailyChallengeQuestions.length);
            const challenge = dailyChallengeQuestions[randomIndex];
            
            document.getElementById('dailyChallengeQuestion').textContent = challenge.question;
            
            const optionsContainer = document.getElementById('dailyChallengeOptions');
            optionsContainer.innerHTML = '';
            
            challenge.options.forEach((option, index) => {
                const optionElement = document.createElement('div');
                optionElement.className = 'daily-challenge-option';
                optionElement.textContent = option;
                optionElement.onclick = () => answerDailyChallenge(String.fromCharCode(65 + index)); // A, B, C, D
                optionsContainer.appendChild(optionElement);
            });
            
            // Store the correct answer
            document.getElementById('dailyChallengeModal').dataset.correctAnswer = challenge.correct;
            document.getElementById('dailyChallengeModal').dataset.explanation = challenge.explanation;
        }
        
        function answerDailyChallenge(answer) {
            const modal = document.getElementById('dailyChallengeModal');
            const correctAnswer = modal.dataset.correctAnswer;
            const explanation = modal.dataset.explanation;
            
            // Disable all options
            const options = document.querySelectorAll('.daily-challenge-option');
            options.forEach(option => {
                option.style.pointerEvents = 'none';
            });
            
            // Check if answer is correct
            if (answer === correctAnswer) {
                event.target.classList.add('correct');
                showToast('success', 'Correct!', 'You have earned 50 XP points!');
                awardXP(50);
                dailyChallengeCompleted = true;
                saveUserData();
            } else {
                event.target.classList.add('incorrect');
                showToast('error', 'Incorrect', explanation);
                
                // Show correct answer
                options[parseInt(correctAnswer)].classList.add('correct');
            }
            
            // Play sound effect
            playSound(answer === correctAnswer ? 'correct' : 'incorrect');
        }
        
        function updateDailyChallengeTimer() {
            const now = new Date();
            const tomorrow = new Date(now);
            tomorrow.setDate(tomorrow.getDate() + 1);
            tomorrow.setHours(0, 0, 0, 0);
            
            const diff = tomorrow - now;
            const hours = Math.floor(diff / (1000 * 60 * 60));
            const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((diff % (1000 * 60)) / 1000);
            
            const timerElement = document.getElementById('challengeTimer');
            if (timerElement) {
                timerElement.textContent = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }
        }
        
        // Leaderboard functions
        function loadLeaderboard() {
            const leaderboardList = document.getElementById('leaderboardList');
            if (!leaderboardList) return;
            
            // In a real app, this would fetch from a server
            // For demo, we'll use mock data
            const mockLeaderboard = [
                { name: 'ChemistryMaster', xp: 1250, rank: 1 },
                { name: 'AlkaliAce', xp: 980, rank: 2 },
                { name: 'ScienceWizard', xp: 750, rank: 3 },
                { name: 'ElementExpert', xp: 620, rank: 4 },
                { name: 'ReactionRuler', xp: 450, rank: 5 }
            ];
            
            // Add current user if logged in
            if (currentUser && userData) {
                mockLeaderboard.push({
                    name: userData.displayName || 'You',
                    xp: xpPoints,
                    rank: mockLeaderboard.length + 1,
                    isCurrentUser: true
                });
                
                // Sort by XP
                mockLeaderboard.sort((a, b) => b.xp - a.xp);
                
                // Update ranks
                mockLeaderboard.forEach((user, index) => {
                    user.rank = index + 1;
                });
            }
            
            // Clear leaderboard
            leaderboardList.innerHTML = '';
            
            // Add leaderboard items
            mockLeaderboard.forEach(user => {
                const item = document.createElement('li');
                item.className = 'leaderboard-item';
                
                if (user.isCurrentUser) {
                    item.style.background = 'rgba(79, 70, 229, 0.1)';
                }
                
                let rankClass = '';
                if (user.rank === 1) rankClass = 'gold';
                else if (user.rank === 2) rankClass = 'silver';
                else if (user.rank === 3) rankClass = 'bronze';
                
                item.innerHTML = `
                    <div class="leaderboard-rank ${rankClass}">${user.rank}</div>
                    <div class="leaderboard-avatar">${user.name.charAt(0)}</div>
                    <div class="leaderboard-info">
                        <div class="leaderboard-name">${user.name}</div>
                        <div class="leaderboard-score"><span class="leaderboard-xp">${user.xp}</span> XP</div>
                    </div>
                `;
                
                leaderboardList.appendChild(item);
            });
        }
        
        function refreshLeaderboard() {
            loadLeaderboard();
            showToast('info', 'Leaderboard Refreshed', 'The leaderboard has been updated with the latest scores.');
        }
        
        // Enhanced Quiz Functions
        function startQuiz() {
            currentQuestion = 0;
            score = 0;
            selectedOption = null;
            answerSubmitted = false;
            quizAnswers = [];
            
            document.getElementById('quizModal').classList.add('active');
            document.getElementById('quizProgress').style.display = 'block';
            document.getElementById('quizContent').style.display = 'block';
            document.getElementById('quizResults').style.display = 'none';
            
            document.getElementById('currentQuestion').textContent = currentQuestion + 1;
            document.getElementById('totalQuestions').textContent = quizQuestions.length;
            document.getElementById('currentScore').textContent = score;
            document.getElementById('progressFill').style.width = ((currentQuestion + 1) / quizQuestions.length * 100) + '%';
            
            loadQuestion();
            
            // Add anti-cheating measures
            addAntiCheatingMeasures();
        }
        
        function addAntiCheatingMeasures() {
            // Disable right-click
            document.getElementById('quizModal').addEventListener('contextmenu', e => e.preventDefault());
            
            // Disable text selection
            document.getElementById('quizModal').addEventListener('selectstart', e => e.preventDefault());
            document.getElementById('quizModal').addEventListener('mousedown', e => e.preventDefault());
            
            // Warn before leaving
            window.addEventListener('beforeunload', preventQuizExit);
        }
        
        function removeAntiCheatingMeasures() {
            // Re-enable right-click
            document.getElementById('quizModal').removeEventListener('contextmenu', e => e.preventDefault());
            
            // Re-enable text selection
            document.getElementById('quizModal').removeEventListener('selectstart', e => e.preventDefault());
            document.getElementById('quizModal').removeEventListener('mousedown', e => e.preventDefault());
            
            // Remove beforeunload listener
            window.removeEventListener('beforeunload', preventQuizExit);
        }
        
        function preventQuizExit(e) {
            if (document.getElementById('quizModal').classList.contains('active')) {
                e.preventDefault();
                e.returnValue = '';
                return '';
            }
        }
        
        function loadQuestion() {
            const question = quizQuestions[currentQuestion];
            document.getElementById('questionText').textContent = question.question;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            
            // Check if this question has been answered already
            const answeredQuestion = quizAnswers[currentQuestion];
            
            switch(question.type) {
                case 'mcq':
                    loadMCQ(question, optionsContainer, answeredQuestion);
                    break;
                case 'dragdrop':
                    loadDragDrop(question, optionsContainer, answeredQuestion);
                    break;
                case 'fillblank':
                    loadFillBlank(question, optionsContainer, answeredQuestion);
                    break;
                case 'matching':
                    loadMatching(question, optionsContainer, answeredQuestion);
                    break;
                case 'truefalse':
                    loadTrueFalse(question, optionsContainer, answeredQuestion);
                    break;
                case 'equation-balancer':
                    loadEquationBalancer(question, optionsContainer, answeredQuestion);
                    break;
                case 'lab-simulation':
                    loadLabSimulation(question, optionsContainer, answeredQuestion);
                    break;
            }
            
            // Show/hide navigation buttons
            document.getElementById('prevButton').classList.toggle('hidden', currentQuestion === 0);
            
            // Show submit button if not answered, show next button if answered
            if (answeredQuestion) {
                document.getElementById('submitButton').style.display = 'none';
                document.getElementById('nextButton').classList.remove('hidden');
                
                // Show feedback for answered question
                const feedback = document.getElementById('feedback');
                if (answeredQuestion.isCorrect) {
                    feedback.className = 'mb-4 p-3 rounded-lg bg-green-100 text-green-800 text-sm';
                    feedback.textContent = 'Correct! ' + question.explanation;
                } else {
                    feedback.className = 'mb-4 p-3 rounded-lg bg-red-100 text-red-800 text-sm';
                    feedback.textContent = 'Incorrect. ' + question.explanation;
                }
                feedback.classList.remove('hidden');
            } else {
                document.getElementById('submitButton').style.display = 'inline-flex';
                document.getElementById('submitButton').disabled = true;
                document.getElementById('nextButton').classList.add('hidden');
                document.getElementById('feedback').classList.add('hidden');
            }
            
            selectedOption = answeredQuestion ? answeredQuestion.selected : null;
            answerSubmitted = !!answeredQuestion;
        }
        
        // MCQ Loader
        function loadMCQ(question, container, answeredQuestion) {
            question.options.forEach((option, index) => {
                const optionDiv = document.createElement('div');
                optionDiv.className = 'quiz-option';
                if (answeredQuestion) {
                    optionDiv.classList.add('disabled');
                    if (answeredQuestion.selected === index) {
                        optionDiv.classList.add(answeredQuestion.isCorrect ? 'correct' : 'incorrect');
                    }
                }
                optionDiv.dataset.index = index;
                
                const input = document.createElement('input');
                input.type = 'radio';
                input.name = 'quiz-option';
                input.id = `option-${index}`;
                input.value = index;
                if (answeredQuestion && answeredQuestion.selected === index) {
                    input.checked = true;
                }
                if (answeredQuestion) {
                    input.disabled = true;
                }
                
                const label = document.createElement('label');
                label.htmlFor = `option-${index}`;
                label.textContent = option;
                
                optionDiv.appendChild(input);
                optionDiv.appendChild(label);
                
                if (!answeredQuestion) {
                    optionDiv.onclick = () => selectOption(index);
                }
                container.appendChild(optionDiv);
            });
        }
        
        // Drag and Drop Loader
        function loadDragDrop(question, container, answeredQuestion) {
            container.innerHTML = `
                <div class="mb-4">
                    <p class="text-gray-700 mb-2">${question.question}</p>
                    <div id="dragDropItems" class="flex flex-wrap gap-2 mb-4">
                        ${question.items.map((item, index) => `
                            <div class="bg-gray-100 px-3 py-2 rounded-lg cursor-move" draggable="true" data-index="${index}" ${answeredQuestion ? 'draggable="false"' : ''}>
                                ${item}
                            </div>
                        `).join('')}
                    </div>
                    <div id="dropZone" class="border-2 border-dashed border-gray-300 rounded-lg p-4 min-h-[100px] ${answeredQuestion ? 'border-solid' : ''}">
                        <p class="text-gray-500 text-center">Drag and drop items here in the correct order</p>
                        <div id="droppedItems" class="flex flex-wrap gap-2 mt-2"></div>
                    </div>
                </div>
            `;
            
            if (answeredQuestion) {
                // Show the ordered items
                const droppedItems = document.getElementById('droppedItems');
                answeredQuestion.userOrder.forEach(index => {
                    const itemDiv = document.createElement('div');
                    itemDiv.className = 'bg-gray-100 px-3 py-2 rounded-lg';
                    itemDiv.textContent = question.items[index];
                    droppedItems.appendChild(itemDiv);
                });
                
                // Hide the original items
                document.getElementById('dragDropItems').style.display = 'none';
                document.getElementById('dropZone').querySelector('p').style.display = 'none';
            } else {
                setupDragDrop();
            }
        }
        
        function setupDragDrop() {
            const dragItems = document.querySelectorAll('#dragDropItems > div');
            const dropZone = document.getElementById('dropZone');
            const droppedItems = document.getElementById('droppedItems');
            let draggedItem = null;
            
            dragItems.forEach(item => {
                item.addEventListener('dragstart', (e) => {
                    draggedItem = e.target;
                    e.target.style.opacity = '0.5';
                });
                
                item.addEventListener('dragend', (e) => {
                    e.target.style.opacity = '';
                });
            });
            
            dropZone.addEventListener('dragover', (e) => {
                e.preventDefault();
                dropZone.style.backgroundColor = 'rgba(79, 70, 229, 0.1)';
            });
            
            dropZone.addEventListener('dragleave', () => {
                dropZone.style.backgroundColor = '';
            });
            
            dropZone.addEventListener('drop', (e) => {
                e.preventDefault();
                dropZone.style.backgroundColor = '';
                
                if (draggedItem) {
                    // Create a copy of the dragged item
                    const newItem = document.createElement('div');
                    newItem.className = 'bg-gray-100 px-3 py-2 rounded-lg';
                    newItem.textContent = draggedItem.textContent;
                    newItem.dataset.index = draggedItem.dataset.index;
                    
                    // Add to dropped items
                    droppedItems.appendChild(newItem);
                    
                    // Hide the original item
                    draggedItem.style.display = 'none';
                    
                    // Hide the placeholder text
                    dropZone.querySelector('p').style.display = 'none';
                    
                    // Enable submit button if all items are dropped
                    if (droppedItems.children.length === dragItems.length) {
                        document.getElementById('submitButton').disabled = false;
                    }
                }
            });
        }
        
        // Fill in the Blanks Loader
        function loadFillBlank(question, container, answeredQuestion) {
            let html = '<div class="space-y-4">';
            
            question.blanks.forEach(blank => {
                html += `
                    <div class="mb-3">
                        <label class="block text-sm font-medium text-gray-700 mb-1">${blank.id.replace('blank', 'Blank ')}:</label>
                        <select id="${blank.id}" class="form-input w-full" ${answeredQuestion ? 'disabled' : ''}>
                            <option value="">Select an answer</option>
                            ${blank.options.map(option => `
                                <option value="${option}" ${answeredQuestion && answeredQuestion.answers[blank.id] === option ? 'selected' : ''}>${option}</option>
                            `).join('')}
                        </select>
                    </div>
                `;
            });
            
            html += '</div>';
            container.innerHTML = html;
            
            // Enable submit when all blanks are filled
            if (!answeredQuestion) {
                question.blanks.forEach(blank => {
                    document.getElementById(blank.id).addEventListener('change', () => {
                        const allFilled = question.blanks.every(b => document.getElementById(b.id).value);
                        document.getElementById('submitButton').disabled = !allFilled;
                    });
                });
            }
        }
        
        // Matching Loader
        function loadMatching(question, container, answeredQuestion) {
            container.innerHTML = `
                <div class="grid grid-cols-2 gap-6">
                    <div>
                        <h4 class="font-semibold mb-3">Elements</h4>
                        <div class="space-y-2">
                            ${question.leftItems.map((item, index) => `
                                <div class="match-item bg-gray-100 p-3 rounded-lg" data-left="${index}" ${answeredQuestion ? 'style="pointer-events: none"' : ''}>
                                    ${item}
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    <div>
                        <h4 class="font-semibold mb-3">Oxides</h4>
                        <div class="space-y-2">
                            ${question.rightItems.map((item, index) => `
                                <div class="match-item bg-gray-100 p-3 rounded-lg" data-right="${index}" ${answeredQuestion ? 'style="pointer-events: none"' : ''}>
                                    ${item}
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
                <div class="mt-4 text-center">
                    <button onclick="checkMatching()" class="btn btn-primary">Check Matches</button>
                    <button onclick="clearMatches()" class="btn btn-secondary ml-2">Clear All</button>
                </div>
            `;
            
            if (answeredQuestion) {
                // Show the matched items
                const leftItems = document.querySelectorAll('[data-left]');
                const rightItems = document.querySelectorAll('[data-right]');
                
                leftItems.forEach((item, index) => {
                    const matchIndex = answeredQuestion.matches[index];
                    if (matchIndex !== undefined) {
                        item.classList.add('matched', 'bg-green-100');
                        const rightItem = rightItems[matchIndex];
                        rightItem.classList.add('matched', 'bg-green-100');
                    }
                });
                
                // Hide buttons
                container.querySelector('.mt-4').style.display = 'none';
            } else {
                setupMatching();
            }
        }
        
        function setupMatching() {
            const leftItems = document.querySelectorAll('[data-left]');
            const rightItems = document.querySelectorAll('[data-right]');
            let selectedLeft = null;
            let selectedRight = null;
            let matches = {};
            
            leftItems.forEach(item => {
                item.addEventListener('click', () => {
                    if (item.classList.contains('matched')) {
                        // If already matched, unmatch it
                        const rightIndex = matches[item.dataset.left];
                        const rightItem = document.querySelector(`[data-right="${rightIndex}"]`);
                        item.classList.remove('matched', 'bg-green-100');
                        rightItem.classList.remove('matched', 'bg-green-100');
                        delete matches[item.dataset.left];
                        return;
                    }
                    
                    if (selectedLeft) {
                        selectedLeft.classList.remove('selected');
                    }
                    selectedLeft = item;
                    item.classList.add('selected');
                    
                    if (selectedRight) {
                        matches[selectedLeft.dataset.left] = selectedRight.dataset.right;
                        selectedLeft.classList.remove('selected');
                        selectedLeft.classList.add('matched', 'bg-green-100');
                        selectedRight.classList.remove('selected');
                        selectedRight.classList.add('matched', 'bg-green-100');
                        selectedLeft = null;
                        selectedRight = null;
                        
                        // Check if all matches are made
                        if (Object.keys(matches).length === leftItems.length) {
                            document.getElementById('submitButton').disabled = false;
                        }
                    }
                });
            });
            
            rightItems.forEach(item => {
                item.addEventListener('click', () => {
                    if (item.classList.contains('matched')) {
                        // If already matched, unmatch it
                        const leftIndex = Object.keys(matches).find(key => matches[key] === item.dataset.right);
                        const leftItem = document.querySelector(`[data-left="${leftIndex}"]`);
                        leftItem.classList.remove('matched', 'bg-green-100');
                        item.classList.remove('matched', 'bg-green-100');
                        delete matches[leftIndex];
                        return;
                    }
                    
                    if (selectedRight) {
                        selectedRight.classList.remove('selected');
                    }
                    selectedRight = item;
                    item.classList.add('selected');
                    
                    if (selectedLeft) {
                        matches[selectedLeft.dataset.left] = selectedRight.dataset.right;
                        selectedLeft.classList.remove('selected');
                        selectedLeft.classList.add('matched', 'bg-green-100');
                        selectedRight.classList.remove('selected');
                        selectedRight.classList.add('matched', 'bg-green-100');
                        selectedLeft = null;
                        selectedRight = null;
                        
                        // Check if all matches are made
                        if (Object.keys(matches).length === leftItems.length) {
                            document.getElementById('submitButton').disabled = false;
                        }
                    }
                });
            });
            
            window.checkMatching = () => {
                // This will be used in submitAnswer
            };
            
            window.clearMatches = () => {
                matches = {};
                leftItems.forEach(item => {
                    item.classList.remove('matched', 'bg-green-100', 'selected');
                });
                rightItems.forEach(item => {
                    item.classList.remove('matched', 'bg-green-100', 'selected');
                });
                document.getElementById('submitButton').disabled = true;
            };
        }
        
        // True/False Loader
        function loadTrueFalse(question, container, answeredQuestion) {
            container.innerHTML = `
                <div class="flex justify-center gap-6">
                    <div class="quiz-option text-center ${answeredQuestion && answeredQuestion.selected === true ? 'correct' : ''}" ${answeredQuestion ? 'disabled' : ''}>
                        <input type="radio" name="tf-option" id="tf-true" value="true" ${answeredQuestion && answeredQuestion.selected === true ? 'checked' : ''} ${answeredQuestion ? 'disabled' : ''}>
                        <label for="tf-true" class="block mt-2">True</label>
                    </div>
                    <div class="quiz-option text-center ${answeredQuestion && answeredQuestion.selected === false ? 'incorrect' : ''}" ${answeredQuestion ? 'disabled' : ''}>
                        <input type="radio" name="tf-option" id="tf-false" value="false" ${answeredQuestion && answeredQuestion.selected === false ? 'checked' : ''} ${answeredQuestion ? 'disabled' : ''}>
                        <label for="tf-false" class="block mt-2">False</label>
                    </div>
                </div>
            `;
            
            if (!answeredQuestion) {
                document.getElementById('tf-true').parentElement.onclick = () => selectTrueFalse(true);
                document.getElementById('tf-false').parentElement.onclick = () => selectTrueFalse(false);
            }
        }
        
        // Chemical Equation Balancer Loader
        function loadEquationBalancer(question, container, answeredQuestion) {
            const equation = question.equation;
            
            container.innerHTML = `
                <div class="equation-balancer">
                    <div class="equation-display">
                        ${equation.left.map((term, index) => `
                            <div class="equation-term">
                                <div class="coefficient" id="coeff-left-${index}" data-term="left-${index}">
                                    ${answeredQuestion ? answeredQuestion.coefficients[index] : term.coefficient}
                                </div>
                                <div class="chemical">${term.symbol}</div>
                            </div>
                        `).join('')}
                        
                        <div class="plus-sign">+</div>
                        
                        ${equation.right.map((term, index) => `
                            <div class="equation-term">
                                <div class="coefficient" id="coeff-right-${index}" data-term="right-${index}">
                                    ${answeredQuestion ? answeredQuestion.coefficients[equation.left.length + index] : term.coefficient}
                                </div>
                                <div class="chemical">${term.symbol}</div>
                            </div>
                        `).join('')}
                    </div>
                    
                    <div class="coefficient-controls">
                        ${equation.left.map((term, index) => `
                            <div class="flex items-center gap-2">
                                <span class="font-medium">${term.symbol}:</span>
                                <button class="coefficient-btn" onclick="changeCoefficient('left-${index}', -1)">
                                    <i class="fas fa-minus"></i>
                                </button>
                                <span id="value-left-${index}" class="font-semibold w-8 text-center">
                                    ${answeredQuestion ? answeredQuestion.coefficients[index] : term.coefficient}
                                </span>
                                <button class="coefficient-btn" onclick="changeCoefficient('left-${index}', 1)">
                                    <i class="fas fa-plus"></i>
                                </button>
                            </div>
                        `).join('')}
                        
                        ${equation.right.map((term, index) => `
                            <div class="flex items-center gap-2">
                                <span class="font-medium">${term.symbol}:</span>
                                <button class="coefficient-btn" onclick="changeCoefficient('right-${index}', -1)">
                                    <i class="fas fa-minus"></i>
                                </button>
                                <span id="value-right-${index}" class="font-semibold w-8 text-center">
                                    ${answeredQuestion ? answeredQuestion.coefficients[equation.left.length + index] : term.coefficient}
                                </span>
                                <button class="coefficient-btn" onclick="changeCoefficient('right-${index}', 1)">
                                    <i class="fas fa-plus"></i>
                                </button>
                            </div>
                        `).join('')}
                    </div>
                    
                    <div id="equationStatus" class="equation-status unbalanced">
                        Equation not balanced
                    </div>
                    
                    <div class="text-center mt-4">
                        <button onclick="checkEquationBalance()" class="btn btn-primary">
                            Check Balance
                        </button>
                        <button onclick="resetEquation()" class="btn btn-secondary ml-2">
                            Reset
                        </button>
                    </div>
                </div>
            `;
            
            if (answeredQuestion) {
                // Show the correct coefficients
                equation.left.forEach((term, index) => {
                    const coeff = document.getElementById(`coeff-left-${index}`);
                    const value = document.getElementById(`value-left-${index}`);
                    const correctCoeff = question.correct[index];
                    
                    coeff.textContent = correctCoeff;
                    value.textContent = correctCoeff;
                    
                    if (correctCoeff === answeredQuestion.coefficients[index]) {
                        coeff.classList.add('correct');
                    }
                });
                
                equation.right.forEach((term, index) => {
                    const coeff = document.getElementById(`coeff-right-${index}`);
                    const value = document.getElementById(`value-right-${index}`);
                    const correctCoeff = question.correct[equation.left.length + index];
                    
                    coeff.textContent = correctCoeff;
                    value.textContent = correctCoeff;
                    
                    if (correctCoeff === answeredQuestion.coefficients[equation.left.length + index]) {
                        coeff.classList.add('correct');
                    }
                });
                
                // Show equation status
                const status = document.getElementById('equationStatus');
                if (answeredQuestion.isCorrect) {
                    status.className = 'equation-status balanced';
                    status.textContent = 'Equation balanced correctly!';
                } else {
                    status.className = 'equation-status unbalanced';
                    status.textContent = 'Equation not balanced correctly';
                }
                
                // Disable controls
                const buttons = container.querySelectorAll('.coefficient-btn');
                buttons.forEach(button => {
                    button.disabled = true;
                });
                
                // Hide action buttons
                container.querySelector('.text-center').style.display = 'none';
            } else {
                // Initialize equation state
                window.equationState = {
                    left: equation.left.map(term => term.coefficient),
                    right: equation.right.map(term => term.coefficient)
                };
                
                // Enable submit button when equation is balanced
                window.equationBalanced = false;
            }
        }
        
        // Change coefficient value
        function changeCoefficient(termId, change) {
            const isLeft = termId.startsWith('left-');
            const index = parseInt(termId.split('-')[1]);
            const side = isLeft ? 'left' : 'right';
            
            // Update value
            window.equationState[side][index] = Math.max(1, window.equationState[side][index] + change);
            
            // Update display
            const coeffElement = document.getElementById(`coeff-${termId}`);
            const valueElement = document.getElementById(`value-${termId}`);
            const newValue = window.equationState[side][index];
            
            coeffElement.textContent = newValue;
            valueElement.textContent = newValue;
            
            // Reset equation status
            const status = document.getElementById('equationStatus');
            status.className = 'equation-status unbalanced';
            status.textContent = 'Equation not balanced';
            
            window.equationBalanced = false;
            document.getElementById('submitButton').disabled = true;
        }
        
        // Check if equation is balanced
        function checkEquationBalance() {
            const question = quizQuestions[currentQuestion];
            const equation = question.equation;
            
            // Get current coefficients
            const currentCoeffs = [
                ...window.equationState.left,
                ...window.equationState.right
            ];
            
            // Check if equation is balanced
            const isBalanced = JSON.stringify(currentCoeffs) === JSON.stringify(question.correct);
            
            // Update equation status
            const status = document.getElementById('equationStatus');
            if (isBalanced) {
                status.className = 'equation-status balanced';
                status.textContent = 'Equation balanced correctly!';
                window.equationBalanced = true;
                document.getElementById('submitButton').disabled = false;
            } else {
                status.className = 'equation-status unbalanced';
                status.textContent = 'Equation not balanced';
                window.equationBalanced = false;
                document.getElementById('submitButton').disabled = true;
            }
        }
        
        // Reset equation
        function resetEquation() {
            const question = quizQuestions[currentQuestion];
            const equation = question.equation;
            
            // Reset equation state
            window.equationState = {
                left: equation.left.map(term => term.coefficient),
                right: equation.right.map(term => term.coefficient)
            };
            
            // Reset display
            equation.left.forEach((term, index) => {
                const coeffElement = document.getElementById(`coeff-left-${index}`);
                const valueElement = document.getElementById(`value-left-${index}`);
                const newValue = term.coefficient;
                
                coeffElement.textContent = newValue;
                valueElement.textContent = newValue;
                coeffElement.classList.remove('correct');
            });
            
            equation.right.forEach((term, index) => {
                const coeffElement = document.getElementById(`coeff-right-${index}`);
                const valueElement = document.getElementById(`value-right-${index}`);
                const newValue = term.coefficient;
                
                coeffElement.textContent = newValue;
                valueElement.textContent = newValue;
                coeffElement.classList.remove('correct');
            });
            
            // Reset equation status
            const status = document.getElementById('equationStatus');
            status.className = 'equation-status unbalanced';
            status.textContent = 'Equation not balanced';
            
            window.equationBalanced = false;
            document.getElementById('submitButton').disabled = true;
        }
        
        // Interactive Lab Simulation Loader
        function loadLabSimulation(question, container, answeredQuestion) {
            container.innerHTML = `
                <div class="lab-container">
                    <div class="lab-instruction">Click on each metal to observe its reaction with water. Then, order the metals by reactivity (most reactive first).</div>
                    
                    <div class="beaker">
                        <div class="beaker-water"></div>
                    </div>
                    
                    ${question.metals.map((metal, index) => `
                        <div class="metal-sample ${metal.color}" data-index="${index}" data-name="${metal.name}" data-reactivity="${metal.reactivity}" onclick="testMetalReactivity(${index})">
                            ${metal.symbol}
                        </div>
                    `).join('')}
                    
                    <div class="lab-bench"></div>
                    
                    <div id="reactionBubbles"></div>
                </div>
                
                <div class="observation-panel">
                    <div class="observation-title">Observation:</div>
                    <div class="observation-text" id="observationText">Click on a metal to see its reaction with water.</div>
                </div>
                
                <div class="mt-4">
                    <h4 class="font-semibold mb-2">Order the metals by reactivity (most reactive first):</h4>
                    <div id="reactivityOrder" class="flex flex-wrap gap-2 mb-4">
                        ${question.metals.map((metal, index) => `
                            <div class="btn btn-secondary" id="metal-btn-${index}" data-index="${index}" onclick="addToReactivityOrder(${index})">
                                ${metal.name}
                            </div>
                        `).join('')}
                    </div>
                    <div id="orderedMetals" class="flex flex-wrap gap-2 mb-4 min-h-[40px] p-2 bg-gray-100 rounded-lg">
                        <!-- Ordered metals will appear here -->
                    </div>
                </div>
                
                <div class="lab-controls">
                    <button onclick="resetLabSimulation()" class="btn btn-secondary">
                        <i class="fas fa-redo mr-1"></i>
                        Reset
                    </button>
                </div>
            `;
            
            if (answeredQuestion) {
                // Show the ordered metals
                const orderedMetalsDiv = document.getElementById('orderedMetals');
                orderedMetalsDiv.innerHTML = '';
                
                answeredQuestion.userOrder.forEach(metalIndex => {
                    const metal = question.metals[metalIndex];
                    const metalDiv = document.createElement('div');
                    metalDiv.className = 'btn btn-primary';
                    metalDiv.textContent = metal.name;
                    orderedMetalsDiv.appendChild(metalDiv);
                });
                
                // Hide the metal buttons
                const metalButtons = document.querySelectorAll('#reactivityOrder .btn');
                metalButtons.forEach(button => {
                    button.style.display = 'none';
                });
            }
        }
        
        // Test metal reactivity
        function testMetalReactivity(metalIndex) {
            const question = quizQuestions[currentQuestion];
            const metal = question.metals[metalIndex];
            
            // Update observation text
            document.getElementById('observationText').textContent = `${metal.name} reaction: ${metal.observation}`;
            
            // Create reaction bubbles based on reactivity
            const reactionBubbles = document.getElementById('reactionBubbles');
            reactionBubbles.innerHTML = '';
            
            const bubbleCount = metal.reactivity === 'high' ? 15 : metal.reactivity === 'medium' ? 8 : 4;
            
            for (let i = 0; i < bubbleCount; i++) {
                setTimeout(() => {
                    const bubble = document.createElement('div');
                    bubble.className = 'reaction-bubble';
                    
                    // Random size and position
                    const size = Math.random() * 20 + 10;
                    bubble.style.width = `${size}px`;
                    bubble.style.height = `${size}px`;
                    bubble.style.left = `${Math.random() * 80 + 10}%`;
                    bubble.style.bottom = '80px';
                    bubble.style.animationDelay = `${Math.random() * 2}s`;
                    
                    reactionBubbles.appendChild(bubble);
                    
                    // Remove bubble after animation
                    setTimeout(() => {
                        if (bubble.parentNode) {
                            bubble.parentNode.removeChild(bubble);
                        }
                    }, 2000);
                }, i * 100);
            }
            
            // Add to reactivity order
            addToReactivityOrder(metalIndex);
        }
        
        // Add metal to reactivity order
        function addToReactivityOrder(metalIndex) {
            const question = quizQuestions[currentQuestion];
            const metal = question.metals[metalIndex];
            
            // Check if metal is already in the order
            const orderedMetalsDiv = document.getElementById('orderedMetals');
            const existingMetals = Array.from(orderedMetalsDiv.children);
            
            if (existingMetals.some(child => child.dataset.index == metalIndex)) {
                return; // Metal already in order
            }
            
            // Add metal to order
            const metalDiv = document.createElement('div');
            metalDiv.className = 'btn btn-primary';
            metalDiv.textContent = metal.name;
            metalDiv.dataset.index = metalIndex;
            
            orderedMetalsDiv.appendChild(metalDiv);
            
            // Hide the metal button
            const metalButton = document.getElementById(`metal-btn-${metalIndex}`);
            if (metalButton) {
                metalButton.style.display = 'none';
            }
            
            // Enable submit if all metals are ordered
            if (orderedMetalsDiv.children.length === question.metals.length) {
                document.getElementById('submitButton').disabled = false;
            }
        }
        
        // Reset lab simulation
        function resetLabSimulation() {
            const question = quizQuestions[currentQuestion];
            
            // Clear observation text
            document.getElementById('observationText').textContent = 'Click on a metal to see its reaction with water.';
            
            // Clear reaction bubbles
            document.getElementById('reactionBubbles').innerHTML = '';
            
            // Clear ordered metals
            document.getElementById('orderedMetals').innerHTML = '';
            
            // Show all metal buttons
            const metalButtons = document.querySelectorAll('#reactivityOrder .btn');
            metalButtons.forEach(button => {
                button.style.display = 'inline-flex';
            });
            
            document.getElementById('submitButton').disabled = true;
        }
        
        // True/False Selection
        function selectTrueFalse(value) {
            const options = document.querySelectorAll('.quiz-option');
            options.forEach(option => {
                option.classList.remove('selected');
                const input = option.querySelector('input');
                input.checked = false;
            });
            
            const selectedOption = value ? document.getElementById('tf-true').parentElement : document.getElementById('tf-false').parentElement;
            selectedOption.classList.add('selected');
            selectedOption.querySelector('input').checked = true;
            
            selectedOption = value;
            document.getElementById('submitButton').disabled = false;
        }
        
        function selectOption(index) {
            if (answerSubmitted) return;
            
            const options = document.querySelectorAll('.quiz-option');
            options.forEach(option => {
                option.classList.remove('selected');
                const input = option.querySelector('input');
                input.checked = false;
            });
            
            options[index].classList.add('selected');
            options[index].querySelector('input').checked = true;
            
            selectedOption = index;
            document.getElementById('submitButton').disabled = false;
        }
        
        // Enhanced Submit Answer Function
        function submitAnswer() {
            if (answerSubmitted) return;
            
            const question = quizQuestions[currentQuestion];
            let isCorrect = false;
            const feedback = document.getElementById('feedback');
            let answerData = {
                selected: selectedOption,
                submitted: true,
                isCorrect: false
            };
            
            switch(question.type) {
                case 'mcq':
                    isCorrect = selectedOption === question.correct;
                    answerData = {
                        selected: selectedOption,
                        submitted: true,
                        isCorrect: isCorrect
                    };
                    break;
                    
                case 'dragdrop':
                    const droppedItems = document.querySelectorAll('#droppedItems > div');
                    const userOrder = Array.from(droppedItems).map(child => parseInt(child.dataset.index));
                    isCorrect = JSON.stringify(userOrder) === JSON.stringify(question.correct);
                    answerData = {
                        userOrder: userOrder,
                        submitted: true,
                        isCorrect: isCorrect
                    };
                    break;
                    
                case 'fillblank':
                    const answers = {};
                    question.blanks.forEach(blank => {
                        answers[blank.id] = document.getElementById(blank.id).value;
                    });
                    isCorrect = question.blanks.every(blank => 
                        document.getElementById(blank.id).value === blank.answer
                    );
                    answerData = {
                        answers: answers,
                        submitted: true,
                        isCorrect: isCorrect
                    };
                    break;
                    
                case 'matching':
                    const leftMatches = document.querySelectorAll('[data-left].matched');
                    const matches = {};
                    leftMatches.forEach(item => {
                        const rightItem = document.querySelector(`[data-right].matched`);
                        if (rightItem) {
                            matches[item.dataset.left] = rightItem.dataset.right;
                        }
                    });
                    isCorrect = leftMatches.length === question.leftItems.length;
                    answerData = {
                        matches: matches,
                        submitted: true,
                        isCorrect: isCorrect
                    };
                    break;
                    
                case 'truefalse':
                    isCorrect = selectedOption === question.correct;
                    answerData = {
                        selected: selectedOption,
                        submitted: true,
                        isCorrect: isCorrect
                    };
                    break;
                    
                case 'equation-balancer':
                    const currentCoeffs = [
                        ...window.equationState.left,
                        ...window.equationState.right
                    ];
                    isCorrect = JSON.stringify(currentCoeffs) === JSON.stringify(question.correct);
                    answerData = {
                        coefficients: currentCoeffs,
                        submitted: true,
                        isCorrect: isCorrect
                    };
                    break;
                    
                case 'lab-simulation':
                    const orderedMetalsDiv = document.getElementById('orderedMetals');
                    const userOrder = Array.from(orderedMetalsDiv.children).map(child => parseInt(child.dataset.index));
                    isCorrect = JSON.stringify(userOrder) === JSON.stringify(question.correct);
                    answerData = {
                        userOrder: userOrder,
                        submitted: true,
                        isCorrect: isCorrect
                    };
                    break;
            }
            
            quizAnswers[currentQuestion] = answerData;
            
            if (isCorrect) {
                feedback.className = 'mb-4 p-3 rounded-lg bg-green-100 text-green-800 text-sm';
                feedback.textContent = 'Correct! ' + question.explanation;
                score++;
                awardXP(10);
            } else {
                feedback.className = 'mb-4 p-3 rounded-lg bg-red-100 text-red-800 text-sm';
                feedback.textContent = 'Incorrect. ' + question.explanation;
            }
            
            feedback.classList.remove('hidden');
            document.getElementById('submitButton').style.display = 'none';
            document.getElementById('nextButton').classList.remove('hidden');
            document.getElementById('currentScore').textContent = score;
            
            answerSubmitted = true;
            
            // Play sound effect
            playSound(isCorrect ? 'correct' : 'incorrect');
        }
        
        function nextQuestion() {
            currentQuestion++;
            
            if (currentQuestion >= quizQuestions.length) {
                showResults();
                return;
            }
            
            document.getElementById('currentQuestion').textContent = currentQuestion + 1;
            document.getElementById('progressFill').style.width = ((currentQuestion + 1) / quizQuestions.length * 100) + '%';
            loadQuestion();
        }
        
        function previousQuestion() {
            if (currentQuestion > 0) {
                currentQuestion--;
                document.getElementById('currentQuestion').textContent = currentQuestion + 1;
                document.getElementById('progressFill').style.width = ((currentQuestion + 1) / quizQuestions.length * 100) + '%';
                loadQuestion();
            }
        }
        
        function showResults() {
            document.getElementById('quizProgress').style.display = 'none';
            document.getElementById('quizContent').style.display = 'none';
            document.getElementById('quizResults').style.display = 'block';
            
            const percentage = Math.round((score / quizQuestions.length) * 100);
            document.getElementById('finalScore').textContent = `${score}/${quizQuestions.length}`;
            
            let message = '';
            let xpAwarded = 0;
            
            if (percentage >= 80) {
                message = 'Excellent! You have a strong understanding of Group 1 elements.';
                xpAwarded = 100;
            } else if (percentage >= 60) {
                message = 'Good job! You have a solid foundation to build upon.';
                xpAwarded = 75;
            } else if (percentage >= 40) {
                message = 'Not bad! Review the materials to improve your understanding.';
                xpAwarded = 50;
            } else {
                message = 'Keep practicing! Review the materials carefully.';
                xpAwarded = 25;
            }
            
            document.getElementById('scoreMessage').textContent = message;
            
            // Award XP for quiz completion
            awardXP(xpAwarded);
            
            // Remove anti-cheating measures
            removeAntiCheatingMeasures();
            
            // Track quiz completion with Google Analytics
            if (typeof gtag !== 'undefined') {
                gtag('event', 'quiz_complete', {
                    score: score,
                    total_questions: quizQuestions.length,
                    percentage: percentage
                });
            }
        }
        
        function closeQuiz() {
            document.getElementById('quizModal').classList.remove('active');
            removeAntiCheatingMeasures();
        }
        
        // Feedback System functions
        function toggleFeedback() {
            const feedbackSystem = document.getElementById('feedbackSystem');
            feedbackVisible = !feedbackVisible;
            feedbackSystem.style.display = feedbackVisible ? 'block' : 'none';
        }
        
        function toggleReaction(reactionType) {
            const reactionBtn = document.getElementById(reactionType);
            const reactionCount = document.getElementById(reactionType + 'Count');
            
            if (userReaction === reactionType) {
                // Remove reaction
                userReaction = null;
                reactionBtn.classList.remove('active');
                reactionCount.textContent = parseInt(reactionCount.textContent) - 1;
            } else {
                // Remove previous reaction if any
                if (userReaction) {
                    const prevBtn = document.getElementById(userReaction);
                    const prevCount = document.getElementById(userReaction + 'Count');
                    prevBtn.classList.remove('active');
                    prevCount.textContent = parseInt(prevCount.textContent) - 1;
                }
                
                // Add new reaction
                userReaction = reactionType;
                reactionBtn.classList.add('active');
                reactionCount.textContent = parseInt(reactionCount.textContent) + 1;
            }
            
            // Play sound effect
            playSound('reaction');
        }
        
        function submitFeedback() {
            const feedbackText = document.getElementById('feedbackText').value.trim();
            
            if (!feedbackText) {
                showToast('error', 'Empty Feedback', 'Please enter your feedback before submitting.');
                return;
            }
            
            // In a real app, this would send feedback to a server
            // For demo, we'll just show a success message
            showToast('success', 'Feedback Submitted', 'Thank you for your feedback!');
            
            // Clear feedback text
            document.getElementById('feedbackText').value = '';
            
            // Award XP for providing feedback
            awardXP(5);
            
            // Play sound effect
            playSound('complete');
        }
        
        // Settings functions
        function toggleSettings() {
            const settingsPanel = document.getElementById('settingsPanel');
            settingsPanel.classList.toggle('active');
        }
        
        function toggleDarkMode() {
            darkMode = document.getElementById('darkModeToggle').checked;
            document.body.classList.toggle('dark-mode', darkMode);
            
            // Save preference
            localStorage.setItem('darkMode', darkMode);
            
            // Play sound effect
            playSound('toggle');
        }
        
        function toggleSound() {
            soundEnabled = document.getElementById('soundToggle').checked;
            const soundToggle = document.getElementById('soundToggle');
            const soundIcon = soundToggle.querySelector('i');
            
            if (soundEnabled) {
                soundIcon.className = 'fas fa-volume-up';
                soundToggle.classList.remove('muted');
            } else {
                soundIcon.className = 'fas fa-volume-mute';
                soundToggle.classList.add('muted');
            }
            
            // Save preference
            localStorage.setItem('soundEnabled', soundEnabled);
        }
        
        function toggleOfflineMode() {
            offlineMode = document.getElementById('offlineToggle').checked;
            const offlineIndicator = document.getElementById('offlineIndicator');
            
            if (offlineMode) {
                offlineIndicator.classList.add('show');
                showToast('info', 'Offline Mode', 'You are now in offline mode. Some features may be limited.');
            } else {
                offlineIndicator.classList.remove('show');
                showToast('info', 'Online Mode', 'You are now in online mode.');
            }
            
            // Save preference
            localStorage.setItem('offlineMode', offlineMode);
        }
        
        // Sound effects functions
        function playSound(type) {
            if (!soundEnabled) return;
            
            // In a real app, you would play actual sound files
            // For demo, we'll just log to console
            console.log(`Playing sound: ${type}`);
            
            // You could use the Web Audio API or HTML5 audio elements here
            // Example:
            // const audio = new Audio(`sounds/${type}.mp3`);
            // audio.volume = document.getElementById('volumeSlider').value / 100;
            // audio.play();
        }
        
        // XP and Badges functions
        function awardXP(amount) {
            xpPoints += amount;
            document.getElementById('userXP').textContent = xpPoints;
            document.getElementById('totalXP').textContent = xpPoints;
            
            // Save user data
            saveUserData();
            
            // Update badges
            updateBadges();
            
            // Show XP notification
            if (amount > 0) {
                showToast('success', 'XP Earned!', `You've earned ${amount} XP points!`);
            }
            
            // Play sound effect
            playSound('xp');
        }
        
        // Export functions
        function exportToPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Add title
            doc.setFontSize(20);
            doc.text('Group 1 Alkali Metals - Study Notes', 105, 20, { align: 'center' });
            
            // Add user info
            doc.setFontSize(12);
            doc.text(`Student: ${userData.displayName || 'User'}`, 20, 40);
            doc.text(`XP Points: ${xpPoints}`, 20, 50);
            doc.text(`Completed Sections: ${completedSections.length}/4`, 20, 60);
            
            // Add progress
            doc.setFontSize(16);
            doc.text('Progress:', 20, 80);
            doc.setFontSize(12);
            doc.text(`Overview: ${completedSections.includes('overview') ? 'Completed' : 'Not Started'}`, 20, 90);
            doc.text(`Elements: ${completedSections.includes('elements') ? 'Completed' : 'Not Started'}`, 20, 100);
            doc.text(`Properties: ${completedSections.includes('properties') ? 'Completed' : 'Not Started'}`, 20, 110);
            doc.text(`Reactions: ${completedSections.includes('reactions') ? 'Completed' : 'Not Started'}`, 20, 120);
            
            // Add badges
            doc.setFontSize(16);
            doc.text('Badges Earned:', 20, 140);
            doc.setFontSize(12);
            
            const badgeNames = {
                'first-steps': 'First Steps',
                'quick-learner': 'Quick Learner',
                'metal-master': 'Metal Master',
                'xp-collector': 'XP Collector',
                'daily-champion': 'Daily Champion',
                'story-explorer': 'Story Explorer'
            };
            
            badges.forEach((badge, index) => {
                doc.text(`${index + 1}. ${badgeNames[badge] || badge}`, 20, 150 + (index * 10));
            });
            
            // Save the PDF
            doc.save('group-1-alkali-metals-notes.pdf');
            
            showToast('success', 'PDF Exported', 'Your study notes have been exported successfully.');
            
            // Play sound effect
            playSound('complete');
        }
        
        function exportToJSON() {
            const exportData = {
                user: userData,
                progress: {
                    completedSections: completedSections,
                    xpPoints: xpPoints,
                    badges: badges
                },
                timestamp: new Date().toISOString()
            };
            
            const dataStr = JSON.stringify(exportData, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = 'group-1-alkali-metals-data.json';
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            showToast('success', 'Data Exported', 'Your data has been exported successfully.');
            
            // Play sound effect
            playSound('complete');
        }
        
        // User preferences functions
        function loadUserPreferences() {
            // Load dark mode preference
            darkMode = localStorage.getItem('darkMode') === 'true';
            document.getElementById('darkModeToggle').checked = darkMode;
            document.body.classList.toggle('dark-mode', darkMode);
            
            // Load sound preference
            soundEnabled = localStorage.getItem('soundEnabled') !== 'false';
            document.getElementById('soundToggle').checked = soundEnabled;
            
            // Load offline mode preference
            offlineMode = localStorage.getItem('offlineMode') === 'true';
            document.getElementById('offlineToggle').checked = offlineMode;
            
            // Update sound toggle icon
            const soundToggle = document.getElementById('soundToggle');
            const soundIcon = soundToggle.querySelector('i');
            if (soundEnabled) {
                soundIcon.className = 'fas fa-volume-up';
                soundToggle.classList.remove('muted');
            } else {
                soundIcon.className = 'fas fa-volume-mute';
                soundToggle.classList.add('muted');
            }
            
            // Update offline indicator
            if (offlineMode) {
                document.getElementById('offlineIndicator').classList.add('show');
            }
        }
        
        // Online/Offline status functions
        function checkOnlineStatus() {
            const offlineIndicator = document.getElementById('offlineIndicator');
            
            if (navigator.onLine) {
                offlineIndicator.classList.remove('show');
            } else {
                offlineIndicator.classList.add('show');
            }
        }
        
        // Google Analytics functions
        function initGoogleAnalytics() {
            // In a real app, you would replace GA_MEASUREMENT_ID with your actual ID
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
            gtag('config', 'GA_MEASUREMENT_ID');
            
            // Track page view
            gtag('event', 'page_view', {
                page_title: 'Group 1 Alkali Metals',
                page_location: window.location.href
            });
        }
        
        // Toast notification function
        function showToast(type, title, message) {
            const toastContainer = document.getElementById('toastContainer');
            
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            
            let icon = 'fa-info-circle';
            if (type === 'success') icon = 'fa-check-circle';
            else if (type === 'error') icon = 'fa-exclamation-circle';
            
            toast.innerHTML = `
                <div class="toast-icon">
                    <i class="fas ${icon}"></i>
                </div>
                <div class="toast-message">
                    <div class="toast-title">${title}</div>
                    <div class="toast-description">${message}</div>
                </div>
            `;
            
            toastContainer.appendChild(toast);
            
            // Show toast
            setTimeout(() => {
                toast.classList.add('show');
            }, 100);
            
            // Hide toast after 3 seconds
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => {
                    toast.remove();
                }, 300);
            }, 3000);
        }
        
        // Initialize the app when DOM is ready
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
