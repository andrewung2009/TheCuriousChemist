


<!DOCTYPE html>
<html lang="en">
   <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Group 1 Alkali Metals - Chemistry</title>
      <meta name="description" content="Interactive learning platform for mastering Group 1 Alkali Metals in chemistry">
      <!-- Tailwind CSS -->
      <script src="https://cdn.tailwindcss.com"></script>
      <!-- Font Awesome -->
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
      <!-- Firebase SDKs -->
      <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
      <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
      <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
      <!-- jsPDF for PDF export -->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
      <!-- Howler for sound effects -->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/howler/2.2.3/howler.min.js"></script>
      <style>
         :root {
         --primary: #4f46e5;
         --primary-dark: #4338ca;
         --secondary: #8b5cf6;
         --success: #10b981;
         --warning: #f59e0b;
         --danger: #ef4444;
         --gray-100: #f3f4f6;
         --gray-200: #e5e7eb;
         --gray-300: #d1d5db;
         --gray-400: #9ca3af;
         --gray-500: #6b7280;
         --gray-600: #4b5563;
         --gray-700: #374151;
         --gray-800: #1f2937;
         --gray-900: #111827;
         }
         body {
         font-family: 'Inter', sans-serif;
         background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
         min-height: 100vh;
         color: var(--gray-900);
         overflow-x: hidden;
         transition: background 0.3s ease;
         }
         body.dark-mode {
         background: linear-gradient(135deg, #1f2937 0%, #111827 100%);
         color: #f3f4f6;
         }
         /* Enhanced content card with more apparent hover */
         .content-card {
         background: rgba(255, 255, 255, 0.95);
         border-radius: 1rem;
         padding: 2rem;
         margin-bottom: 2rem;
         box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
         transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
         border-left: 5px solid var(--primary);
         position: relative;
         overflow: hidden;
         }
         body.dark-mode .content-card {
         background: rgba(31, 41, 55, 0.95);
         color: #f3f4f6;
         }
         .content-card::before {
         content: '';
         position: absolute;
         top: 0;
         left: 0;
         right: 0;
         height: 5px;
         background: linear-gradient(90deg, var(--primary), var(--secondary));
         transform: scaleX(0);
         transition: transform 0.4s ease;
         transform-origin: left;
         }
         .content-card:hover {
         transform: translateY(-8px);
         box-shadow: 0 20px 40px rgba(79, 70, 229, 0.25);
         border-left-color: var(--secondary);
         }
         .content-card:hover::before {
         transform: scaleX(1);
         }
         /* Enhanced Sidebar Styles */
         .sidebar {
         position: fixed;
         top: 0;
         left: 0;
         height: 100vh;
         width: 280px;
         background: rgba(255, 255, 255, 0.95);
         box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
         z-index: 100;
         overflow-y: auto;
         transition: transform 0.3s ease;
         display: flex;
         flex-direction: column;
         }
         body.dark-mode .sidebar {
         background: rgba(31, 41, 55, 0.95);
         color: #f3f4f6;
         }
         .sidebar-header {
         padding: 1.5rem;
         border-bottom: 1px solid rgba(0, 0, 0, 0.05);
         }
         body.dark-mode .sidebar-header {
         border-bottom-color: rgba(255, 255, 255, 0.1);
         }
         .logo-container {
         display: flex;
         align-items: center;
         }
         .search-container {
         padding: 1rem 1.5rem;
         border-bottom: 1px solid rgba(0, 0, 0, 0.05);
         }
         body.dark-mode .search-container {
         border-bottom-color: rgba(255, 255, 255, 0.1);
         }
         .search-box {
         position: relative;
         }
         .search-box input {
         width: 100%;
         padding: 0.6rem 0.6rem 0.6rem 2.5rem;
         border: 1px solid #e2e8f0;
         border-radius: 0.5rem;
         font-size: 0.875rem;
         transition: all 0.3s ease;
         background: #f8fafc;
         }
         body.dark-mode .search-box input {
         background: #1f2937;
         border-color: #374151;
         color: #f3f4f6;
         }
         .search-box input:focus {
         outline: none;
         border-color: #4f46e5;
         box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
         }
         .search-box i {
         position: absolute;
         left: 0.8rem;
         top: 50%;
         transform: translateY(-50%);
         color: #94a3b8;
         }
         .nav-section {
         padding: 1rem 0;
         border-bottom: 1px solid rgba(0, 0, 0, 0.05);
         }
         body.dark-mode .nav-section {
         border-bottom-color: rgba(255, 255, 255, 0.1);
         }
         .nav-section-title {
         padding: 0 1.5rem 0.5rem;
         font-size: 0.75rem;
         font-weight: 600;
         text-transform: uppercase;
         letter-spacing: 0.05em;
         color: #64748b;
         }
         body.dark-mode .nav-section-title {
         color: #94a3b8;
         }
         .nav-items {
         display: flex;
         flex-direction: column;
         }
         .nav-item {
         display: flex;
         align-items: center;
         padding: 0.75rem 1.5rem;
         color: #475569;
         text-decoration: none;
         transition: all 0.3s ease;
         position: relative;
         overflow: hidden;
         }
         body.dark-mode .nav-item {
         color: #cbd5e1;
         }
         .nav-item::before {
         content: '';
         position: absolute;
         left: 0;
         top: 0;
         height: 100%;
         width: 4px;
         background: #4f46e5;
         transform: scaleY(0);
         transition: transform 0.3s ease;
         }
         .nav-item:hover::before {
         transform: scaleY(1);
         }
         .nav-item:hover {
         background: rgba(79, 70, 229, 0.05);
         color: #4f46e5;
         }
         body.dark-mode .nav-item:hover {
         background: rgba(79, 70, 229, 0.1);
         color: #818cf8;
         }
         .nav-item.active {
         background: rgba(79, 70, 229, 0.1);
         color: #4f46e5;
         font-weight: 600;
         }
         body.dark-mode .nav-item.active {
         background: rgba(79, 70, 229, 0.2);
         color: #818cf8;
         }
         .nav-item.active::before {
         transform: scaleY(1);
         }
         .nav-item.completed {
         background: rgba(16, 185, 129, 0.1);
         color: #10b981;
         }
         body.dark-mode .nav-item.completed {
         background: rgba(16, 185, 129, 0.2);
         color: #34d399;
         }
         .nav-item.completed::before {
         background: #10b981;
         }
         .nav-icon {
         width: 1.25rem;
         margin-right: 0.75rem;
         text-align: center;
         }
         .nav-check {
         margin-left: auto;
         color: #10b981;
         opacity: 0;
         transition: opacity 0.3s ease;
         }
         .nav-item.completed .nav-check {
         opacity: 1;
         }
         .nav-lock {
         margin-left: auto;
         color: #94a3b8;
         opacity: 1;
         transition: opacity 0.3s ease;
         }
         .nav-item.completed .nav-lock {
         opacity: 0;
         }
         .nav-badge {
         margin-left: auto;
         background: #ef4444;
         color: white;
         font-size: 0.625rem;
         font-weight: 600;
         padding: 0.125rem 0.375rem;
         border-radius: 9999px;
         min-width: 1.25rem;
         text-align: center;
         }
         .user-section {
         margin-top: auto;
         padding: 1.5rem;
         border-top: 1px solid rgba(0, 0, 0, 0.05);
         }
         body.dark-mode .user-section {
         border-top-color: rgba(255, 255, 255, 0.1);
         }
         .xp-container {
         display: flex;
         justify-content: space-between;
         align-items: center;
         margin-bottom: 1rem;
         padding: 0.75rem;
         background: linear-gradient(135deg, #fef3c7, #fde68a);
         border-radius: 0.5rem;
         }
         body.dark-mode .xp-container {
         background: linear-gradient(135deg, #451a03, #78350f);
         }
         .xp-label {
         display: flex;
         align-items: center;
         font-weight: 500;
         color: #92400e;
         }
         body.dark-mode .xp-label {
         color: #fcd34d;
         }
         .xp-value {
         font-weight: 700;
         font-size: 1.125rem;
         color: #92400e;
         }
         body.dark-mode .xp-value {
         color: #fcd34d;
         }
         .badges-container {
         margin-bottom: 1rem;
         }
         .badges-label {
         font-size: 0.875rem;
         font-weight: 500;
         margin-bottom: 0.5rem;
         color: #475569;
         }
         body.dark-mode .badges-label {
         color: #cbd5e1;
         }
         .badges-list {
         display: flex;
         flex-wrap: wrap;
         gap: 0.5rem;
         }
         .settings-container {
         margin-bottom: 1rem;
         }
         .setting-item {
         display: flex;
         justify-content: space-between;
         align-items: center;
         margin-bottom: 0.75rem;
         }
         .setting-label {
         font-size: 0.875rem;
         color: #475569;
         }
         body.dark-mode .setting-label {
         color: #cbd5e1;
         }
         .user-info {
         display: flex;
         align-items: center;
         justify-content: space-between;
         padding-top: 1rem;
         border-top: 1px solid rgba(0, 0, 0, 0.05);
         }
         body.dark-mode .user-info {
         border-top-color: rgba(255, 255, 255, 0.1);
         }
         .user-details {
         flex: 1;
         }
         .user-name {
         font-weight: 600;
         color: #1e293b;
         }
         body.dark-mode .user-name {
         color: #f1f5f9;
         }
         .user-email {
         font-size: 0.75rem;
         color: #64748b;
         }
         body.dark-mode .user-email {
         color: #94a3b8;
         }
         .logout-btn {
         display: flex;
         align-items: center;
         justify-content: center;
         width: 2rem;
         height: 2rem;
         border-radius: 0.5rem;
         background: #f1f5f9;
         color: #64748b;
         transition: all 0.3s ease;
         }
         body.dark-mode .logout-btn {
         background: #374151;
         color: #94a3b8;
         }
         .logout-btn:hover {
         background: #ef4444;
         color: white;
         transform: rotate(90deg);
         }
         .main-content {
         margin-left: 280px;
         padding: 2rem;
         min-height: 100vh;
         }
         /* Enhanced element grid with more apparent hover */
         .element-grid {
         display: grid;
         grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
         gap: 2rem;
         margin: 2rem 0;
         }
         .element-card {
         background: white;
         border-radius: 1rem;
         padding: 1.5rem;
         text-align: center;
         box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
         transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
         position: relative;
         overflow: hidden;
         cursor: pointer;
         }
         body.dark-mode .element-card {
         background: #374151;
         color: #f3f4f6;
         }
         .element-card::before {
         content: '';
         position: absolute;
         top: 0;
         left: 0;
         right: 0;
         height: 5px;
         background: linear-gradient(90deg, var(--primary), var(--secondary));
         transform: scaleX(0);
         transition: transform 0.4s ease;
         transform-origin: left;
         }
         .element-card:hover {
         transform: translateY(-10px) scale(1.03);
         box-shadow: 0 20px 25px -5px rgba(79, 70, 229, 0.2);
         }
         .element-card:hover::before {
         transform: scaleX(1);
         }
         .element-image {
         width: 80px;
         height: 80px;
         border-radius: 50%;
         margin: 0 auto 1rem;
         object-fit: cover;
         border: 3px solid var(--gray-200);
         transition: all 0.3s ease;
         }
         .element-card:hover .element-image {
         border-color: var(--primary);
         transform: scale(1.1);
         }
         /* Enhanced tabs with more apparent hover */
         .tabs {
         display: flex;
         border-bottom: 2px solid var(--gray-200);
         margin-bottom: 2rem;
         }
         body.dark-mode .tabs {
         border-bottom-color: #4b5563;
         }
         .tab {
         padding: 0.75rem 1.5rem;
         cursor: pointer;
         background: none;
         border: none;
         font-weight: 500;
         color: var(--gray-500);
         transition: all 0.3s ease;
         position: relative;
         margin-right: 1rem;
         }
         body.dark-mode .tab {
         color: #9ca3af;
         }
         .tab::after {
         content: '';
         position: absolute;
         bottom: -2px;
         left: 0;
         right: 0;
         height: 2px;
         background: var(--primary);
         transform: scaleX(0);
         transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
         }
         .tab:hover {
         color: var(--primary);
         transform: translateY(-2px);
         }
         body.dark-mode .tab:hover {
         color: #818cf8;
         }
         .tab.active {
         color: var(--primary);
         }
         body.dark-mode .tab.active {
         color: #818cf8;
         }
         .tab.active::after {
         transform: scaleX(1);
         }
         .tab-content {
         display: none;
         animation: fadeIn 0.5s ease;
         }
         .tab-content.active {
         display: block;
         }
         @keyframes fadeIn {
         from { opacity: 0; transform: translateY(10px); }
         to { opacity: 1; transform: translateY(0); }
         }
         /* Enhanced trend table with more apparent hover */
         .trend-table {
         width: 100%;
         border-collapse: collapse;
         margin: 2rem 0;
         background: white;
         border-radius: 0.5rem;
         overflow: hidden;
         box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
         }
         body.dark-mode .trend-table {
         background: #374151;
         color: #f3f4f6;
         }
         .trend-table th {
         background: var(--primary);
         color: white;
         padding: 1rem;
         text-align: left;
         font-weight: 600;
         }
         .trend-table td {
         padding: 1rem;
         border-bottom: 1px solid var(--gray-200);
         }
         body.dark-mode .trend-table td {
         border-bottom-color: #4b5563;
         }
         .trend-table tr:last-child td {
         border-bottom: none;
         }
         .trend-table tr:nth-child(even) {
         background: var(--gray-100);
         }
         body.dark-mode .trend-table tr:nth-child(even) {
         background: #4b5563;
         }
         .trend-table tr {
         transition: all 0.3s ease;
         }
         .trend-table tr:hover {
         background: rgba(79, 70, 229, 0.1);
         transform: scale(1.01);
         box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
         }
         body.dark-mode .trend-table tr:hover {
         background: rgba(79, 70, 229, 0.2);
         }
         /* Enhanced buttons with more apparent hover */
         .btn {
         padding: 0.75rem 1.5rem;
         border-radius: 0.5rem;
         font-weight: 600;
         cursor: pointer;
         transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
         border: none;
         display: inline-flex;
         align-items: center;
         justify-content: center;
         gap: 0.5rem;
         font-family: 'Inter', sans-serif;
         position: relative;
         overflow: hidden;
         margin: 0.5rem 0;
         }
         .btn::before {
         content: '';
         position: absolute;
         top: 0;
         left: 0;
         right: 0;
         bottom: 0;
         background: rgba(255, 255, 255, 0.2);
         border-radius: 0.5rem;
         opacity: 0;
         transition: opacity 0.3s ease;
         transform: translateY(100%);
         }
         .btn:hover::before {
         opacity: 1;
         transform: translateY(0);
         }
         .btn-primary {
         background: linear-gradient(135deg, var(--primary), var(--secondary));
         color: white;
         box-shadow: 0 4px 6px rgba(79, 70, 229, 0.3);
         }
         .btn-primary:hover {
         transform: translateY(-3px);
         box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
         background: linear-gradient(135deg, var(--primary-dark), var(--primary));
         }
         .btn-success {
         background: var(--success);
         color: white;
         box-shadow: 0 4px 6px rgba(16, 185, 129, 0.3);
         }
         .btn-success:hover {
         background: #059669;
         transform: translateY(-3px);
         box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
         }
         .btn-secondary {
         background: var(--gray-100);
         color: var(--gray-700);
         box-shadow: 0 4px 6px rgba(107, 114, 128, 0.2);
         }
         body.dark-mode .btn-secondary {
         background: #4b5563;
         color: #f3f4f6;
         }
         .btn-secondary:hover {
         background: var(--gray-200);
         transform: translateY(-3px);
         }
         body.dark-mode .btn-secondary:hover {
         background: #6b7280;
         }
         .btn-danger {
         background: var(--danger);
         color: white;
         box-shadow: 0 4px 6px rgba(239, 68, 68, 0.3);
         }
         .btn-danger:hover {
         background: #dc2626;
         transform: translateY(-3px);
         box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
         }
         .btn-sm {
         padding: 0.5rem 1rem;
         font-size: 0.875rem;
         }
         /* Enhanced highlight box with more apparent hover */
         .highlight-box {
         background: rgba(79, 70, 229, 0.1);
         border-left: 4px solid var(--primary);
         padding: 1.5rem;
         border-radius: 0.5rem;
         margin: 1.5rem 0;
         transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
         position: relative;
         overflow: hidden;
         }
         body.dark-mode .highlight-box {
         background: rgba(79, 70, 229, 0.2);
         }
         .highlight-box::before {
         content: '';
         position: absolute;
         top: 0;
         left: 0;
         right: 0;
         bottom: 0;
         background: linear-gradient(135deg, rgba(79, 70, 229, 0.1), rgba(139, 92, 246, 0.1));
         transform: translateX(-100%);
         transition: transform 0.4s ease;
         }
         .highlight-box:hover {
         transform: translateX(8px);
         box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
         }
         .highlight-box:hover::before {
         transform: translateX(0);
         }
         .highlight-box h4 {
         color: var(--primary);
         font-weight: 600;
         margin-bottom: 0.75rem;
         }
         body.dark-mode .highlight-box h4 {
         color: #818cf8;
         }
         .highlight-box p {
         color: var(--gray-700);
         line-height: 1.6;
         }
         body.dark-mode .highlight-box p {
         color: #d1d5db;
         }
         /* Enhanced equation box with more apparent hover */
         .equation-box {
         background: var(--gray-100);
         border: 1px solid var(--gray-200);
         border-radius: 0.5rem;
         padding: 1.5rem;
         margin: 1.5rem 0;
         text-align: center;
         transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
         position: relative;
         overflow: hidden;
         }
         body.dark-mode .equation-box {
         background: #4b5563;
         border-color: #6b7280;
         }
         .equation-box::before {
         content: '';
         position: absolute;
         top: 0;
         left: 0;
         right: 0;
         bottom: 0;
         background: rgba(79, 70, 229, 0.1);
         transform: scale(0);
         transition: transform 0.4s ease;
         border-radius: 0.5rem;
         }
         body.dark-mode .equation-box::before {
         background: rgba(79, 70, 229, 0.2);
         }
         .equation-box:hover {
         transform: scale(1.05);
         box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
         border-color: var(--primary);
         }
         body.dark-mode .equation-box:hover {
         border-color: #818cf8;
         }
         .equation-box:hover::before {
         transform: scale(1);
         }
         .equation-box .equation {
         font-family: 'Courier New', monospace;
         font-size: 1.1rem;
         font-weight: 600;
         color: var(--gray-800);
         margin: 0.75rem 0;
         position: relative;
         z-index: 1;
         }
         body.dark-mode .equation-box .equation {
         color: #f3f4f6;
         }
         /* Enhanced progress bar */
         .progress-bar {
         width: 100%;
         height: 12px;
         background: var(--gray-200);
         border-radius: 0.5rem;
         overflow: hidden;
         margin: 1.5rem 0;
         box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1);
         }
         body.dark-mode .progress-bar {
         background: #4b5563;
         }
         .progress-fill {
         height: 100%;
         background: linear-gradient(90deg, var(--primary), var(--secondary));
         transition: width 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
         position: relative;
         overflow: hidden;
         }
         .progress-fill::after {
         content: '';
         position: absolute;
         top: 0;
         left: 0;
         bottom: 0;
         right: 0;
         background: linear-gradient(
         90deg,
         rgba(255, 255, 255, 0),
         rgba(255, 255, 255, 0.3),
         rgba(255, 255, 255, 0)
         );
         animation: shimmer 2s infinite;
         }
         @keyframes shimmer {
         0% { transform: translateX(-100%); }
         100% { transform: translateX(100%); }
         }
         /* Enhanced modal */
         /* Enhanced modal styles */
         .modal {
         display: none;
         position: fixed;
         top: 0;
         left: 0;
         width: 100%;
         height: 100%;
         background: rgba(0, 0, 0, 0.7);
         z-index: 1000;
         align-items: center;
         justify-content: center;
         padding: 1rem;
         backdrop-filter: blur(4px);
         overflow: auto; /* Allow scrolling if content is too tall */
         }
         .modal.active {
         display: flex;
         animation: fadeIn 0.3s ease;
         }
         .modal-content {
         background: white;
         border-radius: 1rem;
         padding: 2rem;
         max-width: 800px;
         width: 100%;
         max-height: 90vh;
         overflow-y: auto;
         box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
         animation: slideUp 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
         margin: auto; /* Center the modal */
         position: relative; /* For proper positioning */
         }
         body.dark-mode .modal-content {
         background: #374151;
         color: #f3f4f6;
         }
         /* Group details specific styles */
         .group-details-container {
         max-width: 100%;
         box-sizing: border-box;
         }
         .group-announcement {
         background: white;
         border-radius: 0.5rem;
         padding: 1.5rem;
         margin-bottom: 1.5rem;
         box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
         border-left: 4px solid var(--primary);
         }
         body.dark-mode .group-announcement {
         background: #4b5563;
         border-left-color: #818cf8;
         }
         .resource-item {
         background: white;
         border-radius: 0.5rem;
         padding: 1.5rem;
         margin-bottom: 1.5rem;
         box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
         display: flex;
         align-items: flex-start;
         border-left: 4px solid var(--secondary);
         }
         body.dark-mode .resource-item {
         background: #4b5563;
         border-left-color: #818cf8;
         }
         .resource-icon {
         margin-right: 1rem;
         color: var(--primary);
         font-size: 1.25rem;
         }
         .resource-info {
         flex: 1;
         }
         .resource-name {
         font-weight: 600;
         margin-bottom: 0.5rem;
         }
         .resource-meta {
         font-size: 0.875rem;
         color: var(--gray-500);
         }
         body.dark-mode .resource-meta {
         color: #9ca3af;
         }
         .resource-description {
         margin-top: 0.75rem;
         color: var(--gray-700);
         }
         body.dark-mode .resource-description {
         color: #d1d5db;
         }
         .resource-actions {
         display: flex;
         gap: 0.75rem;
         }
         .resource-btn {
         background: none;
         border: none;
         color: var(--gray-500);
         cursor: pointer;
         padding: 0.5rem;
         border-radius: 0.25rem;
         transition: all 0.2s ease;
         }
         .resource-btn:hover {
         background: var(--gray-100);
         color: var(--gray-700);
         }
         body.dark-mode .resource-btn:hover {
         background: #4b5563;
         color: #f3f4f6;
         }
         .group-chat-container {
         background: white;
         border-radius: 0.5rem;
         padding: 1.5rem;
         box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
         border-left: 4px solid var(--success);
         }
         body.dark-mode .group-chat-container {
         background: #4b5563;
         border-left-color: #34d399;
         }
         .group-chat {
         height: 300px;
         overflow-y: auto;
         margin-bottom: 1.5rem;
         padding: 1rem;
         background: var(--gray-50);
         border-radius: 0.25rem;
         }
         body.dark-mode .group-chat {
         background: #374151;
         }
         .chat-message {
         margin-bottom: 1rem;
         padding: 0.75rem;
         border-radius: 0.5rem;
         }
         .chat-message.own {
         background: var(--primary);
         color: white;
         margin-left: 2rem;
         }
         .chat-input {
         display: flex;
         gap: 0.75rem;
         }
         .chat-input input {
         flex: 1;
         }
         /* Enhanced quiz option with more apparent hover */
         .quiz-option {
         padding: 1.25rem;
         border: 2px solid var(--gray-200);
         border-radius: 0.5rem;
         margin: 1rem 0;
         cursor: pointer;
         transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
         background: white;
         display: flex;
         align-items: center;
         position: relative;
         overflow: hidden;
         transform: translateY(0);
         box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
         }
         body.dark-mode .quiz-option {
         background: #4b5563;
         border-color: #6b7280;
         color: #f3f4f6;
         }
         .quiz-option::before {
         content: '';
         position: absolute;
         top: 0;
         left: 0;
         right: 0;
         bottom: 0;
         background: linear-gradient(135deg, rgba(79, 70, 229, 0.1), rgba(139, 92, 246, 0.2));
         transform: scale(0);
         transition: transform 0.5s ease;
         border-radius: 0.5rem;
         z-index: 0;
         }
         .quiz-option:hover {
         transform: translateY(-8px) scale(1.03);
         box-shadow: 0 15px 30px rgba(79, 70, 229, 0.25);
         border-color: var(--primary);
         background: rgba(79, 70, 229, 0.05);
         }
         .quiz-option:hover::before {
         transform: scale(1);
         }
         .quiz-option.selected {
         border-color: var(--primary);
         background: rgba(79, 70, 229, 0.1);
         transform: translateY(-5px) scale(1.02);
         box-shadow: 0 12px 25px rgba(79, 70, 229, 0.2);
         }
         .quiz-option.correct {
         border-color: var(--success);
         background: rgba(16, 185, 129, 0.1);
         animation: correctPulse 0.8s ease;
         }
         .quiz-option.incorrect {
         border-color: var(--danger);
         background: rgba(239, 68, 68, 0.1);
         animation: incorrectShake 0.6s ease;
         }
         @keyframes correctPulse {
         0% { transform: scale(1); }
         50% { transform: scale(1.05); box-shadow: 0 0 20px rgba(16, 185, 129, 0.5); }
         100% { transform: scale(1); }
         }
         @keyframes incorrectShake {
         0%, 100% { transform: translateX(0); }
         20% { transform: translateX(-10px); }
         40% { transform: translateX(10px); }
         60% { transform: translateX(-8px); }
         80% { transform: translateX(8px); }
         }
         .quiz-option.disabled {
         pointer-events: none;
         opacity: 0.7;
         }
         .quiz-option input {
         margin-right: 1.25rem;
         position: relative;
         z-index: 1;
         }
         .quiz-option label {
         cursor: pointer;
         flex: 1;
         position: relative;
         z-index: 1;
         transition: color 0.3s ease;
         }
         .quiz-option:hover label {
         color: var(--primary);
         font-weight: 600;
         }
         body.dark-mode .quiz-option:hover label {
         color: #818cf8;
         }
         /* Enhanced quiz modal */
         .quiz-modal {
         backdrop-filter: blur(8px);
         }
         .quiz-modal .modal-content {
         animation: modalSlideIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
         }
         @keyframes modalSlideIn {
         from { 
         opacity: 0;
         transform: translateY(50px) scale(0.95);
         }
         to { 
         opacity: 1;
         transform: translateY(0) scale(1);
         }
         }
         #questionText {
         animation: fadeInUp 0.7s ease-out;
         }
         @keyframes fadeInUp {
         from {
         opacity: 0;
         transform: translateY(20px);
         }
         to {
         opacity: 1;
         transform: translateY(0);
         }
         }
         #optionsContainer .quiz-option {
         animation: fadeInScale 0.5s ease-out forwards;
         opacity: 0;
         }
         @keyframes fadeInScale {
         from {
         opacity: 0;
         transform: scale(0.9);
         }
         to {
         opacity: 1;
         transform: scale(1);
         }
         }
         #optionsContainer .quiz-option:nth-child(1) { animation-delay: 0.1s; }
         #optionsContainer .quiz-option:nth-child(2) { animation-delay: 0.2s; }
         #optionsContainer .quiz-option:nth-child(3) { animation-delay: 0.3s; }
         #optionsContainer .quiz-option:nth-child(4) { animation-delay: 0.4s; }
         /* Enhanced toast notification */
         .toast {
         position: fixed;
         bottom: 20px;
         right: 20px;
         background: white;
         padding: 20px;
         border-radius: 8px;
         box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
         z-index: 2000;
         display: flex;
         align-items: center;
         transform: translateX(400px);
         transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
         max-width: 400px;
         }
         body.dark-mode .toast {
         background: #374151;
         color: #f3f4f6;
         }
         .toast.show {
         transform: translateX(0);
         }
         .toast.success {
         border-left: 4px solid var(--success);
         }
         .toast.error {
         border-left: 4px solid var(--danger);
         }
         .toast.info {
         border-left: 4px solid var(--primary);
         }
         .toast-icon {
         margin-right: 16px;
         font-size: 1.25rem;
         }
         .toast.success .toast-icon {
         color: var(--success);
         }
         .toast.error .toast-icon {
         color: var(--danger);
         }
         .toast.info .toast-icon {
         color: var(--primary);
         }
         .toast-message {
         flex: 1;
         }
         .toast-title {
         font-weight: 600;
         margin-bottom: 6px;
         }
         .toast-description {
         font-size: 0.875rem;
         color: var(--gray-600);
         }
         body.dark-mode .toast-description {
         color: #d1d5db;
         }
         /* Enhanced tooltip styles */
         .tooltip {
         position: relative;
         display: inline-block;
         cursor: help;
         }
         .tooltip .tooltiptext {
         visibility: hidden;
         width: 250px;
         background-color: var(--gray-800);
         color: #fff;
         text-align: center;
         border-radius: 6px;
         padding: 12px;
         position: absolute;
         z-index: 1;
         bottom: 125%;
         left: 50%;
         margin-left: -125px;
         opacity: 0;
         transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
         font-size: 0.875rem;
         box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
         transform: translateY(10px);
         }
         .tooltip .tooltiptext::after {
         content: "";
         position: absolute;
         top: 100%;
         left: 50%;
         margin-left: -5px;
         border-width: 5px;
         border-style: solid;
         border-color: var(--gray-800) transparent transparent transparent;
         }
         .tooltip:hover .tooltiptext {
         visibility: visible;
         opacity: 1;
         transform: translateY(0);
         }
         .tooltip-icon {
         color: var(--primary);
         font-size: 0.875rem;
         margin-left: 0.25rem;
         vertical-align: super;
         animation: bounce 2s infinite;
         text-decoration: underline dotted;
         text-underline-offset: 2px;
         }
         body.dark-mode .tooltip-icon {
         color: #818cf8;
         }
         @keyframes bounce {
         0%, 100% { transform: translateY(0); }
         50% { transform: translateY(-3px); }
         }
         /* Enhanced element hover effects */
         .element-hover {
         display: inline-block;
         position: relative;
         cursor: pointer;
         font-weight: 600;
         color: var(--primary);
         padding: 4px 6px;
         border-radius: 4px;
         transition: all 0.3s ease;
         text-decoration: underline dotted;
         text-underline-offset: 2px;
         margin: 0 2px;
         }
         body.dark-mode .element-hover {
         color: #818cf8;
         }
         .element-hover:hover {
         background: rgba(79, 70, 229, 0.1);
         transform: scale(1.05);
         }
         body.dark-mode .element-hover:hover {
         background: rgba(79, 70, 229, 0.2);
         }
         .element-hover .element-info {
         visibility: hidden;
         background-color: var(--gray-800);
         color: #fff;
         text-align: center;
         border-radius: 6px;
         padding: 8px;
         position: absolute;
         z-index: 1;
         bottom: 125%;
         left: 50%;
         transform: translateX(-50%) translateY(10px);
         opacity: 0;
         transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
         font-size: 0.875rem;
         box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
         white-space: nowrap;
         }
         .element-hover .element-info::after {
         content: "";
         position: absolute;
         top: 100%;
         left: 50%;
         margin-left: -5px;
         border-width: 5px;
         border-style: solid;
         border-color: var(--gray-800) transparent transparent transparent;
         }
         .element-hover:hover .element-info {
         visibility: visible;
         opacity: 1;
         transform: translateX(-50%) translateY(0);
         }
         /* Enhanced Periodic Table Styles */
         .periodic-table {
         display: grid;
         grid-template-columns: repeat(18, 1fr);
         gap: 0.5rem;
         margin: 2rem 0;
         }
         .element {
         aspect-ratio: 1;
         display: flex;
         flex-direction: column;
         align-items: center;
         justify-content: center;
         background: var(--gray-100);
         border-radius: 0.25rem;
         font-size: 0.75rem;
         cursor: pointer;
         transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
         position: relative;
         overflow: hidden;
         }
         body.dark-mode .element {
         background: #4b5563;
         color: #f3f4f6;
         }
         .element::before {
         content: '';
         position: absolute;
         top: 0;
         left: 0;
         right: 0;
         bottom: 0;
         background: linear-gradient(135deg, var(--primary), var(--secondary));
         opacity: 0;
         transition: opacity 0.3s ease;
         z-index: 0;
         }
         .element:hover {
         transform: scale(1.15);
         z-index: 10;
         box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
         }
         .element:hover::before {
         opacity: 0.2;
         }
         .element:hover > * {
         position: relative;
         z-index: 1;
         color: white;
         }
         .element.group1 {
         background: rgba(79, 70, 229, 0.2);
         color: var(--primary);
         font-weight: 600;
         }
         body.dark-mode .element.group1 {
         background: rgba(79, 70, 229, 0.3);
         color: #818cf8;
         }
         .element-symbol {
         font-weight: 600;
         font-size: 1rem;
         }
         .element-number {
         font-size: 0.625rem;
         position: absolute;
         top: 0.25rem;
         left: 0.25rem;
         }
         .element-name {
         font-size: 0.5rem;
         position: absolute;
         bottom: 0.25rem;
         left: 0;
         right: 0;
         text-align: center;
         }
         /* Enhanced keyword hover effects */
         .keyword {
         display: inline-block;
         position: relative;
         cursor: pointer;
         color: var(--primary);
         font-weight: 600;
         padding: 4px 6px;
         border-radius: 4px;
         transition: all 0.3s ease;
         text-decoration: underline dotted;
         text-underline-offset: 2px;
         margin: 0 2px;
         }
         body.dark-mode .keyword {
         color: #818cf8;
         }
         .keyword:hover {
         background: rgba(79, 70, 229, 0.1);
         transform: scale(1.05);
         }
         body.dark-mode .keyword:hover {
         background: rgba(79, 70, 229, 0.2);
         }
         .keyword .keyword-info {
         visibility: hidden;
         background-color: var(--gray-800);
         color: #fff;
         text-align: center;
         border-radius: 6px;
         padding: 8px;
         position: absolute;
         z-index: 1;
         bottom: 125%;
         left: 50%;
         transform: translateX(-50%) translateY(10px);
         opacity: 0;
         transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
         font-size: 0.875rem;
         box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
         width: 200px;
         }
         .keyword .keyword-info::after {
         content: "";
         position: absolute;
         top: 100%;
         left: 50%;
         margin-left: -5px;
         border-width: 5px;
         border-style: solid;
         border-color: var(--gray-800) transparent transparent transparent;
         }
         .keyword:hover .keyword-info {
         visibility: visible;
         opacity: 1;
         transform: translateX(-50%) translateY(0);
         }
         /* Enhanced valence electron flash effect */
         .valence-electron {
         display: inline-block;
         background: rgba(79, 70, 229, 0.1);
         color: var(--primary);
         font-weight: 600;
         padding: 0.5rem 0.75rem;
         border-radius: 0.25rem;
         margin: 0 0.5rem;
         cursor: pointer;
         position: relative;
         transition: all 0.3s ease;
         text-decoration: underline dotted;
         text-underline-offset: 2px;
         }
         body.dark-mode .valence-electron {
         background: rgba(79, 70, 229, 0.2);
         color: #818cf8;
         }
         .valence-electron:hover {
         background: rgba(79, 70, 229, 0.3);
         box-shadow: 0 0 15px rgba(79, 70, 229, 0.5);
         transform: scale(1.1);
         }
         .valence-electron .valence-info {
         visibility: hidden;
         background-color: var(--gray-800);
         color: #fff;
         text-align: center;
         border-radius: 6px;
         padding: 8px;
         position: absolute;
         z-index: 1;
         bottom: 125%;
         left: 50%;
         transform: translateX(-50%) translateY(10px);
         opacity: 0;
         transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
         font-size: 0.875rem;
         box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
         width: 250px;
         }
         .valence-electron .valence-info::after {
         content: "";
         position: absolute;
         top: 100%;
         left: 50%;
         margin-left: -5px;
         border-width: 5px;
         border-style: solid;
         border-color: var(--gray-800) transparent transparent transparent;
         }
         .valence-electron:hover .valence-info {
         visibility: visible;
         opacity: 1;
         transform: translateX(-50%) translateY(0);
         }
         /* Enhanced Discussion Styles */
         .discussion-post {
         background: white;
         border-radius: 0.75rem;
         padding: 1.5rem;
         margin-bottom: 1.5rem;
         box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
         transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
         position: relative;
         overflow: hidden;
         }
         body.dark-mode .discussion-post {
         background: #374151;
         color: #f3f4f6;
         }
         .discussion-post::before {
         content: '';
         position: absolute;
         top: 0;
         left: 0;
         right: 0;
         height: 3px;
         background: linear-gradient(90deg, var(--primary), var(--secondary));
         transform: scaleX(0);
         transition: transform 0.3s ease;
         transform-origin: left;
         }
         .discussion-post:hover {
         box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
         transform: translateY(-3px);
         }
         .discussion-post:hover::before {
         transform: scaleX(1);
         }
         .post-header {
         display: flex;
         align-items: center;
         margin-bottom: 1rem;
         }
         .post-avatar {
         width: 48px;
         height: 48px;
         border-radius: 50%;
         background: linear-gradient(135deg, var(--primary), var(--secondary));
         display: flex;
         align-items: center;
         justify-content: center;
         color: white;
         font-weight: 600;
         margin-right: 1rem;
         transition: transform 0.3s ease;
         }
         .discussion-post:hover .post-avatar {
         transform: scale(1.1);
         }
         .post-meta {
         flex: 1;
         }
         .post-author {
         font-weight: 600;
         color: var(--gray-800);
         }
         body.dark-mode .post-author {
         color: #f3f4f6;
         }
         .post-time {
         font-size: 0.875rem;
         color: var(--gray-500);
         }
         .post-title {
         font-size: 1.25rem;
         font-weight: 600;
         color: var(--gray-900);
         margin-bottom: 0.75rem;
         }
         body.dark-mode .post-title {
         color: #f3f4f6;
         }
         .post-content {
         color: var(--gray-700);
         line-height: 1.6;
         margin-bottom: 1rem;
         }
         body.dark-mode .post-content {
         color: #d1d5db;
         }
         .post-actions {
         display: flex;
         gap: 1.25rem;
         padding-top: 1rem;
         border-top: 1px solid var(--gray-200);
         }
         body.dark-mode .post-actions {
         border-top-color: #4b5563;
         }
         .post-action {
         display: flex;
         align-items: center;
         gap: 0.5rem;
         color: var(--gray-500);
         cursor: pointer;
         transition: all 0.3s ease;
         font-size: 0.875rem;
         padding: 0.5rem;
         border-radius: 0.25rem;
         }
         .post-action:hover {
         color: var(--primary);
         background: rgba(79, 70, 229, 0.1);
         transform: translateY(-2px);
         }
         body.dark-mode .post-action:hover {
         color: #818cf8;
         background: rgba(79, 70, 229, 0.2);
         }
         .post-action.voted {
         color: var(--primary);
         }
         body.dark-mode .post-action.voted {
         color: #818cf8;
         }
         .comments-section {
         margin-top: 1.5rem;
         padding-left: 1.5rem;
         border-left: 3px solid var(--gray-200);
         }
         body.dark-mode .comments-section {
         border-left-color: #4b5563;
         }
         /* Enhanced comment styles */
         .comment {
         background: white;
         border-radius: 0.5rem;
         padding: 1rem;
         margin-bottom: 0.75rem;
         transition: all 0.3s ease;
         border: 1px solid #e5e7eb;
         box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
         }
         body.dark-mode .comment {
         background: #4b5563;
         color: #f3f4f6;
         border-color: #6b7280;
         }
         .comment:hover {
         transform: translateX(5px);
         box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
         }
         .comment-header {
         display: flex;
         align-items: center;
         margin-bottom: 0.75rem;
         }
         .comment-avatar {
         width: 36px;
         height: 36px;
         border-radius: 50%;
         background: linear-gradient(135deg, var(--primary), var(--secondary));
         display: flex;
         align-items: center;
         justify-content: center;
         color: white;
         font-size: 0.875rem;
         font-weight: 600;
         margin-right: 1rem;
         flex-shrink: 0;
         }
         .comment-author {
         font-weight: 600;
         color: var(--gray-800);
         font-size: 0.95rem;
         }
         body.dark-mode .comment-author {
         color: #f3f4f6;
         }
         .comment-time {
         font-size: 0.75rem;
         color: var(--gray-500);
         margin-left: auto;
         }
         .comment-content {
         color: var(--gray-700);
         font-size: 0.95rem;
         line-height: 1.5;
         margin-left: 2.5rem;
         }
         body.dark-mode .comment-content {
         color: #d1d5db;
         }
         .comments-section {
         margin-top: 1.5rem;
         padding: 1.5rem;
         border-left: 3px solid var(--gray-200);
         background: var(--gray-50);
         border-radius: 0.5rem;
         }
         body.dark-mode .comments-section {
         border-left-color: #4b5563;
         background: #374151;
         }
         /* Leaderboard Table - Separate from other styles */
.leaderboard-table {
    width: 100%;
    border-collapse: collapse;
    margin: 2rem 0;
    background: white;
    border-radius: 0.5rem;
    overflow: hidden;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
}

body.dark-mode .leaderboard-table {
    background: #374151;
    color: #f3f4f6;
}

.leaderboard-table th {
    background: var(--primary);
    color: white;
    padding: 1rem;
    text-align: left;
    font-weight: 600;
}

.leaderboard-table td {
    padding: 1rem;
    border-bottom: 1px solid var(--gray-200);
    vertical-align: middle;
}

body.dark-mode .leaderboard-table td {
    border-bottom-color: #4b5563;
}

.leaderboard-table tr:last-child td {
    border-bottom: none;
}

.leaderboard-table tr:hover {
    background: rgba(79, 70, 229, 0.05);
}

body.dark-mode .leaderboard-table tr:hover {
    background: rgba(79, 70, 229, 0.1);
}

.leaderboard-rank {
    width: 36px;
    height: 36px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--gray-100);
    border-radius: 50%;
    font-weight: 600;
    margin: 0 auto;
    transition: all 0.3s ease;
}

body.dark-mode .leaderboard-rank {
    background: #4b5563;
    color: #f3f4f6;
}

.leaderboard-table tr:hover .leaderboard-rank {
    transform: scale(1.1);
}

.leaderboard-rank.first {
    background: linear-gradient(135deg, #f59e0b, #d97706);
    color: white;
}

.leaderboard-rank.second {
    background: linear-gradient(135deg, #9ca3af, #6b7280);
    color: white;
}

.leaderboard-rank.third {
    background: linear-gradient(135deg, #cd7c2f, #92400e);
    color: white;
}

/* Ensure proper column widths */
.leaderboard-table th:first-child,
.leaderboard-table td:first-child {
    width: 80px;
}

.leaderboard-table th:nth-child(2),
.leaderboard-table td:nth-child(2) {
    width: 30%;
}

.leaderboard-table th:nth-child(3),
.leaderboard-table td:nth-child(3) {
    width: 15%;
}

.leaderboard-table th:nth-child(4),
.leaderboard-table td:nth-child(4) {
    width: 20%;
}

.leaderboard-table th:nth-child(5),
.leaderboard-table td:nth-child(5) {
    width: 15%;
}
         /* Enhanced Study Group Styles */
         .study-group-card {
         background: white;
         border-radius: 0.75rem;
         padding: 1.5rem;
         margin-bottom: 1.5rem;
         box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
         transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
         position: relative;
         overflow: hidden;
         }
         body.dark-mode .study-group-card {
         background: #374151;
         color: #f3f4f6;
         }
         .study-group-card::before {
         content: '';
         position: absolute;
         top: 0;
         left: 0;
         right: 0;
         height: 3px;
         background: linear-gradient(90deg, var(--primary), var(--secondary));
         transform: scaleX(0);
         transition: transform 0.3s ease;
         transform-origin: left;
         }
         .study-group-card:hover {
         box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
         transform: translateY(-3px);
         }
         .study-group-card:hover::before {
         transform: scaleX(1);
         }
         .group-header {
         display: flex;
         justify-content: space-between;
         align-items: start;
         margin-bottom: 1rem;
         }
         .group-title {
         font-size: 1.25rem;
         font-weight: 600;
         color: var(--gray-900);
         }
         body.dark-mode .group-title {
         color: #f3f4f6;
         }
         .group-topic {
         display: inline-block;
         background: var(--primary);
         color: white;
         padding: 0.25rem 0.75rem;
         border-radius: 9999px;
         font-size: 0.75rem;
         margin-top: 0.5rem;
         transition: all 0.3s ease;
         }
         .group-topic:hover {
         transform: scale(1.05);
         box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
         }
         .group-description {
         color: var(--gray-700);
         line-height: 1.6;
         margin-bottom: 1rem;
         }
         body.dark-mode .group-description {
         color: #d1d5db;
         }
         .group-meta {
         display: flex;
         justify-content: space-between;
         align-items: center;
         margin-bottom: 1rem;
         }
         .group-members {
         display: flex;
         align-items: center;
         gap: 0.5rem;
         }
         .member-avatar {
         width: 36px;
         height: 36px;
         border-radius: 50%;
         background: linear-gradient(135deg, var(--primary), var(--secondary));
         display: flex;
         align-items: center;
         justify-content: center;
         color: white;
         font-weight: 600;
         font-size: 0.75rem;
         border: 2px solid white;
         transition: all 0.3s ease;
         }
         .member-avatar:hover {
         transform: scale(1.1);
         z-index: 1;
         }
         .group-stats {
         font-size: 0.875rem;
         color: var(--gray-500);
         }
         .group-actions {
         display: flex;
         gap: 0.75rem;
         }
         .empty-state {
         text-align: center;
         padding: 3rem 1rem;
         color: var(--gray-500);
         }
         .empty-state-icon {
         font-size: 3rem;
         color: var(--gray-300);
         margin-bottom: 1rem;
         animation: float 3s ease-in-out infinite;
         }
         @keyframes float {
         0%, 100% { transform: translateY(0); }
         50% { transform: translateY(-10px); }
         }
         .empty-state-title {
         font-size: 1.5rem;
         font-weight: 600;
         margin-bottom: 0.75rem;
         }
         .form-group {
         margin-bottom: 1.5rem;
         }
         .form-label {
         display: block;
         font-weight: 500;
         color: var(--gray-700);
         margin-bottom: 0.75rem;
         }
         body.dark-mode .form-label {
         color: #f3f4f6;
         }
         .form-input {
         width: 100%;
         padding: 0.875rem;
         border: 1px solid var(--gray-300);
         border-radius: 0.5rem;
         font-size: 1rem;
         transition: all 0.3s ease;
         }
         body.dark-mode .form-input {
         background: #4b5563;
         border-color: #6b7280;
         color: #f3f4f6;
         }
         .form-input:focus {
         outline: none;
         border-color: var(--primary);
         box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
         transform: translateY(-2px);
         }
         body.dark-mode .form-input:focus {
         border-color: #818cf8;
         box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.2);
         }
         .form-textarea {
         resize: vertical;
         min-height: 120px;
         }
         /* Enhanced Quiz Enhancement Styles */
         .feedback-system {
         background: rgba(255, 255, 255, 0.95);
         border-radius: 1rem;
         padding: 2rem;
         margin-bottom: 2rem;
         box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
         transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
         position: relative;
         overflow: hidden;
         }
         body.dark-mode .feedback-system {
         background: rgba(31, 41, 55, 0.95);
         color: #f3f4f6;
         }
         .feedback-system::before {
         content: '';
         position: absolute;
         top: 0;
         left: 0;
         right: 0;
         bottom: 0;
         background: linear-gradient(135deg, rgba(79, 70, 229, 0.05), rgba(139, 92, 246, 0.05));
         transform: scale(0);
         transition: transform 0.4s ease;
         }
         .feedback-system:hover {
         transform: translateY(-5px);
         box-shadow: 0 15px 35px rgba(0, 0, 0, 0.15);
         }
         .feedback-system:hover::before {
         transform: scale(1);
         }
         .reaction-buttons {
         display: flex;
         gap: 1.25rem;
         margin-top: 1.25rem;
         }
         .reaction-btn {
         display: flex;
         align-items: center;
         gap: 0.75rem;
         padding: 0.75rem 1.25rem;
         border-radius: 0.5rem;
         background: var(--gray-100);
         color: var(--gray-700);
         cursor: pointer;
         transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
         border: none;
         position: relative;
         overflow: hidden;
         }
         body.dark-mode .reaction-btn {
         background: #4b5563;
         color: #f3f4f6;
         }
         .reaction-btn::before {
         content: '';
         position: absolute;
         top: 0;
         left: 0;
         right: 0;
         bottom: 0;
         background: rgba(79, 70, 229, 0.1);
         transform: scale(0);
         transition: transform 0.3s ease;
         border-radius: 0.5rem;
         }
         body.dark-mode .reaction-btn::before {
         background: rgba(79, 70, 229, 0.2);
         }
         .reaction-btn:hover {
         background: var(--gray-200);
         transform: translateY(-3px);
         }
         body.dark-mode .reaction-btn:hover {
         background: #6b7280;
         }
         .reaction-btn:hover::before {
         transform: scale(1);
         }
         .reaction-btn.active {
         background: var(--primary);
         color: white;
         transform: translateY(-3px);
         box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
         }
         .xp-display {
         display: flex;
         align-items: center;
         gap: 0.75rem;
         background: linear-gradient(135deg, #f59e0b, #d97706);
         color: white;
         padding: 0.75rem 1.25rem;
         border-radius: 9999px;
         font-weight: 600;
         font-size: 0.875rem;
         transition: all 0.3s ease;
         }
         .xp-display:hover {
         transform: scale(1.05);
         box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
         }
         .badge {
         display: inline-flex;
         align-items: center;
         gap: 0.375rem;
         background: linear-gradient(135deg, #8b5cf6, #7c3aed);
         color: white;
         padding: 0.375rem 0.875rem;
         border-radius: 9999px;
         font-size: 0.75rem;
         font-weight: 600;
         margin-right: 0.75rem;
         transition: all 0.3s ease;
         }
         .badge:hover {
         transform: scale(1.05);
         box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
         }
         .leaderboard-entry {
         display: flex;
         align-items: center;
         padding: 1.25rem;
         border-bottom: 1px solid var(--gray-200);
         transition: all 0.3s ease;
         }
         body.dark-mode .leaderboard-entry {
         border-bottom-color: #4b5563;
         }
         .leaderboard-entry:hover {
         background: rgba(79, 70, 229, 0.05);
         transform: translateX(5px);
         }
         body.dark-mode .leaderboard-entry:hover {
         background: rgba(79, 70, 229, 0.1);
         }
         .leaderboard-rank {
         width: 36px;
         height: 36px;
         display: flex;
         align-items: center;
         justify-content: center;
         background: var(--gray-100);
         border-radius: 50%;
         font-weight: 600;
         margin-right: 1.25rem;
         transition: all 0.3s ease;
         }
         body.dark-mode .leaderboard-rank {
         background: #4b5563;
         color: #f3f4f6;
         }
         .leaderboard-entry:hover .leaderboard-rank {
         transform: scale(1.1);
         }
         .leaderboard-rank.first {
         background: linear-gradient(135deg, #f59e0b, #d97706);
         color: white;
         }
         .leaderboard-rank.second {
         background: linear-gradient(135deg, #9ca3af, #6b7280);
         color: white;
         }
         .leaderboard-rank.third {
         background: linear-gradient(135deg, #cd7c2f, #92400e);
         color: white;
         }
         .leaderboard-info {
         flex: 1;
         }
         .leaderboard-name {
         font-weight: 600;
         color: var(--gray-800);
         }
         body.dark-mode .leaderboard-name {
         color: #f3f4f6;
         }
         .leaderboard-stats {
         display: flex;
         gap: 1.25rem;
         font-size: 0.875rem;
         color: var(--gray-600);
         }
         body.dark-mode .leaderboard-stats {
         color: #d1d5db;
         }
         .daily-challenge {
         background: linear-gradient(135deg, #10b981, #059669);
         color: white;
         border-radius: 1rem;
         padding: 2rem;
         margin-bottom: 2rem;
         box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
         transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
         position: relative;
         overflow: hidden;
         }
         .daily-challenge::before {
         content: '';
         position: absolute;
         top: 0;
         left: 0;
         right: 0;
         bottom: 0;
         background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
         transform: translateX(-100%);
         transition: transform 0.6s ease;
         }
         .daily-challenge:hover {
         transform: translateY(-5px);
         box-shadow: 0 15px 35px rgba(0, 0, 0, 0.15);
         }
         .daily-challenge:hover::before {
         transform: translateX(0);
         }
         .daily-challenge h3 {
         font-size: 1.5rem;
         font-weight: 600;
         margin-bottom: 0.75rem;
         }
         .daily-challenge p {
         margin-bottom: 1.25rem;
         }
         .switch {
         position: relative;
         display: inline-block;
         width: 50px;
         height: 24px;
         }
         .switch input {
         opacity: 0;
         width: 0;
         height: 0;
         }
         .slider {
         position: absolute;
         cursor: pointer;
         top: 0;
         left: 0;
         right: 0;
         bottom: 0;
         background-color: #ccc;
         transition: .4s;
         }
         .slider:before {
         position: absolute;
         content: "";
         height: 16px;
         width: 16px;
         left: 4px;
         bottom: 4px;
         background-color: white;
         transition: .4s;
         }
         input:checked + .slider {
         background-color: var(--primary);
         }
         input:checked + .slider:before {
         transform: translateX(26px);
         }
         .slider.round {
         border-radius: 24px;
         }
         .slider.round:before {
         border-radius: 50%;
         }
         /* Fade-in effect for content */
         .fade-in {
         opacity: 0;
         transform: translateY(30px);
         transition: opacity 0.8s ease-out, transform 0.8s ease-out;
         will-change: opacity, transform;
         }
         .fade-in.visible {
         opacity: 1;
         transform: translateY(0);
         }
         /* Staggered animation for lists */
         .fade-in-stagger > * {
         opacity: 0;
         transform: translateY(20px);
         transition: opacity 0.6s ease-out, transform 0.6s ease-out;
         }
         .fade-in-stagger.visible > * {
         opacity: 1;
         transform: translateY(0);
         }
         .fade-in-stagger.visible > *:nth-child(1) { transition-delay: 0.1s; }
         .fade-in-stagger.visible > *:nth-child(2) { transition-delay: 0.2s; }
         .fade-in-stagger.visible > *:nth-child(3) { transition-delay: 0.3s; }
         .fade-in-stagger.visible > *:nth-child(4) { transition-delay: 0.4s; }
         .fade-in-stagger.visible > *:nth-child(5) { transition-delay: 0.5s; }
         /* Enhanced interactive elements */
         .interactive-element {
         position: relative;
         cursor: pointer;
         transition: all 0.3s ease;
         border-radius: 0.25rem;
         padding: 0.375rem 0.5rem;
         display: inline-block;
         margin: 0 0.25rem;
         }
         .interactive-element:hover {
         background-color: rgba(79, 70, 229, 0.1);
         transform: translateY(-2px);
         }
         .interactive-element .quiz-popup {
         position: absolute;
         background: white;
         border-radius: 0.5rem;
         box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
         padding: 1rem;
         width: 300px;
         z-index: 100;
         display: none;
         top: 100%;
         left: 50%;
         transform: translateX(-50%) translateY(10px);
         opacity: 0;
         transition: all 0.3s ease;
         }
         .interactive-element:hover .quiz-popup {
         display: block;
         opacity: 1;
         transform: translateX(-50%) translateY(5px);
         }
         .interactive-element .quiz-popup h4 {
         margin-top: 0;
         color: var(--primary);
         }
         .interactive-element .quiz-popup .quiz-options {
         margin-top: 0.75rem;
         }
         .interactive-element .quiz-popup .quiz-option {
         padding: 0.5rem;
         margin: 0.375rem 0;
         border-radius: 0.25rem;
         cursor: pointer;
         transition: all 0.2s ease;
         }
         .interactive-element .quiz-popup .quiz-option:hover {
         background-color: rgba(79, 70, 229, 0.1);
         }
         .interactive-element .quiz-popup .quiz-option.correct {
         background-color: rgba(16, 185, 129, 0.1);
         color: var(--success);
         }
         .interactive-element .quiz-popup .quiz-option.incorrect {
         background-color: rgba(239, 68, 68, 0.1);
         color: var(--danger);
         }
         @media (max-width: 768px) {
         .sidebar {
         transform: translateX(-100%);
         }
         .sidebar.active {
         transform: translateX(0);
         }
         .main-content {
         margin-left: 0;
         }
         .element-grid {
         grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
         }
         .discussion-controls {
         flex-direction: column;
         align-items: stretch;
         }
         .search-box {
         min-width: auto;
         }
         }
         /* Loading spinner */
         .spinner {
         border: 4px solid rgba(0, 0, 0, 0.1);
         border-radius: 50%;
         border-top: 4px solid var(--primary);
         width: 40px;
         height: 40px;
         animation: spin 1s linear infinite;
         margin: 2rem auto;
         }
         @keyframes spin {
         0% { transform: rotate(0deg); }
         100% { transform: rotate(360deg); }
         }
         /* Section complete button styles */
         .section-complete-btn {
         transition: all 0.3s ease;
         }
         .section-complete-btn:hover {
         transform: translateY(-3px);
         }
         /* Unmark complete button styles */
         .btn-unmark {
         background: #f59e0b;
         color: white;
         box-shadow: 0 4px 6px rgba(245, 158, 11, 0.3);
         }
         .btn-unmark:hover {
         background: #d97706;
         transform: translateY(-3px);
         box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
         }
      </style>
   </head>
   <body>
      <!-- Landing Page -->
      <div id="landingPage" class="min-h-screen flex items-center justify-center p-6">
         <div class="bg-white rounded-2xl p-8 max-w-2xl w-full text-center shadow-2xl transform transition-all duration-500 hover:scale-105">
            <div class="text-6xl mb-6 text-indigo-600 animate-pulse">
               <i class="fas fa-atom"></i>
            </div>
            <h1 class="text-4xl font-bold text-gray-800 mb-4">Group 1 Alkali Metals</h1>
            <p class="text-lg text-gray-600 mb-8">Master Chemistry through Interactive Learning</p>
            <div class="grid grid-cols-3 gap-8 mb-8">
               <div class="bg-blue-50 p-6 rounded-xl transform transition-all duration-300 hover:scale-110 hover:shadow-lg">
                  <i class="fas fa-book-open text-3xl text-blue-600 mb-3 transform transition-all duration-300 hover:scale-110"></i>
                  <h3 class="font-semibold">Learn</h3>
                  <p class="text-sm text-gray-600">Interactive content</p>
               </div>
               <div class="bg-green-50 p-6 rounded-xl transform transition-all duration-300 hover:scale-110 hover:shadow-lg">
                  <i class="fas fa-chart-line text-3xl text-green-600 mb-3 transform transition-all duration-300 hover:scale-110"></i>
                  <h3 class="font-semibold">Track</h3>
                  <p class="text-sm text-gray-600">Progress monitoring</p>
               </div>
               <div class="bg-purple-50 p-6 rounded-xl transform transition-all duration-300 hover:scale-110 hover:shadow-lg">
                  <i class="fas fa-graduation-cap text-3xl text-purple-600 mb-3 transform transition-all duration-300 hover:scale-110"></i>
                  <h3 class="font-semibold">Test</h3>
                  <p class="text-sm text-gray-600">Innovative quiz</p>
               </div>
            </div>
            <div class="space-y-6">
               <button onclick="showLoginModal()" class="btn btn-primary w-full transform transition-all duration-300 hover:scale-105">
               <i class="fas fa-sign-in-alt mr-2"></i>
               Sign In to Begin
               </button>
               <button onclick="signInWithGoogle()" class="btn btn-secondary w-full transform transition-all duration-300 hover:scale-105">
               <i class="fab fa-google mr-2"></i>
               Continue with Google
               </button>
            </div>
         </div>
      </div>
      <!-- Main App -->
      <div id="mainApp" style="display: none;">
         <!-- Sidebar -->
         <nav class="sidebar" id="sidebar">
            <div class="sidebar-header">
               <div class="logo-container">
                  <i class="fas fa-atom text-indigo-600 text-2xl mr-3 transform transition-all duration-300 hover:rotate-180"></i>
                  <div>
                     <h1 class="text-xl font-bold text-gray-800">Group 1 Alkali Metals</h1>
                     <p class="text-sm text-gray-600">Chemistry</p>
                  </div>
               </div>
            </div>
            <!-- Search Bar -->
            <div class="search-container">
               <div class="search-box">
                  <i class="fas fa-search"></i>
                  <input type="text" id="searchInput" placeholder="Search content...">
               </div>
            </div>
            <!-- Main Navigation -->
            <div class="nav-section">
               <h3 class="nav-section-title">Learning Path</h3>
               <div class="nav-items">
                  <a href="#" class="nav-item active" id="nav-overview" onclick="navigateToSection('overview')">
                  <i class="fas fa-home nav-icon"></i>
                  <span>Overview</span>
                  <i class="fas fa-check nav-check"></i>
                  </a>
                  <a href="#" class="nav-item locked" id="nav-elements" onclick="navigateToSection('elements')">
                  <i class="fas fa-th nav-icon"></i>
                  <span>Elements</span>
                  <i class="fas fa-lock nav-lock"></i>
                  <i class="fas fa-check nav-check"></i>
                  </a>
                  <a href="#" class="nav-item locked" id="nav-properties" onclick="navigateToSection('properties')">
                  <i class="fas fa-chart-line nav-icon"></i>
                  <span>Properties</span>
                  <i class="fas fa-lock nav-lock"></i>
                  <i class="fas fa-check nav-check"></i>
                  </a>
                  <a href="#" class="nav-item locked" id="nav-reactions" onclick="navigateToSection('reactions')">
                  <i class="fas fa-flask nav-icon"></i>
                  <span>Reactions</span>
                  <i class="fas fa-lock nav-lock"></i>
                  <i class="fas fa-check nav-check"></i>
                  </a>
                  <a href="#" class="nav-item locked" id="nav-quiz" onclick="navigateToSection('quiz')">
                  <i class="fas fa-graduation-cap nav-icon"></i>
                  <span>Quiz</span>
                  <i class="fas fa-lock nav-lock"></i>
                  <i class="fas fa-check nav-check"></i>
                  </a>
               </div>
            </div>
            <!-- Community Section -->
            <div class="nav-section">
               <h3 class="nav-section-title">Community</h3>
               <div class="nav-items">
                  <a href="#" class="nav-item" id="nav-discussion" onclick="navigateToSection('discussion')">
                  <i class="fas fa-comments nav-icon"></i>
                  <span>Discussion</span>
                  <span class="nav-badge">3</span>
                  </a>
                  <a href="#" class="nav-item" id="nav-study-groups" onclick="navigateToSection('study-groups')">
                  <i class="fas fa-users nav-icon"></i>
                  <span>Study Groups</span>
                  <span class="nav-badge">2</span>
                  </a>
                  <a href="#" class="nav-item" id="nav-leaderboard" onclick="navigateToSection('leaderboard')">
                  <i class="fas fa-trophy nav-icon"></i>
                  <span>Leaderboard</span>
                  </a>
               </div>
            </div>
            <!-- Tools Section -->
            <div class="nav-section">
               <h3 class="nav-section-title">Tools</h3>
               <div class="nav-items">
                  <a href="#" class="nav-item" onclick="showFeedbackModal()">
                  <i class="fas fa-comment-dots nav-icon"></i>
                  <span>Feedback</span>
                  </a>
                  <a href="#" class="nav-item" onclick="exportToPDF()">
                  <i class="fas fa-file-pdf nav-icon"></i>
                  <span>Export Notes</span>
                  </a>
               </div>
            </div>
            <!-- User Section -->
            <div class="user-section">
               <div class="xp-container">
                  <div class="xp-label">
                     <i class="fas fa-star text-yellow-500"></i>
                     <span>Your XP</span>
                  </div>
                  <div class="xp-value" id="userXP">0</div>
               </div>
               <div class="badges-container">
                  <div class="badges-label">Badges</div>
                  <div id="userBadges" class="badges-list">
                     <!-- Badges will be loaded here -->
                  </div>
               </div>
               <div class="settings-container">
                  <div class="setting-item">
                     <span class="setting-label">Dark Mode</span>
                     <label class="switch">
                     <input type="checkbox" id="darkModeToggle" onchange="toggleDarkMode()">
                     <span class="slider round"></span>
                     </label>
                  </div>
                  <div class="setting-item">
                     <span class="setting-label">Sound Effects</span>
                     <label class="switch">
                     <input type="checkbox" id="soundToggle" checked onchange="toggleSound()">
                     <span class="slider round"></span>
                     </label>
                  </div>
               </div>
               <div class="user-info">
                  <div class="user-details">
                     <div class="user-name" id="userName">User</div>
                     <div class="user-email" id="userEmail">user@example.com</div>
                  </div>
                  <button onclick="signOut()" class="logout-btn">
                  <i class="fas fa-sign-out-alt"></i>
                  </button>
               </div>
            </div>
         </nav>
         <!-- Main Content -->
         <main class="main-content">
            <!-- Daily Challenge -->
            <div id="dailyChallenge" class="daily-challenge fade-in" style="display: none;">
               <h3><i class="fas fa-calendar-day mr-2"></i> Daily Challenge</h3>
               <p id="dailyChallengeQuestion">Loading daily challenge...</p>
               <button onclick="showDailyChallengeModal()" class="btn btn-secondary transform transition-all duration-300 hover:scale-105">
               <i class="fas fa-play mr-2"></i>
               Take Challenge
               </button>
            </div>
            <!-- Progress Tracker -->
            <div class="content-card fade-in">
               <div class="flex justify-between items-center mb-6">
                  <h3 class="text-xl font-bold text-gray-800">Your Progress</h3>
                  <div class="text-xl font-bold text-indigo-600" id="progressPercentage">0%</div>
               </div>
               <div class="progress-bar">
                  <div class="progress-fill" id="overallProgressFill" style="width: 0%"></div>
               </div>
               <div class="grid grid-cols-4 gap-6 mt-6">
                  <div class="text-center p-4 bg-gray-100 rounded-lg transform transition-all duration-300 hover:scale-105 fade-in" id="progress-overview">
                     <i class="fas fa-home text-gray-600 mb-3 transform transition-all duration-300 hover:scale-110"></i>
                     <div class="text-sm font-medium text-gray-700">Overview</div>
                     <div class="text-xs text-gray-500 mt-1">Not Started</div>
                  </div>
                  <div class="text-center p-4 bg-gray-100 rounded-lg transform transition-all duration-300 hover:scale-105 fade-in" id="progress-elements">
                     <i class="fas fa-th text-gray-600 mb-3 transform transition-all duration-300 hover:scale-110"></i>
                     <div class="text-sm font-medium text-gray-700">Elements</div>
                     <div class="text-xs text-gray-500 mt-1">Locked</div>
                  </div>
                  <div class="text-center p-4 bg-gray-100 rounded-lg transform transition-all duration-300 hover:scale-105 fade-in" id="progress-properties">
                     <i class="fas fa-chart-line text-gray-600 mb-3 transform transition-all duration-300 hover:scale-110"></i>
                     <div class="text-sm font-medium text-gray-700">Properties</div>
                     <div class="text-xs text-gray-500 mt-1">Locked</div>
                  </div>
                  <div class="text-center p-4 bg-gray-100 rounded-lg transform transition-all duration-300 hover:scale-105 fade-in" id="progress-quiz">
                     <i class="fas fa-graduation-cap text-gray-600 mb-3 transform transition-all duration-300 hover:scale-110"></i>
                     <div class="text-sm font-medium text-gray-700">Quiz</div>
                     <div class="text-xs text-gray-500 mt-1">Locked</div>
                  </div>
               </div>
            </div>
            <!-- Overview Section -->
            <section id="overview-section" class="content-section">
               <div class="content-card fade-in">
                  <h3 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                     <i class="fas fa-info-circle mr-3 text-indigo-600 transform transition-all duration-300 hover:scale-110"></i>
                     Introduction to Group 1 Alkali Metals
                  </h3>
                  <div class="mb-8 fade-in">
                     <div class="bg-gradient-to-r from-blue-50 to-indigo-50 p-6 rounded-lg border-l-4 border-indigo-500 shadow-sm hover:shadow-md transition-shadow duration-300">
                        <h4 class="font-semibold text-indigo-800 mb-3">Key Concepts</h4>
                        <ul class="space-y-3 text-gray-700 fade-in-stagger">
                           <li class="flex items-start">
                              <i class="fas fa-check-circle text-green-500 mt-1 mr-3"></i>
                              <span>Group 1 elements: <span class="interactive-element font-semibold text-indigo-600" onclick="showElementQuiz('lithium')">Lithium (Li)</span>, <span class="interactive-element font-semibold text-indigo-600" onclick="showElementQuiz('sodium')">Sodium (Na)</span>, <span class="interactive-element font-semibold text-indigo-600" onclick="showElementQuiz('potassium')">Potassium (K)</span>, Rubidium (Rb), Cesium (Cs), Francium (Fr)</span>
                           </li>
                           <li class="flex items-start">
                              <i class="fas fa-check-circle text-green-500 mt-1 mr-3"></i>
                              <span>Known as <span class="interactive-element font-semibold text-indigo-600" onclick="showTermQuiz('alkali-metals')">alkali metals</span></span>
                           </li>
                           <li class="flex items-start">
                              <i class="fas fa-check-circle text-green-500 mt-1 mr-3"></i>
                              <span>Outer shell: <span class="interactive-element font-semibold text-indigo-600" onclick="showTermQuiz('valence-electron')">1 valence electron</span></span>
                           </li>
                           <li class="flex items-start">
                              <i class="fas fa-check-circle text-green-500 mt-1 mr-3"></i>
                              <span>Form +1 ions by losing this electron</span>
                           </li>
                           <li class="flex items-start">
                              <i class="fas fa-check-circle text-green-500 mt-1 mr-3"></i>
                              <span>Stored under oil to prevent reaction with air</span>
                           </li>
                        </ul>
                     </div>
                  </div>
                  <!-- Key Properties with Tooltips -->
                  <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                     <div class="bg-gradient-to-br from-blue-50 to-indigo-50 p-6 rounded-lg shadow-sm hover:shadow-md transition-shadow duration-300 fade-in">
                        <h4 class="font-semibold text-indigo-800 mb-4 flex items-center">
                           <i class="fas fa-atom mr-2"></i> Key Properties
                        </h4>
                        <ul class="space-y-3 fade-in-stagger">
                           <li><span class="interactive-element font-medium text-indigo-600" onclick="showTermQuiz('soft')">Soft metals</span></li>
                           <li><span class="interactive-element font-medium text-indigo-600" onclick="showTermQuiz('melting-point')">Low melting points</span></li>
                           <li><span class="interactive-element font-medium text-indigo-600" onclick="showTermQuiz('density')">Low densities</span></li>
                           <li><span class="interactive-element font-medium text-indigo-600" onclick="showTermQuiz('reactivity')">Reactive with water and oxygen</span></li>
                           <li><span class="interactive-element font-medium text-indigo-600" onclick="showTermQuiz('flame-test')">Characteristic flame test colors</span></li>
                        </ul>
                     </div>
                     <div class="bg-gradient-to-br from-purple-50 to-indigo-50 p-6 rounded-lg shadow-sm hover:shadow-md transition-shadow duration-300 fade-in">
                        <h4 class="font-semibold text-indigo-800 mb-4 flex items-center">
                           <i class="fas fa-chart-line mr-2"></i> Trends
                        </h4>
                        <ul class="space-y-3 fade-in-stagger">
                           <li><span class="interactive-element font-medium text-indigo-600" onclick="showTrendQuiz('melting-point')">Melting Point</span> <i class="fas fa-arrow-down text-red-500"></i> down group</li>
                           <li><span class="interactive-element font-medium text-indigo-600" onclick="showTrendQuiz('density')">Density</span> <i class="fas fa-arrow-up text-green-500"></i> down group (K exception)</li>
                           <li><span class="interactive-element font-medium text-indigo-600" onclick="showTrendQuiz('reactivity')">Reactivity</span> <i class="fas fa-arrow-up text-green-500"></i> down group</li>
                           <li>Atomic radius <i class="fas fa-arrow-up text-green-500"></i> down group</li>
                        </ul>
                     </div>
                  </div>
                  <!-- Interactive Element Quiz Popup -->
                  <div id="elementQuizPopup" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                     <div class="bg-white rounded-lg p-6 max-w-md w-full shadow-xl">
                        <h3 class="text-xl font-bold mb-4" id="elementQuizTitle">Element Quiz</h3>
                        <p id="elementQuizQuestion" class="mb-4"></p>
                        <div id="elementQuizOptions" class="space-y-2 mb-4"></div>
                        <div id="elementQuizFeedback" class="mb-4 p-3 rounded-lg hidden"></div>
                        <button onclick="closeElementQuiz()" class="btn btn-primary w-full">Close</button>
                     </div>
                  </div>
                  <!-- YouTube Video -->
                  <div class="mt-8 fade-in">
                     <h4 class="font-semibold mb-3">Learn More:</h4>
                     <div class="aspect-w-16 aspect-h-9">
                        <iframe src="https://www.youtube.com/embed/TGZs93DzMDY" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen class="w-full h-64 rounded-lg transform transition-all duration-300 hover:scale-105"></iframe>
                     </div>
                  </div>
                  <div class="flex justify-center mt-6">
                     <button id="overview-complete-btn" class="btn btn-success section-complete-btn transform transition-all duration-300 hover:scale-105 fade-in" onclick="completeSection('overview')">
                     <i class="fas fa-check mr-2"></i>
                     Mark as Complete
                     </button>
                  </div>
               </div>
            </section>
            <!-- Elements Section -->
            <section id="elements-section" class="content-section" style="display: none;">
               <div class="content-card fade-in">
                  <h3 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                     <i class="fas fa-th mr-3 text-indigo-600 transform transition-all duration-300 hover:scale-110"></i>
                     Group 1 Elements
                  </h3>
                  <!-- Interactive Periodic Table -->
                  <div class="mb-8 fade-in">
                     <h4 class="font-semibold mb-3">Interactive Periodic Table</h4>
                     <div class="periodic-table">
                        <!-- Simplified periodic table with Group 1 highlighted -->
                        <div class="element group1" data-element="Li" onclick="showElementDetails('Lithium', 'Li', 3, '2,1')">
                           <span class="element-number">3</span>
                           <span class="element-symbol">Li</span>
                           <span class="element-name">Lithium</span>
                        </div>
                        <div class="element" data-element="Na" onclick="showElementDetails('Sodium', 'Na', 11, '2,8,1')">
                           <span class="element-number">11</span>
                           <span class="element-symbol">Na</span>
                           <span class="element-name">Sodium</span>
                        </div>
                        <div class="element" data-element="K" onclick="showElementDetails('Potassium', 'K', 19, '2,8,8,1')">
                           <span class="element-number">19</span>
                           <span class="element-symbol">K</span>
                           <span class="element-name">Potassium</span>
                        </div>
                        <div class="element" data-element="Rb" onclick="showElementDetails('Rubidium', 'Rb', 37, '2,8,18,8,1')">
                           <span class="element-number">37</span>
                           <span class="element-symbol">Rb</span>
                           <span class="element-name">Rubidium</span>
                        </div>
                        <div class="element" data-element="Cs" onclick="showElementDetails('Cesium', 'Cs', 55, '2,8,18,18,8,1')">
                           <span class="element-number">55</span>
                           <span class="element-symbol">Cs</span>
                           <span class="element-name">Cesium</span>
                        </div>
                        <div class="element" data-element="Fr" onclick="showElementDetails('Francium', 'Fr', 87, '2,8,18,32,18,8,1')">
                           <span class="element-number">87</span>
                           <span class="element-symbol">Fr</span>
                           <span class="element-name">Francium</span>
                        </div>
                     </div>
                  </div>
                  <!-- Element Details Modal -->
                  <div id="elementDetailsModal" class="modal">
                     <div class="modal-content">
                        <div class="flex justify-between items-center mb-6">
                           <h2 class="text-2xl font-bold text-gray-800" id="elementDetailsName">Element Details</h2>
                           <button onclick="closeElementDetails()" class="text-gray-500 hover:text-gray-700 transform transition-all duration-300 hover:scale-110">
                           <i class="fas fa-times text-xl"></i>
                           </button>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                           <div>
                              <div class="bg-gray-100 p-5 rounded-lg mb-5">
                                 <h3 class="font-semibold text-gray-800 mb-3">Atomic Information</h3>
                                 <p><strong>Symbol:</strong> <span id="elementDetailsSymbol"></span></p>
                                 <p><strong>Atomic Number:</strong> <span id="elementDetailsNumber"></span></p>
                                 <p><strong>Electron Configuration:</strong> <span id="elementDetailsConfig"></span></p>
                              </div>
                              <div class="bg-gray-100 p-5 rounded-lg">
                                 <h3 class="font-semibold text-gray-800 mb-3">Properties</h3>
                                 <p><strong>Melting Point:</strong> <span id="elementDetailsMP"></span></p>
                                 <p><strong>Density:</strong> <span id="elementDetailsDensity"></span></p>
                                 <p><strong>Reactivity:</strong> <span id="elementDetailsReactivity"></span></p>
                              </div>
                           </div>
                           <div>
                              <div class="bg-gray-100 p-5 rounded-lg mb-5">
                                 <h3 class="font-semibold text-gray-800 mb-3">Uses</h3>
                                 <p id="elementDetailsUses"></p>
                              </div>
                              <div class="bg-gray-100 p-5 rounded-lg">
                                 <h3 class="font-semibold text-gray-800 mb-3">Fun Fact</h3>
                                 <p id="elementDetailsFact"></p>
                              </div>
                           </div>
                        </div>
                        <div class="bg-blue-50 p-5 rounded-lg border-l-4 border-blue-500">
                           <h3 class="font-semibold text-blue-800 mb-3">Quick Quiz</h3>
                           <p id="elementDetailsQuizQuestion"></p>
                           <div id="elementDetailsQuizOptions" class="mt-3 space-y-2"></div>
                           <div id="elementDetailsQuizFeedback" class="mt-3 p-3 rounded-lg hidden"></div>
                        </div>
                     </div>
                  </div>
                  <div class="element-grid fade-in-stagger">
                     <div class="element-card" onclick="showElementDetails('Lithium', 'Li', 3, '2,1')">
                        <img src="https://upload.wikimedia.org/wikipedia/commons/e/ed/Lithiumcut_cropped.jpg" alt="Lithium" class="element-image">
                        <h4 class="font-bold text-lg">Lithium (Li)</h4>
                        <p class="text-sm text-gray-600">Atomic: 3</p>
                        <p class="text-sm text-gray-600">Electron: 2,1</p>
                        <div class="text-xs text-gray-500 mt-2">Lightest metal, floats on water</div>
                     </div>
                     <div class="element-card" onclick="showElementDetails('Sodium', 'Na', 11, '2,8,1')">
                        <img src="https://upload.wikimedia.org/wikipedia/commons/2/27/Na_%28Sodium%29.jpg" alt="Sodium" class="element-image">
                        <h4 class="font-bold text-lg">Sodium (Na)</h4>
                        <p class="text-sm text-gray-600">Atomic: 11</p>
                        <p class="text-sm text-gray-600">Electron: 2,8,1</p>
                        <div class="text-xs text-gray-500 mt-2">Yellow flame test, street lamps</div>
                     </div>
                     <div class="element-card" onclick="showElementDetails('Potassium', 'K', 19, '2,8,8,1')">
                        <img src="https://cdn.britannica.com/77/131177-050-79292189/fragments-Potassium-metal.jpg" alt="Potassium" class="element-image">
                        <h4 class="font-bold text-lg">Potassium (K)</h4>
                        <p class="text-sm text-gray-600">Atomic: 19</p>
                        <p class="text-sm text-gray-600">Electron: 2,8,8,1</p>
                        <div class="text-xs text-gray-500 mt-2">Violet flame, essential for life</div>
                     </div>
                     <div class="element-card" onclick="showElementDetails('Rubidium', 'Rb', 37, '2,8,18,8,1')">
                        <img src="https://upload.wikimedia.org/wikipedia/commons/c/c9/Rb5.JPG" alt="Rubidium" class="element-image">
                        <h4 class="font-bold text-lg">Rubidium (Rb)</h4>
                        <p class="text-sm text-gray-600">Atomic: 37</p>
                        <p class="text-sm text-gray-600">Electron: 2,8,18,8,1</p>
                        <div class="text-xs text-gray-500 mt-2">Used in atomic clocks</div>
                     </div>
                     <div class="element-card" onclick="showElementDetails('Cesium', 'Cs', 55, '2,8,18,18,8,1')">
                        <img src="https://upload.wikimedia.org/wikipedia/commons/3/3d/Cesium.jpg" alt="Cesium" class="element-image">
                        <h4 class="font-bold text-lg">Cesium (Cs)</h4>
                        <p class="text-sm text-gray-600">Atomic: 55</p>
                        <p class="text-sm text-gray-600">Electron: 2,8,18,18,8,1</p>
                        <div class="text-xs text-gray-500 mt-2">Most reactive, photoelectric cells</div>
                     </div>
                     <div class="element-card" onclick="showElementDetails('Francium', 'Fr', 87, '2,8,18,32,18,8,1')">
                        <img src="https://i0.wp.com/periodic-table.com/wp-content/uploads/2018/11/Francium.jpg?fit=238%2C212&ssl=1" alt="Francium" class="element-image">
                        <h4 class="font-bold text-lg">Francium (Fr)</h4>
                        <p class="text-sm text-gray-600">Atomic: 87</p>
                        <p class="text-sm text-gray-600">Electron: 2,8,18,32,18,8,1</p>
                        <div class="text-xs text-gray-500 mt-2">Radioactive, extremely rare</div>
                     </div>
                  </div>
                  <div class="flex justify-center mt-6">
                     <button id="elements-complete-btn" class="btn btn-success section-complete-btn transform transition-all duration-300 hover:scale-105 fade-in" onclick="completeSection('elements')">
                     <i class="fas fa-check mr-2"></i>
                     Mark as Complete
                     </button>
                  </div>
               </div>
            </section>
            <!-- Properties Section -->
            <section id="properties-section" class="content-section" style="display: none;">
               <div class="content-card fade-in">
                  <h3 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                     <i class="fas fa-chart-line mr-3 text-indigo-600 transform transition-all duration-300 hover:scale-110"></i>
                     Trends in Group 1
                  </h3>
                  <div class="tabs">
                     <button class="tab active" onclick="showTab('melting-point')">Melting Point</button>
                     <button class="tab" onclick="showTab('density')">Density</button>
                     <button class="tab" onclick="showTab('reactivity')">Reactivity</button>
                  </div>
                  <div id="melting-point" class="tab-content active">
                     <div class="bg-gradient-to-r from-blue-50 to-indigo-50 p-6 rounded-lg border-l-4 border-indigo-500 shadow-sm hover:shadow-md transition-shadow duration-300 mb-6 fade-in">
                        <h4 class="font-semibold text-indigo-800 mb-3">Key Points</h4>
                        <ul class="list-disc pl-6 space-y-2 text-gray-700">
                           <li>Melting point <strong>decreases</strong> down Group 1</li>
                           <li>Due to increasing atomic size and weaker metallic bonding</li>
                           <li>Li: 180.5C  Cs: 28.4C</li>
                        </ul>
                     </div>
                     <!-- Trend Explanation Modal -->
                     <div id="trendExplanationModal" class="modal">
                        <div class="modal-content">
                           <div class="flex justify-between items-center mb-6">
                              <h2 class="text-2xl font-bold text-gray-800" id="trendExplanationTitle">Trend Explanation</h2>
                              <button onclick="closeTrendExplanation()" class="text-gray-500 hover:text-gray-700 transform transition-all duration-300 hover:scale-110">
                              <i class="fas fa-times text-xl"></i>
                              </button>
                           </div>
                           <div class="mb-6">
                              <h3 class="text-lg font-semibold mb-3" id="trendExplanationHeading">Heading</h3>
                              <p id="trendExplanationContent" class="text-gray-700 mb-5"></p>
                              <div class="bg-blue-50 p-5 rounded-lg border-l-4 border-blue-500">
                                 <h4 class="font-semibold text-blue-800 mb-3">Quick Quiz</h4>
                                 <p id="trendExplanationQuizQuestion"></p>
                                 <div id="trendExplanationQuizOptions" class="mt-3 space-y-2"></div>
                                 <div id="trendExplanationQuizFeedback" class="mt-3 p-3 rounded-lg hidden"></div>
                              </div>
                           </div>
                        </div>
                     </div>
                  </div>
                  <div id="density" class="tab-content">
                     <div class="bg-gradient-to-r from-blue-50 to-indigo-50 p-6 rounded-lg border-l-4 border-indigo-500 shadow-sm hover:shadow-md transition-shadow duration-300 mb-6 fade-in">
                        <h4 class="font-semibold text-indigo-800 mb-3">Key Points</h4>
                        <ul class="list-disc pl-6 space-y-2 text-gray-700">
                           <li>Density generally <strong>increases</strong> down Group 1</li>
                           <li>Exception: Potassium (0.89 g/cm) is less dense than Sodium (0.97 g/cm)</li>
                           <li>Li: 0.53 g/cm  Cs: 1.93 g/cm</li>
                        </ul>
                     </div>
                     <table class="trend-table fade-in">
                        <thead>
                           <tr>
                              <th>Element</th>
                              <th>Density (g/cm)</th>
                              <th>Trend Explanation</th>
                           </tr>
                        </thead>
                        <tbody>
                           <tr onclick="showTrendExplanation('density', 'lithium')">
                              <td>Lithium</td>
                              <td>0.534</td>
                              <td>Lowest density, floats on water</td>
                           </tr>
                           <tr onclick="showTrendExplanation('density', 'sodium')">
                              <td>Sodium</td>
                              <td>0.968</td>
                              <td>Denser than lithium but still floats</td>
                           </tr>
                           <tr onclick="showTrendExplanation('density', 'potassium')">
                              <td>Potassium</td>
                              <td>0.89</td>
                              <td>Anomaly - less dense than sodium</td>
                           </tr>
                           <tr onclick="showTrendExplanation('density', 'rubidium')">
                              <td>Rubidium</td>
                              <td>1.532</td>
                              <td>Significantly denser, sinks in water</td>
                           </tr>
                           <tr onclick="showTrendExplanation('density', 'cesium')">
                              <td>Cesium</td>
                              <td>1.93</td>
                              <td>Densest in the group</td>
                           </tr>
                        </tbody>
                     </table>
                  </div>
                  <div id="reactivity" class="tab-content">
                     <div class="bg-gradient-to-r from-blue-50 to-indigo-50 p-6 rounded-lg border-l-4 border-indigo-500 shadow-sm hover:shadow-md transition-shadow duration-300 mb-6 fade-in">
                        <h4 class="font-semibold text-indigo-800 mb-3">Key Points</h4>
                        <ul class="list-disc pl-6 space-y-2 text-gray-700">
                           <li>Reactivity <strong>increases</strong> down Group 1</li>
                           <li>Outer electron further from nucleus, easier to lose</li>
                           <li>Reaction with water becomes more vigorous</li>
                        </ul>
                     </div>
                     <div class="highlight-box fade-in">
                        <h4>Reactivity Series</h4>
                        <p>Most Reactive: Cesium > Rubidium > Potassium > Sodium > Lithium :Least Reactive</p>
                     </div>
                     <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-8 fade-in-stagger">
                        <div class="bg-gradient-to-br from-red-50 to-orange-50 p-6 rounded-lg shadow-sm hover:shadow-md transition-shadow duration-300">
                           <h4 class="font-semibold text-red-800 mb-3">Lithium Reaction</h4>
                           <p class="text-gray-700">Fizzes steadily with water, moves slowly on surface</p>
                           <button onclick="showReactionVideo('lithium')" class="btn btn-primary btn-sm mt-3">Watch Reaction</button>
                        </div>
                        <div class="bg-gradient-to-br from-orange-50 to-yellow-50 p-6 rounded-lg shadow-sm hover:shadow-md transition-shadow duration-300">
                           <h4 class="font-semibold text-orange-800 mb-3">Sodium Reaction</h4>
                           <p class="text-gray-700">Fizzes rapidly, melts into a ball, moves quickly</p>
                           <button onclick="showReactionVideo('sodium')" class="btn btn-primary btn-sm mt-3">Watch Reaction</button>
                        </div>
                        <div class="bg-gradient-to-br from-yellow-50 to-green-50 p-6 rounded-lg shadow-sm hover:shadow-md transition-shadow duration-300">
                           <h4 class="font-semibold text-yellow-800 mb-3">Potassium Reaction</h4>
                           <p class="text-gray-700">Fizzes violently, ignites with lilac flame</p>
                           <button onclick="showReactionVideo('potassium')" class="btn btn-primary btn-sm mt-3">Watch Reaction</button>
                        </div>
                        <div class="bg-gradient-to-br from-green-50 to-blue-50 p-6 rounded-lg shadow-sm hover:shadow-md transition-shadow duration-300">
                           <h4 class="font-semibold text-green-800 mb-3">Cesium Reaction</h4>
                           <p class="text-gray-700">Explodes on contact with water</p>
                           <button onclick="showReactionVideo('cesium')" class="btn btn-primary btn-sm mt-3">Watch Reaction</button>
                        </div>
                     </div>
                  </div>
                  <div class="flex justify-center mt-6">
                     <button id="properties-complete-btn" class="btn btn-success section-complete-btn transform transition-all duration-300 hover:scale-105 fade-in" onclick="completeSection('properties')">
                     <i class="fas fa-check mr-2"></i>
                     Mark as Complete
                     </button>
                  </div>
               </div>
            </section>
            <!-- Reactions Section -->
            <section id="reactions-section" class="content-section" style="display: none;">
               <div class="content-card fade-in">
                  <h3 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                     <i class="fas fa-flask mr-3 text-indigo-600 transform transition-all duration-300 hover:scale-110"></i>
                     Reactions of Group 1 Metals
                  </h3>
                  <div class="tabs">
                     <button class="tab active" onclick="showTab('water')">With Water</button>
                     <button class="tab" onclick="showTab('oxygen')">With Oxygen</button>
                  </div>
                  <div id="water" class="tab-content active">
                     <div class="bg-gradient-to-r from-blue-50 to-indigo-50 p-6 rounded-lg border-l-4 border-indigo-500 shadow-sm hover:shadow-md transition-shadow duration-300 mb-6 fade-in">
                        <h4 class="font-semibold text-indigo-800 mb-3">Key Points</h4>
                        <ul class="list-disc pl-6 space-y-2 text-gray-700">
                           <li>All Group 1 metals react with water</li>
                           <li>Products: Metal hydroxide + Hydrogen gas</li>
                           <li>Reactivity increases down the group</li>
                        </ul>
                     </div>
                     <div class="equation-box fade-in">
                        <p class="text-gray-700 mb-3">General equation:</p>
                        <p class="equation">2M(s) + 2HO(l)  2MOH(aq) + H(g)</p>
                     </div>
                     <div class="highlight-box fade-in">
                        <h4>Observations</h4>
                        <ul class="list-disc pl-6 space-y-1">
                           <li><strong>Lithium:</strong> Fizzes steadily</li>
                           <li><strong>Sodium:</strong> Fizzes rapidly, melts into a ball</li>
                           <li><strong>Potassium:</strong> Fizzes violently, ignites with lilac flame</li>
                        </ul>
                     </div>
                     <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mt-8 fade-in-stagger">
                        <div class="bg-gradient-to-br from-blue-50 to-indigo-50 p-6 rounded-lg shadow-sm hover:shadow-md transition-shadow duration-300">
                           <h4 class="font-semibold text-blue-800 mb-3">Lithium + Water</h4>
                           <p class="equation text-sm">2Li(s) + 2HO(l)  2LiOH(aq) + H(g)</p>
                           <button onclick="showReactionDetails('lithium-water')" class="btn btn-primary btn-sm mt-3">View Details</button>
                        </div>
                        <div class="bg-gradient-to-br from-purple-50 to-indigo-50 p-6 rounded-lg shadow-sm hover:shadow-md transition-shadow duration-300">
                           <h4 class="font-semibold text-purple-800 mb-3">Sodium + Water</h4>
                           <p class="equation text-sm">2Na(s) + 2HO(l)  2NaOH(aq) + H(g)</p>
                           <button onclick="showReactionDetails('sodium-water')" class="btn btn-primary btn-sm mt-3">View Details</button>
                        </div>
                        <div class="bg-gradient-to-br from-pink-50 to-purple-50 p-6 rounded-lg shadow-sm hover:shadow-md transition-shadow duration-300">
                           <h4 class="font-semibold text-pink-800 mb-3">Potassium + Water</h4>
                           <p class="equation text-sm">2K(s) + 2HO(l)  2KOH(aq) + H(g)</p>
                           <button onclick="showReactionDetails('potassium-water')" class="btn btn-primary btn-sm mt-3">View Details</button>
                        </div>
                     </div>
                  </div>
                  <div id="oxygen" class="tab-content">
                     <div class="bg-gradient-to-r from-blue-50 to-indigo-50 p-6 rounded-lg border-l-4 border-indigo-500 shadow-sm hover:shadow-md transition-shadow duration-300 mb-6 fade-in">
                        <h4 class="font-semibold text-indigo-800 mb-3">Key Points</h4>
                        <ul class="list-disc pl-6 space-y-2 text-gray-700">
                           <li>Group 1 metals react with oxygen when heated</li>
                           <li>Form different types of oxides down the group</li>
                        </ul>
                     </div>
                     <div class="grid grid-cols-1 md:grid-cols-3 gap-6 fade-in-stagger">
                        <div class="bg-gradient-to-br from-blue-50 to-indigo-50 p-6 rounded-lg shadow-sm hover:shadow-md transition-shadow duration-300">
                           <h5 class="font-semibold text-blue-800">Lithium</h5>
                           <p class="text-blue-600">Forms LiO (oxide)</p>
                           <p class="equation text-sm mt-3">4Li(s) + O(g)  2LiO(s)</p>
                           <button onclick="showReactionDetails('lithium-oxygen')" class="btn btn-primary btn-sm mt-3">View Details</button>
                        </div>
                        <div class="bg-gradient-to-br from-green-50 to-emerald-50 p-6 rounded-lg shadow-sm hover:shadow-md transition-shadow duration-300">
                           <h5 class="font-semibold text-green-800">Sodium</h5>
                           <p class="text-green-600">Forms NaO (peroxide)</p>
                           <p class="equation text-sm mt-3">2Na(s) + O(g)  NaO(s)</p>
                           <button onclick="showReactionDetails('sodium-oxygen')" class="btn btn-primary btn-sm mt-3">View Details</button>
                        </div>
                        <div class="bg-gradient-to-br from-purple-50 to-pink-50 p-6 rounded-lg shadow-sm hover:shadow-md transition-shadow duration-300">
                           <h5 class="font-semibold text-purple-800">Potassium</h5>
                           <p class="text-purple-600">Forms KO (superoxide)</p>
                           <p class="equation text-sm mt-3">K(s) + O(g)  KO(s)</p>
                           <button onclick="showReactionDetails('potassium-oxygen')" class="btn btn-primary btn-sm mt-3">View Details</button>
                        </div>
                     </div>
                     <div class="bg-gradient-to-r from-yellow-50 to-orange-50 p-6 rounded-lg border-l-4 border-orange-500 shadow-sm hover:shadow-md transition-shadow duration-300 mt-8 fade-in">
                        <h4 class="font-semibold text-orange-800 mb-3">Trend in Oxide Formation</h4>
                        <p class="text-gray-700">As we move down Group 1, the type of oxide formed changes from normal oxides (Li) to peroxides (Na) to superoxides (K, Rb, Cs). This is due to the increasing size of the metal ion, which can stabilize larger oxygen-containing anions.</p>
                        <button onclick="showOxideTrendQuiz()" class="btn btn-primary btn-sm mt-3">Test Your Knowledge</button>
                     </div>
                  </div>
                  <!-- Reaction Details Modal -->
                  <div id="reactionDetailsModal" class="modal">
                     <div class="modal-content">
                        <div class="flex justify-between items-center mb-6">
                           <h2 class="text-2xl font-bold text-gray-800" id="reactionDetailsTitle">Reaction Details</h2>
                           <button onclick="closeReactionDetails()" class="text-gray-500 hover:text-gray-700 transform transition-all duration-300 hover:scale-110">
                           <i class="fas fa-times text-xl"></i>
                           </button>
                        </div>
                        <div class="mb-6">
                           <div class="bg-gray-100 p-5 rounded-lg mb-5">
                              <h3 class="font-semibold text-gray-800 mb-3">Chemical Equation</h3>
                              <p class="equation text-lg" id="reactionDetailsEquation"></p>
                           </div>
                           <div class="bg-gray-100 p-5 rounded-lg mb-5">
                              <h3 class="font-semibold text-gray-800 mb-3">Observations</h3>
                              <p id="reactionDetailsObservations"></p>
                           </div>
                           <div class="bg-gray-100 p-5 rounded-lg mb-5">
                              <h3 class="font-semibold text-gray-800 mb-3">Explanation</h3>
                              <p id="reactionDetailsExplanation"></p>
                           </div>
                           <div class="bg-blue-50 p-5 rounded-lg border-l-4 border-blue-500">
                              <h4 class="font-semibold text-blue-800 mb-3">Quick Quiz</h4>
                              <p id="reactionDetailsQuizQuestion"></p>
                              <div id="reactionDetailsQuizOptions" class="mt-3 space-y-2"></div>
                              <div id="reactionDetailsQuizFeedback" class="mt-3 p-3 rounded-lg hidden"></div>
                           </div>
                        </div>
                     </div>
                  </div>
                  <div class="flex justify-center mt-6">
                     <button id="reactions-complete-btn" class="btn btn-success section-complete-btn transform transition-all duration-300 hover:scale-105 fade-in" onclick="completeSection('reactions')">
                     <i class="fas fa-check mr-2"></i>
                     Mark as Complete
                     </button>
                  </div>
               </div>
            </section>
            <!-- Quiz Section -->
            <section id="quiz-section" class="content-section" style="display: none;">
               <div class="content-card fade-in">
                  <h3 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                     <i class="fas fa-graduation-cap mr-3 text-indigo-600 transform transition-all duration-300 hover:scale-110"></i>
                     Test Your Knowledge
                  </h3>
                  <div class="bg-gradient-to-r from-indigo-50 to-purple-50 p-8 rounded-lg border-l-4 border-indigo-500 shadow-sm hover:shadow-md transition-shadow duration-300 mb-8">
                     <div class="flex items-center mb-6">
                        <i class="fas fa-info-circle text-indigo-600 text-3xl mr-4"></i>
                        <div>
                           <h4 class="font-semibold text-indigo-800">Quiz Instructions</h4>
                           <p class="text-gray-700">This quiz contains 10 multiple-choice questions about Group 1 Alkali Metals. Take your time to answer each question carefully. You can navigate between questions using the Previous and Next buttons.</p>
                        </div>
                     </div>
                     <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mt-6">
                        <div class="bg-white p-5 rounded-lg shadow-sm">
                           <div class="text-3xl font-bold text-indigo-600">10</div>
                           <div class="text-sm text-gray-600">Questions</div>
                        </div>
                        <div class="bg-white p-5 rounded-lg shadow-sm">
                           <div class="text-3xl font-bold text-indigo-600">5 min</div>
                           <div class="text-sm text-gray-600">Time Limit</div>
                        </div>
                        <div class="bg-white p-5 rounded-lg shadow-sm">
                           <div class="text-3xl font-bold text-indigo-600">80%</div>
                           <div class="text-sm text-gray-600">Passing Score</div>
                        </div>
                     </div>
                  </div>
                  <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
                     <div class="bg-gradient-to-br from-green-50 to-emerald-50 p-6 rounded-lg shadow-sm hover:shadow-md transition-shadow duration-300">
                        <h4 class="font-semibold text-green-800 mb-3 flex items-center">
                           <i class="fas fa-trophy mr-2"></i> Rewards
                        </h4>
                        <ul class="space-y-3 text-gray-700">
                           <li class="flex items-start">
                              <i class="fas fa-star text-yellow-500 mt-1 mr-3"></i>
                              <span>Earn up to 20 XP points</span>
                           </li>
                           <li class="flex items-start">
                              <i class="fas fa-medal text-yellow-500 mt-1 mr-3"></i>
                              <span>Unlock "Quiz Master" badge with 80%+ score</span>
                           </li>
                           <li class="flex items-start">
                              <i class="fas fa-certificate text-yellow-500 mt-1 mr-3"></i>
                              <span>Get completion certificate</span>
                           </li>
                        </ul>
                     </div>
                     <div class="bg-gradient-to-br from-blue-50 to-indigo-50 p-6 rounded-lg shadow-sm hover:shadow-md transition-shadow duration-300">
                        <h4 class="font-semibold text-blue-800 mb-3 flex items-center">
                           <i class="fas fa-lightbulb mr-2"></i> Tips
                        </h4>
                        <ul class="space-y-3 text-gray-700">
                           <li class="flex items-start">
                              <i class="fas fa-check-circle text-green-500 mt-1 mr-3"></i>
                              <span>Review all sections before attempting</span>
                           </li>
                           <li class="flex items-start">
                              <i class="fas fa-check-circle text-green-500 mt-1 mr-3"></i>
                              <span>Pay attention to trends down the group</span>
                           </li>
                           <li class="flex items-start">
                              <i class="fas fa-check-circle text-green-500 mt-1 mr-3"></i>
                              <span>Remember the exceptions (like potassium's density)</span>
                           </li>
                        </ul>
                     </div>
                  </div>
                  <div class="text-center">
                     <button onclick="startQuiz()" class="btn btn-primary transform transition-all duration-300 hover:scale-105">
                     <i class="fas fa-play mr-2"></i>
                     Start Quiz
                     </button>
                  </div>
               </div>
            </section>
            <!-- Discussion Section -->
            <section id="discussion-section" class="content-section" style="display: none;">
               <div class="content-card fade-in">
                  <div class="flex justify-between items-center mb-8">
                     <h3 class="text-2xl font-bold text-gray-800 flex items-center">
                        <i class="fas fa-comments mr-3 text-indigo-600 transform transition-all duration-300 hover:scale-110"></i>
                        Discussion Forum
                     </h3>
                     <button onclick="showCreatePostModal()" class="btn btn-primary transform transition-all duration-300 hover:scale-105">
                     <i class="fas fa-plus mr-2"></i>
                     New Post
                     </button>
                  </div>
                  <!-- Discussion Controls -->
                  <div class="flex flex-col md:flex-row gap-4 mb-8">
                     <div class="search-box flex-1">
                        <i class="fas fa-search"></i>
                        <input type="text" id="discussionSearch" placeholder="Search discussions..." onkeyup="filterDiscussions()">
                     </div>
                     <div class="flex gap-3">
                        <button class="filter-btn active px-5 py-2 bg-indigo-600 text-white rounded-lg" onclick="sortDiscussions('newest')">Newest</button>
                        <button class="filter-btn px-5 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300" onclick="sortDiscussions('oldest')">Oldest</button>
                        <button class="filter-btn px-5 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300" onclick="sortDiscussions('popular')">Most Popular</button>
                     </div>
                  </div>
                  <div id="discussionPosts">
                     <div class="empty-state">
                        <div class="empty-state-icon">
                           <i class="fas fa-comments"></i>
                        </div>
                        <h3 class="empty-state-title">No Posts Yet</h3>
                        <p class="empty-state-description">Be the first to start a discussion about Group 1 Alkali Metals.</p>
                     </div>
                  </div>
               </div>
            </section>
            <!-- Study Groups Section -->
            <section id="study-groups-section" class="content-section" style="display: none;">
               <div class="content-card fade-in">
                  <div class="flex justify-between items-center mb-8">
                     <h3 class="text-2xl font-bold text-gray-800 flex items-center">
                        <i class="fas fa-users mr-3 text-indigo-600 transform transition-all duration-300 hover:scale-110"></i>
                        Study Groups
                     </h3>
                     <button onclick="showCreateGroupModal()" class="btn btn-primary transform transition-all duration-300 hover:scale-105">
                     <i class="fas fa-plus mr-2"></i>
                     Create Group
                     </button>
                  </div>
                  <div id="studyGroupsList">
                     <div class="empty-state">
                        <div class="empty-state-icon">
                           <i class="fas fa-users"></i>
                        </div>
                        <h3 class="empty-state-title">No Study Groups Yet</h3>
                        <p class="empty-state-description">Create your first study group to collaborate with peers.</p>
                     </div>
                  </div>
               </div>
            </section>
            <!-- Leaderboard Section -->
            <section id="leaderboard-section" class="content-section" style="display: none;">
               <div class="content-card fade-in">
                  <h3 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                     <i class="fas fa-trophy mr-3 text-indigo-600 transform transition-all duration-300 hover:scale-110"></i>
                     Leaderboard
                  </h3>
                  <div id="leaderboardContent">
                     <div class="spinner"></div>
                  </div>
               </div>
            </section>
         </main>
      </div>
      <!-- Login Modal -->
      <div id="loginModal" class="modal">
         <div class="modal-content">
            <div class="flex justify-between items-center mb-8">
               <h2 class="text-2xl font-bold text-gray-800">Welcome to Chemistry Mastery</h2>
               <button onclick="closeLoginModal()" class="text-gray-500 hover:text-gray-700 transform transition-all duration-300 hover:scale-110">
               <i class="fas fa-times text-xl"></i>
               </button>
            </div>
            <div class="mb-8">
               <button onclick="signInWithGoogle()" class="btn btn-primary w-full transform transition-all duration-300 hover:scale-105">
               <i class="fab fa-google mr-2"></i>
               Sign in with Google
               </button>
            </div>
            <div class="text-center text-gray-600">
               <p>Or continue with email</p>
            </div>
            <form id="loginForm" class="mt-8 space-y-5" onsubmit="handleEmailLogin(event)">
               <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                  <input type="email" id="loginEmail" class="w-full px-5 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
               </div>
               <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">Password</label>
                  <input type="password" id="loginPassword" class="w-full px-5 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
               </div>
               <button type="submit" class="btn btn-primary w-full transform transition-all duration-300 hover:scale-105">
               <i class="fas fa-sign-in-alt mr-2"></i>
               Sign In
               </button>
            </form>
            <div class="mt-8 text-center">
               <p class="text-sm text-gray-600">Don't have an account? <a href="#" onclick="showSignup()" class="text-indigo-600 hover:text-indigo-800">Sign up</a></p>
            </div>
         </div>
      </div>
      <!-- Signup Modal -->
      <div id="signupModal" class="modal">
         <div class="modal-content">
            <div class="flex justify-between items-center mb-8">
               <h2 class="text-2xl font-bold text-gray-800">Create Account</h2>
               <button onclick="closeSignupModal()" class="text-gray-500 hover:text-gray-700 transform transition-all duration-300 hover:scale-110">
               <i class="fas fa-times text-xl"></i>
               </button>
            </div>
            <form id="signupForm" class="space-y-5" onsubmit="handleSignup(event)">
               <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">Full Name</label>
                  <input type="text" id="signupName" class="w-full px-5 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
               </div>
               <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                  <input type="email" id="signupEmail" class="w-full px-5 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
               </div>
               <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">Password</label>
                  <input type="password" id="signupPassword" class="w-full px-5 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
               </div>
               <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">Confirm Password</label>
                  <input type="password" id="signupConfirmPassword" class="w-full px-5 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
               </div>
               <button type="submit" class="btn btn-primary w-full transform transition-all duration-300 hover:scale-105">
               <i class="fas fa-user-plus mr-2"></i>
               Create Account
               </button>
            </form>
            <div class="mt-8 text-center">
               <p class="text-sm text-gray-600">Already have an account? <a href="#" onclick="showLogin()" class="text-indigo-600 hover:text-indigo-800">Sign in</a></p>
            </div>
         </div>
      </div>
      <!-- Create Post Modal -->
      <div id="createPostModal" class="modal">
         <div class="modal-content">
            <div class="flex justify-between items-center mb-8">
               <h2 class="text-2xl font-bold text-gray-800">Create New Post</h2>
               <button onclick="closeCreatePostModal()" class="text-gray-500 hover:text-gray-700 transform transition-all duration-300 hover:scale-110">
               <i class="fas fa-times text-xl"></i>
               </button>
            </div>
            <form id="createPostForm" class="space-y-5" onsubmit="handleCreatePost(event)">
               <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">Title</label>
                  <input type="text" id="postTitle" class="w-full px-5 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" placeholder="Enter post title" required>
               </div>
               <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">Content</label>
                  <textarea id="postContent" class="w-full px-5 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 form-textarea" placeholder="What would you like to discuss?" required></textarea>
               </div>
               <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">Tags (comma separated)</label>
                  <input type="text" id="postTags" class="w-full px-5 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" placeholder="e.g., melting-point, reactivity, questions">
               </div>
               <button type="submit" class="btn btn-primary w-full transform transition-all duration-300 hover:scale-105">
               <i class="fas fa-paper-plane mr-2"></i>
               Post
               </button>
            </form>
         </div>
      </div>
      <!-- Edit Post Modal -->
      <div id="editPostModal" class="modal">
         <div class="modal-content">
            <div class="flex justify-between items-center mb-8">
               <h2 class="text-2xl font-bold text-gray-800">Edit Post</h2>
               <button onclick="closeEditPostModal()" class="text-gray-500 hover:text-gray-700 transform transition-all duration-300 hover:scale-110">
               <i class="fas fa-times text-xl"></i>
               </button>
            </div>
            <form id="editPostForm" class="space-y-5" onsubmit="handleEditPost(event)">
               <input type="hidden" id="editPostId">
               <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">Title</label>
                  <input type="text" id="editPostTitle" class="w-full px-5 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" placeholder="Enter post title" required>
               </div>
               <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">Content</label>
                  <textarea id="editPostContent" class="w-full px-5 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 form-textarea" placeholder="What would you like to discuss?" required></textarea>
               </div>
               <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">Tags (comma separated)</label>
                  <input type="text" id="editPostTags" class="w-full px-5 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" placeholder="e.g., melting-point, reactivity, questions">
               </div>
               <button type="submit" class="btn btn-primary w-full transform transition-all duration-300 hover:scale-105">
               <i class="fas fa-save mr-2"></i>
               Save Changes
               </button>
            </form>
         </div>
      </div>
      <!-- Create Study Group Modal -->
      <div id="createGroupModal" class="modal">
         <div class="modal-content">
            <div class="flex justify-between items-center mb-8">
               <h2 class="text-2xl font-bold text-gray-800">Create Study Group</h2>
               <button onclick="closeCreateGroupModal()" class="text-gray-500 hover:text-gray-700 transform transition-all duration-300 hover:scale-110">
               <i class="fas fa-times text-xl"></i>
               </button>
            </div>
            <form id="createGroupForm" class="space-y-5" onsubmit="handleCreateGroup(event)">
               <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">Group Name</label>
                  <input type="text" id="groupName" class="w-full px-5 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" placeholder="Enter group name" required>
               </div>
               <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">Topic</label>
                  <select id="groupTopic" class="w-full px-5 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" required>
                     <option value="">Select a topic</option>
                     <option value="melting-point">Melting Point Trends</option>
                     <option value="density">Density Trends</option>
                     <option value="reactivity">Reactivity Series</option>
                     <option value="reactions">Chemical Reactions</option>
                     <option value="electron-configuration">Electron Configuration</option>
                     <option value="experiments">Laboratory Experiments</option>
                     <option value="exam-prep">Exam Preparation</option>
                  </select>
               </div>
               <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">Description</label>
                  <textarea id="groupDescription" class="w-full px-5 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 form-textarea" placeholder="Describe what this group will focus on" required></textarea>
               </div>
               <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">Max Members</label>
                  <select id="groupMaxMembers" class="w-full px-5 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" required>
                     <option value="5">5 members</option>
                     <option value="10">10 members</option>
                     <option value="15">15 members</option>
                     <option value="20">20 members</option>
                  </select>
               </div>
               <button type="submit" class="btn btn-primary w-full transform transition-all duration-300 hover:scale-105">
               <i class="fas fa-plus mr-2"></i>
               Create Group
               </button>
            </form>
         </div>
      </div>
      <!-- Study Group Details Modal -->
      <div id="groupDetailsModal" class="modal modal-lg">
         <div class="modal-content">
            <div class="flex justify-between items-center mb-8">
               <h2 class="text-2xl font-bold text-gray-800" id="groupDetailsTitle">Study Group Details</h2>
               <button onclick="closeGroupDetailsModal()" class="text-gray-500 hover:text-gray-700 transform transition-all duration-300 hover:scale-110">
               <i class="fas fa-times text-xl"></i>
               </button>
            </div>
            <div id="groupDetailsContent">
               <!-- Group details will be loaded here -->
            </div>
         </div>
      </div>
      <!-- Quiz Modal -->
      <div id="quizModal" class="modal quiz-modal">
         <div class="modal-content">
            <div class="flex justify-between items-center mb-6">
               <h2 class="text-xl font-bold text-gray-800">Group 1 Quiz</h2>
               <button onclick="closeQuiz()" class="text-gray-500 hover:text-gray-700 transform transition-all duration-300 hover:scale-110">
               <i class="fas fa-times text-xl"></i>
               </button>
            </div>
            <div id="quizProgress" class="mb-6">
               <div class="flex justify-between items-center mb-3">
                  <span class="text-sm text-gray-600">Question <span id="currentQuestion">1</span> of <span id="totalQuestions">10</span></span>
                  <span class="text-sm text-gray-600">Score: <span id="currentScore">0</span></span>
               </div>
               <div class="progress-bar">
                  <div class="progress-fill" id="progressFill" style="width: 10%"></div>
               </div>
            </div>
            <div id="quizContent">
               <div class="mb-8">
                  <h3 class="text-lg font-semibold mb-5" id="questionText">Loading question...</h3>
                  <div id="optionsContainer"></div>
               </div>
               <div id="feedback" class="hidden mb-5 p-4 rounded-lg text-sm"></div>
               <div class="flex justify-between items-center">
                  <button id="prevButton" class="btn btn-secondary hidden" onclick="previousQuestion()">
                  <i class="fas fa-arrow-left"></i>
                  Previous
                  </button>
                  <div class="flex gap-3">
                     <button id="submitButton" class="btn btn-primary" onclick="submitAnswer()">
                     Submit Answer
                     </button>
                     <button id="nextButton" class="btn btn-primary hidden" onclick="nextQuestion()">
                     Next
                     <i class="fas fa-arrow-right ml-1"></i>
                     </button>
                  </div>
               </div>
            </div>
            <div id="quizResults" class="hidden text-center">
               <i class="fas fa-trophy text-5xl text-yellow-500 mb-6"></i>
               <h3 class="text-2xl font-bold mb-4">Quiz Complete!</h3>
               <div class="text-4xl font-bold text-indigo-600 mb-4" id="finalScore">0/10</div>
               <p class="text-gray-600 mb-8" id="scoreMessage">Great job!</p>
               <button onclick="closeQuiz()" class="btn btn-primary transform transition-all duration-300 hover:scale-105">
               <i class="fas fa-check"></i>
               Finish
               </button>
            </div>
         </div>
      </div>
      <!-- Feedback Modal -->
      <div id="feedbackModal" class="modal">
         <div class="modal-content">
            <div class="flex justify-between items-center mb-8">
               <h2 class="text-2xl font-bold text-gray-800">Send Feedback</h2>
               <button onclick="closeFeedbackModal()" class="text-gray-500 hover:text-gray-700 transform transition-all duration-300 hover:scale-110">
               <i class="fas fa-times text-xl"></i>
               </button>
            </div>
            <form id="feedbackForm" class="space-y-5" onsubmit="handleFeedback(event)">
               <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">Your Feedback</label>
                  <textarea id="feedbackText" class="w-full px-5 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 form-textarea" placeholder="What do you think about this app?" required></textarea>
               </div>
               <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">Rate your experience</label>
                  <div class="reaction-buttons">
                     <button type="button" class="reaction-btn" id="thumbsDownBtn" onclick="setFeedbackRating(1)">
                     <i class="fas fa-thumbs-down"></i>
                     <span>Thumbs Down</span>
                     </button>
                     <button type="button" class="reaction-btn" id="thumbsUpBtn" onclick="setFeedbackRating(2)">
                     <i class="fas fa-thumbs-up"></i>
                     <span>Thumbs Up</span>
                     </button>
                  </div>
                  <input type="hidden" id="feedbackRating" value="0">
               </div>
               <button type="submit" class="btn btn-primary w-full transform transition-all duration-300 hover:scale-105">
               <i class="fas fa-paper-plane mr-2"></i>
               Send Feedback
               </button>
            </form>
         </div>
      </div>
      <!-- Daily Challenge Modal -->
      <div id="dailyChallengeModal" class="modal">
         <div class="modal-content">
            <div class="flex justify-between items-center mb-8">
               <h2 class="text-2xl font-bold text-gray-800">Daily Challenge</h2>
               <button onclick="closeDailyChallengeModal()" class="text-gray-500 hover:text-gray-700 transform transition-all duration-300 hover:scale-110">
               <i class="fas fa-times text-xl"></i>
               </button>
            </div>
            <div class="mb-6">
               <h3 class="text-lg font-semibold mb-4" id="dailyChallengeQuestionText">Loading daily challenge...</h3>
               <div id="dailyChallengeOptions"></div>
            </div>
            <div id="dailyChallengeFeedback" class="hidden mb-5 p-4 rounded-lg text-sm"></div>
            <div class="flex justify-between items-center">
               <button onclick="closeDailyChallengeModal()" class="btn btn-secondary transform transition-all duration-300 hover:scale-105">
               Skip
               </button>
               <button id="dailyChallengeSubmitBtn" class="btn btn-primary transform transition-all duration-300 hover:scale-105" onclick="submitDailyChallenge()">
               Submit Answer
               </button>
            </div>
         </div>
      </div>
      <!-- Quiz Question Modal -->
      <div id="quizQuestionModal" class="modal quiz-question-modal">
         <div class="modal-content">
            <div class="flex justify-between items-center mb-8">
               <h2 class="text-2xl font-bold text-gray-800" id="quizQuestionTitle">Quick Quiz</h2>
               <button onclick="closeQuizQuestionModal()" class="text-gray-500 hover:text-gray-700 transform transition-all duration-300 hover:scale-110">
               <i class="fas fa-times text-xl"></i>
               </button>
            </div>
            <div class="mb-8">
               <div class="quiz-question" id="quizQuestionText">Loading question...</div>
               <div id="quizQuestionAnswers"></div>
               <div id="quizQuestionFeedback" class="quiz-feedback hidden"></div>
            </div>
            <div class="flex justify-end">
               <button onclick="closeQuizQuestionModal()" class="btn btn-secondary mr-3 transform transition-all duration-300 hover:scale-105">
               Close
               </button>
            </div>
         </div>
      </div>
      <!-- Toast Container -->
      <div id="toastContainer"></div>
      <script>
         // Firebase configuration
         const firebaseConfig = {
             apiKey: "AIzaSyBOp4x0lTFvmt2s3MQKBRYmZT9IJ2ZaRi8",
             authDomain: "group-1-alkali-metals.firebaseapp.com",
             databaseURL: "https://group-1-alkali-metals-default-rtdb.firebaseio.com",
             projectId: "group-1-alkali-metals",
             storageBucket: "group-1-alkali-metals.firebasestorage.app",
             messagingSenderId: "806417495419",
             appId: "1:806417495419:web:5b80607e8a23e96da4f9de",
             measurementId: "G-S76E52MQ37"
         };
         // Initialize Firebase
         firebase.initializeApp(firebaseConfig);
         const auth = firebase.auth();
         const database = firebase.database();
         // Global variables
         let currentUser = null;
         let userData = null;
         let currentSection = 'overview';
         let completedSections = [];
         let quizQuestions = [];
         let currentQuestion = 0;
         let score = 0;
         let selectedOption = null;
         let answerSubmitted = false;
         let quizAnswers = []; // To store answers for each question
         let discussionPosts = [];
         let studyGroups = [];
         let currentSort = 'newest';
         let soundEnabled = true;
         let dailyChallenge = null;
         let dailyChallengeAnswered = false;
         let fadeObserver = null; // Store the observer globally
         
         // Quiz questions for terms
         const termQuizQuestions = {
             'lithium': {
                 question: "What is the atomic number of Lithium?",
                 options: ["1", "2", "3", "4"],
                 correct: 2,
                 explanation: "Lithium has an atomic number of 3, meaning it has 3 protons in its nucleus."
             },
             'sodium': {
                 question: "What color flame does Sodium produce in a flame test?",
                 options: ["Red", "Yellow", "Green", "Blue"],
                 correct: 1,
                 explanation: "Sodium produces a bright yellow flame in flame tests, which is why it's used in street lamps."
             },
             'potassium': {
                 question: "How does Potassium react with water?",
                 options: ["No reaction", "Fizzes steadily", "Fizzes violently and may ignite", "Explodes"],
                 correct: 2,
                 explanation: "Potassium reacts violently with water, producing hydrogen gas that often ignites with a lilac flame."
             },
             'alkali-metals': {
                 question: "Why are Group 1 elements called alkali metals?",
                 options: ["They are alkaline in nature", "They form alkaline solutions with water", "They are found in alkali", "They react with alkalis"],
                 correct: 1,
                 explanation: "Group 1 elements are called alkali metals because they react with water to form alkaline (basic) solutions."
             },
             'valence-electron': {
                 question: "How many valence electrons do Group 1 elements have?",
                 options: ["1", "2", "3", "7"],
                 correct: 0,
                 explanation: "All Group 1 elements have 1 valence electron in their outer shell, which they readily lose to form +1 ions."
             },
             'soft': {
                 question: "Why are Group 1 metals considered soft?",
                 options: ["They have low density", "They have weak metallic bonds", "They have low melting points", "They are easily cut with a knife"],
                 correct: 3,
                 explanation: "Group 1 metals are soft enough to be cut with a knife due to weak metallic bonding between atoms."
             },
             'melting-point': {
                 question: "How does the melting point change down Group 1?",
                 options: ["Increases", "Decreases", "Remains constant", "Varies randomly"],
                 correct: 1,
                 explanation: "The melting point decreases down Group 1 due to increasing atomic size and weaker metallic bonding."
             },
             'density': {
                 question: "Which Group 1 metal is less dense than water?",
                 options: ["Only Lithium", "Lithium and Sodium", "Lithium, Sodium, and Potassium", "All Group 1 metals"],
                 correct: 2,
                 explanation: "Lithium, Sodium, and Potassium are less dense than water and will float on it. Potassium is an exception to the general trend of increasing density down the group."
             },
             'reactivity': {
                 question: "Which Group 1 metal is the most reactive?",
                 options: ["Lithium", "Sodium", "Potassium", "Cesium"],
                 correct: 3,
                 explanation: "Reactivity increases down Group 1, making Cesium the most reactive element in the group."
             },
             'flame-test': {
                 question: "What flame color does Lithium produce?",
                 options: ["Red", "Yellow", "Green", "Violet"],
                 correct: 0,
                 explanation: "Lithium produces a red flame in flame tests, while Sodium produces yellow and Potassium produces violet/lilac."
             }
         };
         
         // Trend quiz questions
         const trendQuizQuestions = {
             'melting-point': {
                 question: "Why does melting point decrease down Group 1?",
                 options: [
                     "Atomic size increases, metallic bonds weaken",
                     "Atomic size decreases, metallic bonds strengthen",
                     "Electron configuration changes",
                     "Nuclear charge increases"
                 ],
                 correct: 0,
                 explanation: "As we move down Group 1, atomic size increases due to additional electron shells. This increases the distance between positive nuclei and delocalized electrons, weakening the metallic bonds and lowering the melting point."
             },
             'density': {
                 question: "Why is potassium less dense than sodium?",
                 options: [
                     "Potassium has fewer protons",
                     "Potassium has a larger atomic radius",
                     "Potassium has more electron shells",
                     "Potassium has a different crystal structure"
                 ],
                 correct: 1,
                 explanation: "Potassium has a larger atomic radius than sodium, but the increase in size is proportionally greater than the increase in mass, resulting in a lower density. This is an exception to the general trend of increasing density down the group."
             },
             'reactivity': {
                 question: "Why does reactivity increase down Group 1?",
                 options: [
                     "Nuclear charge increases",
                     "Atomic radius increases, making it easier to lose the outer electron",
                     "Electron shielding decreases",
                     "Ionization energy increases"
                 ],
                 correct: 1,
                 explanation: "As we move down Group 1, the atomic radius increases due to additional electron shells. The outer electron is further from the nucleus and experiences more shielding from inner electrons, making it easier to lose and increasing reactivity."
             }
         };
         
         // Element details
         const elementDetails = {
             'Lithium': {
                 symbol: 'Li',
                 atomicNumber: 3,
                 electronConfig: '2,1',
                 meltingPoint: '180.5C',
                 density: '0.534 g/cm',
                 reactivity: 'Lowest in group',
                 uses: 'Batteries, mood stabilizers, alloys',
                 fact: 'Lithium is the lightest metal element and can float on water.',
                 quizQuestion: "What is the primary use of Lithium in modern technology?",
                 quizOptions: [
                     "Street lighting",
                     "Batteries for electric vehicles",
                     "Atomic clocks",
                     "Photoelectric cells"
                 ],
                 quizCorrect: 1,
                 quizExplanation: "Lithium is primarily used in rechargeable batteries for electric vehicles due to its high electrochemical potential and light weight."
             },
             'Sodium': {
                 symbol: 'Na',
                 atomicNumber: 11,
                 electronConfig: '2,8,1',
                 meltingPoint: '97.8C',
                 density: '0.968 g/cm',
                 reactivity: 'Moderate',
                 uses: 'Street lighting, salt production, chemicals',
                 fact: 'Sodium produces a bright yellow flame in flame tests.',
                 quizQuestion: "What compound of Sodium is essential for human health?",
                 quizOptions: [
                     "Sodium hydroxide",
                     "Sodium carbonate",
                     "Sodium chloride",
                     "Sodium bicarbonate"
                 ],
                 quizCorrect: 2,
                 quizExplanation: "Sodium chloride (table salt) is essential for human health, helping to maintain fluid balance and nerve function."
             },
             'Potassium': {
                 symbol: 'K',
                 atomicNumber: 19,
                 electronConfig: '2,8,8,1',
                 meltingPoint: '63.5C',
                 density: '0.89 g/cm',
                 reactivity: 'High',
                 uses: 'Fertilizers, soaps, explosives',
                 fact: 'Potassium is vital for plant growth and human health.',
                 quizQuestion: "Why is Potassium important for the human body?",
                 quizOptions: [
                     "It strengthens bones",
                     "It aids in muscle contraction and nerve function",
                     "It helps in blood clotting",
                     "It is a primary energy source"
                 ],
                 quizCorrect: 1,
                 quizExplanation: "Potassium is crucial for proper muscle contraction, nerve function, and maintaining fluid balance in the body."
             },
             'Rubidium': {
                 symbol: 'Rb',
                 atomicNumber: 37,
                 electronConfig: '2,8,18,8,1',
                 meltingPoint: '39.3C',
                 density: '1.532 g/cm',
                 reactivity: 'Very high',
                 uses: 'Atomic clocks, research, specialty glasses',
                 fact: 'Rubidium is used in atomic clocks for precise timekeeping.',
                 quizQuestion: "What is Rubidium primarily used for?",
                 quizOptions: [
                     "Medical imaging",
                     "Atomic clocks and research",
                     "Water purification",
                     "Food preservation"
                 ],
                 quizCorrect: 1,
                 quizExplanation: "Rubidium is primarily used in atomic clocks for precise timekeeping and in various research applications due to its unique properties."
             },
             'Cesium': {
                 symbol: 'Cs',
                 atomicNumber: 55,
                 electronConfig: '2,8,18,18,8,1',
                 meltingPoint: '28.4C',
                 density: '1.93 g/cm',
                 reactivity: 'Extremely high',
                 uses: 'Atomic clocks, photoelectric cells, drilling fluids',
                 fact: 'Cesium is the most reactive metal and can explode on contact with water.',
                 quizQuestion: "What property makes Cesium useful in photoelectric cells?",
                 quizOptions: [
                     "Its low melting point",
                     "Its ability to emit electrons when exposed to light",
                     "Its high density",
                     "Its radioactive properties"
                 ],
                 quizCorrect: 1,
                 quizExplanation: "Cesium is useful in photoelectric cells because it readily emits electrons when exposed to light, making it efficient for converting light energy into electrical energy."
             },
             'Francium': {
                 symbol: 'Fr',
                 atomicNumber: 87,
                 electronConfig: '2,8,18,32,18,8,1',
                 meltingPoint: '27C',
                 density: '1.87 g/cm',
                 reactivity: 'Highest',
                 uses: 'Research, potential medical applications',
                 fact: 'Francium is extremely rare and radioactive, with a half-life of only 22 minutes.',
                 quizQuestion: "Why is Francium rarely studied or used?",
                 quizOptions: [
                     "It is too expensive to extract",
                     "It has an extremely short half-life",
                     "It is not reactive enough",
                     "It is toxic to humans"
                 ],
                 quizCorrect: 1,
                 quizExplanation: "Francium has an extremely short half-life of only 22 minutes, making it difficult to study and virtually impossible to use in practical applications."
             }
         };
         
         // Reaction details
         const reactionDetails = {
             'lithium-water': {
                 equation: "2Li(s) + 2HO(l)  2LiOH(aq) + H(g)",
                 observations: "Lithium fizzes steadily as it reacts with water. It moves slowly across the surface and does not melt.",
                 explanation: "Lithium reacts with water to produce lithium hydroxide and hydrogen gas. The reaction is relatively gentle compared to other Group 1 metals due to lithium's small atomic size and strong metallic bonding.",
                 quizQuestion: "What gas is produced when Lithium reacts with water?",
                 quizOptions: [
                     "Oxygen",
                     "Hydrogen",
                     "Chlorine",
                     "Nitrogen"
                 ],
                 quizCorrect: 1,
                 quizExplanation: "Lithium reacts with water to produce hydrogen gas, which can be observed as bubbles during the reaction."
             },
             'sodium-water': {
                 equation: "2Na(s) + 2HO(l)  2NaOH(aq) + H(g)",
                 observations: "Sodium fizzes rapidly and melts into a ball. It moves quickly across the water surface.",
                 explanation: "Sodium reacts vigorously with water, producing sodium hydroxide and hydrogen gas. The heat of the reaction melts the sodium, and the hydrogen gas propels it across the water surface.",
                 quizQuestion: "Why does Sodium melt during its reaction with water?",
                 quizOptions: [
                     "Water has a high boiling point",
                     "The reaction is exothermic and produces enough heat to melt Sodium",
                     "Sodium has a very low melting point",
                     "The reaction produces steam which melts the Sodium"
                 ],
                 quizCorrect: 1,
                 quizExplanation: "The reaction between Sodium and water is highly exothermic, producing enough heat to melt the Sodium (melting point: 97.8C)."
             },
             'potassium-water': {
                 equation: "2K(s) + 2HO(l)  2KOH(aq) + H(g)",
                 observations: "Potassium fizzes violently, ignites with a lilac flame, and may explode.",
                 explanation: "Potassium reacts very violently with water, producing potassium hydroxide and hydrogen gas. The reaction is so exothermic that the hydrogen gas ignites, producing a characteristic lilac flame.",
                 quizQuestion: "What color flame does Potassium produce when it reacts with water?",
                 quizOptions: [
                     "Yellow",
                     "Red",
                     "Lilac",
                     "Green"
                 ],
                 quizCorrect: 2,
                 quizExplanation: "Potassium produces a characteristic lilac flame when it reacts with water due to the excitation of its electrons and subsequent emission of light at specific wavelengths."
             },
             'lithium-oxygen': {
                 equation: "4Li(s) + O(g)  2LiO(s)",
                 observations: "Lithium burns with a red flame to form white lithium oxide.",
                 explanation: "Lithium is the only Group 1 metal that forms a normal oxide (LiO) when burned in oxygen. Other Group 1 metals form peroxides or superoxides.",
                 quizQuestion: "What type of oxide does Lithium form when burned in oxygen?",
                 quizOptions: [
                     "Normal oxide (LiO)",
                     "Peroxide (LiO)",
                     "Superoxide (LiO)",
                     "No oxide is formed"
                 ],
                 quizCorrect: 0,
                 quizExplanation: "Lithium forms a normal oxide (LiO) when burned in oxygen, which is unique among Group 1 metals. Other Group 1 metals form peroxides or superoxides."
             },
             'sodium-oxygen': {
                 equation: "2Na(s) + O(g)  NaO(s)",
                 observations: "Sodium burns with a yellow flame to form pale yellow sodium peroxide.",
                 explanation: "Sodium forms a peroxide (NaO) when burned in oxygen. This contains the peroxide ion (O) with an oxygen-oxygen single bond.",
                 quizQuestion: "What ion is present in Sodium peroxide?",
                 quizOptions: [
                     "O",
                     "O",
                     "O",
                     "O"
                 ],
                 quizCorrect: 1,
                 quizExplanation: "Sodium peroxide (NaO) contains the peroxide ion (O), which consists of two oxygen atoms joined by a single bond with a charge of -2."
             },
             'potassium-oxygen': {
                 equation: "K(s) + O(g)  KO(s)",
                 observations: "Potassium burns with a lilac flame to form orange potassium superoxide.",
                 explanation: "Potassium forms a superoxide (KO) when burned in oxygen. This contains the superoxide ion (O) with an unpaired electron.",
                 quizQuestion: "What ion is present in Potassium superoxide?",
                 quizOptions: [
                     "O",
                     "O",
                     "O",
                     "O"
                 ],
                 quizCorrect: 2,
                 quizExplanation: "Potassium superoxide (KO) contains the superoxide ion (O), which has an unpaired electron and is paramagnetic."
             }
         };
         
         // Sound effects
         const correctSound = new Howl({
             src: ['https://assets.mixkit.co/sfx/preview/mixkit-correct-answer-tone-2870.mp3']
         });
         
         const incorrectSound = new Howl({
             src: ['https://assets.mixkit.co/sfx/preview/mixkit-wrong-answer-fail-notification-946.mp3']
         });
         
         const completeSound = new Howl({
             src: ['https://assets.mixkit.co/sfx/preview/mixkit-unlock-game-notification-253.mp3']
         });
         
         const badgeSound = new Howl({
             src: ['https://assets.mixkit.co/sfx/preview/mixkit-winning-chimes-2015.mp3']
         });
         
         // All MCQ Quiz Questions
         quizQuestions = [
             {
                 question: "What is the electron configuration of the outer shell of all Group 1 elements?",
                 options: ["1 electron", "2 electrons", "8 electrons", "Variable number of electrons"],
                 correct: 0,
                 explanation: "All Group 1 elements have one electron in their outer shell, which they readily lose to form +1 ions."
             },
             {
                 question: "Which of the following statements about the reactivity of Group 1 metals is correct?",
                 options: ["Reactivity decreases down the group", "Reactivity increases down the group", "Reactivity stays the same down the group", "Reactivity is highest for lithium"],
                 correct: 1,
                 explanation: "Reactivity increases down Group 1 because the outer electron is further from the nucleus and easier to lose."
             },
             {
                 question: "When Group 1 metals react with water, what products are formed?",
                 options: ["Metal oxide and hydrogen", "Metal hydroxide and hydrogen", "Metal oxide and oxygen", "Metal hydroxide and oxygen"],
                 correct: 1,
                 explanation: "The general equation is: 2M(s) + 2HO(l)  2MOH(aq) + H(g)"
             },
             {
                 question: "Which Group 1 metal forms a normal oxide when burned in oxygen?",
                 options: ["Lithium", "Sodium", "Potassium", "Rubidium"],
                 correct: 0,
                 explanation: "Lithium forms LiO (oxide), while sodium forms NaO (peroxide) and potassium forms KO (superoxide)."
             },
             {
                 question: "What color flame does sodium produce in a flame test?",
                 options: ["Red", "Yellow", "Green", "Purple"],
                 correct: 1,
                 explanation: "Sodium produces a bright yellow flame in flame tests, which is why it's used in street lamps and fireworks."
             },
             {
                 question: "Which statement about the melting point of Group 1 metals is correct?",
                 options: ["Melting point increases down the group", "Melting point decreases down the group", "Melting point is highest for cesium", "Melting point is constant across the group"],
                 correct: 1,
                 explanation: "The melting point decreases down Group 1 due to increasing atomic size and weaker metallic bonding."
             },
             {
                 question: "Which Group 1 metal has the lowest density?",
                 options: ["Lithium", "Sodium", "Potassium", "Cesium"],
                 correct: 0,
                 explanation: "Lithium has the lowest density of all metals and is so light that it can float on water!"
             },
             {
                 question: "What happens when a small piece of potassium is dropped into water?",
                 options: ["It fizzes steadily and moves slowly on the surface", "It fizzes rapidly, melts into a ball, and moves quickly", "It fizzes violently, ignites with a lilac flame, and may explode", "It sinks to the bottom without reacting"],
                 correct: 2,
                 explanation: "Potassium reacts violently with water, producing hydrogen gas that often ignites with a characteristic lilac flame."
             },
             {
                 question: "Which Group 1 metal is used in batteries for electric vehicles?",
                 options: ["Lithium", "Sodium", "Potassium", "Rubidium"],
                 correct: 0,
                 explanation: "Lithium is used in rechargeable batteries for electric vehicles due to its high electrochemical potential and light weight."
             },
             {
                 question: "Which Group 1 metal is used in atomic clocks?",
                 options: ["Lithium", "Sodium", "Potassium", "Cesium"],
                 correct: 3,
                 explanation: "Cesium is used in atomic clocks because it has a very precise and stable frequency when excited, making it perfect for timekeeping."
             }
         ];
         
         // Daily challenges
         const dailyChallenges = [
             {
                 question: "Which Group 1 metal is used in batteries for electric vehicles?",
                 options: ["Lithium", "Sodium", "Potassium", "Rubidium"],
                 correct: 0,
                 explanation: "Lithium is used in rechargeable batteries for electric vehicles due to its high electrochemical potential and light weight."
             },
             {
                 question: "What color flame does sodium produce when burned?",
                 options: ["Red", "Yellow", "Green", "Purple"],
                 correct: 1,
                 explanation: "Sodium produces a bright yellow flame when burned, which is why it's used in street lamps and fireworks."
             },
             {
                 question: "Which Group 1 metal has the lowest density?",
                 options: ["Lithium", "Sodium", "Potassium", "Rubidium"],
                 correct: 0,
                 explanation: "Lithium has the lowest density of all metals and is so light that it can float on water!"
             },
             {
                 question: "What is the main use of potassium in the human body?",
                 options: ["Bone formation", "Muscle contraction", "Oxygen transport", "Energy production"],
                 correct: 1,
                 explanation: "Potassium is essential for proper muscle contraction, nerve function, and maintaining fluid balance in the body."
             },
             {
                 question: "Which Group 1 metal is used in atomic clocks?",
                 options: ["Lithium", "Sodium", "Potassium", "Cesium"],
                 correct: 3,
                 explanation: "Cesium is used in atomic clocks because it has a very precise and stable frequency when excited, making it perfect for timekeeping."
             }
         ];
         
         // Initialize app
         function initApp() {
             // Check authentication state
             auth.onAuthStateChanged((user) => {
                 if (user) {
                     currentUser = user;
                     loadUserData();
                 } else {
                     showLandingPage();
                 }
             });
             
             // Check for saved dark mode preference
             if (localStorage.getItem('darkMode') === 'true') {
                 document.body.classList.add('dark-mode');
                 document.getElementById('darkModeToggle').checked = true;
             }
             
             // Check for saved sound preference
             if (localStorage.getItem('soundEnabled') === 'false') {
                 soundEnabled = false;
                 document.getElementById('soundToggle').checked = false;
             }
             
             // Initialize search functionality
             document.getElementById('searchInput').addEventListener('input', function(e) {
                 const searchTerm = e.target.value.toLowerCase();
                 // We'll search through the content of the current section
                 if (searchTerm === '') {
                     // Show all content
                     document.querySelectorAll('.content-card').forEach(card => {
                         card.style.display = 'block';
                     });
                 } else {
                     document.querySelectorAll('.content-card').forEach(card => {
                         const text = card.textContent.toLowerCase();
                         if (text.includes(searchTerm)) {
                             card.style.display = 'block';
                         } else {
                             card.style.display = 'none';
                         }
                     });
                 }
             });
             
             // Initialize periodic table interactions
             document.querySelectorAll('.element').forEach(element => {
                 element.addEventListener('click', function() {
                     const elementName = this.querySelector('.element-name').textContent;
                     showToast('info', 'Element Info', `You clicked on ${elementName}`);
                 });
             });
             
             // Initialize fade-in effect on scroll
             initializeFadeInEffect();
         }
         
         // Initialize fade-in effect on scroll
         function initializeFadeInEffect() {
             // Disconnect existing observer if it exists
             if (fadeObserver) {
                 fadeObserver.disconnect();
             }
             
             // Set up Intersection Observer for fade-in effect
             const fadeOptions = {
                 root: null,
                 rootMargin: '0px',
                 threshold: 0.1
             };
             
             fadeObserver = new IntersectionObserver((entries) => {
                 entries.forEach(entry => {
                     if (entry.isIntersecting) {
                         entry.target.classList.add('visible');
                     }
                 });
             }, fadeOptions);
             
             // Add fade-in classes to relevant elements
             addFadeInClasses();
             
             // Observe all elements with fade-in class
             document.querySelectorAll('.fade-in, .fade-in-stagger').forEach(el => {
                 fadeObserver.observe(el);
             });
             
             // Trigger fade-in for elements already in view
             triggerVisibleFadeIns();
         }
         
         // Trigger fade-in for elements already visible
         function triggerVisibleFadeIns() {
             // Small delay to ensure DOM is fully rendered
             setTimeout(() => {
                 document.querySelectorAll('.fade-in, .fade-in-stagger').forEach(el => {
                     const rect = el.getBoundingClientRect();
                     const isVisible = (
                         rect.top >= 0 &&
                         rect.left >= 0 &&
                         rect.bottom <= (window.innerHeight || document.documentElement.clientHeight) &&
                         rect.right <= (window.innerWidth || document.documentElement.clientWidth)
                     );
                     
                     if (isVisible) {
                         el.classList.add('visible');
                     }
                 });
             }, 100);
         }
         
         // Add fade-in classes to relevant elements
         function addFadeInClasses() {
             // Content cards
             document.querySelectorAll('.content-card').forEach(card => {
                 if (!card.classList.contains('fade-in')) {
                     card.classList.add('fade-in');
                 }
             });
             
             // Paragraphs in content sections
             document.querySelectorAll('.content-section p').forEach(p => {
                 if (!p.classList.contains('fade-in')) {
                     p.classList.add('fade-in');
                 }
             });
             
             // Lists
             document.querySelectorAll('.content-section ul, .content-section ol').forEach(list => {
                 if (!list.classList.contains('fade-in-stagger')) {
                     list.classList.add('fade-in-stagger');
                 }
             });
             
             // Headings
             document.querySelectorAll('.content-section h2, .content-section h3, .content-section h4').forEach(heading => {
                 if (!heading.classList.contains('fade-in')) {
                     heading.classList.add('fade-in');
                 }
             });
             
             // Highlight boxes and equation boxes
             document.querySelectorAll('.highlight-box, .equation-box').forEach(box => {
                 if (!box.classList.contains('fade-in')) {
                     box.classList.add('fade-in');
                 }
             });
             
             // Element cards
             document.querySelectorAll('.element-card').forEach(card => {
                 if (!card.classList.contains('fade-in')) {
                     card.classList.add('fade-in');
                 }
             });
             
             // Tables
             document.querySelectorAll('.trend-table').forEach(table => {
                 if (!table.classList.contains('fade-in')) {
                     table.classList.add('fade-in');
                 }
             });
             
             // Tabs
             document.querySelectorAll('.tab').forEach(tab => {
                 if (!tab.classList.contains('fade-in')) {
                     tab.classList.add('fade-in');
                 }
             });
             
             // Discussion posts and study groups
             document.querySelectorAll('.discussion-post, .study-group-card').forEach(post => {
                 if (!post.classList.contains('fade-in')) {
                     post.classList.add('fade-in');
                 }
             });
             
             // Progress tracker elements
             document.querySelectorAll('.progress-bar, .progress-fill').forEach(el => {
                 if (!el.classList.contains('fade-in')) {
                     el.classList.add('fade-in');
                 }
             });
             
             // Buttons
             document.querySelectorAll('.btn').forEach(btn => {
                 if (!btn.classList.contains('fade-in')) {
                     btn.classList.add('fade-in');
                 }
             });
             
             // Grid elements
             document.querySelectorAll('.grid > div').forEach(el => {
                 if (!el.classList.contains('fade-in')) {
                     el.classList.add('fade-in');
                 }
             });
             
             // Interactive elements
             document.querySelectorAll('.interactive-element, .keyword, .valence-electron').forEach(el => {
                 if (!el.classList.contains('fade-in')) {
                     el.classList.add('fade-in');
                 }
             });
             
             // Specific elements in overview section
             const overviewSection = document.getElementById('overview-section');
             if (overviewSection) {
                 overviewSection.querySelectorAll('.bg-gradient-to-r, .mb-6, .grid, .flex').forEach(el => {
                     if (!el.classList.contains('fade-in') && !el.classList.contains('fade-in-stagger')) {
                         if (el.querySelector('ul') || el.querySelector('ol')) {
                             el.classList.add('fade-in-stagger');
                         } else {
                             el.classList.add('fade-in');
                         }
                     }
                 });
             }
         }
         
         // Navigation functions
         function navigateToSection(sectionName) {
             // Check if section is locked
             const navItem = document.getElementById(`nav-${sectionName}`);
             if (navItem && navItem.classList.contains('locked')) {
                 showToast('info', 'Section Locked', 'Please complete previous sections first.');
                 return;
             }
             
             // Hide all sections
             const sections = document.querySelectorAll('.content-section');
             sections.forEach(section => {
                 section.style.display = 'none';
             });
             
             // Show selected section
             const sectionElement = document.getElementById(`${sectionName}-section`);
             if (sectionElement) {
                 sectionElement.style.display = 'block';
                 
                 // Reset fade-in classes for elements in the new section
                 sectionElement.querySelectorAll('.fade-in, .fade-in-stagger').forEach(el => {
                     el.classList.remove('visible');
                 });
                 
                 // Reinitialize fade-in for the new section
                 setTimeout(() => {
                     // Add fade-in classes if they don't exist
                     addFadeInClasses();
                     
                     // Manually trigger fade-in for elements already in view
                     triggerVisibleFadeIns();
                     
                     // Reconnect the observer to observe new elements
                     if (fadeObserver) {
                         sectionElement.querySelectorAll('.fade-in, .fade-in-stagger').forEach(el => {
                             fadeObserver.observe(el);
                         });
                     }
                 }, 50);
             }
             
             // Update active nav item
             const navItems = document.querySelectorAll('.nav-item');
             navItems.forEach(item => {
                 item.classList.remove('active');
             });
             
             if (navItem) {
                 navItem.classList.add('active');
             }
             
             currentSection = sectionName;
             
             // Load leaderboard if that section is selected
             if (sectionName === 'leaderboard') {
                 loadLeaderboard();
             }
         }
         
         // Show main app
         function showMainApp() {
             document.getElementById('landingPage').style.display = 'none';
             document.getElementById('mainApp').style.display = 'block';
             
             // Update user info
             document.getElementById('userName').textContent = userData.displayName || 'User';
             document.getElementById('userEmail').textContent = currentUser.email || 'user@example.com';
             
             // Update XP and badges
             updateUserXP();
             updateUserBadges();
             
             // Update progress
             updateProgressTracker();
             updateSectionCompletionStatus();
             
             // Load discussion posts and study groups
             loadDiscussionPosts();
             loadStudyGroups();
             loadLeaderboard();
             
             // Check for daily challenge
             checkDailyChallenge();
             
             // Initialize fade-in effect after a short delay
             setTimeout(() => {
                 initializeFadeInEffect();
             }, 100);
         }
         
         // Load user data from Firebase
         function loadUserData() {
             const userRef = database.ref('users/' + currentUser.uid);
             userRef.once('value').then((snapshot) => {
                 if (snapshot.exists()) {
                     userData = snapshot.val();
                     completedSections = userData.completedSections || [];
                     showMainApp();
                 } else {
                     // Create new user profile
                     const newUser = {
                         uid: currentUser.uid,
                         email: currentUser.email,
                         displayName: currentUser.displayName || 'User',
                         completedSections: [],
                         savedPosts: [],
                         xp: 0,
                         badges: [],
                         createdAt: firebase.database.ServerValue.TIMESTAMP
                     };
                     
                     userRef.set(newUser).then(() => {
                         userData = newUser;
                         completedSections = [];
                         showMainApp();
                     });
                 }
             }).catch((error) => {
                 console.error("Error loading user data:", error);
                 showToast('error', 'Error', 'Failed to load your data.');
             });
         }
         
         // Show landing page
         function showLandingPage() {
             document.getElementById('landingPage').style.display = 'flex';
             document.getElementById('mainApp').style.display = 'none';
         }
         
         // Update user XP display
         function updateUserXP() {
             const xp = userData.xp || 0;
             document.getElementById('userXP').textContent = xp;
         }
         
         // Update user badges display
         function updateUserBadges() {
             const badges = userData.badges || [];
             const badgesContainer = document.getElementById('userBadges');
             badgesContainer.innerHTML = '';
             
             if (badges.length === 0) {
                 badgesContainer.innerHTML = '<span class="text-sm text-gray-500">No badges yet</span>';
                 return;
             }
             
             badges.forEach(badge => {
                 const badgeElement = document.createElement('div');
                 badgeElement.className = 'badge';
                 badgeElement.innerHTML = `<i class="fas fa-medal"></i>`;
                 badgeElement.title = badge;
                 badgesContainer.appendChild(badgeElement);
             });
         }
         
         // Check for daily challenge
         function checkDailyChallenge() {
             const today = new Date().toISOString().split('T')[0];
             const challengeRef = database.ref('dailyChallenges/' + today);
             
             challengeRef.once('value').then((snapshot) => {
                 if (snapshot.exists()) {
                     dailyChallenge = snapshot.val();
                     
                     // Check if user has completed today's challenge
                     const userChallengeRef = database.ref('users/' + currentUser.uid + '/dailyChallenges/' + today);
                     userChallengeRef.once('value').then((userSnapshot) => {
                         if (!userSnapshot.exists()) {
                             // Show daily challenge
                             document.getElementById('dailyChallenge').style.display = 'block';
                             document.getElementById('dailyChallengeQuestion').textContent = dailyChallenge.question;
                         }
                     });
                 } else {
                     // Create a new daily challenge for today
                     const randomChallenge = dailyChallenges[Math.floor(Math.random() * dailyChallenges.length)];
                     challengeRef.set(randomChallenge).then(() => {
                         dailyChallenge = randomChallenge;
                         document.getElementById('dailyChallenge').style.display = 'block';
                         document.getElementById('dailyChallengeQuestion').textContent = dailyChallenge.question;
                     });
                 }
             });
         }
         
         // Show daily challenge modal
         function showDailyChallengeModal() {
             if (!dailyChallenge) return;
             
             document.getElementById('dailyChallengeModal').classList.add('active');
             document.getElementById('dailyChallengeQuestionText').textContent = dailyChallenge.question;
             
             const optionsContainer = document.getElementById('dailyChallengeOptions');
             optionsContainer.innerHTML = '';
             
             dailyChallenge.options.forEach((option, index) => {
                 const optionDiv = document.createElement('div');
                 optionDiv.className = 'quiz-option';
                 optionDiv.dataset.index = index;
                 
                 const input = document.createElement('input');
                 input.type = 'radio';
                 input.name = 'daily-challenge-option';
                 input.id = `daily-option-${index}`;
                 input.value = index;
                 
                 const label = document.createElement('label');
                 label.htmlFor = `daily-option-${index}`;
                 label.textContent = option;
                 
                 optionDiv.appendChild(input);
                 optionDiv.appendChild(label);
                 
                 optionDiv.onclick = () => selectDailyChallengeOption(index);
                 
                 optionsContainer.appendChild(optionDiv);
             });
             
             // Reset feedback
             document.getElementById('dailyChallengeFeedback').classList.add('hidden');
             document.getElementById('dailyChallengeSubmitBtn').disabled = true;
             dailyChallengeAnswered = false;
         }
         
         // Close daily challenge modal
         function closeDailyChallengeModal() {
             document.getElementById('dailyChallengeModal').classList.remove('active');
         }
         
         // Select daily challenge option
         function selectDailyChallengeOption(index) {
             if (dailyChallengeAnswered) return;
             
             const options = document.querySelectorAll('#dailyChallengeOptions .quiz-option');
             options.forEach(option => {
                 option.classList.remove('selected');
                 const input = option.querySelector('input');
                 input.checked = false;
             });
             
             options[index].classList.add('selected');
             options[index].querySelector('input').checked = true;
             
             document.getElementById('dailyChallengeSubmitBtn').disabled = false;
         }
         
         // Submit daily challenge
         function submitDailyChallenge() {
             if (dailyChallengeAnswered) return;
             
             const selectedOption = document.querySelector('#dailyChallengeOptions .quiz-option.selected');
             if (!selectedOption) return;
             
             const selectedIndex = parseInt(selectedOption.dataset.index);
             const isCorrect = selectedIndex === dailyChallenge.correct;
             
             const feedback = document.getElementById('dailyChallengeFeedback');
             if (isCorrect) {
                 feedback.className = 'mb-5 p-4 rounded-lg bg-green-100 text-green-800 text-sm';
                 feedback.textContent = 'Correct! ' + dailyChallenge.explanation;
                 
                 // Award XP
                 const newXp = (userData.xp || 0) + 5;
                 const userRef = database.ref('users/' + currentUser.uid);
                 userRef.update({
                     xp: newXp
                 }).then(() => {
                     userData.xp = newXp;
                     updateUserXP();
                     
                     if (soundEnabled) correctSound.play();
                     showToast('success', 'Daily Challenge Complete!', 'You earned 5 XP!');
                 });
             } else {
                 feedback.className = 'mb-5 p-4 rounded-lg bg-red-100 text-red-800 text-sm';
                 feedback.textContent = 'Incorrect. ' + dailyChallenge.explanation;
                 
                 if (soundEnabled) incorrectSound.play();
             }
             
             feedback.classList.remove('hidden');
             document.getElementById('dailyChallengeSubmitBtn').disabled = true;
             dailyChallengeAnswered = true;
             
             // Mark as completed
             const today = new Date().toISOString().split('T')[0];
             const userChallengeRef = database.ref('users/' + currentUser.uid + '/dailyChallenges/' + today);
             userChallengeRef.set(true);
             
             // Hide daily challenge banner
             document.getElementById('dailyChallenge').style.display = 'none';
         }
         
         // Toggle dark mode
         function toggleDarkMode() {
             document.body.classList.toggle('dark-mode');
             const isDarkMode = document.body.classList.contains('dark-mode');
             localStorage.setItem('darkMode', isDarkMode);
         }
         
         // Toggle sound effects
         function toggleSound() {
             soundEnabled = document.getElementById('soundToggle').checked;
             localStorage.setItem('soundEnabled', soundEnabled);
         }
         
         // Authentication functions
         function showLoginModal() {
             document.getElementById('loginModal').classList.add('active');
         }
         
         function closeLoginModal() {
             document.getElementById('loginModal').classList.remove('active');
         }
         
         function showSignup() {
             closeLoginModal();
             document.getElementById('signupModal').classList.add('active');
         }
         
         function showLogin() {
             closeSignupModal();
             document.getElementById('loginModal').classList.add('active');
         }
         
         function closeSignupModal() {
             document.getElementById('signupModal').classList.remove('active');
         }
         
         function signInWithGoogle() {
             const provider = new firebase.auth.GoogleAuthProvider();
             auth.signInWithPopup(provider)
                 .then((result) => {
                     showToast('success', 'Welcome!', 'You have been successfully signed in.');
                     closeLoginModal();
                 })
                 .catch((error) => {
                     console.error("Google sign in error:", error);
                     showToast('error', 'Sign in failed', error.message);
                 });
         }
         
         function handleEmailLogin(event) {
             event.preventDefault();
             
             const email = document.getElementById('loginEmail').value;
             const password = document.getElementById('loginPassword').value;
             
             auth.signInWithEmailAndPassword(email, password)
                 .then((userCredential) => {
                     showToast('success', 'Welcome back!', 'You have been successfully signed in.');
                     closeLoginModal();
                 })
                 .catch((error) => {
                     console.error("Email login error:", error);
                     showToast('error', 'Sign in failed', error.message);
                 });
         }
         
         function handleSignup(event) {
             event.preventDefault();
             
             const name = document.getElementById('signupName').value;
             const email = document.getElementById('signupEmail').value;
             const password = document.getElementById('signupPassword').value;
             const confirmPassword = document.getElementById('signupConfirmPassword').value;
             
             if (password !== confirmPassword) {
                 showToast('error', 'Password Mismatch', 'The passwords you entered do not match.');
                 return;
             }
             
             auth.createUserWithEmailAndPassword(email, password)
                 .then((userCredential) => {
                     const user = userCredential.user;
                     
                     // Update profile with display name
                     return user.updateProfile({
                         displayName: name
                     }).then(() => {
                         showToast('success', 'Account Created!', 'Your account has been created successfully.');
                         closeSignupModal();
                     });
                 })
                 .catch((error) => {
                     console.error("Signup error:", error);
                     showToast('error', 'Sign up failed', error.message);
                 });
         }
         
         function signOut() {
             auth.signOut().then(() => {
                 showToast('info', 'Goodbye!', 'You have been successfully signed out.');
                 showLandingPage();
             }).catch((error) => {
                 console.error("Sign out error:", error);
                 showToast('error', 'Error', 'Failed to sign out.');
             });
         }
         
         // Tab functions
         function showTab(tabName) {
             // Hide all tab contents
             const tabContents = document.querySelectorAll('.tab-content');
             tabContents.forEach(content => {
                 content.classList.remove('active');
             });
             
             // Remove active class from all tabs
             const tabs = document.querySelectorAll('.tab');
             tabs.forEach(tab => {
                 tab.classList.remove('active');
             });
             
             // Show selected tab content
             const tabContent = document.getElementById(tabName);
             if (tabContent) {
                 tabContent.classList.add('active');
                 
                 // Reset fade-in classes for elements in this tab content
                 tabContent.querySelectorAll('.fade-in, .fade-in-stagger').forEach(el => {
                     el.classList.remove('visible');
                 });
                 
                 // Reinitialize fade-in for this tab content with a delay
                 setTimeout(() => {
                     // Add fade-in classes if they don't exist
                     addFadeInClasses();
                     
                     // Manually trigger fade-in for elements already in view
                     tabContent.querySelectorAll('.fade-in, .fade-in-stagger').forEach(el => {
                         const rect = el.getBoundingClientRect();
                         const isVisible = (
                             rect.top >= 0 &&
                             rect.left >= 0 &&
                             rect.bottom <= (window.innerHeight || document.documentElement.clientHeight) &&
                             rect.right <= (window.innerWidth || document.documentElement.clientWidth)
                         );
                         
                         if (isVisible) {
                             el.classList.add('visible');
                         }
                     });
                     
                     // Reconnect the observer to observe new elements
                     if (fadeObserver) {
                         tabContent.querySelectorAll('.fade-in, .fade-in-stagger').forEach(el => {
                             fadeObserver.observe(el);
                         });
                     }
                 }, 50);
             }
             
             // Add active class to clicked tab
             const activeTab = document.querySelector(`[onclick="showTab('${tabName}')"]`);
             if (activeTab) {
                 activeTab.classList.add('active');
             }
         }
         
         function completeSection(sectionName) {
             if (completedSections.includes(sectionName)) {
                 // If already completed, unmark as complete
                 unmarkSectionComplete(sectionName);
                 return;
             }
             
             completedSections.push(sectionName);
             
             // Award XP
             const xpAwarded = 10;
             const newXp = (userData.xp || 0) + xpAwarded;
             
             // Check for badges
             const newBadges = [...(userData.badges || [])];
             let badgeEarned = false;
             
             if (completedSections.length === 1 && !newBadges.includes('First Steps')) {
                 newBadges.push('First Steps');
                 badgeEarned = true;
             }
             
             if (completedSections.length === 4 && !newBadges.includes('Metal Master')) {
                 newBadges.push('Metal Master');
                 badgeEarned = true;
             }
             
             // Save to Firebase
             if (currentUser && userData) {
                 const userRef = database.ref('users/' + currentUser.uid);
                 const updates = {
                     completedSections: completedSections,
                     xp: newXp
                 };
                 
                 if (badgeEarned) {
                     updates.badges = newBadges;
                 }
                 
                 userRef.update(updates).then(() => {
                     userData.xp = newXp;
                     if (badgeEarned) {
                         userData.badges = newBadges;
                     }
                     
                     updateUserXP();
                     updateUserBadges();
                     
                     if (soundEnabled) {
                         completeSound.play();
                         if (badgeEarned) badgeSound.play();
                     }
                     
                     showToast('success', 'Section Complete!', `Great job! You've completed this section and earned ${xpAwarded} XP.`);
                     
                     if (badgeEarned) {
                         showToast('success', 'Badge Earned!', `You've earned a new badge: ${newBadges[newBadges.length - 1]}`);
                     }
                     
                     updateSectionCompletionStatus();
                     updateProgressTracker();
                     
                     // Navigate to next section if available
                     const sectionOrder = ['overview', 'elements', 'properties', 'reactions', 'quiz'];
                     const currentIndex = sectionOrder.indexOf(sectionName);
                     if (currentIndex < sectionOrder.length - 1) {
                         const nextSection = sectionOrder[currentIndex + 1];
                         navigateToSection(nextSection);
                     }
                 }).catch((error) => {
                     console.error("Error saving progress:", error);
                     showToast('error', 'Error', 'Failed to save your progress.');
                 });
             }
         }
         
         function unmarkSectionComplete(sectionName) {
             // Remove from completed sections
             completedSections = completedSections.filter(section => section !== sectionName);
             
             // Update UI
             updateSectionCompletionStatus();
             updateProgressTracker();
             
             // Save to Firebase
             if (currentUser && userData) {
                 const userRef = database.ref('users/' + currentUser.uid);
                 userRef.update({
                     completedSections: completedSections
                 }).then(() => {
                     showToast('info', 'Section Unmarked', `You've unmarked ${sectionName} as complete.`);
                 }).catch((error) => {
                     console.error("Error updating progress:", error);
                     showToast('error', 'Error', 'Failed to update your progress.');
                 });
             }
         }
         
         function updateSectionCompletionStatus() {
             // Update nav items
             const navItems = document.querySelectorAll('.nav-item');
             navItems.forEach(item => {
                 const section = item.id.replace('nav-', '');
                 if (completedSections.includes(section)) {
                     item.classList.remove('locked');
                     item.classList.add('completed');
                 } else {
                     item.classList.remove('completed');
                 }
             });
             
             // Unlock next sections
             const sectionOrder = ['overview', 'elements', 'properties', 'reactions', 'quiz'];
             sectionOrder.forEach((section, index) => {
                 if (completedSections.includes(section) && index < sectionOrder.length - 1) {
                     const nextSection = sectionOrder[index + 1];
                     const nextNavItem = document.getElementById(`nav-${nextSection}`);
                     if (nextNavItem) {
                         nextNavItem.classList.remove('locked');
                     }
                 }
             });
             
             // Check if all sections are completed to unlock quiz
             const allSectionsCompleted = ['overview', 'elements', 'properties', 'reactions'].every(section => 
                 completedSections.includes(section)
             );
             
             if (allSectionsCompleted) {
                 const quizNavItem = document.getElementById('nav-quiz');
                 if (quizNavItem) {
                     quizNavItem.classList.remove('locked');
                 }
             }
             
             // Update section buttons
             updateSectionButtons();
         }
         
         function updateSectionButtons() {
             // Update each section's complete button
             const sections = ['overview', 'elements', 'properties', 'reactions', 'quiz'];
             sections.forEach(section => {
                 const button = document.getElementById(`${section}-complete-btn`);
                 if (button) {
                     if (completedSections.includes(section)) {
                         button.innerHTML = '<i class="fas fa-times mr-2"></i>Unmark as Complete';
                         button.classList.remove('btn-success');
                         button.classList.add('btn-unmark');
                     } else {
                         button.innerHTML = '<i class="fas fa-check mr-2"></i>Mark as Complete';
                         button.classList.remove('btn-unmark');
                         button.classList.add('btn-success');
                     }
                 }
             });
         }
         
         function updateProgressTracker() {
             const totalSections = 4; // overview, elements, properties, reactions
             const completedCount = completedSections.length;
             const percentage = Math.round((completedCount / totalSections) * 100);
             
             document.getElementById('progressPercentage').textContent = `${percentage}%`;
             document.getElementById('overallProgressFill').style.width = `${percentage}%`;
             
             // Update progress items
             const sections = ['overview', 'elements', 'properties', 'quiz'];
             sections.forEach(section => {
                 const progressItem = document.getElementById(`progress-${section}`);
                 const statusElement = progressItem.querySelector('.text-xs');
                 
                 if (completedSections.includes(section)) {
                     progressItem.classList.add('bg-green-100');
                     statusElement.textContent = 'Completed';
                     statusElement.classList.remove('text-gray-500');
                     statusElement.classList.add('text-green-600');
                 } else if (section === 'quiz' && completedSections.length === 4) {
                     progressItem.classList.remove('bg-gray-100');
                     progressItem.classList.add('bg-blue-100');
                     statusElement.textContent = 'Available';
                     statusElement.classList.remove('text-gray-500');
                     statusElement.classList.add('text-blue-600');
                 }
             });
         }
         
         // Interactive element quiz functions
         function showElementQuiz(element) {
             const question = termQuizQuestions[element];
             if (!question) return;
             
             const popup = document.getElementById('elementQuizPopup');
             const title = document.getElementById('elementQuizTitle');
             const questionText = document.getElementById('elementQuizQuestion');
             const optionsContainer = document.getElementById('elementQuizOptions');
             const feedback = document.getElementById('elementQuizFeedback');
             
             title.textContent = `${element.charAt(0).toUpperCase() + element.slice(1)} Quiz`;
             questionText.textContent = question.question;
             
             optionsContainer.innerHTML = '';
             question.options.forEach((option, index) => {
                 const optionDiv = document.createElement('div');
                 optionDiv.className = 'quiz-option';
                 optionDiv.textContent = option;
                 optionDiv.onclick = () => checkElementQuizAnswer(index, question.correct, question.explanation);
                 optionsContainer.appendChild(optionDiv);
             });
             
             feedback.classList.add('hidden');
             popup.classList.remove('hidden');
         }
         
         function checkElementQuizAnswer(selectedIndex, correctIndex, explanation) {
             const options = document.querySelectorAll('#elementQuizOptions .quiz-option');
             const feedback = document.getElementById('elementQuizFeedback');
             
             options.forEach((option, index) => {
                 option.onclick = null; // Disable further clicks
                 if (index === correctIndex) {
                     option.classList.add('correct');
                 } else if (index === selectedIndex) {
                     option.classList.add('incorrect');
                 }
             });
             
             if (selectedIndex === correctIndex) {
                 feedback.className = 'mb-5 p-4 rounded-lg bg-green-100 text-green-800';
                 feedback.textContent = 'Correct! ' + explanation;
                 if (soundEnabled) correctSound.play();
             } else {
                 feedback.className = 'mb-5 p-4 rounded-lg bg-red-100 text-red-800';
                 feedback.textContent = 'Incorrect. ' + explanation;
                 if (soundEnabled) incorrectSound.play();
             }
             
             feedback.classList.remove('hidden');
         }
         
         function closeElementQuiz() {
             document.getElementById('elementQuizPopup').classList.add('hidden');
         }
         
         // Term quiz functions
         function showTermQuiz(term) {
             const question = termQuizQuestions[term];
             if (!question) return;
             
             document.getElementById('quizQuestionModal').classList.add('active');
             document.getElementById('quizQuestionTitle').textContent = `Quick Quiz: ${term.replace('-', ' ')}`;
             document.getElementById('quizQuestionText').textContent = question.question;
             
             const answersContainer = document.getElementById('quizQuestionAnswers');
             answersContainer.innerHTML = '';
             
             question.options.forEach((option, index) => {
                 const answerDiv = document.createElement('div');
                 answerDiv.className = 'quiz-option';
                 answerDiv.textContent = option;
                 answerDiv.onclick = () => selectTermQuizAnswer(index, question.correct, question.explanation);
                 answersContainer.appendChild(answerDiv);
             });
             
             // Reset feedback
             document.getElementById('quizQuestionFeedback').classList.add('hidden');
         }
         
         function selectTermQuizAnswer(index, correctIndex, explanation) {
             const answers = document.querySelectorAll('#quizQuestionAnswers .quiz-option');
             const feedback = document.getElementById('quizQuestionFeedback');
             
             answers.forEach(answer => {
                 answer.style.pointerEvents = 'none';
             });
             
             if (index === correctIndex) {
                 answers[index].classList.add('correct');
                 feedback.className = 'quiz-feedback correct';
                 feedback.textContent = 'Correct! ' + explanation;
                 
                 if (soundEnabled) correctSound.play();
             } else {
                 answers[index].classList.add('incorrect');
                 feedback.className = 'quiz-feedback incorrect';
                 feedback.textContent = 'Incorrect. ' + explanation;
                 
                 if (soundEnabled) incorrectSound.play();
             }
             
             feedback.classList.remove('hidden');
         }
         
         function closeQuizQuestionModal() {
             document.getElementById('quizQuestionModal').classList.remove('active');
         }
         
         // Trend quiz functions
         function showTrendQuiz(trend) {
             const question = trendQuizQuestions[trend];
             if (!question) return;
             
             document.getElementById('quizQuestionModal').classList.add('active');
             document.getElementById('quizQuestionTitle').textContent = `Trend Quiz: ${trend.replace('-', ' ')}`;
             document.getElementById('quizQuestionText').textContent = question.question;
             
             const answersContainer = document.getElementById('quizQuestionAnswers');
             answersContainer.innerHTML = '';
             
             question.options.forEach((option, index) => {
                 const answerDiv = document.createElement('div');
                 answerDiv.className = 'quiz-option';
                 answerDiv.textContent = option;
                 answerDiv.onclick = () => selectTrendQuizAnswer(index, question.correct, question.explanation);
                 answersContainer.appendChild(answerDiv);
             });
             
             // Reset feedback
             document.getElementById('quizQuestionFeedback').classList.add('hidden');
         }
         
         function selectTrendQuizAnswer(index, correctIndex, explanation) {
             const answers = document.querySelectorAll('#quizQuestionAnswers .quiz-option');
             const feedback = document.getElementById('quizQuestionFeedback');
             
             answers.forEach(answer => {
                 answer.style.pointerEvents = 'none';
             });
             
             if (index === correctIndex) {
                 answers[index].classList.add('correct');
                 feedback.className = 'quiz-feedback correct';
                 feedback.textContent = 'Correct! ' + explanation;
                 
                 if (soundEnabled) correctSound.play();
             } else {
                 answers[index].classList.add('incorrect');
                 feedback.className = 'quiz-feedback incorrect';
                 feedback.textContent = 'Incorrect. ' + explanation;
                 
                 if (soundEnabled) incorrectSound.play();
             }
             
             feedback.classList.remove('hidden');
         }
         
         // Element details functions
         function showElementDetails(name, symbol, atomicNumber, electronConfig) {
             const details = elementDetails[name];
             if (!details) return;
             
             document.getElementById('elementDetailsName').textContent = name;
             document.getElementById('elementDetailsSymbol').textContent = symbol;
             document.getElementById('elementDetailsNumber').textContent = atomicNumber;
             document.getElementById('elementDetailsConfig').textContent = electronConfig;
             document.getElementById('elementDetailsMP').textContent = details.meltingPoint;
             document.getElementById('elementDetailsDensity').textContent = details.density;
             document.getElementById('elementDetailsReactivity').textContent = details.reactivity;
             document.getElementById('elementDetailsUses').textContent = details.uses;
             document.getElementById('elementDetailsFact').textContent = details.fact;
             
             // Setup quiz
             document.getElementById('elementDetailsQuizQuestion').textContent = details.quizQuestion;
             const optionsContainer = document.getElementById('elementDetailsQuizOptions');
             optionsContainer.innerHTML = '';
             
             details.quizOptions.forEach((option, index) => {
                 const optionDiv = document.createElement('div');
                 optionDiv.className = 'quiz-option';
                 optionDiv.textContent = option;
                 optionDiv.onclick = () => checkElementDetailsQuizAnswer(index, details.quizCorrect, details.quizExplanation);
                 optionsContainer.appendChild(optionDiv);
             });
             
             document.getElementById('elementDetailsQuizFeedback').classList.add('hidden');
             document.getElementById('elementDetailsModal').classList.add('active');
         }
         
         function checkElementDetailsQuizAnswer(selectedIndex, correctIndex, explanation) {
             const options = document.querySelectorAll('#elementDetailsQuizOptions .quiz-option');
             const feedback = document.getElementById('elementDetailsQuizFeedback');
             
             options.forEach((option, index) => {
                 option.onclick = null; // Disable further clicks
                 if (index === correctIndex) {
                     option.classList.add('correct');
                 } else if (index === selectedIndex) {
                     option.classList.add('incorrect');
                 }
             });
             
             if (selectedIndex === correctIndex) {
                 feedback.className = 'mt-3 p-4 rounded-lg bg-green-100 text-green-800';
                 feedback.textContent = 'Correct! ' + explanation;
                 if (soundEnabled) correctSound.play();
             } else {
                 feedback.className = 'mt-3 p-4 rounded-lg bg-red-100 text-red-800';
                 feedback.textContent = 'Incorrect. ' + explanation;
                 if (soundEnabled) incorrectSound.play();
             }
             
             feedback.classList.remove('hidden');
         }
         
         function closeElementDetails() {
             document.getElementById('elementDetailsModal').classList.remove('active');
         }
         
         // Trend explanation functions
         function showTrendExplanation(trend, element) {
             let title, heading, content, quizQuestion, quizOptions, quizCorrect, quizExplanation;
             
             if (trend === 'melting-point') {
                 title = 'Melting Point Trend';
                 heading = `Melting Point of ${element.charAt(0).toUpperCase() + element.slice(1)}`;
                 
                 if (element === 'lithium') {
                     content = 'Lithium has the highest melting point in Group 1 (180.5C) due to its small atomic size and strong metallic bonding. The small size of lithium atoms means the positive nuclei are closer to the delocalized electrons, resulting in stronger metallic bonds that require more energy to break.';
                 } else if (element === 'sodium') {
                     content = 'Sodium has a lower melting point (97.8C) than lithium due to its larger atomic size. The increased atomic radius means the positive nuclei are further from the delocalized electrons, weakening the metallic bonds and requiring less energy to break them.';
                 } else if (element === 'potassium') {
                     content = 'Potassium has an even lower melting point (63.5C) due to its larger atomic size. The additional electron shell increases the atomic radius significantly, further weakening the metallic bonds.';
                 } else if (element === 'rubidium') {
                     content = 'Rubidium has a very low melting point (39.3C) due to its large atomic size. The increased distance between positive nuclei and delocalized electrons results in very weak metallic bonds.';
                 } else if (element === 'cesium') {
                     content = 'Cesium has the lowest melting point in Group 1 (28.4C) due to its largest atomic size. The significant distance between positive nuclei and delocalized electrons results in extremely weak metallic bonds that require very little energy to break.';
                 }
                 
                 quizQuestion = "Why does melting point decrease down Group 1?";
                 quizOptions = [
                     "Atomic size increases, metallic bonds weaken",
                     "Atomic size decreases, metallic bonds strengthen",
                     "Electron configuration changes",
                     "Nuclear charge increases"
                 ];
                 quizCorrect = 0;
                 quizExplanation = "As we move down Group 1, atomic size increases due to additional electron shells. This increases the distance between positive nuclei and delocalized electrons, weakening the metallic bonds and lowering the melting point.";
             } else if (trend === 'density') {
                 title = 'Density Trend';
                 heading = `Density of ${element.charAt(0).toUpperCase() + element.slice(1)}`;
                 
                 if (element === 'lithium') {
                     content = 'Lithium has the lowest density of all metals (0.534 g/cm) and can float on water. Its low density is due to its small atomic mass combined with a relatively large atomic volume.';
                 } else if (element === 'sodium') {
                     content = 'Sodium has a higher density (0.968 g/cm) than lithium but still floats on water. The increase in atomic mass is proportionally greater than the increase in atomic volume compared to lithium.';
                 } else if (element === 'potassium') {
                     content = 'Potassium has a lower density (0.89 g/cm) than sodium, which is an exception to the general trend. The increase in atomic volume is proportionally greater than the increase in atomic mass compared to sodium.';
                 } else if (element === 'rubidium') {
                     content = 'Rubidium has a higher density (1.532 g/cm) than potassium. The increase in atomic mass is proportionally greater than the increase in atomic volume, following the general trend of increasing density down the group.';
                 } else if (element === 'cesium') {
                     content = 'Cesium has the highest density in Group 1 (1.93 g/cm). The significant increase in atomic mass compared to the increase in atomic volume results in the highest density in the group.';
                 }
                 
                 quizQuestion = "Why is potassium less dense than sodium?";
                 quizOptions = [
                     "Potassium has fewer protons",
                     "Potassium has a larger atomic radius",
                     "Potassium has more electron shells",
                     "Potassium has a different crystal structure"
                 ];
                 quizCorrect = 1;
                 quizExplanation = "Potassium has a larger atomic radius than sodium, but the increase in size is proportionally greater than the increase in mass, resulting in a lower density. This is an exception to the general trend of increasing density down the group.";
             }
             
             document.getElementById('trendExplanationTitle').textContent = title;
             document.getElementById('trendExplanationHeading').textContent = heading;
             document.getElementById('trendExplanationContent').textContent = content;
             document.getElementById('trendExplanationQuizQuestion').textContent = quizQuestion;
             
             const optionsContainer = document.getElementById('trendExplanationQuizOptions');
             optionsContainer.innerHTML = '';
             
             quizOptions.forEach((option, index) => {
                 const optionDiv = document.createElement('div');
                 optionDiv.className = 'quiz-option';
                 optionDiv.textContent = option;
                 optionDiv.onclick = () => checkTrendExplanationQuizAnswer(index, quizCorrect, quizExplanation);
                 optionsContainer.appendChild(optionDiv);
             });
             
             document.getElementById('trendExplanationQuizFeedback').classList.add('hidden');
             document.getElementById('trendExplanationModal').classList.add('active');
         }
         
         function checkTrendExplanationQuizAnswer(selectedIndex, correctIndex, explanation) {
             const options = document.querySelectorAll('#trendExplanationQuizOptions .quiz-option');
             const feedback = document.getElementById('trendExplanationQuizFeedback');
             
             options.forEach((option, index) => {
                 option.onclick = null; // Disable further clicks
                 if (index === correctIndex) {
                     option.classList.add('correct');
                 } else if (index === selectedIndex) {
                     option.classList.add('incorrect');
                 }
             });
             
             if (selectedIndex === correctIndex) {
                 feedback.className = 'mt-3 p-4 rounded-lg bg-green-100 text-green-800';
                 feedback.textContent = 'Correct! ' + explanation;
                 if (soundEnabled) correctSound.play();
             } else {
                 feedback.className = 'mt-3 p-4 rounded-lg bg-red-100 text-red-800';
                 feedback.textContent = 'Incorrect. ' + explanation;
                 if (soundEnabled) incorrectSound.play();
             }
             
             feedback.classList.remove('hidden');
         }
         
         function closeTrendExplanation() {
             document.getElementById('trendExplanationModal').classList.remove('active');
         }
         
         // Reaction details functions
         function showReactionDetails(reaction) {
             const details = reactionDetails[reaction];
             if (!details) return;
             
             document.getElementById('reactionDetailsTitle').textContent = `${reaction.replace('-', ' ').replace(/\b\w/g, l => l.toUpperCase())}`;
             document.getElementById('reactionDetailsEquation').textContent = details.equation;
             document.getElementById('reactionDetailsObservations').textContent = details.observations;
             document.getElementById('reactionDetailsExplanation').textContent = details.explanation;
             
             // Setup quiz
             document.getElementById('reactionDetailsQuizQuestion').textContent = details.quizQuestion;
             const optionsContainer = document.getElementById('reactionDetailsQuizOptions');
             optionsContainer.innerHTML = '';
             
             details.quizOptions.forEach((option, index) => {
                 const optionDiv = document.createElement('div');
                 optionDiv.className = 'quiz-option';
                 optionDiv.textContent = option;
                 optionDiv.onclick = () => checkReactionDetailsQuizAnswer(index, details.quizCorrect, details.quizExplanation);
                 optionsContainer.appendChild(optionDiv);
             });
             
             document.getElementById('reactionDetailsQuizFeedback').classList.add('hidden');
             document.getElementById('reactionDetailsModal').classList.add('active');
         }
         
         function checkReactionDetailsQuizAnswer(selectedIndex, correctIndex, explanation) {
             const options = document.querySelectorAll('#reactionDetailsQuizOptions .quiz-option');
             const feedback = document.getElementById('reactionDetailsQuizFeedback');
             
             options.forEach((option, index) => {
                 option.onclick = null; // Disable further clicks
                 if (index === correctIndex) {
                     option.classList.add('correct');
                 } else if (index === selectedIndex) {
                     option.classList.add('incorrect');
                 }
             });
             
             if (selectedIndex === correctIndex) {
                 feedback.className = 'mt-3 p-4 rounded-lg bg-green-100 text-green-800';
                 feedback.textContent = 'Correct! ' + explanation;
                 if (soundEnabled) correctSound.play();
             } else {
                 feedback.className = 'mt-3 p-4 rounded-lg bg-red-100 text-red-800';
                 feedback.textContent = 'Incorrect. ' + explanation;
                 if (soundEnabled) incorrectSound.play();
             }
             
             feedback.classList.remove('hidden');
         }
         
         function closeReactionDetails() {
             document.getElementById('reactionDetailsModal').classList.remove('active');
         }
         
         function showReactionVideo(element) {
             showToast('info', 'Video Demo', `This would show a video of ${element} reacting with water. In a real implementation, this would open a modal with an embedded video.`);
         }
         
         function showOxideTrendQuiz() {
             const question = {
                 question: "Which type of oxide does Potassium form when burned in oxygen?",
                 options: [
                     "Normal oxide (KO)",
                     "Peroxide (KO)",
                     "Superoxide (KO)",
                     "No oxide is formed"
                 ],
                 correct: 2,
                 explanation: "Potassium forms a superoxide (KO) when burned in oxygen. This contains the superoxide ion (O) with an unpaired electron."
             };
             
             document.getElementById('quizQuestionModal').classList.add('active');
             document.getElementById('quizQuestionTitle').textContent = 'Oxide Trend Quiz';
             document.getElementById('quizQuestionText').textContent = question.question;
             
             const answersContainer = document.getElementById('quizQuestionAnswers');
             answersContainer.innerHTML = '';
             
             question.options.forEach((option, index) => {
                 const answerDiv = document.createElement('div');
                 answerDiv.className = 'quiz-option';
                 answerDiv.textContent = option;
                 answerDiv.onclick = () => selectOxideTrendQuizAnswer(index, question.correct, question.explanation);
                 answersContainer.appendChild(answerDiv);
             });
             
             // Reset feedback
             document.getElementById('quizQuestionFeedback').classList.add('hidden');
         }
         
         function selectOxideTrendQuizAnswer(index, correctIndex, explanation) {
             const answers = document.querySelectorAll('#quizQuestionAnswers .quiz-option');
             const feedback = document.getElementById('quizQuestionFeedback');
             
             answers.forEach(answer => {
                 answer.style.pointerEvents = 'none';
             });
             
             if (index === correctIndex) {
                 answers[index].classList.add('correct');
                 feedback.className = 'quiz-feedback correct';
                 feedback.textContent = 'Correct! ' + explanation;
                 
                 if (soundEnabled) correctSound.play();
             } else {
                 answers[index].classList.add('incorrect');
                 feedback.className = 'quiz-feedback incorrect';
                 feedback.textContent = 'Incorrect. ' + explanation;
                 
                 if (soundEnabled) incorrectSound.play();
             }
             
             feedback.classList.remove('hidden');
         }
         
         // Quiz Functions
         function startQuiz() {
             currentQuestion = 0;
             score = 0;
             selectedOption = null;
             answerSubmitted = false;
             quizAnswers = [];
             
             document.getElementById('quizModal').classList.add('active');
             document.getElementById('quizProgress').style.display = 'block';
             document.getElementById('quizContent').style.display = 'block';
             document.getElementById('quizResults').style.display = 'none';
             
             document.getElementById('currentQuestion').textContent = currentQuestion + 1;
             document.getElementById('totalQuestions').textContent = quizQuestions.length;
             document.getElementById('currentScore').textContent = score;
             document.getElementById('progressFill').style.width = ((currentQuestion + 1) / quizQuestions.length * 100) + '%';
             
             loadQuestion();
             
             // Add anti-cheating measures
             addAntiCheatingMeasures();
         }
         
         function addAntiCheatingMeasures() {
             // Disable right-click
             document.getElementById('quizModal').addEventListener('contextmenu', e => e.preventDefault());
             
             // Disable text selection
             document.getElementById('quizModal').addEventListener('selectstart', e => e.preventDefault());
             document.getElementById('quizModal').addEventListener('mousedown', e => e.preventDefault());
             
             // Warn before leaving
             window.addEventListener('beforeunload', preventQuizExit);
         }
         
         function removeAntiCheatingMeasures() {
             // Re-enable right-click
             document.getElementById('quizModal').removeEventListener('contextmenu', e => e.preventDefault());
             
             // Re-enable text selection
             document.getElementById('quizModal').removeEventListener('selectstart', e => e.preventDefault());
             document.getElementById('quizModal').removeEventListener('mousedown', e => e.preventDefault());
             
             // Remove beforeunload listener
             window.removeEventListener('beforeunload', preventQuizExit);
         }
         
         function preventQuizExit(e) {
             if (document.getElementById('quizModal').classList.contains('active')) {
                 e.preventDefault();
                 e.returnValue = '';
                 return '';
             }
         }
         
         function loadQuestion() {
             const question = quizQuestions[currentQuestion];
             document.getElementById('questionText').textContent = question.question;
             
             // Reset animation for question text
             const questionText = document.getElementById('questionText');
             questionText.style.animation = 'none';
             setTimeout(() => {
                 questionText.style.animation = 'fadeInUp 0.7s ease-out';
             }, 10);
             
             const optionsContainer = document.getElementById('optionsContainer');
             optionsContainer.innerHTML = '';
             
             // Check if this question has been answered already
             const answeredQuestion = quizAnswers[currentQuestion];
             
             // Load MCQ options
             question.options.forEach((option, index) => {
                 const optionDiv = document.createElement('div');
                 optionDiv.className = 'quiz-option';
                 if (answeredQuestion) {
                     optionDiv.classList.add('disabled');
                     if (answeredQuestion.selected === index) {
                         optionDiv.classList.add(answeredQuestion.isCorrect ? 'correct' : 'incorrect');
                     }
                 }
                 optionDiv.dataset.index = index;
                 
                 const input = document.createElement('input');
                 input.type = 'radio';
                 input.name = 'quiz-option';
                 input.id = `option-${index}`;
                 input.value = index;
                 if (answeredQuestion && answeredQuestion.selected === index) {
                     input.checked = true;
                 }
                 if (answeredQuestion) {
                     input.disabled = true;
                 }
                 
                 const label = document.createElement('label');
                 label.htmlFor = `option-${index}`;
                 label.textContent = option;
                 
                 optionDiv.appendChild(input);
                 optionDiv.appendChild(label);
                 
                 if (!answeredQuestion) {
                     optionDiv.onclick = () => selectOption(index);
                 }
                 optionsContainer.appendChild(optionDiv);
             });
             
             // Show/hide navigation buttons
             document.getElementById('prevButton').classList.toggle('hidden', currentQuestion === 0);
             
             // Show submit button if not answered, show next button if answered
             if (answeredQuestion) {
                 document.getElementById('submitButton').style.display = 'none';
                 document.getElementById('nextButton').classList.remove('hidden');
                 
                 // Show feedback for answered question
                 const feedback = document.getElementById('feedback');
                 if (answeredQuestion.isCorrect) {
                     feedback.className = 'mb-5 p-4 rounded-lg bg-green-100 text-green-800 text-sm';
                     feedback.textContent = 'Correct! ' + question.explanation;
                 } else {
                     feedback.className = 'mb-5 p-4 rounded-lg bg-red-100 text-red-800 text-sm';
                     feedback.textContent = 'Incorrect. ' + question.explanation;
                 }
                 feedback.classList.remove('hidden');
             } else {
                 document.getElementById('submitButton').style.display = 'inline-flex';
                 document.getElementById('submitButton').disabled = true;
                 document.getElementById('nextButton').classList.add('hidden');
                 document.getElementById('feedback').classList.add('hidden');
             }
             
             selectedOption = answeredQuestion ? answeredQuestion.selected : null;
             answerSubmitted = !!answeredQuestion;
             
             // Apply fade-in to options
             setTimeout(() => {
                 document.querySelectorAll('#optionsContainer .quiz-option').forEach(option => {
                     option.style.animation = 'fadeInScale 0.5s ease-out forwards';
                 });
             }, 100);
         }
         
         function selectOption(index) {
             if (answerSubmitted) return;
             
             const options = document.querySelectorAll('.quiz-option');
             options.forEach(option => {
                 option.classList.remove('selected');
                 const input = option.querySelector('input');
                 input.checked = false;
             });
             
             options[index].classList.add('selected');
             options[index].querySelector('input').checked = true;
             
             selectedOption = index;
             document.getElementById('submitButton').disabled = false;
         }
         
         function submitAnswer() {
             if (answerSubmitted) return;
             
             const question = quizQuestions[currentQuestion];
             const isCorrect = selectedOption === question.correct;
             const feedback = document.getElementById('feedback');
             
             quizAnswers[currentQuestion] = {
                 selected: selectedOption,
                 submitted: true,
                 isCorrect: isCorrect
             };
             
             // Store quiz analytics in Firebase
             const analyticsRef = database.ref('quizAnalytics/' + currentQuestion);
             analyticsRef.transaction((analytics) => {
                 if (!analytics) {
                     analytics = { correct: 0, incorrect: 0 };
                 }
                 if (isCorrect) {
                     analytics.correct++;
                 } else {
                     analytics.incorrect++;
                 }
                 return analytics;
             });
             
             if (isCorrect) {
                 feedback.className = 'mb-5 p-4 rounded-lg bg-green-100 text-green-800 text-sm';
                 feedback.textContent = 'Correct! ' + question.explanation;
                 score++;
                 
                 if (soundEnabled) correctSound.play();
             } else {
                 feedback.className = 'mb-5 p-4 rounded-lg bg-red-100 text-red-800 text-sm';
                 feedback.textContent = 'Incorrect. ' + question.explanation;
                 
                 if (soundEnabled) incorrectSound.play();
             }
             
             feedback.classList.remove('hidden');
             document.getElementById('submitButton').style.display = 'none';
             document.getElementById('nextButton').classList.remove('hidden');
             document.getElementById('currentScore').textContent = score;
             
             answerSubmitted = true;
         }
         
         function nextQuestion() {
             currentQuestion++;
             
             if (currentQuestion >= quizQuestions.length) {
                 showResults();
                 return;
             }
             
             document.getElementById('currentQuestion').textContent = currentQuestion + 1;
             document.getElementById('progressFill').style.width = ((currentQuestion + 1) / quizQuestions.length * 100) + '%';
             loadQuestion();
         }
         
         function previousQuestion() {
             if (currentQuestion > 0) {
                 currentQuestion--;
                 document.getElementById('currentQuestion').textContent = currentQuestion + 1;
                 document.getElementById('progressFill').style.width = ((currentQuestion + 1) / quizQuestions.length * 100) + '%';
                 loadQuestion();
             }
         }
         
         function showResults() {
             document.getElementById('quizProgress').style.display = 'none';
             document.getElementById('quizContent').style.display = 'none';
             document.getElementById('quizResults').style.display = 'block';
             
             const percentage = Math.round((score / quizQuestions.length) * 100);
             document.getElementById('finalScore').textContent = `${score}/${quizQuestions.length}`;
             
             let message = '';
             if (percentage >= 80) {
                 message = 'Excellent! You have a strong understanding of Group 1 elements.';
             } else if (percentage >= 60) {
                 message = 'Good job! You have a solid foundation to build upon.';
             } else if (percentage >= 40) {
                 message = 'Not bad! Review the materials to improve your understanding.';
             } else {
                 message = 'Keep practicing! Review the materials carefully.';
             }
             
             document.getElementById('scoreMessage').textContent = message;
             
             // Award XP for quiz completion
             const quizXP = Math.round((score / quizQuestions.length) * 20); // Max 20 XP for perfect score
             const newXp = (userData.xp || 0) + quizXP;
             
             // Check for quiz badge
             const newBadges = [...(userData.badges || [])];
             let badgeEarned = false;
             
             if (percentage >= 80 && !newBadges.includes('Quiz Master')) {
                 newBadges.push('Quiz Master');
                 badgeEarned = true;
             }
             
             // Save to Firebase
             const userRef = database.ref('users/' + currentUser.uid);
             const updates = {
                 xp: newXp
             };
             
             if (badgeEarned) {
                 updates.badges = newBadges;
             }
             
             userRef.update(updates).then(() => {
                 userData.xp = newXp;
                 if (badgeEarned) {
                     userData.badges = newBadges;
                 }
                 
                 updateUserXP();
                 updateUserBadges();
                 
                 if (soundEnabled) {
                     completeSound.play();
                     if (badgeEarned) badgeSound.play();
                 }
                 
                 if (badgeEarned) {
                     showToast('success', 'Badge Earned!', `You've earned a new badge: ${newBadges[newBadges.length - 1]}`);
                 }
             });
             
             // Remove anti-cheating measures
             removeAntiCheatingMeasures();
         }
         
         function closeQuiz() {
             document.getElementById('quizModal').classList.remove('active');
             removeAntiCheatingMeasures();
         }
         
         // Feedback System Functions
         function showFeedbackModal() {
             if (!currentUser) {
                 showToast('error', 'Sign in required', 'Please sign in to provide feedback.');
                 showLoginModal();
                 return;
             }
             document.getElementById('feedbackModal').classList.add('active');
         }
         
         function closeFeedbackModal() {
             document.getElementById('feedbackModal').classList.remove('active');
             document.getElementById('feedbackForm').reset();
             document.getElementById('feedbackRating').value = '0';
             // Reset thumbs
             document.querySelectorAll('#feedbackModal .fa-thumbs-up, #feedbackModal .fa-thumbs-down').forEach(icon => {
                 icon.classList.remove('fas', 'text-yellow-500');
                 icon.classList.add('far', 'text-gray-400');
             });
         }
         
         function setFeedbackRating(rating) {
             document.getElementById('feedbackRating').value = rating;
             // Update the thumbs
             document.querySelectorAll('#feedbackModal .fa-thumbs-up, #feedbackModal .fa-thumbs-down').forEach(icon => {
                 icon.classList.remove('fas', 'text-yellow-500');
                 icon.classList.add('far', 'text-gray-400');
             });
             if (rating === 1) {
                 const thumbsDown = document.querySelector('#feedbackModal .fa-thumbs-down');
                 thumbsDown.classList.remove('far', 'text-gray-400');
                 thumbsDown.classList.add('fas', 'text-yellow-500');
             } else if (rating === 2) {
                 const thumbsUp = document.querySelector('#feedbackModal .fa-thumbs-up');
                 thumbsUp.classList.remove('far', 'text-gray-400');
                 thumbsUp.classList.add('fas', 'text-yellow-500');
             }
         }
         
         function handleFeedback(event) {
             event.preventDefault();
             const text = document.getElementById('feedbackText').value.trim();
             const rating = document.getElementById('feedbackRating').value;
             if (!text) {
                 showToast('error', 'Missing Feedback', 'Please enter your feedback.');
                 return;
             }
             // Save feedback to Firebase
             const feedbackRef = database.ref('feedback').push();
             feedbackRef.set({
                 userId: currentUser.uid,
                 userName: userData.displayName,
                 text: text,
                 rating: rating,
                 timestamp: firebase.database.ServerValue.TIMESTAMP
             }).then(() => {
                 showToast('success', 'Feedback Sent', 'Thank you for your feedback.');
                 closeFeedbackModal();
             }).catch((error) => {
                 console.error("Error sending feedback:", error);
                 showToast('error', 'Error', 'Failed to send feedback.');
             });
         }
         
         // Export to PDF
         function exportToPDF() {
             const { jsPDF } = window.jspdf;
             const doc = new jsPDF();
             // Add title
             doc.setFontSize(20);
             doc.text('Group 1 Alkali Metals - Notes', 105, 15, { align: 'center' });
             // Add content from the current section
             const section = document.querySelector('.content-section:not([style*="display: none"])');
             if (section) {
                 const content = section.textContent;
                 doc.setFontSize(12);
                 const lines = doc.splitTextToSize(content, 180);
                 doc.text(lines, 15, 30);
             }
             doc.save('alkali-metals-notes.pdf');
             showToast('success', 'Export Successful', 'Your notes have been exported as PDF.');
         }
         
         // Discussion functions
         function showCreatePostModal() {
             if (!currentUser) {
                 showToast('error', 'Sign in required', 'Please sign in to create posts.');
                 showLoginModal();
                 return;
             }
             document.getElementById('createPostModal').classList.add('active');
         }
         
         function closeCreatePostModal() {
             document.getElementById('createPostModal').classList.remove('active');
             document.getElementById('createPostForm').reset();
         }
         
         function showEditPostModal(postId) {
             if (!currentUser) {
                 showToast('error', 'Sign in required', 'Please sign in to edit posts.');
                 showLoginModal();
                 return;
             }
             
             const post = discussionPosts.find(p => p.id === postId);
             if (!post) return;
             
             document.getElementById('editPostId').value = postId;
             document.getElementById('editPostTitle').value = post.title;
             document.getElementById('editPostContent').value = post.content;
             document.getElementById('editPostTags').value = post.tags ? post.tags.join(', ') : '';
             
             document.getElementById('editPostModal').classList.add('active');
         }
         
         function closeEditPostModal() {
             document.getElementById('editPostModal').classList.remove('active');
             document.getElementById('editPostForm').reset();
         }
         
         function handleCreatePost(event) {
             event.preventDefault();
             
             const title = document.getElementById('postTitle').value.trim();
             const content = document.getElementById('postContent').value.trim();
             const tags = document.getElementById('postTags').value.trim();
             
             if (!title || !content) {
                 showToast('error', 'Missing Fields', 'Please fill in all required fields.');
                 return;
             }
             
             const postsRef = database.ref('discussionPosts').push();
             const newPost = {
                 authorId: currentUser.uid,
                 authorName: userData.displayName,
                 title: title,
                 content: content,
                 tags: tags ? tags.split(',').map(tag => tag.trim()) : [],
                 upvotes: 0,
                 downvotes: 0,
                 votes: {},
                 comments: 0,
                 saved: 0,
                 createdAt: firebase.database.ServerValue.TIMESTAMP
             };
             
             postsRef.set(newPost).then(() => {
                 showToast('success', 'Post Created!', 'Your post has been published successfully.');
                 closeCreatePostModal();
             }).catch((error) => {
                 console.error("Error creating post:", error);
                 showToast('error', 'Error', 'Failed to create post.');
             });
         }
         
         function handleEditPost(event) {
             event.preventDefault();
             
             const postId = document.getElementById('editPostId').value;
             const title = document.getElementById('editPostTitle').value.trim();
             const content = document.getElementById('editPostContent').value.trim();
             const tags = document.getElementById('editPostTags').value.trim();
             
             if (!title || !content) {
                 showToast('error', 'Missing Fields', 'Please fill in all required fields.');
                 return;
             }
             
             const postRef = database.ref('discussionPosts/' + postId);
             postRef.once('value').then((snapshot) => {
                 const post = snapshot.val();
                 
                 if (!post) {
                     showToast('error', 'Error', 'Post not found.');
                     return;
                 }
                 
                 if (post.authorId !== currentUser.uid) {
                     showToast('error', 'Permission Denied', 'You can only edit your own posts.');
                     return;
                 }
                 
                 const updates = {};
                 updates['/title'] = title;
                 updates['/content'] = content;
                 updates['/tags'] = tags ? tags.split(',').map(tag => tag.trim()) : [];
                 updates['/editedAt'] = firebase.database.ServerValue.TIMESTAMP;
                 
                 postRef.update(updates).then(() => {
                     showToast('success', 'Post Updated!', 'Your post has been updated successfully.');
                     closeEditPostModal();
                 }).catch((error) => {
                     console.error("Error updating post:", error);
                     showToast('error', 'Error', 'Failed to update post.');
                 });
             }).catch((error) => {
                 console.error("Error getting post:", error);
                 showToast('error', 'Error', 'Failed to update post.');
             });
         }
         
         function loadDiscussionPosts() {
             const postsContainer = document.getElementById('discussionPosts');
             postsContainer.innerHTML = '<div class="spinner"></div>';
             
             const postsRef = database.ref('discussionPosts');
             postsRef.orderByChild('createdAt').on('value', (snapshot) => {
                 postsContainer.innerHTML = '';
                 
                 if (!snapshot.exists()) {
                     postsContainer.innerHTML = `
                         <div class="empty-state">
                             <div class="empty-state-icon">
                                 <i class="fas fa-comments"></i>
                             </div>
                             <h3 class="empty-state-title">No Posts Yet</h3>
                             <p class="empty-state-description">Be the first to start a discussion about Group 1 Alkali Metals.</p>
                         </div>`;
                     return;
                 }
                 
                 discussionPosts = [];
                 snapshot.forEach((childSnapshot) => {
                     discussionPosts.push({
                         id: childSnapshot.key,
                         ...childSnapshot.val()
                     });
                 });
                 
                 // Sort based on current sort option
                 sortDiscussionPosts();
                 
                 discussionPosts.forEach(post => {
                     const postElement = createDiscussionPostElement(post);
                     postsContainer.appendChild(postElement);
                 });
                 
                 // Apply fade-in to new posts
                 setTimeout(() => {
                     if (fadeObserver) {
                         postsContainer.querySelectorAll('.discussion-post').forEach(post => {
                             fadeObserver.observe(post);
                         });
                     }
                 }, 100);
             }, (error) => {
                 console.error("Error loading discussion posts:", error);
                 postsContainer.innerHTML = '<p class="text-gray-500 text-center">Error loading posts.</p>';
             });
         }
         
         function sortDiscussionPosts() {
             switch(currentSort) {
                 case 'newest':
                     discussionPosts.sort((a, b) => {
                         return new Date(b.createdAt) - new Date(a.createdAt);
                     });
                     break;
                 case 'oldest':
                     discussionPosts.sort((a, b) => {
                         return new Date(a.createdAt) - new Date(b.createdAt);
                     });
                     break;
                 case 'popular':
                     discussionPosts.sort((a, b) => {
                         const aScore = (a.upvotes || 0) - (a.downvotes || 0);
                         const bScore = (b.upvotes || 0) - (b.downvotes || 0);
                         return bScore - aScore;
                     });
                     break;
             }
         }
         
         function sortDiscussions(sortType) {
             currentSort = sortType;
             
             // Update active button
             document.querySelectorAll('.filter-btn').forEach(btn => {
                 btn.classList.remove('active', 'bg-indigo-600', 'text-white');
                 btn.classList.add('bg-gray-200', 'text-gray-700');
             });
             event.target.classList.remove('bg-gray-200', 'text-gray-700');
             event.target.classList.add('active', 'bg-indigo-600', 'text-white');
             
             // Re-sort and re-render
             sortDiscussionPosts();
             
             const postsContainer = document.getElementById('discussionPosts');
             postsContainer.innerHTML = '';
             
             discussionPosts.forEach(post => {
                 const postElement = createDiscussionPostElement(post);
                 postsContainer.appendChild(postElement);
             });
         }
         
         function filterDiscussions() {
             const searchTerm = document.getElementById('discussionSearch').value.toLowerCase();
             
             const postsContainer = document.getElementById('discussionPosts');
             postsContainer.innerHTML = '';
             
             const filteredPosts = discussionPosts.filter(post => {
                 return post.title.toLowerCase().includes(searchTerm) || 
                        post.content.toLowerCase().includes(searchTerm) ||
                        (post.tags && post.tags.some(tag => tag.toLowerCase().includes(searchTerm)));
             });
             
             if (filteredPosts.length === 0) {
                 postsContainer.innerHTML = `
                     <div class="empty-state">
                         <div class="empty-state-icon">
                             <i class="fas fa-search"></i>
                         </div>
                         <h3 class="empty-state-title">No Posts Found</h3>
                         <p class="empty-state-description">No posts match your search criteria.</p>
                     </div>`;
                 return;
             }
             
             filteredPosts.forEach(post => {
                 const postElement = createDiscussionPostElement(post);
                 postsContainer.appendChild(postElement);
             });
         }
         
         function createDiscussionPostElement(post) {
             const postDiv = document.createElement('div');
             postDiv.className = 'discussion-post fade-in';
             
             const date = new Date(post.createdAt);
             const formattedDate = date.toLocaleDateString();
             const formattedTime = date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
             
             const isAuthor = currentUser && post.authorId === currentUser.uid;
             const userVote = post.votes && post.votes[currentUser.uid];
             const isSaved = userData && userData.savedPosts && userData.savedPosts.includes(post.id);
             
             postDiv.innerHTML = `
                 <div class="post-header">
                     <div class="post-avatar">${post.authorName ? post.authorName.charAt(0).toUpperCase() : 'A'}</div>
                     <div class="post-meta">
                         <div class="post-author">${post.authorName || 'Anonymous'}</div>
                         <div class="post-time">${formattedDate} at ${formattedTime}</div>
                     </div>
                 </div>
                 <h3 class="post-title">${post.title}</h3>
                 <div class="post-content">${post.content}</div>
                 ${post.tags && post.tags.length > 0 ? `
                     <div class="mt-3">
                         ${post.tags.map(tag => `<span class="post-tag">#${tag}</span>`).join('')}
                     </div>
                 ` : ''}
                 <div class="post-actions">
                     <div class="post-action ${userVote === true ? 'voted' : ''}" onclick="togglePostVote('${post.id}', 'up')">
                         <i class="fas fa-arrow-up"></i>
                         <span>${post.upvotes || 0}</span>
                     </div>
                     <div class="post-action ${userVote === false ? 'voted' : ''}" onclick="togglePostVote('${post.id}', 'down')">
                         <i class="fas fa-arrow-down"></i>
                         <span>${post.downvotes || 0}</span>
                     </div>
                     <div class="post-action" onclick="toggleComments('${post.id}')">
                         <i class="fas fa-comment"></i>
                         <span>${post.comments || 0}</span>
                     </div>
                     <div class="post-action ${isSaved ? 'voted' : ''}" onclick="toggleSavePost('${post.id}')">
                         <i class="fas fa-bookmark"></i>
                         <span>${post.saved || 0}</span>
                     </div>
                     ${isAuthor ? `
                         <div class="post-action" onclick="showEditPostModal('${post.id}')">
                             <i class="fas fa-edit"></i>
                             Edit
                         </div>
                         <div class="post-action text-red-500" onclick="deletePost('${post.id}')">
                             <i class="fas fa-trash"></i>
                             Delete
                         </div>
                     ` : ''}
                 </div>
                 <div id="comments-${post.id}" class="comments-section" style="display: none;">
                     <div class="mb-4">
                         <form onsubmit="addComment(event, '${post.id}')" class="flex gap-3">
                             <input type="text" id="comment-input-${post.id}" class="form-input flex-1" placeholder="Add a comment...">
                             <button type="submit" class="btn btn-primary">Comment</button>
                         </form>
                     </div>
                     <div id="comments-list-${post.id}"></div>
                 </div>
             `;
             
             // Load comments for this post
             loadPostComments(post.id);
             
             return postDiv;
         }
         
         function togglePostVote(postId, voteType) {
             if (!currentUser) {
                 showToast('error', 'Sign in required', 'Please sign in to vote on posts.');
                 showLoginModal();
                 return;
             }
             
             const postRef = database.ref('discussionPosts/' + postId);
             postRef.once('value').then((snapshot) => {
                 const post = snapshot.val();
                 
                 if (!post) {
                     showToast('error', 'Error', 'Post not found.');
                     return;
                 }
                 
                 const votes = post.votes || {};
                 const currentVote = votes[currentUser.uid];
                 const upvotes = post.upvotes || 0;
                 const downvotes = post.downvotes || 0;
                 
                 let newUpvotes = upvotes;
                 let newDownvotes = downvotes;
                 let newVotes = { ...votes };
                 
                 if (voteType === 'up') {
                     if (currentVote === true) {
                         // Remove upvote
                         delete newVotes[currentUser.uid];
                         newUpvotes = Math.max(0, upvotes - 1);
                     } else {
                         // Add or change to upvote
                         newVotes[currentUser.uid] = true;
                         newUpvotes = upvotes + 1;
                         if (currentVote === false) {
                             // Was downvoted before
                             newDownvotes = Math.max(0, downvotes - 1);
                         }
                     }
                 } else { // voteType === 'down'
                     if (currentVote === false) {
                         // Remove downvote
                         delete newVotes[currentUser.uid];
                         newDownvotes = Math.max(0, downvotes - 1);
                     } else {
                         // Add or change to downvote
                         newVotes[currentUser.uid] = false;
                         newDownvotes = downvotes + 1;
                         if (currentVote === true) {
                             // Was upvoted before
                             newUpvotes = Math.max(0, upvotes - 1);
                         }
                     }
                 }
                 
                 const updates = {};
                 updates['/upvotes'] = newUpvotes;
                 updates['/downvotes'] = newDownvotes;
                 updates['/votes'] = newVotes;
                 
                 postRef.update(updates).catch((error) => {
                     console.error("Error voting on post:", error);
                     showToast('error', 'Error', 'Failed to vote on post.');
                 });
             }).catch((error) => {
                 console.error("Error getting post:", error);
                 showToast('error', 'Error', 'Failed to vote on post.');
             });
         }
         
         function toggleSavePost(postId) {
             if (!currentUser) {
                 showToast('error', 'Sign in required', 'Please sign in to save posts.');
                 showLoginModal();
                 return;
             }
             
             const userRef = database.ref('users/' + currentUser.uid);
             userRef.once('value').then((snapshot) => {
                 const userData = snapshot.val();
                 const savedPosts = userData.savedPosts || [];
                 
                 const postIndex = savedPosts.indexOf(postId);
                 const postRef = database.ref('discussionPosts/' + postId);
                 
                 if (postIndex > -1) {
                     // Remove from saved posts
                     savedPosts.splice(postIndex, 1);
                     
                     // Decrement saved count
                     postRef.transaction((post) => {
                         if (post) {
                             post.saved = Math.max(0, (post.saved || 0) - 1);
                         }
                         return post;
                     });
                     
                     showToast('info', 'Post Unsaved', 'This post has been removed from your saved posts.');
                 } else {
                     // Add to saved posts
                     savedPosts.push(postId);
                     
                     // Increment saved count
                     postRef.transaction((post) => {
                         if (post) {
                             post.saved = (post.saved || 0) + 1;
                         }
                         return post;
                     });
                     
                     showToast('success', 'Post Saved!', 'This post has been added to your saved posts.');
                 }
                 
                 // Update user data
                 userRef.update({
                     savedPosts: savedPosts
                 });
                 
                 // Update local user data
                 userData.savedPosts = savedPosts;
             }).catch((error) => {
                 console.error("Error saving post:", error);
                 showToast('error', 'Error', 'Failed to save post.');
             });
         }
         
         function deletePost(postId) {
             if (!confirm('Are you sure you want to delete this post?')) {
                 return;
             }
             
             const postRef = database.ref('discussionPosts/' + postId);
             postRef.remove().then(() => {
                 showToast('success', 'Post Deleted', 'Your post has been deleted successfully.');
             }).catch((error) => {
                 console.error("Error deleting post:", error);
                 showToast('error', 'Error', 'Failed to delete post.');
             });
         }
         
         function toggleComments(postId) {
             const commentsSection = document.getElementById(`comments-${postId}`);
             if (commentsSection.style.display === 'none') {
                 commentsSection.style.display = 'block';
                 // Focus on comment input
                 const commentInput = document.getElementById(`comment-input-${postId}`);
                 if (commentInput) {
                     commentInput.focus();
                 }
                 
                 // Ensure comments are loaded and visible
                 loadPostComments(postId);
             } else {
                 commentsSection.style.display = 'none';
             }
         }
         
         function loadPostComments(postId) {
             const commentsContainer = document.getElementById(`comments-list-${postId}`);
             if (!commentsContainer) return;
             
             // Show loading indicator
             commentsContainer.innerHTML = '<div class="text-center py-3"><div class="spinner"></div></div>';
             
             const commentsRef = database.ref('postComments').orderByChild('postId').equalTo(postId);
             commentsRef.on('value', (snapshot) => {
                 commentsContainer.innerHTML = '';
                 
                 if (!snapshot.exists()) {
                     commentsContainer.innerHTML = '<p class="text-gray-500 text-center py-3">No comments yet. Be the first to comment!</p>';
                     return;
                 }
                 
                 const commentsArray = [];
                 snapshot.forEach((childSnapshot) => {
                     commentsArray.push({
                         id: childSnapshot.key,
                         ...childSnapshot.val()
                     });
                 });
                 
                 // Sort by creation date (oldest first)
                 commentsArray.sort((a, b) => {
                     return new Date(a.createdAt) - new Date(b.createdAt);
                 });
                 
                 if (commentsArray.length === 0) {
                     commentsContainer.innerHTML = '<p class="text-gray-500 text-center py-3">No comments yet. Be the first to comment!</p>';
                     return;
                 }
                 
                 commentsArray.forEach(comment => {
                     const commentElement = createCommentElement(comment);
                     commentsContainer.appendChild(commentElement);
                 });
             });
         }
         
         function createCommentElement(comment) {
             const commentDiv = document.createElement('div');
             commentDiv.className = 'comment mb-4 p-4 bg-white rounded-lg shadow-sm';
             
             const date = new Date(comment.createdAt);
             const formattedDate = date.toLocaleDateString();
             const formattedTime = date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
             const isAuthor = currentUser && comment.authorId === currentUser.uid;
             
             commentDiv.innerHTML = `
                 <div class="flex items-start space-x-4">
                     <div class="comment-avatar flex-shrink-0 w-10 h-10 rounded-full bg-indigo-100 flex items-center justify-center">
                         <span class="text-indigo-800 font-medium">${comment.authorName ? comment.authorName.charAt(0).toUpperCase() : 'A'}</span>
                     </div>
                     <div class="flex-1">
                         <div class="flex items-center justify-between">
                             <div class="comment-author font-semibold text-gray-800">${comment.authorName || 'Anonymous'}</div>
                             <div class="comment-time text-xs text-gray-500">${formattedDate} at ${formattedTime}</div>
                         </div>
                         <div class="comment-content mt-2 text-gray-700">${comment.content}</div>
                         ${isAuthor ? `
                             <div class="mt-3">
                                 <button onclick="deleteComment('${comment.id}', '${comment.postId}')" class="text-red-500 text-sm hover:text-red-700 flex items-center">
                                     <i class="fas fa-trash mr-2"></i>Delete
                                 </button>
                             </div>
                         ` : ''}
                     </div>
                 </div>
             `;
             
             return commentDiv;
         }
         
         function addComment(event, postId) {
             event.preventDefault();
             
             if (!currentUser) {
                 showToast('error', 'Sign in required', 'Please sign in to comment.');
                 showLoginModal();
                 return;
             }
             
             const commentInput = document.getElementById(`comment-input-${postId}`);
             const content = commentInput.value.trim();
             
             if (!content) {
                 showToast('error', 'Empty Comment', 'Please enter a comment before posting.');
                 return;
             }
             
             const commentsRef = database.ref('postComments').push();
             const newComment = {
                 postId: postId,
                 authorId: currentUser.uid,
                 authorName: userData.displayName,
                 content: content,
                 createdAt: firebase.database.ServerValue.TIMESTAMP
             };
             
             commentsRef.set(newComment).then(() => {
                 // Update comment count on post
                 const postRef = database.ref('discussionPosts/' + postId);
                 postRef.transaction((post) => {
                     if (post) {
                         post.comments = (post.comments || 0) + 1;
                     }
                     return post;
                 });
                 
                 // Clear input field
                 commentInput.value = '';
                 
                 // Show success message
                 showToast('success', 'Comment Added', 'Your comment has been posted successfully.');
                 
                 // Load comments for this post to update the UI
                 loadPostComments(postId);
             }).catch((error) => {
                 console.error("Error adding comment:", error);
                 showToast('error', 'Error', 'Failed to post comment.');
             });
         }
         
         function deleteComment(commentId, postId) {
             if (!confirm('Are you sure you want to delete this comment?')) {
                 return;
             }
             
             const commentRef = database.ref('postComments/' + commentId);
             commentRef.remove().then(() => {
                 // Update comment count on post
                 const postRef = database.ref('discussionPosts/' + postId);
                 postRef.transaction((post) => {
                     if (post) {
                         post.comments = Math.max(0, (post.comments || 0) - 1);
                     }
                     return post;
                 });
                 
                 showToast('success', 'Comment Deleted', 'Your comment has been deleted successfully.');
                 
                 // Reload comments to update the UI
                 loadPostComments(postId);
             }).catch((error) => {
                 console.error("Error deleting comment:", error);
                 showToast('error', 'Error', 'Failed to delete comment.');
             });
         }
         
         // Study Groups functions
         function showCreateGroupModal() {
             if (!currentUser) {
                 showToast('error', 'Sign in required', 'Please sign in to create study groups.');
                 showLoginModal();
                 return;
             }
             document.getElementById('createGroupModal').classList.add('active');
         }
         
         function closeCreateGroupModal() {
             document.getElementById('createGroupModal').classList.remove('active');
             document.getElementById('createGroupForm').reset();
         }
         
         function handleCreateGroup(event) {
             event.preventDefault();
             
             const name = document.getElementById('groupName').value.trim();
             const topic = document.getElementById('groupTopic').value;
             const description = document.getElementById('groupDescription').value.trim();
             const maxMembers = parseInt(document.getElementById('groupMaxMembers').value);
             
             if (!name || !topic || !description) {
                 showToast('error', 'Missing Fields', 'Please fill in all fields.');
                 return;
             }
             
             const groupsRef = database.ref('studyGroups').push();
             const newGroup = {
                 name: name,
                 topic: topic,
                 description: description,
                 maxMembers: maxMembers,
                 creatorId: currentUser.uid,
                 creatorName: userData.displayName,
                 members: [currentUser.uid],
                 memberCount: 1,
                 announcements: [],
                 resources: [],
                 createdAt: firebase.database.ServerValue.TIMESTAMP,
                 lastActivity: firebase.database.ServerValue.TIMESTAMP
             };
             
             groupsRef.set(newGroup).then(() => {
                 showToast('success', 'Group Created!', 'Your study group has been created successfully.');
                 closeCreateGroupModal();
             }).catch((error) => {
                 console.error("Error creating study group:", error);
                 showToast('error', 'Error', 'Failed to create study group.');
             });
         }
         
         function loadStudyGroups() {
    const groupsContainer = document.getElementById('studyGroupsList');
    groupsContainer.innerHTML = '<div class="spinner"></div>';
    
    // Make spinner visible immediately
    setTimeout(() => {
        const spinner = groupsContainer.querySelector('.spinner');
        if (spinner) spinner.style.display = 'block';
    }, 10);
    
    const groupsRef = database.ref('studyGroups');
    groupsRef.on('value', (snapshot) => {
        groupsContainer.innerHTML = '';
        
        if (!snapshot.exists()) {
            groupsContainer.innerHTML = `
                <div class="empty-state">
                    <div class="empty-state-icon">
                        <i class="fas fa-users"></i>
                    </div>
                    <h3 class="empty-state-title">No Study Groups Yet</h3>
                    <p class="empty-state-description">Create your first study group to collaborate with peers.</p>
                </div>`;
            // Force visibility
            setTimeout(() => {
                groupsContainer.style.display = 'block';
                groupsContainer.style.visibility = 'visible';
                groupsContainer.style.opacity = '1';
            }, 50);
            return;
        }
        
        studyGroups = [];
        snapshot.forEach((childSnapshot) => {
            studyGroups.push({
                id: childSnapshot.key,
                ...childSnapshot.val()
            });
        });
        
        // Create a document fragment to improve performance
        const fragment = document.createDocumentFragment();
        
        studyGroups.forEach(group => {
            const groupElement = createStudyGroupElement(group);
            fragment.appendChild(groupElement);
        });
        
        // Append all elements at once
        groupsContainer.appendChild(fragment);
        
        // Force visibility of the container and all its children
        setTimeout(() => {
            groupsContainer.style.display = 'block';
            groupsContainer.style.visibility = 'visible';
            groupsContainer.style.opacity = '1';
            
            // Make all child elements visible
            Array.from(groupsContainer.children).forEach(child => {
                child.style.display = 'block';
                child.style.visibility = 'visible';
                child.style.opacity = '1';
                
                // If it's a study group card, make its children visible too
                if (child.classList.contains('study-group-card')) {
                    Array.from(child.children).forEach(grandChild => {
                        grandChild.style.display = 'block';
                        grandChild.style.visibility = 'visible';
                        grandChild.style.opacity = '1';
                    });
                }
            });
        }, 100);
    }, (error) => {
        console.error("Error loading study groups:", error);
        groupsContainer.innerHTML = '<p class="text-gray-500 text-center">Error loading study groups.</p>';
        // Force error message visibility
        setTimeout(() => {
            groupsContainer.style.display = 'block';
            groupsContainer.style.visibility = 'visible';
            groupsContainer.style.opacity = '1';
        }, 50);
    });
}
         
         function createStudyGroupElement(group) {
             const groupDiv = document.createElement('div');
             groupDiv.className = 'study-group-card fade-in';
            // Force immediate visibility for fade-in elements
            setTimeout(() => {
                groupDiv.classList.add('visible');
            }, 100);
             
             const isMember = currentUser && group.members && group.members.includes(currentUser.uid);
             const memberCount = group.members ? group.members.length : 0;
             const maxMembers = group.maxMembers || 10;
             const isFull = memberCount >= maxMembers;
             
             const createdDate = new Date(group.createdAt);
             const formattedDate = createdDate.toLocaleDateString();
             
             // Format topic for display
             const topicLabels = {
                 'melting-point': 'Melting Point Trends',
                 'density': 'Density Trends',
                 'reactivity': 'Reactivity Series',
                 'reactions': 'Chemical Reactions',
                 'electron-configuration': 'Electron Configuration',
                 'experiments': 'Laboratory Experiments',
                 'exam-prep': 'Exam Preparation'
             };
             
             groupDiv.innerHTML = `
                 <div class="group-header">
                     <div>
                         <h3 class="group-title">${group.name}</h3>
                         <span class="group-topic">${topicLabels[group.topic] || group.topic}</span>
                     </div>
                 </div>
                 <p class="group-description">${group.description}</p>
                 <div class="group-meta">
                     <div class="group-members">
                         <div class="flex -space-x-2">
                             ${(group.members || []).slice(0, 5).map(member =>
                                 `<div class="member-avatar" title="${member}">${member.charAt(0).toUpperCase()}</div>`
                             ).join('')}
                             ${(memberCount || 0) > 5 ?
                                 `<div class="member-avatar">+${(memberCount || 0) - 5}</div>` : ''
                             }
                         </div>
                         <span class="ml-3 text-sm">${memberCount}/${maxMembers} members</span>
                     </div>
                     <div class="group-stats">
                         Created on ${formattedDate}
                     </div>
                 </div>
                 <div class="group-actions">
                     <button onclick="showGroupDetails('${group.id}')" class="btn btn-primary btn-sm">
                         <i class="fas fa-eye mr-2"></i>
                         View Details
                     </button>
                     <button onclick="${isMember ? 'leaveStudyGroup' : 'joinStudyGroup'}('${group.id}')"
                             class="btn ${isMember ? 'btn-danger' : 'btn-primary'} btn-sm"
                             ${isFull && !isMember ? 'disabled' : ''}>
                         ${isMember ? 'Leave Group' : isFull ? 'Full' : 'Join Group'}
                     </button>
                 </div>
             `;
             
             return groupDiv;
         }
         
         function showGroupDetails(groupId) {
             if (!currentUser) {
                 showToast('error', 'Sign in required', 'Please sign in to view group details.');
                 showLoginModal();
                 return;
             }
             
             const group = studyGroups.find(g => g.id === groupId);
             if (!group) return;
             
             const isMember = currentUser && group.members && group.members.includes(currentUser.uid);
             
             // Format topic for display
             const topicLabels = {
                 'melting-point': 'Melting Point Trends',
                 'density': 'Density Trends',
                 'reactivity': 'Reactivity Series',
                 'reactions': 'Chemical Reactions',
                 'electron-configuration': 'Electron Configuration',
                 'experiments': 'Laboratory Experiments',
                 'exam-prep': 'Exam Preparation'
             };
             
             document.getElementById('groupDetailsTitle').textContent = group.name;
             
             let content = `
                 <div class="group-details-container">
                    <div class="flex justify-between items-start mb-8">
                        <div>
                            <h3 class="text-2xl font-bold text-gray-800">${group.name}</h3>
                            <span class="group-topic inline-block mt-2">${topicLabels[group.topic] || group.topic}</span>
                        </div>
                        <button onclick="closeGroupDetailsModal()" class="text-gray-500 hover:text-gray-700 p-3 rounded-full hover:bg-gray-100 transition-colors">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                    
                    <p class="text-gray-700 mb-8">${group.description}</p>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
                        <div class="bg-gray-50 p-6 rounded-lg shadow-sm">
                            <h4 class="font-semibold text-gray-800 mb-4 flex items-center">
                                <i class="fas fa-info-circle mr-3 text-indigo-600"></i>
                                Group Info
                            </h4>
                            <p class="text-sm text-gray-600 mb-3">
                                <i class="fas fa-calendar-alt mr-3"></i>
                                Created: ${new Date(group.createdAt).toLocaleDateString()}
                            </p>
                            <p class="text-sm text-gray-600 mb-3">
                                <i class="fas fa-users mr-3"></i>
                                Members: ${group.memberCount || 0}/${group.maxMembers || 10}
                            </p>
                            <p class="text-sm text-gray-600">
                                <i class="fas fa-user-cog mr-3"></i>
                                Creator: ${group.creatorName}
                            </p>
                        </div>
                        <div class="bg-gray-50 p-6 rounded-lg shadow-sm">
                            <h4 class="font-semibold text-gray-800 mb-4 flex items-center">
                                <i class="fas fa-chart-line mr-3 text-indigo-600"></i>
                                Activity
                            </h4>
                            <p class="text-sm text-gray-600 mb-3">
                                <i class="fas fa-clock mr-3"></i>
                                Last active: ${new Date(group.lastActivity).toLocaleDateString()}
                            </p>
                            <p class="text-sm text-gray-600 mb-3">
                                <i class="fas fa-bullhorn mr-3"></i>
                                Announcements: ${group.announcements ? group.announcements.length : 0}
                            </p>
                            <p class="text-sm text-gray-600">
                                <i class="fas fa-folder-open mr-3"></i>
                                Resources: ${group.resources ? group.resources.length : 0}
                            </p>
                        </div>
                    </div>
                    
                    ${isMember ? `
                        <div class="mb-8">
                            <div class="flex justify-between items-center mb-5">
                                <h4 class="font-semibold text-gray-800 flex items-center">
                                    <i class="fas fa-bullhorn mr-3 text-indigo-600"></i>
                                    Group Announcements
                                </h4>
                                ${group.creatorId === currentUser.uid ? `
                                    <button onclick="showAddAnnouncementModal('${group.id}')" class="btn btn-primary btn-sm">
                                        <i class="fas fa-plus mr-2"></i>
                                        Add Announcement
                                    </button>
                                ` : ''}
                            </div>
                            <div id="groupAnnouncements">
                                ${(group.announcements || []).map(announcement => `
                                    <div class="group-announcement">
                                        <h5 class="font-semibold text-gray-800 mb-3">${announcement.title}</h5>
                                        <p class="text-gray-600 mb-3">${announcement.content}</p>
                                        <p class="text-xs text-gray-500">
                                            <i class="fas fa-calendar-alt mr-2"></i>
                                            ${new Date(announcement.createdAt).toLocaleDateString()}
                                        </p>
                                    </div>
                                `).join('') || '<p class="text-gray-500 italic">No announcements yet.</p>'}
                            </div>
                        </div>
                        
                        <div class="mb-8">
                            <div class="flex justify-between items-center mb-5">
                                <h4 class="font-semibold text-gray-800 flex items-center">
                                    <i class="fas fa-folder-open mr-3 text-indigo-600"></i>
                                    Group Resources
                                </h4>
                                ${isMember ? `
                                    <button onclick="showAddResourceModal('${group.id}')" class="btn btn-primary btn-sm">
                                        <i class="fas fa-plus mr-2"></i>
                                        Add Resource
                                    </button>
                                ` : ''}
                            </div>
                            <div id="groupResources">
                                ${(group.resources || []).map(resource => `
                                    <div class="resource-item">
                                        <div class="resource-icon">
                                            <i class="fas fa-file-alt"></i>
                                        </div>
                                        <div class="resource-info">
                                            <div class="resource-name">${resource.name}</div>
                                            <div class="resource-meta">
                                                <i class="fas fa-user mr-2"></i>
                                                ${resource.addedBy}  
                                                <i class="fas fa-calendar-alt mr-2"></i>
                                                ${new Date(resource.createdAt).toLocaleDateString()}
                                            </div>
                                            ${resource.description ? `<div class="resource-description">${resource.description}</div>` : ''}
                                        </div>
                                        <div class="resource-actions">
                                            <button class="resource-btn" onclick="downloadResource('${resource.url}')" title="Download">
                                            <i class="fas fa-download"></i>
                                    </button>
                                    ${group.creatorId === currentUser.uid ? `
                                        <button class="resource-btn text-red-500" onclick="removeResource('${group.id}', '${resource.id}')" title="Remove">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    ` : ''}
                                </div>
                                    </div>
                                `).join('') || '<p class="text-gray-500 italic">No resources shared yet.</p>'}
                            </div>
                        </div>
                    </div>
                    
                    <div class="mb-8">
                        <h4 class="font-semibold text-gray-800 mb-5 flex items-center">
                            <i class="fas fa-comments mr-3 text-indigo-600"></i>
                            Group Chat
                        </h4>
                        <div class="group-chat-container">
                            <div class="group-chat" id="groupChat-${group.id}">
                                <!-- Chat messages will be loaded here -->
                            </div>
                            <div class="chat-input">
                                <input type="text" id="chatInput-${group.id}" class="form-input flex-1" placeholder="Type a message..." onkeypress="if(event.key === 'Enter') sendChatMessage(event, '${group.id}')">
                            <button onclick="sendChatMessage(event, '${group.id}')" class="btn btn-primary">Send</button>
                        </div>
                    </div>
                </div>
            ` : `
                <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-4 rounded-lg">
                    <div class="flex">
                        <div class="flex-shrink-0">
                            <i class="fas fa-exclamation-triangle text-yellow-400"></i>
                        </div>
                        <div class="ml-3">
                            <p class="text-sm text-yellow-700">
                                Join this study group to access announcements, resources, and group chat.
                            </p>
                        </div>
                    </div>
                </div>
            `}
         </div>
         `;
         
         document.getElementById('groupDetailsContent').innerHTML = content;
         document.getElementById('groupDetailsModal').classList.add('active');
         
         // Load chat messages if member
         if (isMember) {
         loadGroupChat(group.id);
         }
         }
         
         function closeGroupDetailsModal() {
             document.getElementById('groupDetailsModal').classList.remove('active');
         }
         
         function joinStudyGroup(groupId) {
             if (!currentUser) {
                 showToast('error', 'Sign in required', 'Please sign in to join study groups.');
                 showLoginModal();
                 return;
             }
             
             const groupRef = database.ref('studyGroups/' + groupId);
             groupRef.once('value').then((snapshot) => {
                 const group = snapshot.val();
                 
                 if (!group) {
                     showToast('error', 'Error', 'Study group not found.');
                     return;
                 }
                 
                 if (group.members && group.members.includes(currentUser.uid)) {
                     showToast('info', 'Already Member', 'You are already a member of this group.');
                     return;
                 }
                 
                 if ((group.memberCount || 0) >= (group.maxMembers || 10)) {
                     showToast('error', 'Group Full', 'This study group is already full.');
                     return;
                 }
                 
                 const members = [...(group.members || []), currentUser.uid];
                 const updates = {};
                 updates['/members'] = members;
                 updates['/memberCount'] = members.length;
                 updates['/lastActivity'] = firebase.database.ServerValue.TIMESTAMP;
                 
                 groupRef.update(updates).then(() => {
                     showToast('success', 'Joined Group', 'You have successfully joined the study group.');
                     
                     // Add welcome message to chat
                     const chatRef = database.ref('groupChat').push();
                     chatRef.set({
                         groupId: groupId,
                         authorId: 'system',
                         authorName: 'System',
                         content: `${userData.displayName} has joined the group.`,
                         createdAt: firebase.database.ServerValue.TIMESTAMP
                     });
                 }).catch((error) => {
                     console.error("Error joining study group:", error);
                     showToast('error', 'Error', 'Failed to join study group.');
                 });
             }).catch((error) => {
                 console.error("Error getting study group:", error);
                 showToast('error', 'Error', 'Failed to join study group.');
             });
         }
         
         function leaveStudyGroup(groupId) {
             if (!currentUser) {
                 showToast('error', 'Sign in required', 'Please sign in to leave study groups.');
                 showLoginModal();
                 return;
             }
             
             const groupRef = database.ref('studyGroups/' + groupId);
             groupRef.once('value').then((snapshot) => {
                 const group = snapshot.val();
                 
                 // Filter out current user
                 const updatedMembers = (group.members || []).filter(member => member !== currentUser.uid);
                 
                 const updates = {};
                 updates['/members'] = updatedMembers;
                 updates['/memberCount'] = updatedMembers.length;
                 updates['/lastActivity'] = firebase.database.ServerValue.TIMESTAMP;
                 
                 groupRef.update(updates).then(() => {
                     showToast('success', 'Left Group', 'You have successfully left the study group.');
                     
                     // Add goodbye message to chat
                     const chatRef = database.ref('groupChat').push();
                     chatRef.set({
                         groupId: groupId,
                         authorId: 'system',
                         authorName: 'System',
                         content: `${userData.displayName} has left the group.`,
                         createdAt: firebase.database.ServerValue.TIMESTAMP
                     });
                 }).catch((error) => {
                     console.error("Error leaving study group:", error);
                     showToast('error', 'Error', 'Failed to leave study group.');
                 });
             }).catch((error) => {
                 console.error("Error getting study group:", error);
                 showToast('error', 'Error', 'Failed to leave study group.');
             });
         }
         
         // Add Announcement Modal
         function showAddAnnouncementModal(groupId) {
             if (!currentUser) {
                 showToast('error', 'Sign in required', 'Please sign in to add announcements.');
                 showLoginModal();
                 return;
             }
             
             const modal = document.createElement('div');
             modal.className = 'modal';
             modal.innerHTML = `
                 <div class="modal-content">
                     <div class="flex justify-between items-center mb-6">
                         <h2 class="text-2xl font-bold text-gray-800">Add Announcement</h2>
                         <button onclick="this.closest('.modal').classList.remove('active')" class="text-gray-500 hover:text-gray-700">
                             <i class="fas fa-times text-xl"></i>
                         </button>
                     </div>
                     
                     <form onsubmit="addAnnouncement(event, '${groupId}')" class="space-y-4">
                         <div>
                             <label class="block text-sm font-medium text-gray-700 mb-1">Title</label>
                             <input type="text" id="announcementTitle" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" placeholder="Announcement title" required>
                         </div>
                         <div>
                             <label class="block text-sm font-medium text-gray-700 mb-1">Content</label>
                             <textarea id="announcementContent" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 form-textarea" placeholder="Announcement content" required></textarea>
                         </div>
                         <button type="submit" class="btn btn-primary w-full">
                             <i class="fas fa-bullhorn mr-2"></i>
                             Post Announcement
                         </button>
                     </form>
                 </div>
             `;
             
             document.body.appendChild(modal);
             modal.classList.add('active');
         }
         
         function addAnnouncement(event, groupId) {
             event.preventDefault();
             
             const title = document.getElementById('announcementTitle').value.trim();
             const content = document.getElementById('announcementContent').value.trim();
             
             if (!title || !content) {
                 showToast('error', 'Missing Fields', 'Please fill in all fields.');
                 return;
             }
             
             const groupRef = database.ref('studyGroups/' + groupId);
             groupRef.once('value').then((snapshot) => {
                 const group = snapshot.val();
                 
                 if (!group) {
                     showToast('error', 'Error', 'Study group not found.');
                     return;
                 }
                 
                 if (group.creatorId !== currentUser.uid) {
                     showToast('error', 'Permission Denied', 'Only the group creator can add announcements.');
                     return;
                 }
                 
                 const announcements = group.announcements || [];
                 const newAnnouncement = {
                     id: Date.now().toString(),
                     title: title,
                     content: content,
                     createdBy: currentUser.uid,
                     createdAt: firebase.database.ServerValue.TIMESTAMP
                 };
                 
                 announcements.push(newAnnouncement);
                 
                 groupRef.update({
                     announcements: announcements,
                     lastActivity: firebase.database.ServerValue.TIMESTAMP
                 }).then(() => {
                     showToast('success', 'Announcement Added', 'Your announcement has been posted successfully.');
                     
                     // Close modal
                     event.target.closest('.modal').classList.remove('active');
                     
                     // Add announcement message to chat
                     const chatRef = database.ref('groupChat').push();
                     chatRef.set({
                         groupId: groupId,
                         authorId: 'system',
                         authorName: 'System',
                         content: `New announcement: ${title}`,
                         createdAt: firebase.database.ServerValue.TIMESTAMP
                     });
                     
                     // Refresh group details
                     showGroupDetails(groupId);
                 }).catch((error) => {
                     console.error("Error adding announcement:", error);
                     showToast('error', 'Error', 'Failed to add announcement.');
                 });
             }).catch((error) => {
                 console.error("Error getting study group:", error);
                 showToast('error', 'Error', 'Failed to add announcement.');
             });
         }
         
         // Add Resource Modal
         function showAddResourceModal(groupId) {
             if (!currentUser) {
                 showToast('error', 'Sign in required', 'Please sign in to add resources.');
                 showLoginModal();
                 return;
             }
             
             const modal = document.createElement('div');
             modal.className = 'modal';
             modal.innerHTML = `
                 <div class="modal-content">
                     <div class="flex justify-between items-center mb-6">
                         <h2 class="text-2xl font-bold text-gray-800">Add Resource</h2>
                         <button onclick="this.closest('.modal').classList.remove('active')" class="text-gray-500 hover:text-gray-700">
                             <i class="fas fa-times text-xl"></i>
                         </button>
                     </div>
                     
                     <form onsubmit="addResource(event, '${groupId}')" class="space-y-4">
                         <div>
                             <label class="block text-sm font-medium text-gray-700 mb-1">Resource Name</label>
                             <input type="text" id="resourceName" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" placeholder="Resource name" required>
                         </div>
                         <div>
                             <label class="block text-sm font-medium text-gray-700 mb-1">URL</label>
                             <input type="url" id="resourceUrl" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" placeholder="https://example.com" required>
                         </div>
                         <div>
                             <label class="block text-sm font-medium text-gray-700 mb-1">Description</label>
                             <textarea id="resourceDescription" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 form-textarea" placeholder="Brief description of the resource"></textarea>
                         </div>
                         <button type="submit" class="btn btn-primary w-full">
                             <i class="fas fa-plus mr-2"></i>
                             Add Resource
                         </button>
                     </form>
                 </div>
             `;
             
             document.body.appendChild(modal);
             modal.classList.add('active');
         }
         
         function addResource(event, groupId) {
             event.preventDefault();
             
             const name = document.getElementById('resourceName').value.trim();
             const url = document.getElementById('resourceUrl').value.trim();
             const description = document.getElementById('resourceDescription').value.trim();
             
             if (!name || !url) {
                 showToast('error', 'Missing Fields', 'Please fill in all required fields.');
                 return;
             }
             
             const groupRef = database.ref('studyGroups/' + groupId);
             groupRef.once('value').then((snapshot) => {
                 const group = snapshot.val();
                 
                 if (!group) {
                     showToast('error', 'Error', 'Study group not found.');
                     return;
                 }
                 
                 if (!group.members || !group.members.includes(currentUser.uid)) {
                     showToast('error', 'Permission Denied', 'Only group members can add resources.');
                     return;
                 }
                 
                 const resources = group.resources || [];
                 const newResource = {
                     id: Date.now().toString(),
                     name: name,
                     url: url,
                     description: description,
                     addedBy: userData.displayName,
                     addedById: currentUser.uid,
                     createdAt: firebase.database.ServerValue.TIMESTAMP
                 };
                 
                 resources.push(newResource);
                 
                 groupRef.update({
                     resources: resources,
                     lastActivity: firebase.database.ServerValue.TIMESTAMP
                 }).then(() => {
                     showToast('success', 'Resource Added', 'Your resource has been shared successfully.');
                     
                     // Close modal
                     event.target.closest('.modal').classList.remove('active');
                     
                     // Add resource message to chat
                     const chatRef = database.ref('groupChat').push();
                     chatRef.set({
                         groupId: groupId,
                         authorId: 'system',
                         authorName: 'System',
                         content: `${userData.displayName} shared a new resource: ${name}`,
                         createdAt: firebase.database.ServerValue.TIMESTAMP
                     });
                     
                     // Refresh group details
                     showGroupDetails(groupId);
                 }).catch((error) => {
                     console.error("Error adding resource:", error);
                     showToast('error', 'Error', 'Failed to add resource.');
                 });
             }).catch((error) => {
                 console.error("Error getting study group:", error);
                 showToast('error', 'Error', 'Failed to add resource.');
             });
         }
         
         function removeResource(groupId, resourceId) {
             if (!confirm('Are you sure you want to remove this resource?')) {
                 return;
             }
             
             const groupRef = database.ref('studyGroups/' + groupId);
             groupRef.once('value').then((snapshot) => {
                 const group = snapshot.val();
                 
                 if (!group) {
                     showToast('error', 'Error', 'Study group not found.');
                     return;
                 }
                 
                 if (group.creatorId !== currentUser.uid) {
                     showToast('error', 'Permission Denied', 'Only the group creator can remove resources.');
                     return;
                 }
                 
                 const resources = (group.resources || []).filter(r => r.id !== resourceId);
                 
                 groupRef.update({
                     resources: resources,
                     lastActivity: firebase.database.ServerValue.TIMESTAMP
                 }).then(() => {
                     showToast('success', 'Resource Removed', 'The resource has been removed successfully.');
                     
                     // Refresh group details
                     showGroupDetails(groupId);
                 }).catch((error) => {
                     console.error("Error removing resource:", error);
                     showToast('error', 'Error', 'Failed to remove resource.');
                 });
             }).catch((error) => {
                 console.error("Error getting study group:", error);
                 showToast('error', 'Error', 'Failed to remove resource.');
             });
         }
         
         function downloadResource(url) {
             window.open(url, '_blank');
         }
         
         // Group Chat Functions
         function loadGroupChat(groupId) {
             const chatContainer = document.getElementById(`groupChat-${groupId}`);
             if (!chatContainer) return;
             
             const chatRef = database.ref('groupChat').orderByChild('groupId').equalTo(groupId);
             chatRef.on('value', (snapshot) => {
                 chatContainer.innerHTML = '';
                 
                 if (!snapshot.exists()) {
                     chatContainer.innerHTML = '<p class="text-gray-500 text-center">No messages yet. Start the conversation!</p>';
                     return;
                 }
                 
                 const messages = [];
                 snapshot.forEach((childSnapshot) => {
                     messages.push({
                         id: childSnapshot.key,
                         ...childSnapshot.val()
                     });
                 });
                 
                 // Sort by creation date (oldest first)
                 messages.sort((a, b) => {
                     return new Date(a.createdAt) - new Date(b.createdAt);
                 });
                 
                 messages.forEach(message => {
                     const messageDiv = document.createElement('div');
                     messageDiv.className = 'chat-message';
                     
                     if (message.authorId === currentUser.uid) {
                         messageDiv.classList.add('own');
                     }
                     
                     const date = new Date(message.createdAt);
                     const formattedTime = date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                     
                     messageDiv.innerHTML = `
                         <div class="font-semibold text-sm">${message.authorName}</div>
                         <div class="text-sm">${message.content}</div>
                         <div class="text-xs text-gray-500">${formattedTime}</div>
                     `;
                     
                     chatContainer.appendChild(messageDiv);
                 });
                 
                 // Scroll to bottom
                 chatContainer.scrollTop = chatContainer.scrollHeight;
             });
         }
         
         function sendChatMessage(event, groupId) {
             if (event.key === 'Enter' || event.type === 'click') {
                 event.preventDefault();
                 
                 if (!currentUser) {
                     showToast('error', 'Sign in required', 'Please sign in to send messages.');
                     showLoginModal();
                     return;
                 }
                 
                 const input = document.getElementById(`chatInput-${groupId}`);
                 const content = input.value.trim();
                 
                 if (!content) {
                     return;
                 }
                 
                 const chatRef = database.ref('groupChat').push();
                 const newMessage = {
                     groupId: groupId,
                     authorId: currentUser.uid,
                     authorName: userData.displayName,
                     content: content,
                     createdAt: firebase.database.ServerValue.TIMESTAMP
                 };
                 
                 chatRef.set(newMessage).then(() => {
                     input.value = '';
                     
                     // Update group activity
                     const groupRef = database.ref('studyGroups/' + groupId);
                     groupRef.update({
                         lastActivity: firebase.database.ServerValue.TIMESTAMP
                     });
                 }).catch((error) => {
                     console.error("Error sending chat message:", error);
                     showToast('error', 'Error', 'Failed to send message.');
                 });
             }
         }
         
         // Leaderboard functions
         // Leaderboard functions
// Leaderboard functions
function loadLeaderboard() {
    const leaderboardContent = document.getElementById('leaderboardContent');
    leaderboardContent.innerHTML = '<div class="spinner"></div>';
    
    const usersRef = database.ref('users');
    usersRef.orderByChild('xp').limitToLast(10).on('value', (snapshot) => {
        leaderboardContent.innerHTML = '';
        
        if (!snapshot.exists()) {
            leaderboardContent.innerHTML = '<p class="text-gray-500 text-center">No data available.</p>';
            return;
        }
        
        const users = [];
        snapshot.forEach((childSnapshot) => {
            users.push({
                id: childSnapshot.key,
                ...childSnapshot.val()
            });
        });
        
        // Sort by XP descending
        users.sort((a, b) => (b.xp || 0) - (a.xp || 0));
        
        // Create table
        const table = document.createElement('table');
        table.className = 'leaderboard-table';
        table.style.opacity = '0';
        table.style.transform = 'translateY(20px)';
        table.style.transition = 'opacity 0.6s ease, transform 0.6s ease';
        
        // Create table header
        const thead = document.createElement('thead');
        thead.innerHTML = `
            <tr>
                <th>Rank</th>
                <th>User</th>
                <th>XP</th>
                <th>Sections Completed</th>
                <th>Badges</th>
            </tr>
        `;
        table.appendChild(thead);
        
        // Create table body
        const tbody = document.createElement('tbody');
        
        users.forEach((user, index) => {
            const rank = index + 1;
            const row = document.createElement('tr');
            row.style.opacity = '0';
            row.style.transform = 'translateY(20px)';
            row.style.transition = `opacity 0.5s ease ${index * 0.1}s, transform 0.5s ease ${index * 0.1}s`;
            
            let rankClass = '';
            if (rank === 1) rankClass = 'first';
            else if (rank === 2) rankClass = 'second';
            else if (rank === 3) rankClass = 'third';
            
            row.innerHTML = `
                <td>
                    <div class="leaderboard-rank ${rankClass}">${rank}</div>
                </td>
                <td>${user.displayName || 'Anonymous'}</td>
                <td>${user.xp || 0}</td>
                <td>${user.completedSections ? user.completedSections.length : 0}</td>
                <td>${user.badges ? user.badges.length : 0}</td>
            `;
            
            tbody.appendChild(row);
        });
        
        table.appendChild(tbody);
        leaderboardContent.appendChild(table);
        
        // Trigger fade-in effect after a short delay
        setTimeout(() => {
            // Fade in the table
            table.style.opacity = '1';
            table.style.transform = 'translateY(0)';
            
            // Fade in each row with staggered delay
            const rows = tbody.querySelectorAll('tr');
            rows.forEach((row, index) => {
                setTimeout(() => {
                    row.style.opacity = '1';
                    row.style.transform = 'translateY(0)';
                }, index * 100);
            });
        }, 100);
    });
}
         
         // Toast notification function
         function showToast(type, title, message) {
             const toastContainer = document.getElementById('toastContainer');
             
             const toast = document.createElement('div');
             toast.className = `toast ${type}`;
             
             let icon = 'fa-info-circle';
             if (type === 'success') icon = 'fa-check-circle';
             else if (type === 'error') icon = 'fa-exclamation-circle';
             
             toast.innerHTML = `
                 <div class="toast-icon">
                     <i class="fas ${icon}"></i>
                 </div>
                 <div class="toast-message">
                     <div class="toast-title">${title}</div>
                     <div class="toast-description">${message}</div>
                 </div>
             `;
             
             toastContainer.appendChild(toast);
             
             // Show toast
             setTimeout(() => {
                 toast.classList.add('show');
             }, 100);
             
             // Hide toast after 3 seconds
             setTimeout(() => {
                 toast.classList.remove('show');
                 setTimeout(() => {
                     toast.remove();
                 }, 300);
             }, 3000);
         }
         
         // Add this helper function to reset and trigger fade-in animations
         function resetAndTriggerFadeIn(container) {
         // Reset fade-in classes for elements in this container
         container.querySelectorAll('.fade-in, .fade-in-stagger').forEach(el => {
         el.classList.remove('visible');
         });
         
         // Reinitialize fade-in for this container after a short delay
         setTimeout(() => {
         // Add fade-in classes if they don't exist
         addFadeInClasses();
         
         // Manually trigger fade-in for elements already in view
         container.querySelectorAll('.fade-in, .fade-in-stagger').forEach(el => {
            const rect = el.getBoundingClientRect();
            const isVisible = (
                rect.top >= 0 &&
                rect.left >= 0 &&
                rect.bottom <= (window.innerHeight || document.documentElement.clientHeight) &&
                rect.right <= (window.innerWidth || document.documentElement.clientWidth)
            );
            
            if (isVisible) {
                el.classList.add('visible');
            }
         });
         }, 50);
         }
         
         // Update the showTab function to use the helper
         function showTab(tabName) {
         // Hide all tab contents
         const tabContents = document.querySelectorAll('.tab-content');
         tabContents.forEach(content => {
         content.classList.remove('active');
         });
         
         // Remove active class from all tabs
         const tabs = document.querySelectorAll('.tab');
         tabs.forEach(tab => {
         tab.classList.remove('active');
         });
         
         // Show selected tab content
         const tabContent = document.getElementById(tabName);
         if (tabContent) {
         tabContent.classList.add('active');
         
         // Reset and trigger fade-in for this tab content
         resetAndTriggerFadeIn(tabContent);
         }
         
         // Add active class to clicked tab
         const activeTab = document.querySelector(`[onclick="showTab('${tabName}')"]`);
         if (activeTab) {
         activeTab.classList.add('active');
         }
         }
         
         // Update navigateToSection to use the helper function
         function navigateToSection(sectionName) {
         // Check if section is locked
         const navItem = document.getElementById(`nav-${sectionName}`);
         if (navItem && navItem.classList.contains('locked')) {
         showToast('info', 'Section Locked', 'Please complete previous sections first.');
         return;
         }
         
         // Hide all sections
         const sections = document.querySelectorAll('.content-section');
         sections.forEach(section => {
         section.style.display = 'none';
         });
         
         // Show selected section
         const sectionElement = document.getElementById(`${sectionName}-section`);
         if (sectionElement) {
         sectionElement.style.display = 'block';
         
         // Reset and trigger fade-in for this section
         resetAndTriggerFadeIn(sectionElement);
         }
         
         // Update active nav item
         const navItems = document.querySelectorAll('.nav-item');
         navItems.forEach(item => {
         item.classList.remove('active');
         });
         
         if (navItem) {
         navItem.classList.add('active');
         }
         
         currentSection = sectionName;
         
         // Load leaderboard if that section is selected
         if (sectionName === 'leaderboard') {
         loadLeaderboard();
         }
         }
         
         // Initialize the app when DOM is ready
         document.addEventListener('DOMContentLoaded', initApp);
      </script>
   </body>
</html>
