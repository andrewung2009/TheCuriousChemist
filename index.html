<!DOCTYPE html>
<html lang="en">
   <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Chemistry Mastery - Group 1 Alkali Metals</title>
      <meta name="description" content="Interactive learning platform for mastering Group 1 Alkali Metals in chemistry">
      <!-- PWA Meta Tags -->
      <meta name="theme-color" content="#4f46e5">
      <link rel="manifest" href="site.webmanifest">
      <link rel="apple-touch-icon" href="icon.png">
      <!-- Tailwind CSS -->
      <script src="https://cdn.tailwindcss.com"></script>
      <!-- Font Awesome -->
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
      <!-- Firebase SDKs -->
      <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
      <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
      <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
      <!-- Custom CSS -->
      <style>
         :root {
         /* Color System */
         --primary-50: #f0f9ff;
         --primary-100: #e0f2fe;
         --primary-500: #3b82f6;
         --primary-600: #2563eb;
         --primary-700: #1d4ed8;
         --primary-800: #1e40af;
         --primary-900: #1e3a8a;
         --secondary-500: #8b5cf6;
         --secondary-600: #7c3aed;
         --secondary-700: #6d28d9;
         --success-500: #10b981;
         --success-600: #059669;
         --warning-500: #f59e0b;
         --warning-600: #d97706;
         --error-500: #ef4444;
         --error-600: #dc2626;
         --gray-50: #f9fafb;
         --gray-100: #f3f4f6;
         --gray-200: #e5e7eb;
         --gray-300: #d1d5db;
         --gray-400: #9ca3af;
         --gray-500: #6b7280;
         --gray-600: #4b5563;
         --gray-700: #374151;
         --gray-800: #1f2937;
         --gray-900: #111827;
         /* Dark mode colors */
         --dark-bg: #1a202c;
         --dark-surface: #2d3748;
         --dark-text: #e2e8f0;
         --dark-border: #4a5568;
         /* Spacing */
         --space-xs: 0.25rem;
         --space-sm: 0.5rem;
         --space-md: 1rem;
         --space-lg: 1.5rem;
         --space-xl: 2rem;
         --space-2xl: 3rem;
         /* Typography */
         --font-sans: 'Inter', sans-serif;
         --font-mono: 'Courier New', monospace;
         /* Shadows */
         --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
         --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
         --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
         --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
         /* Border Radius */
         --radius-sm: 0.25rem;
         --radius-md: 0.375rem;
         --radius-lg: 0.5rem;
         --radius-xl: 0.75rem;
         --radius-2xl: 1rem;
         --radius-full: 9999px;
         /* Transitions */
         --transition-fast: 150ms;
         --transition-normal: 300ms;
         --transition-slow: 500ms;
         }
         /* Dark mode styles */
         body.dark-mode {
         background: linear-gradient(135deg, var(--dark-bg) 0%, var(--dark-surface) 100%);
         color: var(--dark-text);
         }
         body.dark-mode .content-card {
         background: var(--dark-surface);
         color: var(--dark-text);
         border-left: 5px solid var(--primary-600);
         }
         body.dark-mode .sidebar {
         background: rgba(26, 32, 44, 0.95);
         color: var(--dark-text);
         }
         body.dark-mode .nav-item {
         color: var(--gray-300);
         }
         body.dark-mode .nav-item:hover {
         background: rgba(79, 70, 229, 0.2);
         color: var(--primary-400);
         }
         body.dark-mode .nav-item.active {
         background: rgba(79, 70, 229, 0.2);
         color: var(--primary-400);
         }
         body.dark-mode .progress-tracker {
         background: var(--dark-surface);
         color: var(--dark-text);
         }
         body.dark-mode .element-card {
         background: var(--dark-surface);
         color: var(--dark-text);
         }
         body.dark-mode .highlight-box {
         background: rgba(79, 70, 229, 0.1);
         border-left: 4px solid var(--primary-500);
         }
         body.dark-mode .equation-box {
         background: var(--dark-bg);
         border: 1px solid var(--dark-border);
         }
         body.dark-mode .key-point {
         background: rgba(245, 158, 11, 0.1);
         border-left: 4px solid var(--warning-500);
         }
         body.dark-mode .comparison-table {
         background: var(--dark-surface);
         color: var(--dark-text);
         }
         body.dark-mode .comparison-table th {
         background: var(--primary-700);
         color: white;
         }
         body.dark-mode .comparison-table tr:nth-child(even) {
         background: var(--dark-bg);
         }
         body.dark-mode .comparison-table tr:hover {
         background: rgba(79, 70, 229, 0.1);
         }
         body.dark-mode .comparison-table td {
         border-bottom: 1px solid var(--dark-border);
         }
         body.dark-mode .modal-content {
         background: var(--dark-surface);
         color: var(--dark-text);
         }
         body.dark-mode .auth-tab {
         color: var(--gray-300);
         }
         body.dark-mode .auth-tab.active {
         color: var(--primary-400);
         }
         body.dark-mode input, 
         body.dark-mode textarea, 
         body.dark-mode select {
         background: var(--dark-bg);
         border: 1px solid var(--dark-border);
         color: var(--dark-text);
         }
         body.dark-mode .btn-secondary {
         background: var(--dark-bg);
         color: var(--dark-text);
         }
         body.dark-mode .btn-secondary:hover {
         background: var(--dark-border);
         }
         body.dark-mode .comment {
         background: var(--dark-bg);
         border-left: 4px solid var(--primary-600);
         }
         body.dark-mode .reply {
         background: var(--dark-surface);
         }
         body.dark-mode .group-message {
         background: var(--dark-bg);
         border-left: 4px solid var(--success-500);
         }
         body.dark-mode .empty-state {
         color: var(--gray-400);
         }
         body.dark-mode .feature-card {
         background: var(--dark-bg);
         }
         body.dark-mode .study-group-card {
         background: var(--dark-surface);
         }
         body.dark-mode .comment-section {
         background: var(--dark-surface);
         }
         body.dark-mode .group-discussion {
         background: var(--dark-surface);
         }
         body.dark-mode .landing-card {
         background: var(--dark-surface);
         color: var(--dark-text);
         }
         body.dark-mode .prequiz-card {
         background: var(--dark-surface);
         color: var(--dark-text);
         }
         body.dark-mode .support-message {
         background: rgba(79, 70, 229, 0.1);
         border-left: 4px solid var(--primary-500);
         }
         body.dark-mode .support-message h3 {
         color: var(--primary-400);
         }
         body.dark-mode .support-message p {
         color: var(--primary-300);
         }
         body.dark-mode .bg-blue-50 {
         background: rgba(79, 70, 229, 0.1);
         }
         body.dark-mode .bg-blue-50 p {
         color: var(--primary-300);
         }
         body.dark-mode .bg-blue-50 h3 {
         color: var(--primary-400);
         }
         body.dark-mode .bg-green-50 {
         background: rgba(16, 185, 129, 0.1);
         }
         body.dark-mode .bg-purple-50 {
         background: rgba(139, 92, 246, 0.1);
         }
         body.dark-mode .bg-yellow-50 {
         background: rgba(245, 158, 11, 0.1);
         }
         body.dark-mode .bg-red-50 {
         background: rgba(239, 68, 68, 0.1);
         }
         body.dark-mode .bg-indigo-50 {
         background: rgba(79, 70, 229, 0.1);
         }
         body.dark-mode .text-gray-700 {
         color: var(--gray-300);
         }
         body.dark-mode .text-gray-600 {
         color: var(--gray-400);
         }
         body.dark-mode .text-gray-800 {
         color: var(--gray-200);
         }
         body.dark-mode .text-gray-900 {
         color: var(--gray-100);
         }
         body.dark-mode .text-blue-800 {
         color: var(--primary-400);
         }
         body.dark-mode .text-blue-700 {
         color: var(--primary-300);
         }
         body.dark-mode .text-blue-600 {
         color: var(--primary-400);
         }
         body.dark-mode .text-green-800 {
         color: var(--success-400);
         }
         body.dark-mode .text-green-600 {
         color: var(--success-400);
         }
         body.dark-mode .text-purple-800 {
         color: var(--secondary-400);
         }
         body.dark-mode .text-purple-600 {
         color: var(--secondary-400);
         }
         body.dark-mode .text-yellow-800 {
         color: var(--warning-400);
         }
         body.dark-mode .text-yellow-600 {
         color: var(--warning-400);
         }
         body.dark-mode .text-yellow-500 {
         color: var(--warning-400);
         }
         body.dark-mode .text-red-800 {
         color: var(--error-400);
         }
         body.dark-mode .text-red-700 {
         color: var(--error-400);
         }
         body.dark-mode .text-indigo-800 {
         color: var(--primary-400);
         }
         body.dark-mode .text-indigo-600 {
         color: var(--primary-400);
         }
         body.dark-mode .border-gray-200 {
         border-color: var(--dark-border);
         }
         body.dark-mode .border-gray-300 {
         border-color: var(--dark-border);
         }
         body.dark-mode .bg-gray-50 {
         background: var(--dark-bg);
         }
         body.dark-mode .bg-gray-100 {
         background: var(--dark-surface);
         }
         body.dark-mode .bg-gray-200 {
         background: var(--dark-border);
         }
         body.dark-mode .bg-white {
         background: var(--dark-surface);
         }
         body.dark-mode .text-white {
         color: var(--dark-text);
         }
         * {
         margin: 0;
         padding: 0;
         box-sizing: border-box;
         }
         body {
         font-family: var(--font-sans);
         background: linear-gradient(135deg, var(--primary-600) 0%, var(--secondary-600) 100%);
         min-height: 100vh;
         color: var(--gray-900);
         overflow-x: hidden;
         transition: background var(--transition-normal) ease;
         }
         /* Accessibility */
         .sr-only {
         position: absolute;
         width: 1px;
         height: 1px;
         padding: 0;
         margin: -1px;
         overflow: hidden;
         clip: rect(0, 0, 0, 0);
         white-space: nowrap;
         border-width: 0;
         }
         /* Focus Styles */
         *:focus {
         outline: 2px solid var(--primary-500);
         outline-offset: 2px;
         }
         *:focus:not(:focus-visible) {
         outline: none;
         }
         /* Skip to content link */
         .skip-link {
         position: absolute;
         top: -40px;
         left: 0;
         background: var(--primary-600);
         color: white;
         padding: 8px;
         text-decoration: none;
         border-radius: 0 0 var(--radius-md) 0;
         z-index: 100;
         }
         .skip-link:focus {
         top: 0;
         }
         /* Animations */
         @keyframes fadeIn {
         from { opacity: 0; transform: translateY(20px); }
         to { opacity: 1; transform: translateY(0); }
         }
         @keyframes slideIn {
         from { transform: translateX(-100%); }
         to { transform: translateX(0); }
         }
         @keyframes pulse {
         0%, 100% { transform: scale(1); }
         50% { transform: scale(1.05); }
         }
         @keyframes glow {
         0%, 100% { text-shadow: 0 0 5px rgba(79, 70, 229, 0.7); }
         50% { text-shadow: 0 0 20px rgba(79, 70, 229, 0.9), 0 0 30px rgba(79, 70, 229, 0.7); }
         }
         @keyframes typewriter {
         from { width: 0; }
         to { width: 100%; }
         }
         @keyframes bounce {
         0%, 100% { transform: translateY(0); }
         50% { transform: translateY(-10px); }
         }
         @keyframes highlight {
         0% { background-color: rgba(79, 70, 229, 0.2); }
         50% { background-color: rgba(79, 70, 229, 0.4); }
         100% { background-color: rgba(79, 70, 229, 0.2); }
         }
         @keyframes textReveal {
         0% { 
         opacity: 0;
         transform: translateY(30px) scale(0.9);
         filter: blur(10px);
         }
         100% { 
         opacity: 1;
         transform: translateY(0) scale(1);
         filter: blur(0);
         }
         }
         @keyframes slideUp {
         0% { 
         opacity: 0;
         transform: translateY(50px);
         }
         100% { 
         opacity: 1;
         transform: translateY(0);
         }
         }
         @keyframes letterPop {
         0%, 100% { transform: scale(1); }
         50% { transform: scale(1.2); }
         }
         @keyframes colorShift {
         0% { color: var(--primary-600); }
         25% { color: var(--secondary-600); }
         50% { color: var(--error-500); }
         75% { color: var(--secondary-500); }
         100% { color: var(--primary-600); }
         }
         @keyframes shimmer {
         0% { background-position: -1000px 0; }
         100% { background-position: 1000px 0; }
         }
         /* Valence Electron Animation */
         @keyframes valenceFlash {
         0%, 100% { 
         color: var(--primary-600);
         transform: scale(1);
         text-shadow: 0 0 5px rgba(79, 70, 229, 0.5);
         }
         50% { 
         color: var(--secondary-600);
         transform: scale(1.3);
         text-shadow: 0 0 15px rgba(139, 92, 246, 0.8);
         }
         }
         /* Animation Classes */
         .fade-in {
         animation: fadeIn 0.6s ease-out forwards;
         }
         .slide-in {
         animation: slideIn 0.5s ease-out forwards;
         }
         .pulse {
         animation: pulse 2s infinite;
         }
         .glow-text {
         animation: glow 2s infinite;
         font-weight: 700;
         color: var(--primary-600);
         }
         .typewriter {
         overflow: hidden;
         white-space: nowrap;
         animation: typewriter 3s steps(40) 1s 1 normal both;
         }
         .bounce-text {
         display: inline-block;
         animation: bounce 1s ease infinite;
         }
         .highlight-text {
         background: linear-gradient(120deg, rgba(79, 70, 229, 0.2) 0%, rgba(79, 70, 229, 0.4) 100%);
         padding: 0 5px;
         border-radius: var(--radius-sm);
         font-weight: 600;
         animation: highlight 3s infinite;
         }
         .text-reveal {
         animation: textReveal 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
         opacity: 0;
         }
         .slide-up {
         animation: slideUp 0.7s ease-out forwards;
         opacity: 0;
         }
         .letter-pop {
         display: inline-block;
         animation: letterPop 0.5s ease forwards;
         opacity: 0;
         }
         .color-shift {
         animation: colorShift 5s ease infinite;
         }
         /* Valence Electron Special Effect */
         .valence-electron {
         display: inline-block;
         position: relative;
         font-weight: bold;
         color: var(--primary-600);
         cursor: pointer;
         animation: valenceFlash 2s infinite;
         }
         .valence-tooltip {
         position: absolute;
         bottom: 125%;
         left: 50%;
         transform: translateX(-50%);
         background: var(--primary-600);
         color: white;
         padding: 8px 12px;
         border-radius: var(--radius-md);
         font-size: 0.875rem;
         white-space: nowrap;
         opacity: 0;
         pointer-events: none;
         transition: opacity var(--transition-normal) ease;
         z-index: 10;
         box-shadow: var(--shadow-lg);
         width: 200px;
         text-align: center;
         }
         .valence-tooltip::after {
         content: '';
         position: absolute;
         top: 100%;
         left: 50%;
         transform: translateX(-50%);
         border: 6px solid transparent;
         border-top-color: var(--primary-600);
         }
         .valence-electron:hover .valence-tooltip {
         opacity: 1;
         }
         /* Melting Point Tooltip */
         .melting-point-cell {
         position: relative;
         cursor: pointer;
         }
         .melting-tooltip {
         position: absolute;
         bottom: 125%;
         left: 50%;
         transform: translateX(-50%);
         background: white;
         border: 1px solid var(--gray-200);
         border-radius: var(--radius-lg);
         padding: 12px;
         width: 280px;
         box-shadow: var(--shadow-xl);
         opacity: 0;
         pointer-events: none;
         transition: opacity var(--transition-normal) ease;
         z-index: 10;
         }
         .melting-tooltip::after {
         content: '';
         position: absolute;
         top: 100%;
         left: 50%;
         transform: translateX(-50%);
         border: 8px solid transparent;
         border-top-color: white;
         }
         .melting-point-cell:hover .melting-tooltip {
         opacity: 1;
         }
         .melting-tooltip h4 {
         font-weight: 600;
         margin-bottom: 8px;
         color: var(--primary-700);
         }
         .melting-tooltip p {
         font-size: 0.875rem;
         margin-bottom: 10px;
         color: var(--gray-600);
         }
         .melting-quiz {
         margin-top: 10px;
         padding-top: 10px;
         border-top: 1px solid var(--gray-200);
         }
         .melting-quiz p {
         font-weight: 500;
         margin-bottom: 8px;
         color: var(--gray-700);
         }
         .melting-quiz input {
         width: 100%;
         padding: 6px 8px;
         border: 1px solid var(--gray-300);
         border-radius: var(--radius-sm);
         font-size: 0.875rem;
         margin-bottom: 8px;
         }
         .melting-quiz button {
         background: var(--primary-600);
         color: white;
         border: none;
         padding: 6px 12px;
         border-radius: var(--radius-sm);
         font-size: 0.875rem;
         cursor: pointer;
         transition: background var(--transition-normal) ease;
         }
         .melting-quiz button:hover {
         background: var(--primary-700);
         }
         .quiz-result {
         margin-top: 8px;
         padding: 6px;
         border-radius: var(--radius-sm);
         font-size: 0.875rem;
         font-weight: 500;
         }
         .quiz-result.correct {
         background: var(--success-100);
         color: var(--success-700);
         }
         .quiz-result.incorrect {
         background: var(--error-100);
         color: var(--error-700);
         }
         /* Animation Delays */
         .delay-100 { animation-delay: 0.1s; }
         .delay-200 { animation-delay: 0.2s; }
         .delay-300 { animation-delay: 0.3s; }
         .delay-400 { animation-delay: 0.4s; }
         .delay-500 { animation-delay: 0.5s; }
         .delay-600 { animation-delay: 0.6s; }
         .delay-700 { animation-delay: 0.7s; }
         .delay-800 { animation-delay: 0.8s; }
         .delay-900 { animation-delay: 0.9s; }
         .delay-1000 { animation-delay: 1s; }
         .delay-1200 { animation-delay: 1.2s; }
         .delay-1500 { animation-delay: 1.5s; }
         /* Sidebar Styles */
         .sidebar {
         position: fixed;
         top: 0;
         left: 0;
         height: 100vh;
         width: 260px;
         background: rgba(255, 255, 255, 0.95);
         backdrop-filter: blur(10px);
         box-shadow: var(--shadow-lg);
         z-index: 100;
         overflow-y: auto;
         transition: transform var(--transition-normal) ease;
         }
         .sidebar-header {
         padding: var(--space-xl);
         border-bottom: 1px solid var(--gray-200);
         }
         .sidebar-nav {
         padding: var(--space-md) 0;
         }
         .nav-item {
         display: flex;
         align-items: center;
         padding: 0.75rem var(--space-xl);
         color: var(--gray-600);
         text-decoration: none;
         transition: all var(--transition-fast) ease;
         border-left: 3px solid transparent;
         position: relative;
         }
         .nav-item:hover {
         background: rgba(79, 70, 229, 0.1);
         color: var(--primary-600);
         border-left-color: var(--primary-600);
         }
         .nav-item.active {
         background: rgba(79, 70, 229, 0.1);
         color: var(--primary-600);
         border-left-color: var(--primary-600);
         font-weight: 600;
         }
         .nav-item.locked {
         color: var(--gray-400);
         cursor: not-allowed;
         }
         .nav-item.locked:hover {
         background: transparent;
         color: var(--gray-400);
         border-left-color: transparent;
         }
         .nav-item.completed {
         border-left-color: var(--success-500);
         }
         .nav-item.completed::after {
         content: '\f00c';
         font-family: 'Font Awesome 5 Free';
         font-weight: 900;
         position: absolute;
         right: var(--space-xl);
         color: var(--success-500);
         }
         .nav-item i {
         margin-right: var(--space-md);
         width: 20px;
         text-align: center;
         }
         .nav-item.locked i::after {
         content: '\f023';
         font-family: 'Font Awesome 5 Free';
         font-weight: 900;
         position: absolute;
         right: var(--space-xl);
         color: var(--gray-400);
         }
         .sidebar-footer {
         position: absolute;
         bottom: 0;
         left: 0;
         right: 0;
         padding: var(--space-md) var(--space-xl);
         border-top: 1px solid var(--gray-200);
         }
         .main-content {
         margin-left: 260px;
         padding: var(--space-xl);
         min-height: 100vh;
         }
         .menu-toggle {
         display: none;
         position: fixed;
         top: var(--space-md);
         left: var(--space-md);
         z-index: 101;
         background: rgba(255, 255, 255, 0.9);
         border: none;
         border-radius: var(--radius-md);
         padding: var(--space-sm);
         cursor: pointer;
         box-shadow: var(--shadow-md);
         }
         /* Theme Toggle */
         .theme-toggle {
         position: fixed;
         bottom: var(--space-xl);
         right: var(--space-xl);
         background: rgba(255, 255, 255, 0.9);
         border: none;
         border-radius: var(--radius-full);
         width: 50px;
         height: 50px;
         display: flex;
         align-items: center;
         justify-content: center;
         cursor: pointer;
         box-shadow: var(--shadow-md);
         z-index: 50;
         transition: all var(--transition-normal) ease;
         }
         .theme-toggle:hover {
         transform: translateY(-3px);
         box-shadow: var(--shadow-lg);
         }
         .theme-toggle i {
         font-size: 1.25rem;
         color: var(--primary-600);
         }
         body.dark-mode .theme-toggle {
         background: rgba(26, 32, 44, 0.9);
         }
         body.dark-mode .theme-toggle i {
         color: var(--primary-400);
         }
         /* Search Bar */
         .search-container {
         position: relative;
         margin-bottom: var(--space-xl);
         }
         .search-input {
         width: 100%;
         padding: 0.75rem var(--space-xl) 0.75rem 3rem;
         border: 1px solid var(--gray-300);
         border-radius: var(--radius-full);
         font-size: 1rem;
         transition: all var(--transition-normal) ease;
         }
         .search-input:focus {
         outline: none;
         border-color: var(--primary-600);
         box-shadow: 0 0 0 2px rgba(79, 70, 229, 0.2);
         }
         .search-icon {
         position: absolute;
         left: 1rem;
         top: 50%;
         transform: translateY(-50%);
         color: var(--gray-400);
         }
         .search-results {
         position: absolute;
         top: 100%;
         left: 0;
         right: 0;
         background: white;
         border-radius: var(--radius-md);
         box-shadow: var(--shadow-lg);
         max-height: 300px;
         overflow-y: auto;
         z-index: 10;
         display: none;
         }
         .search-results.active {
         display: block;
         }
         .search-result-item {
         padding: var(--space-md);
         border-bottom: 1px solid var(--gray-200);
         cursor: pointer;
         transition: background var(--transition-fast) ease;
         }
         .search-result-item:hover {
         background: var(--gray-100);
         }
         .search-result-item:last-child {
         border-bottom: none;
         }
         .search-result-title {
         font-weight: 600;
         color: var(--gray-800);
         margin-bottom: 0.25rem;
         }
         .search-result-description {
         font-size: 0.875rem;
         color: var(--gray-600);
         }
         /* Learning Path Styles */
         .learning-path {
         display: flex;
         justify-content: space-between;
         align-items: center;
         margin: var(--space-xl) 0;
         position: relative;
         }
         .learning-path::before {
         content: '';
         position: absolute;
         top: 50%;
         left: 0;
         right: 0;
         height: 4px;
         background: rgba(255, 255, 255, 0.3);
         z-index: 0;
         }
         .path-step {
         background: white;
         border-radius: var(--radius-full);
         width: 60px;
         height: 60px;
         display: flex;
         align-items: center;
         justify-content: center;
         position: relative;
         z-index: 1;
         box-shadow: var(--shadow-md);
         transition: all var(--transition-normal) ease;
         }
         .path-step.active {
         background: var(--primary-600);
         color: white;
         transform: scale(1.1);
         }
         .path-step.completed {
         background: var(--success-500);
         color: white;
         }
         .path-step.locked {
         background: var(--gray-400);
         color: white;
         }
         .path-label {
         position: absolute;
         bottom: -30px;
         white-space: nowrap;
         font-size: 0.875rem;
         font-weight: 500;
         color: white;
         }
         /* Content Cards */
         .content-card {
         background: rgba(255, 255, 255, 0.95);
         border-radius: var(--radius-2xl);
         padding: var(--space-xl);
         margin-bottom: var(--space-xl);
         box-shadow: var(--shadow-xl);
         transition: all var(--transition-normal) ease;
         border-left: 5px solid var(--primary-600);
         }
         .content-card:hover {
         transform: translateY(-5px);
         box-shadow: 0 15px 35px rgba(0, 0, 0, 0.15);
         }
         .content-card.locked {
         opacity: 0.6;
         filter: grayscale(100%);
         cursor: not-allowed;
         }
         .content-card.locked:hover {
         transform: none;
         }
         /* Bookmark Button */
         .bookmark-btn {
         position: absolute;
         top: var(--space-md);
         right: var(--space-md);
         background: none;
         border: none;
         font-size: 1.25rem;
         color: var(--gray-400);
         cursor: pointer;
         transition: color var(--transition-fast) ease;
         }
         .bookmark-btn:hover {
         color: var(--warning-500);
         }
         .bookmark-btn.bookmarked {
         color: var(--warning-500);
         }
         /* Notes Section */
         .notes-section {
         margin-top: var(--space-xl);
         }
         .notes-header {
         display: flex;
         justify-content: space-between;
         align-items: center;
         margin-bottom: var(--space-md);
         }
         .notes-title {
         font-weight: 600;
         color: var(--gray-800);
         }
         .notes-container {
         background: var(--gray-50);
         border-radius: var(--radius-md);
         padding: var(--space-md);
         min-height: 150px;
         }
         .notes-input {
         width: 100%;
         min-height: 100px;
         padding: var(--space-md);
         border: 1px solid var(--gray-300);
         border-radius: var(--radius-md);
         font-family: var(--font-sans);
         font-size: 1rem;
         resize: vertical;
         }
         .notes-input:focus {
         outline: none;
         border-color: var(--primary-600);
         box-shadow: 0 0 0 2px rgba(79, 70, 229, 0.2);
         }
         .notes-actions {
         display: flex;
         justify-content: flex-end;
         margin-top: var(--space-sm);
         }
         /* Element Cards */
         .element-grid {
         display: grid;
         grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
         gap: var(--space-xl);
         margin: var(--space-xl) 0;
         }
         .element-card {
         background: white;
         border-radius: var(--radius-2xl);
         padding: var(--space-xl);
         text-align: center;
         box-shadow: var(--shadow-lg);
         transition: all var(--transition-normal) ease;
         position: relative;
         overflow: hidden;
         }
         .element-card::before {
         content: '';
         position: absolute;
         top: 0;
         left: 0;
         right: 0;
         height: 5px;
         background: linear-gradient(90deg, var(--primary-600), var(--secondary-600));
         }
         .element-card:hover {
         transform: translateY(-5px);
         box-shadow: var(--shadow-xl);
         }
         .element-image {
         width: 80px;
         height: 80px;
         border-radius: var(--radius-full);
         margin: 0 auto var(--space-md);
         object-fit: cover;
         border: 3px solid var(--gray-200);
         }
         /* Tab Styles */
         .tabs {
         display: flex;
         border-bottom: 2px solid var(--gray-200);
         margin-bottom: var(--space-xl);
         }
         .tab {
         padding: 0.75rem var(--space-xl);
         cursor: pointer;
         background: none;
         border: none;
         font-weight: 500;
         color: var(--gray-500);
         transition: all var(--transition-normal) ease;
         position: relative;
         }
         .tab::after {
         content: '';
         position: absolute;
         bottom: -2px;
         left: 0;
         right: 0;
         height: 2px;
         background: var(--primary-600);
         transform: scaleX(0);
         transition: transform var(--transition-normal) ease;
         }
         .tab.active {
         color: var(--primary-600);
         }
         .tab.active::after {
         transform: scaleX(1);
         }
         .tab-content {
         display: none;
         }
         .tab-content.active {
         display: block;
         }
         /* Quiz Styles */
         .quiz-option {
         padding: var(--space-md);
         border: 2px solid var(--gray-200);
         border-radius: var(--radius-md);
         margin: 0.75rem 0;
         cursor: pointer;
         transition: all var(--transition-normal) ease;
         background: white;
         display: flex;
         align-items: center;
         }
         .quiz-option:hover {
         border-color: var(--primary-600);
         background: var(--gray-50);
         }
         .quiz-option.selected {
         border-color: var(--primary-600);
         background: var(--primary-50);
         }
         .quiz-option.correct {
         border-color: var(--success-500);
         background: var(--success-50);
         }
         .quiz-option.incorrect {
         border-color: var(--error-500);
         background: var(--error-50);
         }
         .quiz-option input {
         margin-right: var(--space-md);
         }
         .quiz-option label {
         cursor: pointer;
         flex: 1;
         }
         /* Quiz Timer */
         .quiz-timer {
         display: flex;
         align-items: center;
         justify-content: center;
         margin-bottom: var(--space-md);
         font-size: 1.25rem;
         font-weight: 600;
         color: var(--gray-700);
         }
         .quiz-timer i {
         margin-right: var(--space-sm);
         color: var(--primary-600);
         }
         .quiz-timer.warning {
         color: var(--warning-600);
         }
         .quiz-timer.warning i {
         color: var(--warning-600);
         }
         .quiz-timer.danger {
         color: var(--error-600);
         }
         .quiz-timer.danger i {
         color: var(--error-600);
         }
         /* Drag and Drop Styles */
         .drag-items-container {
         display: flex;
         flex-wrap: wrap;
         gap: var(--space-sm);
         margin-bottom: var(--space-xl);
         }
         .drag-item {
         background: var(--gray-100);
         border: 1px solid var(--gray-300);
         border-radius: var(--radius-md);
         padding: var(--space-md) var(--space-lg);
         cursor: move;
         transition: all var(--transition-fast) ease;
         user-select: none;
         }
         .drag-item:hover {
         background: var(--gray-200);
         transform: translateY(-2px);
         }
         .drag-item.dragging {
         opacity: 0.5;
         }
         .drop-targets-container {
         display: flex;
         flex-wrap: wrap;
         gap: var(--space-md);
         }
         .drop-target {
         background: var(--gray-50);
         border: 2px dashed var(--gray-300);
         border-radius: var(--radius-md);
         padding: var(--space-md);
         min-width: 150px;
         min-height: 50px;
         text-align: center;
         transition: all var(--transition-fast) ease;
         }
         .drop-target.drag-over {
         background: var(--primary-50);
         border-color: var(--primary-500);
         }
         /* Fill in the Blank Styles */
         .blank-container {
         font-size: 1rem;
         line-height: 1.6;
         }
         .blank-input {
         display: inline-block;
         width: 120px;
         padding: 5px 8px;
         margin: 0 5px;
         border: 1px solid var(--gray-300);
         border-radius: var(--radius-sm);
         font-size: 1rem;
         text-align: center;
         }
         .blank-input:focus {
         outline: none;
         border-color: var(--primary-600);
         box-shadow: 0 0 0 2px rgba(79, 70, 229, 0.2);
         }
         /* Matching Styles */
         .matching-container {
         display: flex;
         gap: var(--space-xl);
         }
         .matching-column {
         flex: 1;
         display: flex;
         flex-direction: column;
         gap: var(--space-sm);
         }
         .matching-item {
         background: var(--gray-50);
         border: 1px solid var(--gray-200);
         border-radius: var(--radius-md);
         padding: var(--space-md);
         cursor: pointer;
         transition: all var(--transition-fast) ease;
         user-select: none;
         }
         .matching-item:hover {
         background: var(--gray-100);
         }
         .matching-item.selected {
         background: var(--primary-50);
         border-color: var(--primary-600);
         }
         .matching-item.matched {
         background: var(--success-50);
         border-color: var(--success-500);
         cursor: default;
         }
         /* Progress Bar */
         .progress-bar {
         width: 100%;
         height: 8px;
         background: var(--gray-200);
         border-radius: var(--radius-sm);
         overflow: hidden;
         margin: var(--space-md) 0;
         }
         .progress-fill {
         height: 100%;
         background: linear-gradient(90deg, var(--primary-600), var(--secondary-600));
         transition: width var(--transition-normal) ease;
         }
         /* Modal Styles */
         .modal {
         display: none;
         position: fixed;
         top: 0;
         left: 0;
         width: 100%;
         height: 100%;
         background: rgba(0, 0, 0, 0.5);
         z-index: 1000;
         align-items: center;
         justify-content: center;
         padding: var(--space-md);
         }
         .modal.active {
         display: flex;
         }
         .modal-content {
         background: white;
         border-radius: var(--radius-2xl);
         padding: var(--space-2xl);
         max-width: 600px;
         width: 100%;
         max-height: 90vh;
         overflow-y: auto;
         box-shadow: var(--shadow-xl);
         }
         /* Button Styles */
         .btn {
         padding: 0.75rem var(--space-xl);
         border-radius: var(--radius-md);
         font-weight: 600;
         cursor: pointer;
         transition: all var(--transition-normal) ease;
         border: none;
         display: inline-flex;
         align-items: center;
         justify-content: center;
         gap: var(--space-sm);
         font-family: var(--font-sans);
         font-size: 1rem;
         }
         .btn:focus {
         outline: 2px solid var(--primary-600);
         outline-offset: 2px;
         }
         .btn-primary {
         background: linear-gradient(135deg, var(--primary-600), var(--secondary-600));
         color: white;
         }
         .btn-primary:hover {
         transform: translateY(-2px);
         box-shadow: var(--shadow-xl);
         }
         .btn-primary:disabled {
         opacity: 0.6;
         cursor: not-allowed;
         transform: none;
         }
         .btn-secondary {
         background: var(--gray-100);
         color: var(--gray-700);
         }
         .btn-secondary:hover {
         background: var(--gray-200);
         }
         .btn-success {
         background: var(--success-500);
         color: white;
         }
         .btn-danger {
         background: var(--error-500);
         color: white;
         }
         /* Lock Overlay */
         .lock-overlay {
         position: absolute;
         top: 0;
         left: 0;
         right: 0;
         bottom: 0;
         background: rgba(0, 0, 0, 0.7);
         display: flex;
         align-items: center;
         justify-content: center;
         border-radius: var(--radius-2xl);
         color: white;
         font-size: 3rem;
         }
         /* Toast Notification */
         .toast {
         position: fixed;
         bottom: var(--space-xl);
         right: var(--space-xl);
         background: white;
         padding: var(--space-md);
         border-radius: var(--radius-md);
         box-shadow: var(--shadow-lg);
         z-index: 2000;
         display: flex;
         align-items: center;
         transform: translateX(400px);
         transition: transform var(--transition-normal) ease;
         max-width: 400px;
         }
         .toast.show {
         transform: translateX(0);
         }
         .toast-icon {
         margin-right: var(--space-md);
         font-size: 1.25rem;
         }
         .toast.success .toast-icon {
         color: var(--success-500);
         }
         .toast.error .toast-icon {
         color: var(--error-500);
         }
         .toast.info .toast-icon {
         color: var(--primary-500);
         }
         .toast-message {
         flex: 1;
         }
         .toast-title {
         font-weight: 600;
         margin-bottom: 0.25rem;
         }
         .toast-description {
         font-size: 0.875rem;
         color: var(--gray-600);
         }
         /* Loading Spinner */
         .spinner {
         border: 3px solid var(--gray-200);
         border-top: 3px solid var(--primary-600);
         border-radius: var(--radius-full);
         width: 30px;
         height: 30px;
         animation: spin 1s linear infinite;
         margin: 0 auto;
         }
         @keyframes spin {
         0% { transform: rotate(0deg); }
         100% { transform: rotate(360deg); }
         }
         /* Landing Page Styles */
         .landing-container {
         min-height: 100vh;
         display: flex;
         align-items: center;
         justify-content: center;
         padding: var(--space-xl);
         }
         .landing-card {
         background: white;
         border-radius: var(--radius-2xl);
         padding: var(--space-2xl);
         max-width: 800px;
         width: 100%;
         box-shadow: var(--shadow-xl);
         text-align: center;
         }
         .landing-icon {
         font-size: 4rem;
         color: var(--primary-600);
         margin-bottom: var(--space-md);
         animation: pulse 2s infinite;
         }
         .landing-title {
         font-size: 2.5rem;
         font-weight: 800;
         color: var(--gray-900);
         margin-bottom: var(--space-md);
         }
         .landing-subtitle {
         font-size: 1.25rem;
         color: var(--gray-600);
         margin-bottom: var(--space-xl);
         }
         .feature-grid {
         display: grid;
         grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
         gap: var(--space-xl);
         margin: var(--space-xl) 0;
         }
         .feature-card {
         padding: var(--space-xl);
         border-radius: var(--radius-xl);
         background: var(--gray-50);
         text-align: center;
         transition: all var(--transition-normal) ease;
         }
         .feature-card:hover {
         transform: translateY(-5px);
         box-shadow: var(--shadow-lg);
         }
         .feature-icon {
         font-size: 2rem;
         color: var(--primary-600);
         margin-bottom: var(--space-sm);
         animation: bounce 2s infinite;
         }
         /* Pre-Quiz Introduction Styles */
         .prequiz-container {
         min-height: 100vh;
         display: flex;
         align-items: center;
         justify-content: center;
         padding: var(--space-xl);
         }
         .prequiz-card {
         background: white;
         border-radius: var(--radius-2xl);
         padding: var(--space-2xl);
         max-width: 800px;
         width: 100%;
         box-shadow: var(--shadow-xl);
         text-align: center;
         }
         .prequiz-icon {
         font-size: 4rem;
         color: var(--primary-600);
         margin-bottom: var(--space-md);
         animation: pulse 2s infinite;
         }
         .prequiz-title {
         font-size: 2.5rem;
         font-weight: 800;
         color: var(--gray-900);
         margin-bottom: var(--space-md);
         }
         .prequiz-subtitle {
         font-size: 1.25rem;
         color: var(--gray-600);
         margin-bottom: var(--space-xl);
         }
         .support-message {
         background: var(--primary-50);
         border-left: 4px solid var(--primary-500);
         padding: var(--space-md);
         border-radius: var(--radius-md);
         margin: var(--space-xl) 0;
         text-align: left;
         }
         .support-message h3 {
         font-size: 1.25rem;
         font-weight: 600;
         color: var(--primary-800);
         margin-bottom: var(--space-sm);
         }
         .support-message p {
         color: var(--primary-700);
         line-height: 1.6;
         }
         /* Study Group Styles */
         .study-group-card {
         background: rgba(255, 255, 255, 0.95);
         border-radius: var(--radius-xl);
         padding: var(--space-xl);
         margin-bottom: var(--space-md);
         box-shadow: var(--shadow-lg);
         transition: all var(--transition-normal) ease;
         position: relative;
         }
         .study-group-card:hover {
         transform: translateY(-3px);
         box-shadow: var(--shadow-xl);
         }
         .member-avatar {
         width: 30px;
         height: 30px;
         border-radius: var(--radius-full);
         background: linear-gradient(135deg, var(--primary-600), var(--secondary-600));
         display: flex;
         align-items: center;
         justify-content: center;
         color: white;
         font-weight: 600;
         font-size: 0.75rem;
         margin-right: -10px;
         border: 2px solid white;
         }
         .study-group-activity {
         font-size: 0.875rem;
         color: var(--gray-500);
         margin-top: var(--space-sm);
         }
         /* Comment Styles */
         .comment-section {
         background: rgba(255, 255, 255, 0.95);
         border-radius: var(--radius-xl);
         padding: var(--space-xl);
         margin-top: var(--space-xl);
         }
         .comment {
         background: var(--gray-50);
         border-radius: var(--radius-lg);
         padding: var(--space-md);
         margin-bottom: var(--space-md);
         border-left: 4px solid var(--primary-600);
         transition: all var(--transition-normal) ease;
         position: relative;
         }
         .comment:hover {
         transform: translateX(5px);
         box-shadow: var(--shadow-md);
         }
         .comment-author {
         font-weight: 600;
         color: var(--gray-800);
         margin-bottom: 0.25rem;
         display: flex;
         align-items: center;
         }
         .comment-avatar {
         width: 24px;
         height: 24px;
         border-radius: var(--radius-full);
         background: linear-gradient(135deg, var(--primary-600), var(--secondary-600));
         display: flex;
         align-items: center;
         justify-content: center;
         color: white;
         font-weight: 600;
         font-size: 0.625rem;
         margin-right: var(--space-sm);
         }
         .comment-text {
         color: var(--gray-600);
         line-height: 1.5;
         }
         .comment-time {
         font-size: 0.75rem;
         color: var(--gray-400);
         margin-top: 0.25rem;
         }
         .comment-form {
         display: flex;
         margin-top: var(--space-md);
         gap: var(--space-sm);
         }
         .comment-input {
         flex: 1;
         padding: var(--space-md);
         border: 1px solid var(--gray-300);
         border-radius: var(--radius-md);
         font-size: 0.875rem;
         }
         .comment-submit {
         background: var(--primary-600);
         color: white;
         border: none;
         padding: var(--space-md) var(--space-xl);
         border-radius: var(--radius-md);
         cursor: pointer;
         font-weight: 600;
         transition: all var(--transition-normal) ease;
         }
         .comment-submit:hover {
         background: var(--primary-700);
         }
         .comment-actions {
         position: absolute;
         top: var(--space-md);
         right: var(--space-md);
         display: flex;
         gap: var(--space-sm);
         }
         .comment-action {
         color: var(--gray-400);
         cursor: pointer;
         transition: color var(--transition-fast);
         }
         .comment-action:hover {
         color: var(--primary-600);
         }
         /* Reply Styles */
         .replies-container {
         margin-left: var(--space-xl);
         margin-top: 0.75rem;
         border-left: 2px solid var(--gray-200);
         padding-left: var(--space-md);
         }
         .reply {
         background: var(--gray-100);
         border-radius: var(--radius-md);
         padding: 0.75rem;
         margin-bottom: 0.75rem;
         position: relative;
         }
         .reply-author {
         font-weight: 500;
         color: var(--gray-600);
         font-size: 0.875rem;
         margin-bottom: 0.25rem;
         display: flex;
         align-items: center;
         }
         .reply-avatar {
         width: 20px;
         height: 20px;
         border-radius: var(--radius-full);
         background: linear-gradient(135deg, var(--secondary-600), var(--secondary-500));
         display: flex;
         align-items: center;
         justify-content: center;
         color: white;
         font-weight: 600;
         font-size: 0.5rem;
         margin-right: var(--space-sm);
         }
         .reply-text {
         color: var(--gray-600);
         font-size: 0.875rem;
         line-height: 1.4;
         }
         .reply-time {
         font-size: 0.75rem;
         color: var(--gray-400);
         margin-top: 0.25rem;
         }
         .reply-form {
         display: flex;
         margin-top: 0.5rem;
         gap: var(--space-sm);
         }
         .reply-input {
         flex: 1;
         padding: var(--space-sm);
         border: 1px solid var(--gray-300);
         border-radius: var(--radius-sm);
         font-size: 0.8rem;
         }
         .reply-submit {
         background: var(--secondary-600);
         color: white;
         border: none;
         padding: var(--space-sm) var(--space-md);
         border-radius: var(--radius-sm);
         cursor: pointer;
         font-weight: 500;
         font-size: 0.8rem;
         transition: all var(--transition-normal) ease;
         }
         .reply-submit:hover {
         background: var(--secondary-700);
         }
         /* Group Discussion Styles */
         .group-discussion {
         margin-top: var(--space-xl);
         }
         .group-discussion-header {
         display: flex;
         justify-content: space-between;
         align-items: center;
         margin-bottom: var(--space-md);
         }
         .group-discussion-title {
         font-weight: 600;
         color: var(--gray-800);
         }
         .group-message {
         background: var(--gray-50);
         border-radius: var(--radius-lg);
         padding: var(--space-md);
         margin-bottom: var(--space-md);
         border-left: 4px solid var(--success-500);
         transition: all var(--transition-normal) ease;
         position: relative;
         }
         .group-message:hover {
         transform: translateX(5px);
         box-shadow: var(--shadow-md);
         }
         .group-message-author {
         font-weight: 600;
         color: var(--gray-800);
         margin-bottom: 0.25rem;
         display: flex;
         align-items: center;
         }
         .group-message-avatar {
         width: 24px;
         height: 24px;
         border-radius: var(--radius-full);
         background: linear-gradient(135deg, var(--success-500), var(--success-600));
         display: flex;
         align-items: center;
         justify-content: center;
         color: white;
         font-weight: 600;
         font-size: 0.625rem;
         margin-right: var(--space-sm);
         }
         .group-message-text {
         color: var(--gray-600);
         line-height: 1.5;
         }
         .group-message-time {
         font-size: 0.75rem;
         color: var(--gray-400);
         margin-top: 0.25rem;
         }
         .group-message-form {
         display: flex;
         margin-top: var(--space-md);
         gap: var(--space-sm);
         }
         .group-message-input {
         flex: 1;
         padding: var(--space-md);
         border: 1px solid var(--gray-300);
         border-radius: var(--radius-md);
         font-size: 0.875rem;
         }
         .group-message-submit {
         background: var(--success-500);
         color: white;
         border: none;
         padding: var(--space-md) var(--space-xl);
         border-radius: var(--radius-md);
         cursor: pointer;
         font-weight: 600;
         transition: all var(--transition-normal) ease;
         }
         .group-message-submit:hover {
         background: var(--success-600);
         }
         /* Feedback Form Styles */
         .feedback-form {
         background: rgba(255, 255, 255, 0.95);
         border-radius: var(--radius-xl);
         padding: var(--space-xl);
         margin-top: var(--space-xl);
         box-shadow: var(--shadow-lg);
         }
         .feedback-form h3 {
         font-size: 1.25rem;
         font-weight: 600;
         color: var(--gray-800);
         margin-bottom: var(--space-lg);
         display: flex;
         align-items: center;
         }
         .feedback-form h3 i {
         margin-right: var(--space-sm);
         color: var(--primary-600);
         }
         .form-group {
         margin-bottom: var(--space-lg);
         }
         .form-group label {
         display: block;
         font-weight: 500;
         color: var(--gray-700);
         margin-bottom: var(--space-sm);
         }
         .form-group input,
         .form-group textarea,
         .form-group select {
         width: 100%;
         padding: var(--space-md);
         border: 1px solid var(--gray-300);
         border-radius: var(--radius-md);
         font-size: 1rem;
         transition: all var(--transition-normal) ease;
         }
         .form-group input:focus,
         .form-group textarea:focus,
         .form-group select:focus {
         outline: none;
         border-color: var(--primary-600);
         box-shadow: 0 0 0 2px rgba(79, 70, 229, 0.2);
         }
         .form-group textarea {
         resize: vertical;
         min-height: 120px;
         }
         .rating-container {
         display: flex;
         gap: var(--space-md);
         margin-bottom: var(--space-md);
         }
         .rating-star {
         font-size: 1.5rem;
         color: var(--gray-300);
         cursor: pointer;
         transition: color var(--transition-normal) ease;
         }
         .rating-star:hover,
         .rating-star.active {
         color: var(--warning-500);
         }
         /* Highlight Box */
         .highlight-box {
         background: var(--primary-50);
         border-left: 4px solid var(--primary-500);
         padding: var(--space-md);
         border-radius: var(--radius-md);
         margin: var(--space-md) 0;
         transition: all var(--transition-normal) ease;
         }
         .highlight-box:hover {
         transform: translateX(5px);
         box-shadow: var(--shadow-md);
         }
         .highlight-box h4 {
         color: var(--primary-800);
         font-weight: 600;
         margin-bottom: var(--space-sm);
         }
         .highlight-box p {
         color: var(--primary-700);
         }
         /* Equation Box */
         .equation-box {
         background: var(--gray-50);
         border: 1px solid var(--gray-200);
         border-radius: var(--radius-md);
         padding: var(--space-md);
         margin: var(--space-md) 0;
         text-align: center;
         transition: all var(--transition-normal) ease;
         }
         .equation-box:hover {
         transform: scale(1.02);
         box-shadow: var(--shadow-md);
         }
         .equation-box .equation {
         font-family: var(--font-mono);
         font-size: 1.1rem;
         font-weight: 600;
         color: var(--gray-800);
         margin: var(--space-sm) 0;
         }
         /* Key Point Box */
         .key-point {
         background: var(--warning-50);
         border-left: 4px solid var(--warning-500);
         padding: var(--space-md);
         border-radius: var(--radius-md);
         margin: var(--space-md) 0;
         transition: all var(--transition-normal) ease;
         }
         .key-point:hover {
         transform: translateX(5px);
         box-shadow: var(--shadow-md);
         }
         .key-point h4 {
         color: var(--warning-800);
         font-weight: 600;
         margin-bottom: var(--space-sm);
         }
         .key-point p {
         color: var(--warning-700);
         }
         /* Comparison Table */
         .comparison-table {
         width: 100%;
         border-collapse: collapse;
         margin: var(--space-xl) 0;
         background: white;
         border-radius: var(--radius-md);
         overflow: hidden;
         box-shadow: var(--shadow-md);
         }
         .comparison-table th {
         background: var(--primary-600);
         color: white;
         padding: 0.75rem;
         text-align: left;
         font-weight: 600;
         }
         .comparison-table td {
         padding: 0.75rem;
         border-bottom: 1px solid var(--gray-200);
         }
         .comparison-table tr:last-child td {
         border-bottom: none;
         }
         .comparison-table tr:nth-child(even) {
         background: var(--gray-50);
         }
         .comparison-table tr:hover {
         background: var(--primary-50);
         }
         /* Section Completion Button */
         .complete-section-btn {
         margin-top: var(--space-xl);
         width: 100%;
         }
         /* Progress Tracker */
         .progress-tracker {
         background: white;
         border-radius: var(--radius-xl);
         padding: var(--space-xl);
         margin-bottom: var(--space-xl);
         box-shadow: var(--shadow-lg);
         }
         .progress-header {
         display: flex;
         justify-content: space-between;
         align-items: center;
         margin-bottom: var(--space-md);
         }
         .progress-title {
         font-weight: 600;
         color: var(--gray-800);
         }
         .progress-percentage {
         font-weight: 700;
         color: var(--primary-600);
         font-size: 1.25rem;
         }
         .progress-details {
         display: grid;
         grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
         gap: var(--space-md);
         margin-top: var(--space-md);
         }
         .progress-item {
         text-align: center;
         padding: var(--space-md);
         border-radius: var(--radius-md);
         background: var(--gray-50);
         transition: all var(--transition-normal) ease;
         }
         .progress-item:hover {
         background: var(--primary-50);
         transform: translateY(-2px);
         }
         .progress-item-icon {
         font-size: 1.5rem;
         margin-bottom: var(--space-sm);
         }
         .progress-item.completed .progress-item-icon {
         color: var(--success-500);
         }
         .progress-item.active .progress-item-icon {
         color: var(--primary-600);
         }
         .progress-item.locked .progress-item-icon {
         color: var(--gray-400);
         }
         .progress-item-label {
         font-size: 0.875rem;
         font-weight: 500;
         color: var(--gray-600);
         }
         .progress-item-status {
         font-size: 0.75rem;
         margin-top: 0.25rem;
         }
         .progress-item.completed .progress-item-status {
         color: var(--success-500);
         }
         .progress-item.active .progress-item-status {
         color: var(--primary-600);
         }
         .progress-item.locked .progress-item-status {
         color: var(--gray-400);
         }
         /* Empty State */
         .empty-state {
         text-align: center;
         padding: var(--space-2xl) var(--space-md);
         color: var(--gray-500);
         }
         .empty-state-icon {
         font-size: 3rem;
         color: var(--gray-300);
         margin-bottom: var(--space-md);
         }
         .empty-state-title {
         font-size: 1.25rem;
         font-weight: 600;
         margin-bottom: var(--space-sm);
         }
         .empty-state-description {
         max-width: 400px;
         margin: 0 auto;
         }
         /* Vote Styles */
         .vote-container {
         display: flex;
         align-items: center;
         gap: var(--space-sm);
         margin-top: var(--space-sm);
         }
         .vote-button {
         background: none;
         border: none;
         color: var(--gray-400);
         cursor: pointer;
         display: flex;
         align-items: center;
         gap: var(--space-xs);
         font-size: 0.875rem;
         padding: var(--space-xs) var(--space-sm);
         border-radius: var(--radius-sm);
         transition: all var(--transition-fast);
         }
         .vote-button:hover {
         background: var(--gray-100);
         color: var(--gray-600);
         }
         .vote-button.voted {
         color: var(--primary-600);
         }
         .vote-button.voted .vote-icon {
         color: var(--primary-600);
         }
         .vote-icon {
         font-size: 1rem;
         }
         .vote-count {
         font-weight: 500;
         }
         /* Skeleton Loading */
         .skeleton {
         background: linear-gradient(90deg, var(--gray-200) 25%, var(--gray-300) 50%, var(--gray-200) 75%);
         background-size: 200% 100%;
         animation: shimmer 1.5s infinite;
         }
         @keyframes shimmer {
         0% { background-position: -1000px 0; }
         100% { background-position: 1000px 0; }
         }
         .skeleton-card {
         background: white;
         border-radius: var(--radius-xl);
         padding: var(--space-xl);
         margin-bottom: var(--space-xl);
         box-shadow: var(--shadow-lg);
         }
         .skeleton-title {
         height: 24px;
         width: 60%;
         margin-bottom: var(--space-md);
         border-radius: var(--radius-sm);
         }
         .skeleton-text {
         height: 16px;
         width: 100%;
         margin-bottom: var(--space-sm);
         border-radius: var(--radius-sm);
         }
         .skeleton-text:last-child {
         width: 80%;
         }
         .skeleton-button {
         height: 40px;
         width: 120px;
         border-radius: var(--radius-md);
         margin-top: var(--space-md);
         }
         /* Step Progress Indicator */
         .step-progress {
         display: flex;
         justify-content: space-between;
         margin: var(--space-xl) 0;
         position: relative;
         }
         .step-progress::before {
         content: '';
         position: absolute;
         top: 20px;
         left: 0;
         right: 0;
         height: 4px;
         background: var(--gray-200);
         z-index: 0;
         }
         .step-progress-item {
         display: flex;
         flex-direction: column;
         align-items: center;
         position: relative;
         z-index: 1;
         }
         .step-progress-circle {
         width: 40px;
         height: 40px;
         border-radius: var(--radius-full);
         background: var(--gray-200);
         display: flex;
         align-items: center;
         justify-content: center;
         margin-bottom: var(--space-sm);
         transition: all var(--transition-normal) ease;
         }
         .step-progress-circle.active {
         background: var(--primary-600);
         color: white;
         }
         .step-progress-circle.completed {
         background: var(--success-500);
         color: white;
         }
         .step-progress-label {
         font-size: 0.875rem;
         font-weight: 500;
         color: var(--gray-600);
         text-align: center;
         }
         .step-progress-label.active {
         color: var(--primary-600);
         font-weight: 600;
         }
         .step-progress-label.completed {
         color: var(--success-500);
         }
         /* Auth Modal Styles */
         .auth-tabs {
         display: flex;
         border-bottom: 2px solid var(--gray-200);
         margin-bottom: var(--space-xl);
         }
         .auth-tab {
         flex: 1;
         padding: var(--space-md);
         text-align: center;
         cursor: pointer;
         font-weight: 500;
         color: var(--gray-600);
         transition: all var(--transition-normal) ease;
         position: relative;
         }
         .auth-tab::after {
         content: '';
         position: absolute;
         bottom: -2px;
         left: 0;
         right: 0;
         height: 2px;
         background: var(--primary-600);
         transform: scaleX(0);
         transition: transform var(--transition-normal) ease;
         }
         .auth-tab.active {
         color: var(--primary-600);
         }
         .auth-tab.active::after {
         transform: scaleX(1);
         }
         .auth-content {
         display: none;
         }
         .auth-content.active {
         display: block;
         }
         .modal-header {
         display: flex;
         justify-content: space-between;
         align-items: center;
         margin-bottom: var(--space-xl);
         }
         .modal-title {
         font-size: 1.5rem;
         font-weight: 700;
         color: var(--gray-800);
         }
         .close-btn {
         background: none;
         border: none;
         font-size: 1.25rem;
         color: var(--gray-600);
         cursor: pointer;
         transition: color var(--transition-fast);
         padding: var(--space-sm);
         border-radius: var(--radius-sm);
         }
         .close-btn:hover {
         color: var(--gray-800);
         background: var(--gray-100);
         }
         /* Glossary Section */
         .glossary-section {
         margin-top: var(--space-xl);
         }
         .glossary-header {
         display: flex;
         justify-content: space-between;
         align-items: center;
         margin-bottom: var(--space-md);
         }
         .glossary-title {
         font-weight: 600;
         color: var(--gray-800);
         }
         .glossary-search {
         width: 100%;
         padding: 0.5rem 1rem;
         border: 1px solid var(--gray-300);
         border-radius: var(--radius-md);
         margin-bottom: var(--space-md);
         }
         .glossary-terms {
         display: grid;
         grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
         gap: var(--space-md);
         }
         .glossary-term {
         background: var(--gray-50);
         border-radius: var(--radius-md);
         padding: var(--space-md);
         transition: all var(--transition-normal) ease;
         }
         .glossary-term:hover {
         background: var(--primary-50);
         transform: translateY(-2px);
         box-shadow: var(--shadow-md);
         }
         .glossary-term-name {
         font-weight: 600;
         color: var(--primary-600);
         margin-bottom: 0.25rem;
         }
         .glossary-term-definition {
         font-size: 0.875rem;
         color: var(--gray-600);
         }
         /* Responsive Design */
         @media (max-width: 768px) {
         .sidebar {
         transform: translateX(-100%);
         }
         .sidebar.active {
         transform: translateX(0);
         }
         .main-content {
         margin-left: 0;
         }
         .menu-toggle {
         display: block;
         }
         .landing-title, .prequiz-title {
         font-size: 2rem;
         }
         .feature-grid {
         grid-template-columns: 1fr;
         }
         .element-grid {
         grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
         }
         .learning-path {
         flex-direction: column;
         gap: var(--space-xl);
         }
         .learning-path::before {
         width: 4px;
         height: 100%;
         top: 0;
         left: 50%;
         right: auto;
         transform: translateX(-50%);
         }
         .comparison-table {
         font-size: 0.875rem;
         }
         .comparison-table th, .comparison-table td {
         padding: 0.5rem;
         }
         .matching-container {
         flex-direction: column;
         gap: var(--space-md);
         }
         .drag-items-container,
         .drop-targets-container {
         justify-content: center;
         }
         .blank-input {
         width: 100px;
         }
         .progress-details {
         grid-template-columns: repeat(2, 1fr);
         }
         .toast {
         right: var(--space-md);
         left: var(--space-md);
         max-width: none;
         }
         .glossary-terms {
         grid-template-columns: 1fr;
         }
         }
         @media (max-width: 480px) {
         .landing-card, .prequiz-card, .modal-content {
         padding: var(--space-md);
         }
         .landing-title, .prequiz-title {
         font-size: 1.5rem;
         }
         .feature-card {
         padding: var(--space-md);
         }
         .content-card {
         padding: var(--space-md);
         }
         .btn {
         padding: var(--space-sm) var(--space-md);
         font-size: 0.875rem;
         }
         .theme-toggle {
         bottom: var(--space-md);
         right: var(--space-md);
         width: 40px;
         height: 40px;
         }
         .theme-toggle i {
         font-size: 1rem;
         }
         }
         /* High Contrast Mode */
         @media (prefers-contrast: high) {
         :root {
         --primary-600: #0066cc;
         --secondary-600: #6600cc;
         --gray-200: #cccccc;
         --gray-300: #999999;
         }
         .nav-item:hover {
         background: rgba(0, 102, 204, 0.2);
         }
         .btn-primary {
         background: var(--primary-600);
         }
         }
         /* Reduced Motion */
         @media (prefers-reduced-motion: reduce) {
         * {
         animation-duration: 0.01ms !important;
         animation-iteration-count: 1 !important;
         transition-duration: 0.01ms !important;
         }
         }
      </style>
      <!-- Google Fonts -->
      <link rel="preconnect" href="https://fonts.googleapis.com">
      <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
      <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
   </head>
   <body>
      <!-- Skip to content link for accessibility -->
      <a href="#main-content" class="skip-link">Skip to main content</a>
      <!-- Status message for screen readers -->
      <div role="status" aria-live="polite" class="sr-only" id="statusMessage"></div>
      <!-- Loading Overlay -->
      <div id="loadingOverlay" style="display: none;" role="alert" aria-busy="true">
         <div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white rounded-lg p-6 text-center">
               <div class="spinner" aria-label="Loading"></div>
               <p class="mt-2 text-gray-600">Loading...</p>
            </div>
         </div>
      </div>
      <!-- Theme Toggle Button -->
      <button class="theme-toggle" onclick="toggleTheme()" aria-label="Toggle dark mode">
      <i class="fas fa-moon" id="themeIcon"></i>
      </button>
      <!-- Landing Page (shown when user hasn't signed in) -->
      <div id="landingPage" class="landing-container">
         <div class="landing-card">
            <div class="landing-icon text-reveal delay-100" aria-hidden="true">
               <i class="fas fa-atom"></i>
            </div>
            <h1 class="landing-title glow-text text-reveal delay-300">
               <span class="letter-pop delay-300">C</span>
               <span class="letter-pop delay-320">h</span>
               <span class="letter-pop delay-340">e</span>
               <span class="letter-pop delay-360">m</span>
               <span class="letter-pop delay-380">i</span>
               <span class="letter-pop delay-400">s</span>
               <span class="letter-pop delay-420">t</span>
               <span class="letter-pop delay-440">r</span>
               <span class="letter-pop delay-460">y</span>
               <span class="letter-pop delay-480"> </span>
               <span class="letter-pop delay-500">M</span>
               <span class="letter-pop delay-520">a</span>
               <span class="letter-pop delay-540">s</span>
               <span class="letter-pop delay-560">t</span>
               <span class="letter-pop delay-580">e</span>
               <span class="letter-pop delay-600">r</span>
               <span class="letter-pop delay-620">y</span>
            </h1>
            <p class="landing-subtitle text-reveal delay-700">
               Master <strong class="color-shift">Group 1 Alkali Metals</strong> through Interactive Learning
            </p>
            <div class="feature-grid">
               <div class="feature-card slide-up delay-800">
                  <div class="feature-icon" aria-hidden="true">
                     <i class="fas fa-clipboard-check"></i>
                  </div>
                  <h3 class="font-semibold">Pre-Assessment</h3>
                  <p class="text-sm text-gray-600">Test your <strong>current knowledge</strong></p>
               </div>
               <div class="feature-card slide-up delay-900">
                  <div class="feature-icon" aria-hidden="true">
                     <i class="fas fa-book-open"></i>
                  </div>
                  <h3 class="font-semibold">Interactive Content</h3>
                  <p class="text-sm text-gray-600">Learn through <strong>engaging materials</strong></p>
               </div>
               <div class="feature-card slide-up delay-1000">
                  <div class="feature-icon" aria-hidden="true">
                     <i class="fas fa-users"></i>
                  </div>
                  <h3 class="font-semibold">Collaborative Learning</h3>
                  <p class="text-sm text-gray-600">Study with <strong>peers</strong></p>
               </div>
            </div>
            <div class="mt-8">
               <p class="text-lg font-semibold text-gray-700 mb-4 text-reveal delay-1100">Your Learning Journey</p>
               <div class="step-progress slide-up delay-1200">
                  <div class="step-progress-item">
                     <div class="step-progress-circle active" id="step-prequiz-landing">
                        <i class="fas fa-play"></i>
                     </div>
                     <div class="step-progress-label active">Pre-Quiz</div>
                  </div>
                  <div class="step-progress-item">
                     <div class="step-progress-circle" id="step-overview-landing">
                        <i class="fas fa-lock"></i>
                     </div>
                     <div class="step-progress-label">Learn</div>
                  </div>
                  <div class="step-progress-item">
                     <div class="step-progress-circle" id="step-quiz-landing">
                        <i class="fas fa-lock"></i>
                     </div>
                     <div class="step-progress-label">Post-Quiz</div>
                  </div>
               </div>
            </div>
            <div class="mt-8 space-y-4">
               <button onclick="showLoginModal()" class="btn btn-primary w-full slide-up delay-1300" aria-label="Sign in to begin learning">
               <i class="fas fa-sign-in-alt"></i>
               Sign In to Begin
               </button>
               <button onclick="signInWithGoogle()" class="btn btn-secondary w-full slide-up delay-1500" aria-label="Continue with Google">
               <i class="fab fa-google"></i>
               Continue with Google
               </button>
            </div>
         </div>
      </div>
      <!-- Pre-Quiz Introduction Page (shown after sign-in) -->
      <div id="prequizPage" class="prequiz-container" style="display: none;">
         <div class="prequiz-card">
            <div class="prequiz-icon text-reveal delay-100" aria-hidden="true">
               <i class="fas fa-clipboard-list"></i>
            </div>
            <h1 class="prequiz-title glow-text text-reveal delay-300">
               <span class="letter-pop delay-300">P</span>
               <span class="letter-pop delay-320">r</span>
               <span class="letter-pop delay-340">e</span>
               <span class="letter-pop delay-360">-</span>
               <span class="letter-pop delay-380">A</span>
               <span class="letter-pop delay-400">s</span>
               <span class="letter-pop delay-420">s</span>
               <span class="letter-pop delay-440">e</span>
               <span class="letter-pop delay-460">s</span>
               <span class="letter-pop delay-480">s</span>
               <span class="letter-pop delay-500">m</span>
               <span class="letter-pop delay-520">e</span>
               <span class="letter-pop delay-540">n</span>
               <span class="letter-pop delay-560">t</span>
               <span class="letter-pop delay-580"> </span>
               <span class="letter-pop delay-600">Q</span>
               <span class="letter-pop delay-620">u</span>
               <span class="letter-pop delay-640">i</span>
               <span class="letter-pop delay-660">z</span>
            </h1>
            <p class="prequiz-subtitle text-reveal delay-700">
               Let's check your <strong class="color-shift">current knowledge</strong> of Group 1 Alkali Metals
            </p>
            <div class="support-message slide-up delay-800">
               <h3><i class="fas fa-lightbulb mr-2" aria-hidden="true"></i>Before You Begin</h3>
               <p>This quiz helps us understand your <strong>current knowledge level</strong>. Don't worry if you don't know all the answers - this is just a <strong>starting point</strong>! Take your time, read each question carefully, and do your best. Your results will help us <strong>personalize your learning experience</strong>.</p>
            </div>
            <div class="bg-blue-50 p-4 rounded-lg mb-6 slide-up delay-900">
               <div class="flex items-center mb-2">
                  <i class="fas fa-info-circle text-blue-500 mr-2" aria-hidden="true"></i>
                  <h3 class="font-semibold text-blue-800">Quiz Details</h3>
               </div>
               <ul class="text-left text-blue-700 space-y-1">
                  <li>• <strong>7 interactive questions</strong></li>
                  <li>• <strong>No time limit</strong></li>
                  <li>• <strong>Immediate feedback</strong> on answers</li>
                  <li>• <strong>Results saved</strong> to your profile</li>
               </ul>
            </div>
            <div class="mt-8">
               <button onclick="startPreQuiz()" class="btn btn-primary w-full slide-up delay-1000" aria-label="Start pre-quiz">
               <i class="fas fa-play mr-2"></i>
               Start Pre-Quiz
               </button>
            </div>
         </div>
      </div>
      <!-- Main App (shown after pre-quiz completion) -->
      <div id="mainApp" style="display: none;">
         <!-- Menu Toggle Button (Mobile) -->
         <button class="menu-toggle" onclick="toggleSidebar()" aria-label="Toggle navigation menu">
         <i class="fas fa-bars"></i>
         </button>
         <!-- Sidebar -->
         <nav class="sidebar" id="sidebar" role="navigation" aria-label="Main navigation">
            <div class="sidebar-header">
               <div class="flex items-center">
                  <i class="fas fa-atom text-indigo-600 text-2xl mr-3" aria-hidden="true"></i>
                  <h1 class="text-xl font-bold text-gray-800">Chemistry Mastery</h1>
               </div>
               <p class="text-sm text-gray-600 mt-1">Group 1 - Alkali Metals</p>
            </div>
            <div class="sidebar-nav">
               <a href="#" class="nav-item active" id="nav-overview" onclick="navigateToSection('overview')" aria-current="page">
               <i class="fas fa-home"></i>
               <span>Overview</span>
               </a>
               <a href="#" class="nav-item locked" id="nav-elements" onclick="navigateToSection('elements')">
               <i class="fas fa-th"></i>
               <span>Elements</span>
               </a>
               <a href="#" class="nav-item locked" id="nav-properties" onclick="navigateToSection('properties')">
               <i class="fas fa-flask"></i>
               <span>Properties</span>
               </a>
               <a href="#" class="nav-item locked" id="nav-reactions" onclick="navigateToSection('reactions')">
               <i class="fas fa-vial"></i>
               <span>Reactions</span>
               </a>
               <a href="#" class="nav-item" id="nav-glossary" onclick="navigateToSection('glossary')">
               <i class="fas fa-book"></i>
               <span>Glossary</span>
               </a>
               <a href="#" class="nav-item" id="nav-study-groups" onclick="navigateToSection('study-groups')">
               <i class="fas fa-users"></i>
               <span>Study Groups</span>
               </a>
               <a href="#" class="nav-item" id="nav-discussion" onclick="navigateToSection('discussion')">
               <i class="fas fa-comments"></i>
               <span>Discussion</span>
               </a>
               <a href="#" class="nav-item" id="nav-feedback" onclick="navigateToSection('feedback')">
               <i class="fas fa-comment-dots"></i>
               <span>Feedback</span>
               </a>
               <a href="#" class="nav-item locked" id="nav-quiz" onclick="navigateToSection('quiz')">
               <i class="fas fa-graduation-cap"></i>
               <span>Final Quiz</span>
               </a>
            </div>
            <div class="sidebar-footer">
               <div class="flex items-center justify-between mb-3">
                  <div class="flex items-center">
                     <div class="bg-indigo-100 rounded-full p-2 mr-2" aria-hidden="true">
                        <i class="fas fa-coins text-indigo-600"></i>
                     </div>
                     <span class="text-sm font-medium text-gray-700"><span id="userPoints">0</span> pts</span>
                  </div>
                  <div class="flex items-center">
                     <div class="bg-orange-100 rounded-full p-2 mr-2" aria-hidden="true">
                        <i class="fas fa-fire text-orange-500"></i>
                     </div>
                     <span class="text-sm font-medium text-gray-700"><span id="userStreak">0</span></span>
                  </div>
               </div>
               <div class="flex items-center justify-between">
                  <span class="text-sm text-gray-600">Signed in as:</span>
                  <span class="text-sm font-medium text-gray-800" id="userName">User</span>
               </div>
               <button onclick="signOut()" class="btn btn-secondary w-full mt-3 text-sm" aria-label="Sign out of your account">
               <i class="fas fa-sign-out-alt mr-1"></i>
               Logout
               </button>
            </div>
         </nav>
         <!-- Main Content -->
         <main class="main-content" id="main-content">
            <!-- Search Bar -->
            <div class="search-container fade-in">
               <div class="search-icon" aria-hidden="true">
                  <i class="fas fa-search"></i>
               </div>
               <input type="text" id="searchInput" class="search-input" placeholder="Search for content..." aria-label="Search for content">
               <div class="search-results" id="searchResults"></div>
            </div>
            <!-- Progress Tracker -->
            <div class="progress-tracker fade-in">
               <div class="progress-header">
                  <h3 class="progress-title">Your Learning Progress</h3>
                  <div class="progress-percentage" id="progressPercentage">0%</div>
               </div>
               <div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
                  <div class="progress-fill" id="overallProgressFill" style="width: 0%"></div>
               </div>
               <div class="progress-details" id="progressDetails">
                  <div class="progress-item" id="progress-overview">
                     <div class="progress-item-icon" aria-hidden="true"><i class="fas fa-home"></i></div>
                     <div class="progress-item-label">Overview</div>
                     <div class="progress-item-status">Not Started</div>
                  </div>
                  <div class="progress-item" id="progress-elements">
                     <div class="progress-item-icon" aria-hidden="true"><i class="fas fa-th"></i></div>
                     <div class="progress-item-label">Elements</div>
                     <div class="progress-item-status">Locked</div>
                  </div>
                  <div class="progress-item" id="progress-properties">
                     <div class="progress-item-icon" aria-hidden="true"><i class="fas fa-flask"></i></div>
                     <div class="progress-item-label">Properties</div>
                     <div class="progress-item-status">Locked</div>
                  </div>
                  <div class="progress-item" id="progress-reactions">
                     <div class="progress-item-icon" aria-hidden="true"><i class="fas fa-vial"></i></div>
                     <div class="progress-item-label">Reactions</div>
                     <div class="progress-item-status">Locked</div>
                  </div>
                  <div class="progress-item" id="progress-quiz">
                     <div class="progress-item-icon" aria-hidden="true"><i class="fas fa-graduation-cap"></i></div>
                     <div class="progress-item-label">Final Quiz</div>
                     <div class="progress-item-status">Locked</div>
                  </div>
               </div>
            </div>
            <!-- Learning Path -->
            <div class="mb-6">
               <div class="step-progress">
                  <div class="step-progress-item">
                     <div class="step-progress-circle completed" id="step-prequiz">
                        <i class="fas fa-check"></i>
                     </div>
                     <div class="step-progress-label completed">Pre-Quiz</div>
                  </div>
                  <div class="step-progress-item">
                     <div class="step-progress-circle" id="step-overview">
                        <i class="fas fa-home"></i>
                     </div>
                     <div class="step-progress-label">Overview</div>
                  </div>
                  <div class="step-progress-item">
                     <div class="step-progress-circle" id="step-elements">
                        <i class="fas fa-th"></i>
                     </div>
                     <div class="step-progress-label">Elements</div>
                  </div>
                  <div class="step-progress-item">
                     <div class="step-progress-circle" id="step-properties">
                        <i class="fas fa-flask"></i>
                     </div>
                     <div class="step-progress-label">Properties</div>
                  </div>
                  <div class="step-progress-item">
                     <div class="step-progress-circle" id="step-reactions">
                        <i class="fas fa-vial"></i>
                     </div>
                     <div class="step-progress-label">Reactions</div>
                  </div>
                  <div class="step-progress-item">
                     <div class="step-progress-circle" id="step-quiz">
                        <i class="fas fa-graduation-cap"></i>
                     </div>
                     <div class="step-progress-label">Final Quiz</div>
                  </div>
               </div>
            </div>
            <!-- Overview Section -->
            <section id="overview-section" class="content-section">
               <!-- Hero Section -->
               <div class="text-center mb-8">
                  <h2 class="text-3xl font-bold text-white mb-3 glow-text">Group 1: The Alkali Metals</h2>
                  <p class="text-lg text-white/90 max-w-2xl mx-auto">
                     Explore the <strong>most reactive metals</strong> in the periodic table
                  </p>
               </div>
               <!-- Introduction -->
               <div class="content-card fade-in">
                  <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                     <i class="fas fa-info-circle mr-2 text-indigo-600" aria-hidden="true"></i>
                     Introduction
                  </h3>
                  <p class="text-gray-700 mb-4">
                     Group 1 elements, known as the <strong>alkali metals</strong>, occupy the first column of the periodic table. 
                     They consist of lithium (Li), sodium (Na), potassium (K), rubidium (Rb), cesium (Cs), and francium (Fr). 
                     These elements share similar properties because they all have <strong>one electron in their outer shell</strong>, 
                     which they readily lose to form +1 ions.
                  </p>
                  <div class="highlight-box">
                     <h4>Electron Configuration</h4>
                     <p>All Group 1 elements have an electron number configuration that ends with a <strong>single electron</strong> in the outermost shell, such as lithium 2,<span class="valence-electron">1<span class="valence-tooltip">This is the valence electron that makes Group 1 metals special! It's easily lost, making these elements highly reactive.</span></span>, sodium 2,8,<span class="valence-electron">1<span class="valence-tooltip">This is the valence electron that makes Group 1 metals special! It's easily lost, making these elements highly reactive.</span></span>, and potassium 2,8,8,<span class="valence-electron">1<span class="valence-tooltip">This is the valence electron that makes Group 1 metals special! It's easily lost, making these elements highly reactive.</span></span>; this single valence electron is <strong>easily lost</strong>, which makes these elements highly reactive metals.</p>
                  </div>
                  <p class="text-gray-700 mt-4">
                     Alkali metals are <strong>soft, shiny metals</strong> with low densities and low melting points. 
                     Their reactivity increases as you move down the group. Due to their <strong>high reactivity</strong>, 
                     they are never found free in nature but always occur in compounds, often as chlorides, 
                     carbonates, or sulfates.
                  </p>
                  <button class="btn btn-success complete-section-btn" onclick="completeSection('overview')" aria-label="Mark overview section as complete">
                  <i class="fas fa-check mr-2"></i>
                  Mark as Complete
                  </button>
               </div>
               <!-- Key Characteristics -->
               <div class="content-card fade-in">
                  <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                     <i class="fas fa-star mr-2 text-indigo-600" aria-hidden="true"></i>
                     Key Characteristics
                  </h3>
                  <div class="grid md:grid-cols-2 gap-6">
                     <div>
                        <h4 class="font-semibold text-gray-700 mb-3">Physical Properties</h4>
                        <ul class="space-y-2 text-gray-600">
                           <li class="flex items-start">
                              <i class="fas fa-check-circle text-green-500 mt-1 mr-2" aria-hidden="true"></i>
                              <span><strong>Soft metals</strong> that can be cut with a knife</span>
                           </li>
                           <li class="flex items-start">
                              <i class="fas fa-check-circle text-green-500 mt-1 mr-2" aria-hidden="true"></i>
                              <span><strong>Low density</strong> - lithium floats on water</span>
                           </li>
                           <li class="flex items-start">
                              <i class="fas fa-check-circle text-green-500 mt-1 mr-2" aria-hidden="true"></i>
                              <span><strong>Low melting and boiling points</strong></span>
                           </li>
                           <li class="flex items-start">
                              <i class="fas fa-check-circle text-green-500 mt-1 mr-2" aria-hidden="true"></i>
                              <span><strong>Good conductors</strong> of heat and electricity</span>
                           </li>
                        </ul>
                     </div>
                     <div>
                        <h4 class="font-semibold text-gray-700 mb-3">Chemical Properties</h4>
                        <ul class="space-y-2 text-gray-600">
                           <li class="flex items-start">
                              <i class="fas fa-check-circle text-green-500 mt-1 mr-2" aria-hidden="true"></i>
                              <span><strong>Highly reactive</strong> with one valence electron</span>
                           </li>
                           <li class="flex items-start">
                              <i class="fas fa-check-circle text-green-500 mt-1 mr-2" aria-hidden="true"></i>
                              <span>Form <strong>+1 ions</strong> by losing their valence electron</span>
                           </li>
                           <li class="flex items-start">
                              <i class="fas fa-check-circle text-green-500 mt-1 mr-2" aria-hidden="true"></i>
                              <span><strong>Reactivity increases</strong> down the group</span>
                           </li>
                           <li class="flex items-start">
                              <i class="fas fa-check-circle text-green-500 mt-1 mr-2" aria-hidden="true"></i>
                              <span><strong>Never found free</strong> in nature</span>
                           </li>
                        </ul>
                     </div>
                  </div>
                  <div class="key-point mt-4">
                     <h4>Remember</h4>
                     <p>Group 1 metals are <strong>so reactive</strong> they must be stored under oil to prevent reaction with air and moisture!</p>
                  </div>
               </div>
               <!-- Applications -->
               <div class="content-card fade-in">
                  <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                     <i class="fas fa-industry mr-2 text-indigo-600" aria-hidden="true"></i>
                     Real-World Applications
                  </h3>
                  <div class="grid md:grid-cols-3 gap-4">
                     <div class="bg-blue-50 p-4 rounded-lg">
                        <h4 class="font-semibold text-blue-800 mb-2">Lithium</h4>
                        <p class="text-sm text-blue-600">Used in <strong>batteries</strong> for phones and electric vehicles, glass production, and as a medication for bipolar disorder</p>
                     </div>
                     <div class="bg-green-50 p-4 rounded-lg">
                        <h4 class="font-semibold text-green-800 mb-2">Sodium</h4>
                        <p class="text-sm text-green-600">Essential for life (<strong>nerve function</strong>), used in street lights (sodium vapor lamps), and food preservation (salt)</p>
                     </div>
                     <div class="bg-purple-50 p-4 rounded-lg">
                        <h4 class="font-semibold text-purple-800 mb-2">Potassium</h4>
                        <p class="text-sm text-purple-600">Vital for plants (<strong>fertilizers</strong>), essential for nerve and muscle function in animals, used in soap production</p>
                     </div>
                  </div>
               </div>
               <!-- Notes Section -->
               <div class="notes-section">
                  <div class="notes-header">
                     <h3 class="notes-title">Your Notes</h3>
                     <button class="btn btn-primary btn-sm" onclick="saveNotes()" aria-label="Save notes">
                     <i class="fas fa-save"></i>
                     Save
                     </button>
                  </div>
                  <div class="notes-container">
                     <textarea id="notesInput" class="notes-input" placeholder="Add your notes here..." aria-label="Add your notes"></textarea>
                  </div>
               </div>
            </section>
            <!-- Elements Section -->
            <section id="elements-section" class="content-section" style="display: none;">
               <div class="content-card fade-in">
                  <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                     <i class="fas fa-th mr-2 text-indigo-600" aria-hidden="true"></i>
                     Meet the Elements
                  </h3>
                  <div class="element-grid">
                     <div class="element-card">
                        <img src="https://upload.wikimedia.org/wikipedia/commons/e/ed/Lithiumcut_cropped.jpg" alt="Lithium metal sample" class="element-image" loading="lazy">
                        <h4 class="font-bold text-lg">Lithium (Li)</h4>
                        <p class="text-sm text-gray-600">Atomic: <strong>3</strong></p>
                        <p class="text-sm text-gray-600">Electron: 2,<span class="valence-electron">1<span class="valence-tooltip">This is the valence electron that makes Group 1 metals special! It's easily lost, making these elements highly reactive.</span></span></p>
                     </div>
                     <div class="element-card">
                        <img src="https://upload.wikimedia.org/wikipedia/commons/2/27/Na_%28Sodium%29.jpg" alt="Sodium metal sample" class="element-image" loading="lazy">
                        <h4 class="font-bold text-lg">Sodium (Na)</h4>
                        <p class="text-sm text-gray-600">Atomic: <strong>11</strong></p>
                        <p class="text-sm text-gray-600">Electron: 2,8,<span class="valence-electron">1<span class="valence-tooltip">This is the valence electron that makes Group 1 metals special! It's easily lost, making these elements highly reactive.</span></span></p>
                     </div>
                     <div class="element-card">
                        <img src="https://cdn.britannica.com/77/131177-050-79292189/fragments-Potassium-metal.jpg" alt="Potassium metal sample" class="element-image" loading="lazy">
                        <h4 class="font-bold text-lg">Potassium (K)</h4>
                        <p class="text-sm text-gray-600">Atomic: <strong>19</strong></p>
                        <p class="text-sm text-gray-600">Electron: 2,8,8,<span class="valence-electron">1<span class="valence-tooltip">This is the valence electron that makes Group 1 metals special! It's easily lost, making these elements highly reactive.</span></span></p>
                     </div>
                     <div class="element-card">
                        <img src="https://upload.wikimedia.org/wikipedia/commons/c/c9/Rb5.JPG" alt="Rubidium metal sample" class="element-image" loading="lazy">
                        <h4 class="font-bold text-lg">Rubidium (Rb)</h4>
                        <p class="text-sm text-gray-600">Atomic: <strong>37</strong></p>
                        <p class="text-sm text-gray-600">Electron: 2,8,18,8,<span class="valence-electron">1<span class="valence-tooltip">This is the valence electron that makes Group 1 metals special! It's easily lost, making these elements highly reactive.</span></span></p>
                     </div>
                     <div class="element-card">
                        <img src="https://upload.wikimedia.org/wikipedia/commons/3/3d/Cesium.jpg" alt="Cesium metal sample" class="element-image" loading="lazy">
                        <h4 class="font-bold text-lg">Cesium (Cs)</h4>
                        <p class="text-sm text-gray-600">Atomic: <strong>55</strong></p>
                        <p class="text-sm text-gray-600">Electron: 2,8,18,18,8,<span class="valence-electron">1<span class="valence-tooltip">This is the valence electron that makes Group 1 metals special! It's easily lost, making these elements highly reactive.</span></span></p>
                     </div>
                     <div class="element-card">
                        <img src="https://i0.wp.com/periodic-table.com/wp-content/uploads/2018/11/Francium.jpg?fit=238%2C212&ssl=1" alt="Francium representation" class="element-image" loading="lazy">
                        <h4 class="font-bold text-lg">Francium (Fr)</h4>
                        <p class="text-sm text-gray-600">Atomic: <strong>87</strong></p>
                        <p class="text-sm text-gray-600">Electron: 2,8,18,32,18,8,<span class="valence-electron">1<span class="valence-tooltip">This is the valence electron that makes Group 1 metals special! It's easily lost, making these elements highly reactive.</span></span></p>
                     </div>
                  </div>
               </div>
               <!-- Element Details -->
               <div class="content-card fade-in">
                  <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                     <i class="fas fa-info mr-2 text-indigo-600" aria-hidden="true"></i>
                     Element Details
                  </h3>
                  <div class="overflow-x-auto">
                     <table class="comparison-table">
                        <thead>
                           <tr>
                              <th scope="col">Element</th>
                              <th scope="col">Symbol</th>
                              <th scope="col">Atomic Number</th>
                              <th scope="col">Electron Configuration</th>
                              <th scope="col">Density (g/cm³)</th>
                              <th scope="col">Melting Point (°C)</th>
                              <th scope="col">Key Uses</th>
                           </tr>
                        </thead>
                        <tbody>
                           <tr>
                              <td class="font-medium">Lithium</td>
                              <td>Li</td>
                              <td>3</td>
                              <td>2, <span class="valence-electron">1<span class="valence-tooltip">This is the valence electron that makes Group 1 metals special! It's easily lost, making these elements highly reactive.</span></span></td>
                              <td>0.534</td>
                              <td class="melting-point-cell">
                                 180.5
                                 <div class="melting-tooltip">
                                    <h4>Did you realize?</h4>
                                    <p>The melting point decreases down the group due to weaker metallic bonding as atomic size increases.</p>
                                    <div class="melting-quiz">
                                       <p>Why does the melting point decrease down the group?</p>
                                       <input type="text" class="melting-quiz-answer" placeholder="Your answer...">
                                       <button class="melting-quiz-submit">Submit</button>
                                       <div class="quiz-result"></div>
                                    </div>
                                 </div>
                              </td>
                              <td><strong>Batteries</strong>, ceramics, mood stabilizers</td>
                           </tr>
                           <tr>
                              <td class="font-medium">Sodium</td>
                              <td>Na</td>
                              <td>11</td>
                              <td>2, 8, <span class="valence-electron">1<span class="valence-tooltip">This is the valence electron that makes Group 1 metals special! It's easily lost, making these elements highly reactive.</span></span></td>
                              <td>0.968</td>
                              <td class="melting-point-cell">
                                 97.8
                                 <div class="melting-tooltip">
                                    <h4>Did you realize?</h4>
                                    <p>The melting point decreases down the group due to weaker metallic bonding as atomic size increases.</p>
                                    <div class="melting-quiz">
                                       <p>Why does the melting point decrease down the group?</p>
                                       <input type="text" class="melting-quiz-answer" placeholder="Your answer...">
                                       <button class="melting-quiz-submit">Submit</button>
                                       <div class="quiz-result"></div>
                                    </div>
                                 </div>
                              </td>
                              <td><strong>Street lights</strong>, salt, soap</td>
                           </tr>
                           <tr>
                              <td class="font-medium">Potassium</td>
                              <td>K</td>
                              <td>19</td>
                              <td>2, 8, 8, <span class="valence-electron">1<span class="valence-tooltip">This is the valence electron that makes Group 1 metals special! It's easily lost, making these elements highly reactive.</span></span></td>
                              <td>0.89</td>
                              <td class="melting-point-cell">
                                 63.5
                                 <div class="melting-tooltip">
                                    <h4>Did you realize?</h4>
                                    <p>The melting point decreases down the group due to weaker metallic bonding as atomic size increases.</p>
                                    <div class="melting-quiz">
                                       <p>Why does the melting point decrease down the group?</p>
                                       <input type="text" class="melting-quiz-answer" placeholder="Your answer...">
                                       <button class="melting-quiz-submit">Submit</button>
                                       <div class="quiz-result"></div>
                                    </div>
                                 </div>
                              </td>
                              <td><strong>Fertilizers</strong>, soap, glass</td>
                           </tr>
                           <tr>
                              <td class="font-medium">Rubidium</td>
                              <td>Rb</td>
                              <td>37</td>
                              <td>2, 8, 18, 8, <span class="valence-electron">1<span class="valence-tooltip">This is the valence electron that makes Group 1 metals special! It's easily lost, making these elements highly reactive.</span></span></td>
                              <td>1.532</td>
                              <td class="melting-point-cell">
                                 39.3
                                 <div class="melting-tooltip">
                                    <h4>Did you realize?</h4>
                                    <p>The melting point decreases down the group due to weaker metallic bonding as atomic size increases.</p>
                                    <div class="melting-quiz">
                                       <p>Why does the melting point decrease down the group?</p>
                                       <input type="text" class="melting-quiz-answer" placeholder="Your answer...">
                                       <button class="melting-quiz-submit">Submit</button>
                                       <div class="quiz-result"></div>
                                    </div>
                                 </div>
                              </td>
                              <td><strong>Atomic clocks</strong>, photocells</td>
                           </tr>
                           <tr>
                              <td class="font-medium">Cesium</td>
                              <td>Cs</td>
                              <td>55</td>
                              <td>2, 8, 18, 18, 8, <span class="valence-electron">1<span class="valence-tooltip">This is the valence electron that makes Group 1 metals special! It's easily lost, making these elements highly reactive.</span></span></td>
                              <td>1.93</td>
                              <td class="melting-point-cell">
                                 28.4
                                 <div class="melting-tooltip">
                                    <h4>Did you realize?</h4>
                                    <p>The melting point decreases down the group due to weaker metallic bonding as atomic size increases.</p>
                                    <div class="melting-quiz">
                                       <p>Why does the melting point decrease down the group?</p>
                                       <input type="text" class="melting-quiz-answer" placeholder="Your answer...">
                                       <button class="melting-quiz-submit">Submit</button>
                                       <div class="quiz-result"></div>
                                    </div>
                                 </div>
                              </td>
                              <td><strong>Atomic clocks</strong>, drilling fluids</td>
                           </tr>
                           <tr>
                              <td class="font-medium">Francium</td>
                              <td>Fr</td>
                              <td>87</td>
                              <td>2, 8, 18, 32, 18, 8, <span class="valence-electron">1<span class="valence-tooltip">This is the valence electron that makes Group 1 metals special! It's easily lost, making these elements highly reactive.</span></span></td>
                              <td>~1.87</td>
                              <td class="melting-point-cell">
                                 ~27
                                 <div class="melting-tooltip">
                                    <h4>Did you realize?</h4>
                                    <p>The melting point decreases down the group due to weaker metallic bonding as atomic size increases.</p>
                                    <div class="melting-quiz">
                                       <p>Why does the melting point decrease down the group?</p>
                                       <input type="text" class="melting-quiz-answer" placeholder="Your answer...">
                                       <button class="melting-quiz-submit">Submit</button>
                                       <div class="quiz-result"></div>
                                    </div>
                                 </div>
                              </td>
                              <td><strong>Research purposes</strong> only</td>
                           </tr>
                        </tbody>
                     </table>
                  </div>
                  <div class="highlight-box mt-4">
                     <h4>Occurrence and Extraction</h4>
                     <p>Group 1 metals are <strong>never found free</strong> in nature due to their high reactivity. They are typically found as:
                     <ul class="list-disc pl-5 mt-2">
                        <li><strong>Chlorides</strong> (e.g., rock salt - NaCl)</li>
                        <li><strong>Carbonates</strong> (e.g., limestone - CaCO₃, which contains Na and K impurities)</li>
                        <li><strong>Sulfates</strong> (e.g., Chile saltpeter - NaNO₃)</li>
                     </ul>
                     <p class="mt-2">They are extracted by <strong>electrolysis</strong> of their molten chlorides, as chemical reduction is not possible.</p>
                  </div>
                  <button class="btn btn-success complete-section-btn" onclick="completeSection('elements')" aria-label="Mark elements section as complete">
                  <i class="fas fa-check mr-2"></i>
                  Mark as Complete
                  </button>
               </div>
            </section>
            <!-- Properties Section -->
            <section id="properties-section" class="content-section" style="display: none;">
               <div class="content-card fade-in">
                  <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                     <i class="fas fa-flask mr-2 text-indigo-600" aria-hidden="true"></i>
                     Properties & Characteristics
                  </h3>
                  <div class="tabs" role="tablist">
                     <button class="tab active" id="physical-tab" onclick="showTab('physical')" role="tab" aria-selected="true" aria-controls="physical-panel">Physical</button>
                     <button class="tab" id="chemical-tab" onclick="showTab('chemical')" role="tab" aria-selected="false" aria-controls="chemical-panel">Chemical</button>
                     <button class="tab" id="trends-tab" onclick="showTab('trends')" role="tab" aria-selected="false" aria-controls="trends-panel">Trends</button>
                  </div>
                  <div id="physical" class="tab-content active" role="tabpanel" aria-labelledby="physical-tab">
                     <div class="grid md:grid-cols-2 gap-4">
                        <div>
                           <h4 class="font-semibold text-gray-700 mb-2">Physical Properties</h4>
                           <ul class="space-y-2 text-gray-600">
                              <li class="flex items-start">
                                 <i class="fas fa-check-circle text-green-500 mt-1 mr-2" aria-hidden="true"></i>
                                 <span><strong>Soft metals</strong> that can be cut with a knife</span>
                              </li>
                              <li class="flex items-start">
                                 <i class="fas fa-check-circle text-green-500 mt-1 mr-2" aria-hidden="true"></i>
                                 <span><strong>Low density</strong> - lithium floats on water</span>
                              </li>
                              <li class="flex items-start">
                                 <i class="fas fa-check-circle text-green-500 mt-1 mr-2" aria-hidden="true"></i>
                                 <span><strong>Low melting and boiling points</strong></span>
                              </li>
                              <li class="flex items-start">
                                 <i class="fas fa-check-circle text-green-500 mt-1 mr-2" aria-hidden="true"></i>
                                 <span><strong>Good conductors</strong> of heat and electricity</span>
                              </li>
                           </ul>
                        </div>
                        <div>
                           <h4 class="font-semibold text-gray-700 mb-2">Appearance</h4>
                           <ul class="space-y-2 text-gray-600">
                              <li class="flex items-start">
                                 <i class="fas fa-check-circle text-green-500 mt-1 mr-2" aria-hidden="true"></i>
                                 <span><strong>Silvery-white, shiny metals</strong></span>
                              </li>
                              <li class="flex items-start">
                                 <i class="fas fa-check-circle text-green-500 mt-1 mr-2" aria-hidden="true"></i>
                                 <span><strong>Tarnish quickly</strong> in air</span>
                              </li>
                              <li class="flex items-start">
                                 <i class="fas fa-check-circle text-green-500 mt-1 mr-2" aria-hidden="true"></i>
                                 <span><strong>Freshly cut surfaces</strong> are highly reflective</span>
                              </li>
                           </ul>
                        </div>
                     </div>
                     <div class="highlight-box mt-4">
                        <h4>Why are Group 1 metals soft?</h4>
                        <p>Group 1 metals have a <strong>metallic structure</strong> held together by metallic bonds. The bonds are <strong>relatively weak</strong> because:
                        <ul class="list-disc pl-5 mt-2">
                           <li>Each atom contributes only <strong>one electron</strong> to the "sea" of delocalized electrons</li>
                           <li>The <strong>atomic radius is relatively large</strong></li>
                           <li>The <strong>charge on the cation is only +1</strong></li>
                        </ul>
                        <p class="mt-2">These factors result in <strong>weak metallic bonding</strong>, making the metals soft with low melting points.</p>
                     </div>
                  </div>
                  <div id="chemical" class="tab-content" role="tabpanel" aria-labelledby="chemical-tab">
                     <div class="space-y-4">
                        <div>
                           <h4 class="font-semibold text-gray-700 mb-2">Chemical Properties</h4>
                           <p class="text-gray-600 mb-4">
                              Group 1 elements are <strong>highly reactive metals</strong> with one valence electron that they readily lose to form +1 ions.
                           </p>
                           <div class="equation-box">
                              <p class="text-gray-700 mb-2">General ionization reaction:</p>
                              <p class="equation">M → M⁺ + e⁻</p>
                           </div>
                        </div>
                        <div>
                           <h4 class="font-semibold text-gray-700 mb-2">Reactivity</h4>
                           <p class="text-gray-600">
                              Reactivity increases down the group as the atomic radius increases and the valence electron is further from the nucleus, making it <strong>easier to lose</strong>. This is shown by the <strong>decreasing first ionization energy</strong> down the group.
                           </p>
                           <div class="highlight-box mt-3">
                              <h4>Ionization Energy Trend</h4>
                              <p>First ionization energy decreases down Group 1 because:
                              <ul class="list-disc pl-5 mt-2">
                                 <li><strong>Atomic radius increases</strong></li>
                                 <li><strong>Outer electron is further from the nucleus</strong></li>
                                 <li><strong>More inner electron shells shield</strong> the outer electron from the nucleus</li>
                              </ul>
                              <p class="mt-2">This makes it <strong>easier to remove</strong> the outer electron, increasing reactivity.</p>
                           </div>
                        </div>
                     </div>
                  </div>
                  <div id="trends" class="tab-content" role="tabpanel" aria-labelledby="trends-tab">
                     <div class="space-y-4">
                        <h4 class="font-semibold text-gray-700 mb-3">Trends Down Group 1</h4>
                        <div class="overflow-x-auto">
                           <table class="comparison-table">
                              <thead>
                                 <tr>
                                    <th scope="col">Property</th>
                                    <th scope="col">Trend</th>
                                    <th scope="col">Reason</th>
                                 </tr>
                              </thead>
                              <tbody>
                                 <tr>
                                    <td>Atomic radius</td>
                                    <td><strong>Increases</strong></td>
                                    <td>More electron shells</td>
                                 </tr>
                                 <tr>
                                    <td>First ionization energy</td>
                                    <td><strong>Decreases</strong></td>
                                    <td>Outer electron further from nucleus</td>
                                 </tr>
                                 <tr>
                                    <td>Reactivity</td>
                                    <td><strong>Increases</strong></td>
                                    <td>Easier to lose valence electron</td>
                                 </tr>
                                 <tr>
                                    <td>Melting/boiling point</td>
                                    <td><strong>Decreases</strong></td>
                                    <td>Weaker metallic bonding</td>
                                 </tr>
                                 <tr>
                                    <td>Density</td>
                                    <td><strong>Increases</strong></td>
                                    <td>Exception: K < Na</td>
                                 </tr>
                              </tbody>
                           </table>
                        </div>
                        <div class="key-point">
                           <h4>Important Exception</h4>
                           <p>While density generally increases down Group 1, <strong>potassium (K) is less dense than sodium (Na)</strong>. This is because the increase in atomic mass is offset by a larger increase in atomic volume.</p>
                        </div>
                        <div class="highlight-box mt-3">
                           <h4>Practical Observation of Trends</h4>
                           <p>The reactivity trend can be clearly observed in the reaction with water:
                           <ul class="list-disc pl-5 mt-2">
                              <li><strong>Lithium:</strong> Fizzes steadily, moves slowly on surface</li>
                              <li><strong>Sodium:</strong> Fizzes rapidly, melts into a ball, moves quickly</li>
                              <li><strong>Potassium:</strong> Fizzes very rapidly, may ignite with lilac flame, moves very quickly</li>
                           </ul>
                           </p>
                        </div>
                     </div>
                  </div>
               </div>
               <button class="btn btn-success complete-section-btn" onclick="completeSection('properties')" aria-label="Mark properties section as complete">
               <i class="fas fa-check mr-2"></i>
               Mark as Complete
               </button>
            </section>
            <!-- Reactions Section -->
            <section id="reactions-section" class="content-section" style="display: none;">
               <div class="content-card fade-in">
                  <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                     <i class="fas fa-vial mr-2 text-indigo-600" aria-hidden="true"></i>
                     Chemical Reactions
                  </h3>
                  <div class="tabs" role="tablist">
                     <button class="tab active" id="water-tab" onclick="showTab('water')" role="tab" aria-selected="true" aria-controls="water-panel">With Water</button>
                     <button class="tab" id="oxygen-tab" onclick="showTab('oxygen')" role="tab" aria-selected="false" aria-controls="oxygen-panel">With Oxygen</button>
                     <button class="tab" id="halogens-tab" onclick="showTab('halogens')" role="tab" aria-selected="false" aria-controls="halogens-panel">With Halogens</button>
                     <button class="tab" id="acids-tab" onclick="showTab('acids')" role="tab" aria-selected="false" aria-controls="acids-panel">With Acids</button>
                  </div>
                  <div id="water" class="tab-content active" role="tabpanel" aria-labelledby="water-tab">
                     <div class="space-y-6">
                        <div>
                           <h4 class="font-semibold text-gray-700 mb-3">Reaction with Water</h4>
                           <div class="equation-box">
                              <p class="text-gray-700 mb-2">General equation:</p>
                              <p class="equation">2M(s) + 2H₂O(l) → 2MOH(aq) + H₂(g)</p>
                           </div>
                           <p class="text-gray-600 mb-4">
                              All Group 1 metals react with water to produce <strong>hydrogen gas</strong> and the corresponding <strong>metal hydroxide</strong>. 
                              The reactivity increases down the group, with lithium reacting relatively slowly and cesium reacting explosively.
                           </p>
                           <div class="highlight-box">
                              <h4>Observations for Different Metals</h4>
                              <div class="grid md:grid-cols-3 gap-4 mt-3">
                                 <div class="bg-blue-50 p-3 rounded-lg">
                                    <h5 class="font-semibold text-blue-800">Lithium</h5>
                                    <p class="text-sm text-blue-600"><strong>Fizzes steadily</strong></p>
                                    <p class="text-xs text-blue-500 mt-1">Doesn't melt</p>
                                    <p class="text-xs text-blue-500 mt-1">Moves slowly on surface</p>
                                 </div>
                                 <div class="bg-blue-50 p-3 rounded-lg">
                                    <h5 class="font-semibold text-blue-800">Sodium</h5>
                                    <p class="text-sm text-blue-600"><strong>Fizzes rapidly</strong></p>
                                    <p class="text-xs text-blue-500 mt-1">Melts into a ball</p>
                                    <p class="text-xs text-blue-500 mt-1">Moves quickly on surface</p>
                                 </div>
                                 <div class="bg-blue-50 p-3 rounded-lg">
                                    <h5 class="font-semibold text-blue-800">Potassium</h5>
                                    <p class="text-sm text-blue-600"><strong>Fizzes very rapidly</strong></p>
                                    <p class="text-xs text-blue-500 mt-1">Ignites with lilac flame</p>
                                    <p class="text-xs text-blue-500 mt-1">May explode</p>
                                 </div>
                              </div>
                           </div>
                        </div>
                        <div>
                           <h4 class="font-semibold text-gray-700 mb-3">Reaction Mechanism</h4>
                           <p class="text-gray-600">
                              The reaction with water is a <strong>redox reaction</strong> where the metal is oxidized and water is reduced:
                           </p>
                           <div class="equation-box">
                              <p class="text-gray-700 mb-2">Oxidation: 2M → 2M⁺ + 2e⁻</p>
                              <p class="text-gray-700 mb-2">Reduction: 2H₂O + 2e⁻ → 2OH⁻ + H₂</p>
                              <p class="text-gray-700">Overall: 2M + 2H₂O → 2MOH + H₂</p>
                           </div>
                        </div>
                        <div class="bg-indigo-50 p-4 rounded-lg mb-6">
                           <h5 class="font-semibold text-indigo-800 mb-2">Safety Note:</h5>
                           <p class="text-indigo-700">
                              Due to their <strong>violent reactions</strong> with water, Group 1 metals must be stored under oil to prevent contact with air and moisture. 
                              Small pieces should always be used for demonstrations, and <strong>safety goggles</strong> must be worn.
                           </p>
                        </div>
                     </div>
                  </div>
                  <div id="oxygen" class="tab-content" role="tabpanel" aria-labelledby="oxygen-tab">
                     <div class="space-y-6">
                        <div>
                           <h4 class="font-semibold text-gray-700 mb-3">Reaction with Oxygen</h4>
                           <p class="text-gray-600 mb-4">
                              Group 1 metals react with oxygen to form <strong>oxides, peroxides, or superoxides</strong> depending on the metal and reaction conditions.
                           </p>
                           <div class="grid md:grid-cols-3 gap-4">
                              <div class="bg-green-50 p-3 rounded-lg">
                                 <h5 class="font-semibold text-green-800">Lithium</h5>
                                 <p class="text-sm text-green-600">Forms <strong>Li₂O (oxide)</strong></p>
                                 <div class="equation-box mt-2">
                                    <p class="equation text-sm">4Li + O₂ → 2Li₂O</p>
                                 </div>
                              </div>
                              <div class="bg-green-50 p-3 rounded-lg">
                                 <h5 class="font-semibold text-green-800">Sodium</h5>
                                 <p class="text-sm text-green-600">Forms <strong>Na₂O₂ (peroxide)</strong></p>
                                 <div class="equation-box mt-2">
                                    <p class="equation text-sm">2Na + O₂ → Na₂O₂</p>
                                 </div>
                              </div>
                              <div class="bg-green-50 p-3 rounded-lg">
                                 <h5 class="font-semibold text-green-800">Potassium</h5>
                                 <p class="text-sm text-green-600">Forms <strong>KO₂ (superoxide)</strong></p>
                                 <div class="equation-box mt-2">
                                    <p class="equation text-sm">K + O₂ → KO₂</p>
                                 </div>
                              </div>
                           </div>
                        </div>
                        <div>
                           <h5 class="font-semibold text-gray-700 mb-2">Trend in Oxide Formation:</h5>
                           <p class="text-gray-600">
                              As we move down the group, the tendency to form peroxides and superoxides increases due to the <strong>larger size of the metal ions</strong>, which can stabilize larger anions.
                           </p>
                           <div class="highlight-box mt-3">
                              <h4>Why the Change in Products?</h4>
                              <p>The stability of different oxides depends on the <strong>size of the cation</strong>:
                              <ul class="list-disc pl-5 mt-2">
                                 <li><strong>Small Li⁺</strong> stabilizes the small O²⁻ ion in Li₂O</li>
                                 <li><strong>Medium Na⁺</strong> stabilizes the O₂²⁻ ion in Na₂O₂</li>
                                 <li><strong>Large K⁺, Rb⁺, Cs⁺</strong> stabilize the large O₂⁻ ion in superoxides</li>
                              </ul>
                              <p class="mt-2">This is an example of how <strong>cation size affects compound stability</strong>.</p>
                           </div>
                        </div>
                        <div>
                           <h5 class="font-semibold text-gray-700 mb-2">Reactions of the Oxides with Water</h5>
                           <p class="text-gray-600">All Group 1 oxides, peroxides, and superoxides react with water to form <strong>alkaline solutions</strong>:</p>
                           <div class="grid md:grid-cols-3 gap-4 mt-3">
                              <div class="bg-purple-50 p-3 rounded-lg">
                                 <h5 class="font-semibold text-purple-800">Oxide</h5>
                                 <div class="equation-box mt-2">
                                    <p class="equation text-sm">Li₂O + H₂O → 2LiOH</p>
                                 </div>
                              </div>
                              <div class="bg-purple-50 p-3 rounded-lg">
                                 <h5 class="font-semibold text-purple-800">Peroxide</h5>
                                 <div class="equation-box mt-2">
                                    <p class="equation text-sm">Na₂O₂ + 2H₂O → 2NaOH + H₂O₂</p>
                                 </div>
                              </div>
                              <div class="bg-purple-50 p-3 rounded-lg">
                                 <h5 class="font-semibold text-purple-800">Superoxide</h5>
                                 <div class="equation-box mt-2">
                                    <p class="equation text-sm">2KO₂ + 2H₂O → 2KOH + H₂O₂ + O₂</p>
                                 </div>
                              </div>
                           </div>
                        </div>
                     </div>
                  </div>
                  <div id="halogens" class="tab-content" role="tabpanel" aria-labelledby="halogens-tab">
                     <div class="space-y-6">
                        <div>
                           <h4 class="font-semibold text-gray-700 mb-3">Reaction with Halogens</h4>
                           <div class="equation-box">
                              <p class="text-gray-700 mb-2">General equation:</p>
                              <p class="equation">2M(s) + X₂ → 2MX(s)</p>
                              <p class="text-gray-600 text-sm">Where X = F, Cl, Br, I</p>
                           </div>
                           <p class="text-gray-600 mb-4">
                              Group 1 metals react <strong>vigorously</strong> with halogens to form ionic halides. These reactions are <strong>highly exothermic</strong> and often produce bright flames.
                           </p>
                           <div class="grid md:grid-cols-2 gap-4">
                              <div class="bg-purple-50 p-3 rounded-lg">
                                 <h5 class="font-semibold text-purple-800">With Chlorine</h5>
                                 <div class="equation-box mt-2">
                                    <p class="equation text-sm">2Na + Cl₂ → 2NaCl</p>
                                 </div>
                                 <p class="text-sm text-purple-600 mt-2"><strong>Bright yellow flame</strong></p>
                              </div>
                              <div class="bg-purple-50 p-3 rounded-lg">
                                 <h5 class="font-semibold text-purple-800">With Bromine</h5>
                                 <div class="equation-box mt-2">
                                    <p class="equation text-sm">2K + Br₂ → 2KBr</p>
                                 </div>
                                 <p class="text-sm text-purple-600 mt-2"><strong>Red-brown vapor</strong></p>
                              </div>
                           </div>
                        </div>
                        <div class="bg-purple-50 p-4 rounded-lg">
                           <h5 class="font-semibold text-purple-800 mb-2">Properties of Halides:</h5>
                           <ul class="text-sm text-purple-700 space-y-1">
                              <li>• All are <strong>white crystalline solids</strong> at room temperature</li>
                              <li>• <strong>High melting and boiling points</strong> due to strong ionic bonding</li>
                              <li>• <strong>Soluble in water</strong>, forming neutral solutions</li>
                              <li>• <strong>Conduct electricity</strong> when molten or in aqueous solution</li>
                           </ul>
                        </div>
                        <div>
                           <h5 class="font-semibold text-gray-700 mb-2">Test for Halide Ions</h5>
                           <p class="text-gray-600">
                              The halide ions (Cl⁻, Br⁻, I⁻) can be identified using <strong>silver nitrate solution</strong>:
                           </p>
                           <div class="grid md:grid-cols-3 gap-4 mt-3">
                              <div class="bg-yellow-50 p-3 rounded-lg">
                                 <h5 class="font-semibold text-yellow-800">Chloride</h5>
                                 <p class="text-sm text-yellow-600">Forms <strong>white precipitate</strong> of AgCl</p>
                                 <p class="text-xs text-yellow-500 mt-1">Soluble in dilute NH₃</p>
                              </div>
                              <div class="bg-yellow-50 p-3 rounded-lg">
                                 <h5 class="font-semibold text-yellow-800">Bromide</h5>
                                 <p class="text-sm text-yellow-600">Forms <strong>cream precipitate</strong> of AgBr</p>
                                 <p class="text-xs text-yellow-500 mt-1">Partially soluble in conc. NH₃</p>
                              </div>
                              <div class="bg-yellow-50 p-3 rounded-lg">
                                 <h5 class="font-semibold text-yellow-800">Iodide</h5>
                                 <p class="text-sm text-yellow-600">Forms <strong>yellow precipitate</strong> of AgI</p>
                                 <p class="text-xs text-yellow-500 mt-1">Insoluble in NH₃</p>
                              </div>
                           </div>
                        </div>
                     </div>
                  </div>
                  <div id="acids" class="tab-content" role="tabpanel" aria-labelledby="acids-tab">
                     <div class="space-y-6">
                        <div>
                           <h4 class="font-semibold text-gray-700 mb-3">Reaction with Acids</h4>
                           <div class="equation-box">
                              <p class="text-gray-700 mb-2">General equation:</p>
                              <p class="equation">2M(s) + 2H⁺(aq) → 2M⁺(aq) + H₂(g)</p>
                           </div>
                           <p class="text-gray-600 mb-4">
                              Group 1 metals react with acids to produce <strong>hydrogen gas</strong> and the corresponding salt. These reactions are <strong>extremely vigorous and dangerous</strong> due to the high reactivity of the metals.
                           </p>
                           <div class="bg-red-50 p-4 rounded-lg mb-4">
                              <h5 class="font-semibold text-red-800 mb-2">⚠️ Safety Warning:</h5>
                              <p class="text-red-700">
                                 These reactions are <strong>too violent</strong> to be performed safely in a school laboratory. The hydrogen gas produced is <strong>highly flammable</strong> and can explode. 
                                 Never attempt to react Group 1 metals with acids outside of specialized facilities with proper safety equipment.
                              </p>
                           </div>
                        </div>
                        <div>
                           <h5 class="font-semibold text-gray-700 mb-2">Example Reactions:</h5>
                           <div class="space-y-2">
                              <div class="bg-gray-50 p-3 rounded-lg">
                                 <p class="text-sm font-mono">2Li(s) + 2HCl(aq) → 2LiCl(aq) + H₂(g)</p>
                              </div>
                              <div class="bg-gray-50 p-3 rounded-lg">
                                 <p class="text-sm font-mono">2Na(s) + H₂SO₄(aq) → Na₂SO₄(aq) + H₂(g)</p>
                              </div>
                           </div>
                        </div>
                        <div>
                           <h5 class="font-semibold text-gray-700 mb-2">Reaction Mechanism</h5>
                           <p class="text-gray-600">
                              The reaction with acids is a <strong>redox reaction</strong> where the metal is oxidized and hydrogen ions from the acid are reduced:
                           </p>
                           <div class="equation-box mt-3">
                              <p class="text-gray-700 mb-2">Oxidation: 2M → 2M⁺ + 2e⁻</p>
                              <p class="text-gray-700 mb-2">Reduction: 2H⁺ + 2e⁻ → H₂</p>
                              <p class="text-gray-700">Overall: 2M + 2H⁺ → 2M⁺ + H₂</p>
                           </div>
                        </div>
                        <div class="highlight-box">
                           <h4>Why So Vigorous?</h4>
                           <p>The reaction with acids is more vigorous than with water because:
                           <ul class="list-disc pl-5 mt-2">
                              <li>Acids provide a <strong>higher concentration of H⁺ ions</strong> than water</li>
                              <li>The <strong>reduction potential of H⁺ is higher</strong> than that of H₂O</li>
                              <li>This makes the reaction <strong>more thermodynamically favorable</strong></li>
                           </ul>
                           </p>
                        </div>
                     </div>
                  </div>
               </div>
               <button class="btn btn-success complete-section-btn" onclick="completeSection('reactions')" aria-label="Mark reactions section as complete">
               <i class="fas fa-check mr-2"></i>
               Mark as Complete
               </button>
            </section>
            <!-- Glossary Section -->
            <section id="glossary-section" class="content-section" style="display: none;">
               <div class="content-card fade-in">
                  <div class="glossary-header">
                     <h3 class="glossary-title">Glossary</h3>
                     <div class="relative">
                        <div class="search-icon" aria-hidden="true">
                           <i class="fas fa-search"></i>
                        </div>
                        <input type="text" id="glossarySearch" class="glossary-search" placeholder="Search terms..." aria-label="Search glossary terms">
                     </div>
                  </div>
                  <div class="glossary-terms" id="glossaryTerms">
                     <div class="glossary-term">
                        <div class="glossary-term-name">Alkali Metals</div>
                        <div class="glossary-term-definition">Group 1 elements in the periodic table, including lithium, sodium, potassium, rubidium, cesium, and francium. They are highly reactive metals with one electron in their outer shell.</div>
                     </div>
                     <div class="glossary-term">
                        <div class="glossary-term-name">Electron Configuration</div>
                        <div class="glossary-term-definition">The arrangement of electrons in an atom's electron shells. Group 1 metals all end with a single electron in their outermost shell (ns¹).</div>
                     </div>
                     <div class="glossary-term">
                        <div class="glossary-term-name">Ionization Energy</div>
                        <div class="glossary-term-definition">The energy required to remove an electron from an atom. It decreases down Group 1 as the outer electron is further from the nucleus.</div>
                     </div>
                     <div class="glossary-term">
                        <div class="glossary-term-name">Reactivity</div>
                        <div class="glossary-term-definition">The tendency of a substance to undergo chemical reactions. Reactivity increases down Group 1 due to decreasing ionization energy.</div>
                     </div>
                     <div class="glossary-term">
                        <div class="glossary-term-name">Metallic Bonding</div>
                        <div class="glossary-term-definition">The bonding in metals where positive metal ions are held together by a "sea" of delocalized electrons. It is relatively weak in Group 1 metals.</div>
                     </div>
                     <div class="glossary-term">
                        <div class="glossary-term-name">Oxide</div>
                        <div class="glossary-term-definition">A compound containing oxygen and another element. Lithium forms the normal oxide (Li₂O) when burned in oxygen.</div>
                     </div>
                     <div class="glossary-term">
                        <div class="glossary-term-name">Peroxide</div>
                        <div class="glossary-term-definition">A compound containing the O₂²⁻ ion. Sodium forms the peroxide (Na₂O₂) when burned in oxygen.</div>
                     </div>
                     <div class="glossary-term">
                        <div class="glossary-term-name">Superoxide</div>
                        <div class="glossary-term-definition">A compound containing the O₂⁻ ion. Potassium, rubidium, and cesium form superoxides when burned in oxygen.</div>
                     </div>
                     <div class="glossary-term">
                        <div class="glossary-term-name">Halides</div>
                        <div class="glossary-term-definition">Compounds of Group 1 metals with halogens (fluorine, chlorine, bromine, iodine). They are typically white crystalline solids.</div>
                     </div>
                     <div class="glossary-term">
                        <div class="glossary-term-name">Flame Test</div>
                        <div class="glossary-term-definition">A test to identify metal ions by the color they produce when heated in a flame. Each Group 1 metal produces a characteristic color.</div>
                     </div>
                  </div>
               </div>
            </section>
            <!-- Study Groups Section -->
            <section id="study-groups-section" class="content-section" style="display: none;">
               <div class="content-card fade-in">
                  <div class="flex justify-between items-center mb-4">
                     <h3 class="text-xl font-bold text-gray-800 flex items-center">
                        <i class="fas fa-users mr-2 text-indigo-600" aria-hidden="true"></i>
                        Study Circles
                     </h3>
                     <button onclick="showCreateStudyGroup()" class="btn btn-primary" aria-label="Create new study group">
                     <i class="fas fa-plus"></i>
                     Create Group
                     </button>
                  </div>
                  <div id="studyGroupsContainer">
                     <div class="empty-state">
                        <div class="empty-state-icon" aria-hidden="true">
                           <i class="fas fa-users"></i>
                        </div>
                        <h3 class="empty-state-title">No Study Groups Yet</h3>
                        <p class="empty-state-description">Create your first study group to collaborate with peers on mastering Group 1 Alkali Metals.</p>
                     </div>
                  </div>
               </div>
            </section>
            <!-- Discussion Section -->
            <section id="discussion-section" class="content-section" style="display: none;">
               <div class="comment-section fade-in">
                  <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                     <i class="fas fa-comments mr-2 text-indigo-600" aria-hidden="true"></i>
                     Discussion
                  </h3>
                  <div id="commentsContainer">
                     <div class="empty-state">
                        <div class="empty-state-icon" aria-hidden="true">
                           <i class="fas fa-comments"></i>
                        </div>
                        <h3 class="empty-state-title">No Comments Yet</h3>
                        <p class="empty-state-description">Be the first to share your thoughts about Group 1 Alkali Metals.</p>
                     </div>
                  </div>
                  <form class="comment-form" onsubmit="addComment(event)">
                     <input type="text" id="commentInput" class="comment-input" placeholder="Share your thoughts..." aria-label="Write a comment">
                     <button type="submit" class="comment-submit">Post</button>
                  </form>
               </div>
            </section>
            <!-- Feedback Section -->
            <section id="feedback-section" class="content-section" style="display: none;">
               <div class="feedback-form fade-in">
                  <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                     <i class="fas fa-comment-dots mr-2 text-indigo-600" aria-hidden="true"></i>
                     Feedback
                  </h3>
                  <form id="feedbackFormElement" class="space-y-4" onsubmit="handleFeedbackSubmit(event)">
                     <div class="form-group">
                        <label for="feedbackName" class="block text-sm font-medium text-gray-700 mb-1">Your Name</label>
                        <input type="text" id="feedbackName" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" placeholder="Enter your name" required>
                     </div>
                     <div class="form-group">
                        <label for="feedbackEmail" class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                        <input type="email" id="feedbackEmail" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" placeholder="your@email.com" required>
                     </div>
                     <div class="form-group">
                        <label for="feedbackRating" class="block text-sm font-medium text-gray-700 mb-1">Rating</label>
                        <div class="rating-container">
                           <i class="fas fa-star rating-star" data-rating="1"></i>
                           <i class="fas fa-star rating-star" data-rating="2"></i>
                           <i class="fas fa-star rating-star" data-rating="3"></i>
                           <i class="fas fa-star rating-star" data-rating="4"></i>
                           <i class="fas fa-star rating-star" data-rating="5"></i>
                        </div>
                        <input type="hidden" id="ratingValue" value="0">
                     </div>
                     <div class="form-group">
                        <label for="feedbackComment" class="block text-sm font-medium text-gray-700 mb-1">Comments</label>
                        <textarea id="feedbackComment" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" rows="4" placeholder="Share your feedback..." required></textarea>
                     </div>
                     <div class="form-group">
                        <label for="feedbackSuggestion" class="block text-sm font-medium text-gray-700 mb-1">Suggestions for Improvement</label>
                        <textarea id="feedbackSuggestion" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" rows="3" placeholder="Any suggestions for improving this learning platform?"></textarea>
                     </div>
                     <button type="submit" class="btn btn-primary w-full">
                     <i class="fas fa-paper-plane mr-2"></i>
                     Submit Feedback
                     </button>
                  </form>
               </div>
            </section>
            <!-- Post Quiz Section -->
            <section id="quiz-section" class="content-section" style="display: none;">
               <div class="content-card fade-in">
                  <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                     <i class="fas fa-graduation-cap mr-2 text-indigo-600" aria-hidden="true"></i>
                     Final Assessment
                  </h3>
                  <p class="text-gray-600 mb-4">
                     Test your knowledge after completing the learning materials. See how much you've <strong>improved</strong>!
                  </p>
                  <div class="flex items-center mb-4">
                     <input type="checkbox" id="quizTimer" class="mr-2" aria-label="Enable quiz timer">
                     <label for="quizTimer">Enable timer (15 minutes)</label>
                  </div>
                  <button onclick="startPostQuiz()" class="btn btn-primary" aria-label="Start final quiz">
                  <i class="fas fa-play"></i>
                  Start Post-Quiz
                  </button>
               </div>
            </section>
         </main>
      </div>
      <!-- Login Modal -->
      <div id="loginModal" class="modal" role="dialog" aria-labelledby="loginModalTitle" aria-hidden="true">
         <div class="modal-content">
            <div class="modal-header">
               <h2 class="modal-title" id="loginModalTitle">Welcome to Chemistry Mastery</h2>
               <button class="close-btn" onclick="closeLoginModal()" aria-label="Close login modal">
               <i class="fas fa-times"></i>
               </button>
            </div>
            <div class="auth-tabs" role="tablist">
               <div class="auth-tab active" id="login-tab" onclick="switchAuthTab('login')" role="tab" aria-selected="true" aria-controls="login-panel">Sign In</div>
               <div class="auth-tab" id="signup-tab" onclick="switchAuthTab('signup')" role="tab" aria-selected="false" aria-controls="signup-panel">Sign Up</div>
            </div>
            <!-- Login Form -->
            <div id="loginForm" class="auth-content active" role="tabpanel" aria-labelledby="login-tab">
               <form id="loginFormElement" class="space-y-4" onsubmit="handleLogin(event)">
                  <div>
                     <label for="loginEmail" class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                     <input type="email" id="loginEmail" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" placeholder="your@email.com" required aria-required="true">
                  </div>
                  <div>
                     <label for="loginPassword" class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                     <input type="password" id="loginPassword" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" placeholder="••••••••" required aria-required="true">
                  </div>
                  <button type="submit" class="btn btn-primary w-full">
                  <i class="fas fa-sign-in-alt"></i>
                  Sign In
                  </button>
               </form>
            </div>
            <!-- Signup Form -->
            <div id="signupForm" class="auth-content" role="tabpanel" aria-labelledby="signup-tab">
               <form id="signupFormElement" class="space-y-4" onsubmit="handleSignup(event)">
                  <div>
                     <label for="signupName" class="block text-sm font-medium text-gray-700 mb-1">Full Name</label>
                     <input type="text" id="signupName" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" placeholder="John Doe" required aria-required="true">
                  </div>
                  <div>
                     <label for="signupEmail" class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                     <input type="email" id="signupEmail" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" placeholder="your@email.com" required aria-required="true">
                  </div>
                  <div>
                     <label for="signupPassword" class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                     <input type="password" id="signupPassword" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" placeholder="••••••••" required aria-required="true">
                  </div>
                  <div>
                     <label for="signupConfirmPassword" class="block text-sm font-medium text-gray-700 mb-1">Confirm Password</label>
                     <input type="password" id="signupConfirmPassword" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" placeholder="••••••••" required aria-required="true">
                  </div>
                  <button type="submit" class="btn btn-primary w-full">
                  <i class="fas fa-user-plus"></i>
                  Create Account
                  </button>
               </form>
            </div>
            <div class="mt-6 text-center">
               <p class="text-gray-600">Or continue with</p>
               <button onclick="signInWithGoogle()" class="btn btn-secondary w-full mt-2" aria-label="Sign in with Google">
               <i class="fab fa-google"></i>
               Google
               </button>
            </div>
         </div>
      </div>
      <!-- Quiz Modal -->
      <div id="quizModal" class="modal" role="dialog" aria-labelledby="quizTitle" aria-hidden="true">
         <div class="modal-content">
            <div class="flex justify-between items-center mb-4">
               <h2 class="text-xl font-bold text-gray-800" id="quizTitle">Pre-Quiz</h2>
               <button onclick="closeQuiz()" class="text-gray-500 hover:text-gray-700" aria-label="Close quiz">
               <i class="fas fa-times text-xl"></i>
               </button>
            </div>
            <div id="quizProgress" class="mb-4">
               <div class="flex justify-between items-center mb-2">
                  <span class="text-sm text-gray-600">Question <span id="currentQuestion">1</span> of <span id="totalQuestions">7</span></span>
                  <span class="text-sm text-gray-600">Score: <span id="currentScore">0</span></span>
               </div>
               <div class="progress-bar" role="progressbar" aria-valuenow="14.3" aria-valuemin="0" aria-valuemax="100">
                  <div class="progress-fill" id="progressFill" style="width: 14.3%"></div>
               </div>
            </div>
            <div id="quizTimerContainer" class="mb-4" style="display: none;">
               <div class="quiz-timer" id="quizTimer">
                  <i class="fas fa-clock"></i>
                  <span id="timerDisplay">15:00</span>
               </div>
            </div>
            <div id="quizContent">
               <div class="mb-6">
                  <h3 class="text-lg font-semibold mb-4" id="questionText">Loading question...</h3>
                  <div id="optionsContainer"></div>
               </div>
               <div id="feedback" class="hidden mb-4 p-3 rounded-lg text-sm" role="alert"></div>
               <div class="flex justify-between items-center">
                  <button id="prevButton" class="btn btn-secondary hidden" onclick="previousQuestion()" aria-label="Previous question">
                  <i class="fas fa-arrow-left"></i>
                  Previous
                  </button>
                  <div class="flex gap-2">
                     <button id="submitButton" class="btn btn-primary" onclick="submitAnswer()" aria-label="Submit answer">
                     Submit Answer
                     </button>
                     <button id="nextButton" class="btn btn-primary hidden" onclick="nextQuestion()" aria-label="Next question">
                     Next
                     <i class="fas fa-arrow-right ml-1"></i>
                     </button>
                  </div>
               </div>
            </div>
            <div id="quizResults" class="hidden text-center">
               <i class="fas fa-trophy text-5xl text-yellow-500 mb-4" aria-hidden="true"></i>
               <h3 class="text-2xl font-bold mb-3">Quiz Complete!</h3>
               <div class="text-4xl font-bold text-indigo-600 mb-3" id="finalScore">0/7</div>
               <p class="text-gray-600 mb-6" id="scoreMessage">Great job!</p>
               <div id="postQuizActions" class="hidden">
                  <button onclick="completePreQuiz()" class="btn btn-primary" aria-label="Continue to learning materials">
                  <i class="fas fa-arrow-right"></i>
                  Continue to Learning Materials
                  </button>
               </div>
               <div id="finalActions" class="hidden">
                  <button onclick="closeQuiz()" class="btn btn-primary" aria-label="Finish quiz">
                  <i class="fas fa-check"></i>
                  Finish
                  </button>
               </div>
            </div>
         </div>
      </div>
      <!-- Create Study Group Modal -->
      <div id="createStudyGroupModal" class="modal" role="dialog" aria-labelledby="createGroupTitle" aria-hidden="true">
         <div class="modal-content">
            <h2 class="text-xl font-bold text-gray-800 mb-4" id="createGroupTitle">Create Study Group</h2>
            <form id="createStudyGroupForm" class="space-y-4" onsubmit="handleCreateStudyGroup(event)">
               <div>
                  <label for="groupName" class="block text-sm font-medium text-gray-700 mb-1">Group Name</label>
                  <input type="text" id="groupName" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" placeholder="Enter group name" required aria-required="true">
               </div>
               <div>
                  <label for="groupDescription" class="block text-sm font-medium text-gray-700 mb-1">Description</label>
                  <textarea id="groupDescription" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" rows="3" placeholder="Describe your study group" required aria-required="true"></textarea>
               </div>
               <div>
                  <label for="groupGoal" class="block text-sm font-medium text-gray-700 mb-1">Goal</label>
                  <input type="text" id="groupGoal" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" placeholder="What's the goal of this group?" required aria-required="true">
               </div>
               <div>
                  <label for="groupMaxMembers" class="block text-sm font-medium text-gray-700 mb-1">Max Members</label>
                  <select id="groupMaxMembers" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" required aria-required="true">
                     <option value="5">5 members</option>
                     <option value="10">10 members</option>
                     <option value="15">15 members</option>
                     <option value="20">20 members</option>
                  </select>
               </div>
               <button type="submit" class="btn btn-primary w-full">
               <i class="fas fa-plus"></i>
               Create Group
               </button>
            </form>
         </div>
      </div>
      <!-- Group Detail Modal -->
      <div id="groupDetailModal" class="modal" role="dialog" aria-labelledby="groupDetailTitle" aria-hidden="true">
         <div class="modal-content">
            <div class="flex justify-between items-center mb-4">
               <h2 class="text-xl font-bold text-gray-800" id="groupDetailTitle">Study Group</h2>
               <button onclick="closeGroupDetail()" class="text-gray-500 hover:text-gray-700" aria-label="Close group details">
               <i class="fas fa-times text-xl"></i>
               </button>
            </div>
            <div id="groupDetailContent">
               <div class="mb-4">
                  <h3 class="font-semibold text-gray-700 mb-2">Description</h3>
                  <p class="text-gray-600" id="groupDetailDescription"></p>
               </div>
               <div class="mb-4">
                  <h3 class="font-semibold text-gray-700 mb-2">Goal</h3>
                  <p class="text-gray-600" id="groupDetailGoal"></p>
               </div>
               <div class="mb-4">
                  <h3 class="font-semibold text-gray-700 mb-2">Members</h3>
                  <div id="groupDetailMembers"></div>
               </div>
               <div class="mb-4">
                  <h3 class="font-semibold text-gray-700 mb-2">Group Progress</h3>
                  <div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
                     <div class="progress-fill" id="groupProgressFill" style="width: 0%"></div>
                  </div>
                  <p class="text-sm text-gray-600 mt-1" id="groupProgressText">0% completed</p>
               </div>
            </div>
            <div class="group-discussion">
               <div class="group-discussion-header">
                  <h3 class="group-discussion-title">Group Discussion</h3>
               </div>
               <div id="groupMessagesContainer">
                  <div class="empty-state">
                     <div class="empty-state-icon" aria-hidden="true">
                        <i class="fas fa-comments"></i>
                     </div>
                     <h3 class="empty-state-title">No Messages Yet</h3>
                     <p class="empty-state-description">Start a conversation with your group members.</p>
                  </div>
               </div>
               <form class="group-message-form" onsubmit="handleGroupMessage(event)">
                  <input type="text" id="groupMessageInput" class="group-message-input" placeholder="Type a message..." aria-label="Type a message">
                  <button type="submit" class="group-message-submit">Send</button>
               </form>
            </div>
         </div>
      </div>
      <!-- Toast Container -->
      <div id="toastContainer" aria-live="polite"></div>
      <!-- JavaScript Modules -->
      <script>
         // Utility Module
         const Utils = (() => {
             // Email validation
             const isValidEmail = (email) => {
                 return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
             };
             
             // Format date
             const formatDate = (date) => {
                 const d = new Date(date);
                 return d.toLocaleDateString();
             };
             
             // Format time
             const formatTime = (date) => {
                 const d = new Date(date);
                 return d.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
             };
             
             // Debounce function
             const debounce = (func, wait) => {
                 let timeout;
                 return function executedFunction(...args) {
                     const later = () => {
                         clearTimeout(timeout);
                         func(...args);
                     };
                     clearTimeout(timeout);
                     timeout = setTimeout(later, wait);
                 };
             };
             
             // Generate random ID
             const generateId = () => {
                 return Math.random().toString(36).substr(2, 9);
             };
             
             // Search function
             const searchContent = (query, content) => {
                 if (!query) return content;
                 
                 const lowerQuery = query.toLowerCase();
                 
                 return content.filter(item => {
                     // Search in title
                     if (item.title && item.title.toLowerCase().includes(lowerQuery)) {
                         return true;
                     }
                     
                     // Search in content
                     if (item.content && item.content.toLowerCase().includes(lowerQuery)) {
                         return true;
                     }
                     
                     // Search in tags
                     if (item.tags && Array.isArray(item.tags)) {
                         return item.tags.some(tag => tag.toLowerCase().includes(lowerQuery));
                     }
                     
                     return false;
                 });
             };
             
             return {
                 isValidEmail,
                 formatDate,
                 formatTime,
                 debounce,
                 generateId,
                 searchContent
             };
         })();
         
         // UI Module
         const UIModule = (() => {
             // Show loading overlay
             const showLoading = () => {
                 document.getElementById('loadingOverlay').style.display = 'flex';
                 document.getElementById('loadingOverlay').setAttribute('aria-busy', 'true');
             };
             
             // Hide loading overlay
             const hideLoading = () => {
                 document.getElementById('loadingOverlay').style.display = 'none';
                 document.getElementById('loadingOverlay').setAttribute('aria-busy', 'false');
             };
             
             // Show toast notification
             const showToast = (type, title, message) => {
                 const toastContainer = document.getElementById('toastContainer');
                 
                 const toast = document.createElement('div');
                 toast.className = `toast ${type}`;
                 toast.setAttribute('role', 'alert');
                 
                 let icon = 'fa-info-circle';
                 if (type === 'success') icon = 'fa-check-circle';
                 else if (type === 'error') icon = 'fa-exclamation-circle';
                 
                 toast.innerHTML = `
                     <div class="toast-icon" aria-hidden="true">
                         <i class="fas ${icon}"></i>
                     </div>
                     <div class="toast-message">
                         <div class="toast-title">${title}</div>
                         <div class="toast-description">${message}</div>
                     </div>
                 `;
                 
                 toastContainer.appendChild(toast);
                 
                 // Show toast
                 setTimeout(() => {
                     toast.classList.add('show');
                 }, 100);
                 
                 // Hide toast after 3 seconds
                 setTimeout(() => {
                     toast.classList.remove('show');
                     setTimeout(() => {
                         toast.remove();
                     }, 300);
                 }, 3000);
             };
             
             // Update status message for screen readers
             const updateStatus = (message) => {
                 const statusElement = document.getElementById('statusMessage');
                 statusElement.textContent = message;
                 
                 // Clear after announcement
                 setTimeout(() => {
                     statusElement.textContent = '';
                 }, 1000);
             };
             
             // Toggle dark mode
             const toggleTheme = () => {
                 const body = document.body;
                 const themeIcon = document.getElementById('themeIcon');
                 
                 body.classList.toggle('dark-mode');
                 
                 if (body.classList.contains('dark-mode')) {
                     themeIcon.classList.remove('fa-moon');
                     themeIcon.classList.add('fa-sun');
                     localStorage.setItem('theme', 'dark');
                 } else {
                     themeIcon.classList.remove('fa-sun');
                     themeIcon.classList.add('fa-moon');
                     localStorage.setItem('theme', 'light');
                 }
             };
             
             // Initialize theme
             const initTheme = () => {
                 const savedTheme = localStorage.getItem('theme');
                 const themeIcon = document.getElementById('themeIcon');
                 
                 if (savedTheme === 'dark') {
                     document.body.classList.add('dark-mode');
                     themeIcon.classList.remove('fa-moon');
                     themeIcon.classList.add('fa-sun');
                 }
             };
             
             return {
                 showLoading,
                 hideLoading,
                 showToast,
                 updateStatus,
                 toggleTheme,
                 initTheme
             };
         })();
         
         // Authentication Module
         const AuthModule = (() => {
             // Firebase configuration
             const firebaseConfig = {
                 apiKey: "AIzaSyBOp4x0lTFvmt2s3MQKBRYmZT9IJ2ZaRi8",
                 authDomain: "group-1-alkali-metals.firebaseapp.com",
                 databaseURL: "https://group-1-alkali-metals-default-rtdb.firebaseio.com",
                 projectId: "group-1-alkali-metals",
                 storageBucket: "group-1-alkali-metals.firebasestorage.app",
                 messagingSenderId: "806417495419",
                 appId: "1:806417495419:web:5b80607e8a23e96da4f9de",
                 measurementId: "G-S76E52MQ37"
             };
             
             // Initialize Firebase
             firebase.initializeApp(firebaseConfig);
             const auth = firebase.auth();
             const database = firebase.database();
             
             // Global variables
             let currentUser = null;
             let userData = null;
             let justSignedIn = false;
             let authInitialized = false;
             
             // Check authentication state on page load
         auth.onAuthStateChanged((user) => {
         authInitialized = true;
         console.log("Auth state changed, user:", user);
         
         if (user) {
           currentUser = user;
           console.log("User is signed in:", user.uid);
           
           // Check user data on page load
           const userRef = database.ref('users/' + user.uid);
           userRef.once('value').then((snapshot) => {
               if (snapshot.exists()) {
                   userData = snapshot.val();
                   
                   if (userData.preQuizCompleted) {
                       showMainApp();
                   } else {
                       showPreQuizIntroduction();
                   }
               } else {
                   // This should only happen if a user signs in for the first time
                   // but the handleLogin or signInWithGoogle didn't complete properly
                   showLandingPage();
               }
           }).catch((error) => {
               console.error("Error checking user data:", error);
               showLandingPage();
           });
         } else {
           console.log("No user signed in");
           showLandingPage();
         }
         });
             // Show landing page
             const showLandingPage = () => {
                 document.getElementById('landingPage').style.display = 'flex';
                 document.getElementById('prequizPage').style.display = 'none';
                 document.getElementById('mainApp').style.display = 'none';
             };
             
             // Show pre-quiz introduction
             const showPreQuizIntroduction = () => {
                 document.getElementById('landingPage').style.display = 'none';
                 document.getElementById('prequizPage').style.display = 'flex';
                 document.getElementById('mainApp').style.display = 'none';
             };
             
             // Check pre-quiz status
             const checkPreQuizStatus = () => {
                 if (!currentUser) {
                     showLandingPage();
                     return;
                 }
                 
                 const userRef = database.ref('users/' + currentUser.uid);
                 
                 userRef.once('value').then((snapshot) => {
                     if (snapshot.exists()) {
                         userData = snapshot.val();
                         
                         if (userData.preQuizCompleted) {
                             showMainApp();
                         } else {
                             showPreQuizIntroduction();
                         }
                     } else {
                         // Create new user
                         const newUser = {
                             uid: currentUser.uid,
                             email: currentUser.email,
                             displayName: currentUser.displayName || 'User',
                             points: 0,
                             currentStreak: 1,
                             lastActiveDate: new Date().toDateString(),
                             preQuizCompleted: false,
                             postQuizCompleted: false,
                             completedSections: [],
                             bookmarks: [],
                             notes: {},
                             createdAt: firebase.database.ServerValue.TIMESTAMP
                         };
                         
                         userRef.set(newUser).then(() => {
                             userData = newUser;
                             showPreQuizIntroduction();
                         }).catch((error) => {
                             console.error("Error creating new user:", error);
                             UIModule.showToast('error', 'Error', 'Failed to create user profile.');
                         });
                     }
                 }).catch((error) => {
                     console.error("Error checking pre-quiz status:", error);
                     UIModule.showToast('error', 'Error', 'Failed to check your progress.');
                     showLandingPage();
                 });
             };
             
             // Show main app
             const showMainApp = () => {
                 document.getElementById('landingPage').style.display = 'none';
                 document.getElementById('prequizPage').style.display = 'none';
                 document.getElementById('mainApp').style.display = 'block';
                 
                 // Update user profile
                 document.getElementById('userName').textContent = userData.displayName || 'User';
                 document.getElementById('userPoints').textContent = userData.points || 0;
                 document.getElementById('userStreak').textContent = userData.currentStreak || 0;
                 
                 // Load notes if they exist
                 if (userData.notes && userData.notes.overview) {
                     document.getElementById('notesInput').value = userData.notes.overview;
                 }
                 
                 // Update section completion status
                 updateSectionCompletionStatus();
                 
                 // Update progress tracker
                 updateProgressTracker();
                 
                 // Load data
                 StudyGroupModule.loadStudyGroups();
                 DiscussionModule.loadComments();
                 
                 // Initialize search functionality
                 SearchModule.initSearch();
                 
                 // Initialize melting point quiz functionality
                 initMeltingPointQuiz();
                 
                 // Add fade-in animation to elements
                 document.querySelectorAll('.fade-in').forEach((el, index) => {
                     el.style.animationDelay = `${index * 0.1}s`;
                 });
             };
             
         // Handle login
         const handleLogin = (event) => {
         event.preventDefault();
         const email = document.getElementById('loginEmail').value;
         const password = document.getElementById('loginPassword').value;
         
         if (!Utils.isValidEmail(email)) {
           UIModule.showToast('error', 'Invalid Email', 'Please enter a valid email address');
           return;
         }
         
         UIModule.showLoading();
         
         auth.signInWithEmailAndPassword(email, password)
           .then((userCredential) => {
               const user = userCredential.user;
               console.log("Sign in successful:", user.uid);
               UIModule.showToast('success', 'Welcome back!', 'You have been successfully signed in.');
               closeLoginModal();
               
               // Check if user exists in database
               const userRef = database.ref('users/' + user.uid);
               userRef.once('value').then((snapshot) => {
                   if (snapshot.exists()) {
                       userData = snapshot.val();
                       
                       if (userData.preQuizCompleted) {
                           showMainApp();
                       } else {
                           showPreQuizIntroduction();
                       }
                   } else {
                       // Create new user profile
                       const newUser = {
                           uid: user.uid,
                           email: user.email,
                           displayName: user.displayName || 'User',
                           points: 0,
                           currentStreak: 1,
                           lastActiveDate: new Date().toDateString(),
                           preQuizCompleted: false,
                           postQuizCompleted: false,
                           completedSections: [],
                           bookmarks: [],
                           notes: {},
                           createdAt: firebase.database.ServerValue.TIMESTAMP
                       };
                       
                       userRef.set(newUser).then(() => {
                           userData = newUser;
                           showPreQuizIntroduction();
                       }).catch((error) => {
                           console.error("Error creating user profile:", error);
                           UIModule.showToast('error', 'Error', 'Failed to create user profile.');
                       });
                   }
               }).catch((error) => {
                   console.error("Error checking user data:", error);
                   UIModule.showToast('error', 'Error', 'Failed to load your data.');
               });
           })
           .catch((error) => {
               const errorCode = error.code;
               const errorMessage = error.message;
               console.error("Sign in error:", errorCode, errorMessage);
               
               if (errorCode === 'auth/unauthorized-domain') {
                   UIModule.showToast('error', 'Domain not authorized', 
                       'Please add your domain to the authorized domains in your Firebase project settings.');
               } else if (errorCode === 'auth/user-not-found') {
                   UIModule.showToast('error', 'User not found', 'No account found with this email address.');
               } else if (errorCode === 'auth/wrong-password') {
                   UIModule.showToast('error', 'Incorrect password', 'The password you entered is incorrect.');
               } else {
                   UIModule.showToast('error', 'Sign in failed', errorMessage);
               }
           })
           .finally(() => {
               UIModule.hideLoading();
           });
         };
             // Handle signup
             const handleSignup = (event) => {
                 event.preventDefault();
                 const name = document.getElementById('signupName').value;
                 const email = document.getElementById('signupEmail').value;
                 const password = document.getElementById('signupPassword').value;
                 const confirmPassword = document.getElementById('signupConfirmPassword').value;
                 
                 if (!Utils.isValidEmail(email)) {
                     UIModule.showToast('error', 'Invalid Email', 'Please enter a valid email address');
                     return;
                 }
                 
                 if (password !== confirmPassword) {
                     UIModule.showToast('error', 'Password Mismatch', 'The passwords you entered do not match.');
                     return;
                 }
                 
                 if (password.length < 6) {
                     UIModule.showToast('error', 'Password Too Short', 'Password must be at least 6 characters long.');
                     return;
                 }
                 
                 UIModule.showLoading();
                 
                 auth.createUserWithEmailAndPassword(email, password)
                     .then((userCredential) => {
                         const user = userCredential.user;
                         
                         // Update user profile with display name
                         return user.updateProfile({
                             displayName: name
                         }).then(() => {
                             console.log("Sign up successful:", user.uid);
                             UIModule.showToast('success', 'Account Created!', 'Your account has been created successfully.');
                             closeLoginModal();
                             justSignedIn = true;
                             
                             // Create user data in database
                             const newUser = {
                                 uid: user.uid,
                                 email: email,
                                 displayName: name,
                                 points: 0,
                                 currentStreak: 1,
                                 lastActiveDate: new Date().toDateString(),
                                 preQuizCompleted: false,
                                 postQuizCompleted: false,
                                 completedSections: [],
                                 bookmarks: [],
                                 notes: {},
                                 createdAt: firebase.database.ServerValue.TIMESTAMP
                             };
                             
                             return database.ref('users/' + user.uid).set(newUser);
                         });
                     })
                     .then(() => {
                         // The onAuthStateChanged listener will handle showing the pre-quiz introduction
                     })
                     .catch((error) => {
                         const errorCode = error.code;
                         const errorMessage = error.message;
                         console.error("Sign up error:", errorCode, errorMessage);
                         
                         if (errorCode === 'auth/email-already-in-use') {
                             UIModule.showToast('error', 'Email Already In Use', 'This email address is already associated with an account.');
                         } else if (errorCode === 'auth/weak-password') {
                             UIModule.showToast('error', 'Weak Password', 'Password must be at least 6 characters long.');
                         } else {
                             UIModule.showToast('error', 'Sign up failed', errorMessage);
                         }
                     })
                     .finally(() => {
                         UIModule.hideLoading();
                     });
             };
             
            // Sign in with Google
         const signInWithGoogle = () => {
         const provider = new firebase.auth.GoogleAuthProvider();
         
         auth.signInWithPopup(provider)
           .then((result) => {
               const user = result.user;
               console.log("Google sign in successful:", user.uid);
               UIModule.showToast('success', 'Welcome!', 'You have been successfully signed in with Google.');
               closeLoginModal();
               
               // Check if user exists in database
               const userRef = database.ref('users/' + user.uid);
               userRef.once('value').then((snapshot) => {
                   if (snapshot.exists()) {
                       userData = snapshot.val();
                       
                       if (userData.preQuizCompleted) {
                           showMainApp();
                       } else {
                           showPreQuizIntroduction();
                       }
                   } else {
                       // Create new user profile
                       const newUser = {
                           uid: user.uid,
                           email: user.email,
                           displayName: user.displayName || 'User',
                           points: 0,
                           currentStreak: 1,
                           lastActiveDate: new Date().toDateString(),
                           preQuizCompleted: false,
                           postQuizCompleted: false,
                           completedSections: [],
                           bookmarks: [],
                           notes: {},
                           createdAt: firebase.database.ServerValue.TIMESTAMP
                       };
                       
                       userRef.set(newUser).then(() => {
                           userData = newUser;
                           showPreQuizIntroduction();
                       }).catch((error) => {
                           console.error("Error creating user profile:", error);
                           UIModule.showToast('error', 'Error', 'Failed to create user profile.');
                       });
                   }
               }).catch((error) => {
                   console.error("Error checking user data:", error);
                   UIModule.showToast('error', 'Error', 'Failed to load your data.');
               });
           })
           .catch((error) => {
               const errorCode = error.code;
               const errorMessage = error.message;
               console.error("Google sign in error:", errorCode, errorMessage);
               
               if (errorCode === 'auth/unauthorized-domain') {
                   UIModule.showToast('error', 'Domain not authorized', 
                       'Please add your domain to the authorized domains in your Firebase project settings.');
               } else {
                   UIModule.showToast('error', 'Sign in failed', errorMessage);
               }
           });
         };
                 
                 // Check if all sections are completed to unlock final quiz
                 const allSectionsCompleted = sectionOrder.every(section => completedSections.includes(section));
                 const quizNavItem = document.getElementById('nav-quiz');
                 const quizStep = document.getElementById('step-quiz');
                 
                 if (allSectionsCompleted) {
                     quizNavItem.classList.remove('locked');
                     quizStep.classList.remove('active');
                     quizStep.classList.add('completed');
                     quizStep.innerHTML = '<i class="fas fa-graduation-cap"></i>';
                 } else {
                     quizNavItem.classList.add('locked');
                     quizStep.classList.remove('completed');
                     quizStep.innerHTML = '<i class="fas fa-lock"></i>';
                 }
             };
             
             // Get section icon
             const getSectionIcon = (section) => {
                 switch (section) {
                     case 'overview': return 'home';
                     case 'elements': return 'th';
                     case 'properties': return 'flask';
                     case 'reactions': return 'vial';
                     default: return 'lock';
                 }
             };
             
             // Update progress tracker
             const updateProgressTracker = () => {
                 if (!userData) return;
                 
                 const sectionOrder = ['overview', 'elements', 'properties', 'reactions'];
                 const completedSections = userData.completedSections || [];
                 const totalSections = sectionOrder.length;
                 const completedCount = completedSections.length;
                 const percentage = Math.round((completedCount / totalSections) * 100);
                 
                 // Update progress percentage and bar
                 document.getElementById('progressPercentage').textContent = `${percentage}%`;
                 document.getElementById('overallProgressFill').style.width = `${percentage}%`;
                 
                 // Update progress items
                 sectionOrder.forEach((section, index) => {
                     const progressItem = document.getElementById(`progress-${section}`);
                     const statusElement = progressItem.querySelector('.progress-item-status');
                     const iconElement = progressItem.querySelector('.progress-item-icon');
                     
                     if (completedSections.includes(section)) {
                         progressItem.classList.add('completed');
                         progressItem.classList.remove('active', 'locked');
                         statusElement.textContent = 'Completed';
                         iconElement.style.color = 'var(--success-500)';
                     } else if (index === 0 || completedSections.includes(sectionOrder[index - 1])) {
                         progressItem.classList.add('active');
                         progressItem.classList.remove('completed', 'locked');
                         statusElement.textContent = 'In Progress';
                         iconElement.style.color = 'var(--primary-600)';
                     } else {
                         progressItem.classList.add('locked');
                         progressItem.classList.remove('completed', 'active');
                         statusElement.textContent = 'Locked';
                         iconElement.style.color = 'var(--gray-400)';
                     }
                 });
             };
             
             // Complete a section
             const completeSection = (sectionName) => {
                 // Check if user is signed in
                 const user = firebase.auth().currentUser;
                 if (!user) {
                     UIModule.showToast('error', 'Sign in required', 'Please sign in to mark sections as complete.');
                     return;
                 }
                 
                 // Check if section is already completed
                 if (userData.completedSections && userData.completedSections.includes(sectionName)) {
                     UIModule.showToast('info', 'Already Completed', 'This section is already marked as complete.');
                     return;
                 }
                 
                 // Update user data
                 const completedSections = userData.completedSections || [];
                 completedSections.push(sectionName);
                 
                 const userRef = database.ref('users/' + firebase.auth().currentUser.uid);
                 userRef.update({
                     completedSections: completedSections
                 }).then(() => {
                     // Update local data
                     userData.completedSections = completedSections;
                     
                     // Award points
                     awardPoints(15, `Completed ${sectionName} section`);
                     
                     // Show success message
                     UIModule.showToast('success', 'Section Complete!', 'Great job! You\'ve completed this section.');
                     
                     // Update section completion status
                     updateSectionCompletionStatus();
                     
                     // Update progress tracker
                     updateProgressTracker();
                     
                     // Update group progress if user is in any groups
                     StudyGroupModule.updateGroupProgress();
                     
                     // Navigate to next section if available
                     const sectionOrder = ['overview', 'elements', 'properties', 'reactions'];
                     const currentIndex = sectionOrder.indexOf(sectionName);
                     if (currentIndex < sectionOrder.length - 1) {
                         const nextSection = sectionOrder[currentIndex + 1];
                         NavigationModule.navigateToSection(nextSection);
                     } else {
                         // All sections completed, show final quiz
                         UIModule.showToast('success', 'All Sections Complete!', 'You can now take the final quiz.');
                         NavigationModule.navigateToSection('quiz');
                     }
                 }).catch((error) => {
                     console.error("Error updating section completion:", error);
                     UIModule.showToast('error', 'Error', 'Failed to mark section as complete.');
                 });
             };
             
             // Save notes
             const saveNotes = () => {
                 // Check if user is signed in
                 const user = firebase.auth().currentUser;
                 if (!user) {
                     UIModule.showToast('error', 'Sign in required', 'Please sign in to save notes.');
                     return;
                 }
                 
                 const notesInput = document.getElementById('notesInput');
                 const notes = notesInput.value.trim();
                 
                 // Get current section
                 const currentSection = document.querySelector('.content-section:not([style*="display: none"])').id.replace('-section', '');
                 
                 // Update user data
                 const userNotes = userData.notes || {};
                 userNotes[currentSection] = notes;
                 
                 const userRef = database.ref('users/' + user.uid);
                 userRef.update({
                     notes: userNotes
                 }).then(() => {
                     // Update local data
                     userData.notes = userNotes;
                     
                     // Award points
                     awardPoints(5, 'Saved notes');
                     
                     // Show success message
                     UIModule.showToast('success', 'Notes Saved!', 'Your notes have been saved successfully.');
                 }).catch((error) => {
                     console.error("Error saving notes:", error);
                     UIModule.showToast('error', 'Error', 'Failed to save notes.');
                 });
             };
             
             // Award points to user
             const awardPoints = (points, reason) => {
                 // Check if user is authenticated
                 if (!authInitialized) {
                     // Wait for auth to initialize
                     setTimeout(() => {
                         awardPoints(points, reason);
                     }, 500);
                     return;
                 }
                 
                 const user = firebase.auth().currentUser;
                 if (!user) {
                     console.error("No user signed in when awarding points");
                     return;
                 }
                 
                 const userRef = database.ref('users/' + user.uid);
                 
                 const updates = {};
                 updates['/points'] = (userData.points || 0) + points;
                 updates['/lastActiveDate'] = new Date().toDateString();
                 
                 // Update streak
                 const today = new Date().toDateString();
                 const yesterday = new Date();
                 yesterday.setDate(yesterday.getDate() - 1);
                 const yesterdayString = yesterday.toDateString();
                 
                 if (userData.lastActiveDate === yesterdayString) {
                     updates['/currentStreak'] = (userData.currentStreak || 1) + 1;
                 } else if (userData.lastActiveDate !== today) {
                     updates['/currentStreak'] = 1;
                 }
                 
                 userRef.update(updates).then(() => {
                     userData.points = updates['/points'];
                     userData.currentStreak = updates['/currentStreak'];
                     userData.lastActiveDate = updates['/lastActiveDate'];
                     
                     // Update UI
                     document.getElementById('userPoints').textContent = userData.points;
                     document.getElementById('userStreak').textContent = userData.currentStreak;
                     
                     UIModule.showToast('success', 'Points Awarded', `+${points} points for ${reason}`);
                 }).catch((error) => {
                     console.error("Error awarding points:", error);
                 });
             };
             
             // Show login modal
             const showLoginModal = () => {
                 document.getElementById('loginModal').classList.add('active');
                 document.getElementById('loginModal').setAttribute('aria-hidden', 'false');
             };
             
             // Close login modal
             const closeLoginModal = () => {
                 document.getElementById('loginModal').classList.remove('active');
                 document.getElementById('loginModal').setAttribute('aria-hidden', 'true');
             };
             
             // Switch auth tab
             const switchAuthTab = (tabName) => {
                 // Hide all auth contents
                 const authContents = document.querySelectorAll('.auth-content');
                 authContents.forEach(content => {
                     content.classList.remove('active');
                 });
                 
                 // Remove active class from all auth tabs
                 const authTabs = document.querySelectorAll('.auth-tab');
                 authTabs.forEach(tab => {
                     tab.classList.remove('active');
                     tab.setAttribute('aria-selected', 'false');
                 });
                 
                 // Show selected auth content
                 document.getElementById(`${tabName}Form`).classList.add('active');
                 
                 // Add active class to clicked auth tab
                 const activeTab = document.getElementById(`${tabName}-tab`);
                 activeTab.classList.add('active');
                 activeTab.setAttribute('aria-selected', 'true');
             };
             
             return {
                 handleLogin,
                 handleSignup,
                 signInWithGoogle,
                 signOut,
                 completeSection,
                 saveNotes,
                 showLoginModal,
                 closeLoginModal,
                 switchAuthTab
             };
         })();
         
         // Navigation Module
         const NavigationModule = (() => {
             // Toggle sidebar (mobile)
             const toggleSidebar = () => {
                 const sidebar = document.getElementById('sidebar');
                 sidebar.classList.toggle('active');
             };
             
             // Navigate to section
             const navigateToSection = (sectionName) => {
                 // Check if section is locked
                 const navItem = document.getElementById(`nav-${sectionName}`);
                 if (navItem.classList.contains('locked')) {
                     UIModule.showToast('info', 'Section Locked', 'Please complete previous sections first.');
                     return;
                 }
                 
                 // Hide all sections
                 const sections = document.querySelectorAll('.content-section');
                 sections.forEach(section => {
                     section.style.display = 'none';
                 });
                 
                 // Show selected section
                 document.getElementById(`${sectionName}-section`).style.display = 'block';
                 
                 // Update active nav item
                 const navItems = document.querySelectorAll('.nav-item');
                 navItems.forEach(item => {
                     item.classList.remove('active');
                     item.setAttribute('aria-current', 'false');
                 });
                 navItem.classList.add('active');
                 navItem.setAttribute('aria-current', 'page');
                 
                 // Load notes for this section if they exist
                 if (AuthModule.userData && AuthModule.userData.notes && AuthModule.userData.notes[sectionName]) {
                     document.getElementById('notesInput').value = AuthModule.userData.notes[sectionName];
                 } else {
                     document.getElementById('notesInput').value = '';
                 }
                 
                 // Close sidebar on mobile
                 if (window.innerWidth <= 768) {
                     toggleSidebar();
                 }
                 
                 // Update URL hash for bookmarking
                 window.location.hash = sectionName;
             };
             
             // Show tab
             const showTab = (tabName) => {
                 // Hide all tab contents
                 const tabContents = document.querySelectorAll('.tab-content');
                 tabContents.forEach(content => {
                     content.classList.remove('active');
                     content.setAttribute('aria-hidden', 'true');
                 });
                 
                 // Remove active class from all tabs
                 const tabs = document.querySelectorAll('.tab');
                 tabs.forEach(tab => {
                     tab.classList.remove('active');
                     tab.setAttribute('aria-selected', 'false');
                 });
                 
                 // Show selected tab content
                 document.getElementById(tabName).classList.add('active');
                 document.getElementById(tabName).setAttribute('aria-hidden', 'false');
                 
                 // Add active class to clicked tab
                 const activeTab = document.getElementById(`${tabName}-tab`);
                 activeTab.classList.add('active');
                 activeTab.setAttribute('aria-selected', 'true');
             };
             
             return {
                 toggleSidebar,
                 navigateToSection,
                 showTab
             };
         })();
         
         // Search Module
         const SearchModule = (() => {
             // Content index for search
             let contentIndex = [];
             
             // Initialize search functionality
             const initSearch = () => {
                 const searchInput = document.getElementById('searchInput');
                 const searchResults = document.getElementById('searchResults');
                 
                 // Build content index
                 buildContentIndex();
                 
                 // Add event listener for search input
                 searchInput.addEventListener('input', Utils.debounce(handleSearch, 300));
                 
                 // Hide search results when clicking outside
                 document.addEventListener('click', (e) => {
                     if (!searchInput.contains(e.target) && !searchResults.contains(e.target)) {
                         searchResults.classList.remove('active');
                     }
                 });
             };
             
             // Build content index for search
             const buildContentIndex = () => {
                 contentIndex = [
                     {
                         id: 'overview',
                         title: 'Overview',
                         content: 'Group 1 elements, known as the alkali metals, occupy the first column of the periodic table. They consist of lithium, sodium, potassium, rubidium, cesium, and francium.',
                         tags: ['introduction', 'alkali metals', 'group 1']
                     },
                     {
                         id: 'elements',
                         title: 'Elements',
                         content: 'Lithium, sodium, potassium, rubidium, cesium, and francium are the Group 1 alkali metals.',
                         tags: ['lithium', 'sodium', 'potassium', 'rubidium', 'cesium', 'francium']
                     },
                     {
                         id: 'properties',
                         title: 'Properties',
                         content: 'Group 1 metals are soft, shiny metals with low densities and low melting points. Their reactivity increases as you move down the group.',
                         tags: ['physical properties', 'chemical properties', 'reactivity', 'trends']
                     },
                     {
                         id: 'reactions',
                         title: 'Reactions',
                         content: 'Group 1 metals react with water, oxygen, halogens, and acids. These reactions are highly exothermic.',
                         tags: ['water', 'oxygen', 'halogens', 'acids', 'reactions']
                     },
                     {
                         id: 'glossary',
                         title: 'Glossary',
                         content: 'Alkali Metals, Electron Configuration, Ionization Energy, Reactivity, Metallic Bonding, Oxide, Peroxide, Superoxide, Halides, Flame Test',
                         tags: ['glossary', 'terms', 'definitions']
                     }
                 ];
             };
             
             // Handle search input
             const handleSearch = (e) => {
                 const query = e.target.value.trim();
                 const searchResults = document.getElementById('searchResults');
                 
                 if (!query) {
                     searchResults.classList.remove('active');
                     return;
                 }
                 
                 // Filter content based on query
                 const results = Utils.searchContent(query, contentIndex);
                 
                 // Clear previous results
                 searchResults.innerHTML = '';
                 
                 if (results.length === 0) {
                     searchResults.innerHTML = '<div class="search-result-item"><div class="search-result-title">No results found</div><div class="search-result-description">Try a different search term</div></div>';
                 } else {
                     // Add results to search results container
                     results.forEach(result => {
                         const resultItem = document.createElement('div');
                         resultItem.className = 'search-result-item';
                         resultItem.innerHTML = `
                             <div class="search-result-title">${result.title}</div>
                             <div class="search-result-description">${result.content.substring(0, 100)}...</div>
                         `;
                         resultItem.addEventListener('click', () => {
                             NavigationModule.navigateToSection(result.id);
                             searchResults.classList.remove('active');
                             document.getElementById('searchInput').value = '';
                         });
                         searchResults.appendChild(resultItem);
                     });
                 }
                 
                 // Show search results
                 searchResults.classList.add('active');
             };
             
             return {
                 initSearch
             };
         })();
         
         // Quiz Module
         const QuizModule = (() => {
             // Global variables
             let currentQuiz = [];
             let currentQuestion = 0;
             let score = 0;
             let selectedOption = null;
             let quizType = '';
             let answerSubmitted = false;
             let quizTimer = null;
             let timeRemaining = 900; // 15 minutes in seconds
             
             // Quiz questions - IGCSE Level with Interactive Types
             const preQuizQuestions = [
                 {
                     type: 'single',
                     question: "Which of the following is the correct electron configuration of sodium?",
                     options: ["[He] 2s² 2p⁶ 3s¹", "[Ne] 3s²", "[Ne] 3s¹", "[Ar] 4s¹"],
                     correct: 2,
                     explanation: "Sodium (Na) has atomic number 11. Its electron configuration is [Ne] 3s¹, meaning it has the same configuration as neon plus one electron in the 3s orbital."
                 },
                 {
                     type: 'drag-drop',
                     question: "Match the Group 1 element to its flame test color:",
                     dragItems: ["Lithium", "Sodium", "Potassium", "Rubidium"],
                     dropTargets: ["Red", "Yellow", "Lilac", "Red-violet"],
                     correct: { "Lithium": "Red", "Sodium": "Yellow", "Potassium": "Lilac", "Rubidium": "Red-violet" },
                     explanation: "Each Group 1 metal produces a characteristic flame color during flame tests: Lithium (red), Sodium (yellow), Potassium (lilac), and Rubidium (red-violet)."
                 },
                 {
                     type: 'fill-blank',
                     question: "Group 1 metals are stored under oil because they react with ______ and ______ in the air.",
                     correct: ["oxygen", "moisture"],
                     caseSensitive: false,
                     explanation: "Group 1 metals are highly reactive and react with both oxygen and moisture in the air. Storing them under oil prevents these reactions."
                 },
                 {
                     type: 'multiple',
                     question: "Which of the following are properties of Group 1 metals? (Select all that apply)",
                     options: [
                         "Low density", 
                         "High melting points", 
                         "Form +1 ions", 
                         "Good conductors of electricity",
                         "High ionization energy"
                     ],
                     correct: [0, 2, 3],
                     explanation: "Group 1 metals have low density, form +1 ions, and are good conductors of electricity. They have low melting points and low ionization energy."
                 },
                 {
                     type: 'single',
                     question: "What is the main product when sodium reacts with cold water?",
                     options: ["Sodium oxide and hydrogen", "Sodium hydroxide and hydrogen", "Sodium peroxide and hydrogen", "Sodium and water"],
                     correct: 1,
                     explanation: "Sodium reacts with cold water to produce sodium hydroxide (NaOH) and hydrogen gas (H₂). The equation is: 2Na + 2H₂O → 2NaOH + H₂."
                 },
                 {
                     type: 'matching',
                     question: "Match the reaction to the correct observation:",
                     pairs: [
                         { left: "Lithium + water", right: "Fizzes steadily" },
                         { left: "Sodium + water", right: "Melts into a ball" },
                         { left: "Potassium + water", right: "Ignites with lilac flame" }
                     ],
                     correct: 0,
                     explanation: "Lithium fizzes steadily in water, sodium melts into a ball and moves quickly, while potassium reacts violently and may ignite with a lilac flame."
                 },
                 {
                     type: 'single',
                     question: "Which Group 1 element has the lowest density and floats on water?",
                     options: ["Sodium", "Lithium", "Cesium", "Rubidium"],
                     correct: 1,
                     explanation: "Lithium has the lowest density (0.534 g/cm³) of all Group 1 metals, which is less than water (1 g/cm³), so it floats on water."
                 }
             ];
             
             const postQuizQuestions = [
                 {
                     type: 'single',
                     question: "Which element in Group 1 forms a peroxide when burned in oxygen?",
                     options: ["Lithium", "Sodium", "Potassium", "Rubidium"],
                     correct: 1,
                     explanation: "Sodium primarily forms the peroxide Na₂O₂ when burned in air, unlike lithium which forms the normal oxide Li₂O, and potassium/rubidium which form superoxides."
                 },
                 {
                     type: 'drag-drop',
                     question: "Match the reaction to the correct observation:",
                     dragItems: [
                         "Lithium + water", 
                         "Sodium + water", 
                         "Potassium + water"
                     ],
                     dropTargets: [
                         "Fizzes steadily", 
                         "Melts into a ball", 
                         "Ignites with lilac flame"
                     ],
                     correct: { 
                         "Lithium + water": "Fizzes steadily", 
                         "Sodium + water": "Melts into a ball", 
                         "Potassium + water": "Ignites with lilac flame" 
                     },
                     explanation: "Lithium fizzes steadily in water, sodium melts into a ball and moves quickly, while potassium reacts violently and may ignite with a lilac flame."
                 },
                 {
                     type: 'fill-blank',
                     question: "The reactivity of Group 1 metals ______ down the group.",
                     correct: ["increases"],
                     caseSensitive: false,
                     explanation: "Reactivity increases down Group 1 because the atomic radius increases and the outer electron is further from the nucleus, making it easier to lose."
                 },
                 {
                     type: 'multiple',
                     question: "Which of these are uses of Group 1 metals and their compounds? (Select all that apply)",
                     options: [
                         "Lithium in batteries",
                         "Sodium vapor in street lights",
                         "Potassium in fertilizers",
                         "Rubidium in atomic clocks",
                         "All of the above"
                     ],
                     correct: [0, 1, 2, 3, 4],
                     explanation: "All Group 1 metals have important uses: Lithium in batteries, sodium vapor in street lights, potassium in fertilizers, and rubidium in atomic clocks."
                 },
                 {
                     type: 'single',
                     question: "What is the formula of the superoxide formed by potassium?",
                     options: ["KO", "KO₂", "K₂O", "K₂O₂"],
                     correct: 1,
                     explanation: "Potassium forms the superoxide KO₂ when burned in oxygen, unlike sodium which forms the peroxide Na₂O₂ and lithium which forms the oxide Li₂O."
                 },
                 {
                     type: 'matching',
                     question: "Match the element to its primary oxide type:",
                     pairs: [
                         { left: "Lithium", right: "Normal oxide (Li₂O)" },
                         { left: "Sodium", right: "Peroxide (Na₂O₂)" },
                         { left: "Potassium", right: "Superoxide (KO₂)" }
                     ],
                     correct: 0,
                     explanation: "Lithium forms the normal oxide Li₂O, sodium forms the peroxide Na₂O₂, and potassium forms the superoxide KO₂ when burned in oxygen."
                 },
                 {
                     type: 'multiple',
                     question: "Which statements about the extraction of Group 1 metals are correct? (Select all that apply)",
                     options: [
                         "They are extracted by electrolysis of molten chlorides",
                         "They can be extracted by reduction with carbon",
                         "They are found free in nature",
                         "They are extracted from their ores",
                         "The process requires a lot of energy"
                     ],
                     correct: [0, 3, 4],
                     explanation: "Group 1 metals are extracted by electrolysis of their molten chlorides, not by reduction with carbon. They are not found free in nature but in ores, and the process requires a lot of energy."
                 }
             ];
             
             // Start pre-quiz
             const startPreQuiz = (retryCount = 0) => {
                 console.log("startPreQuiz called, retryCount:", retryCount);
                 console.log("authInitialized:", AuthModule.authInitialized);
                 console.log("currentUser:", firebase.auth().currentUser);
                 
                 // Check if user is authenticated
                 if (!AuthModule.authInitialized) {
                     if (retryCount < 10) { // Max 10 retries (5 seconds)
                         console.log("Auth not initialized, waiting...");
                         // Wait for auth to initialize
                         setTimeout(() => {
                             startPreQuiz(retryCount + 1);
                         }, 500);
                         return;
                     } else {
                         console.log("Auth not initialized after 10 retries, proceeding anyway");
                     }
                 }
                 
                 if (!firebase.auth().currentUser) {
                     console.log("No current user, showing login modal");
                     UIModule.showToast('error', 'Sign in required', 'Please sign in to take the quiz.');
                     AuthModule.showLoginModal();
                     return;
                 }
                 
                 console.log("Starting pre-quiz");
                 // Hide pre-quiz introduction page
                 document.getElementById('prequizPage').style.display = 'none';
                 
                 currentQuiz = [...preQuizQuestions];
                 quizType = 'pre';
                 currentQuestion = 0;
                 score = 0;
                 selectedOption = null;
                 answerSubmitted = false;
                 showQuiz();
             };
             
             // Start post-quiz
             const startPostQuiz = () => {
                 // Check if user is authenticated
                 if (!AuthModule.authInitialized) {
                     // Wait for auth to initialize
                     setTimeout(() => {
                         startPostQuiz();
                     }, 500);
                     return;
                 }
                 
                 if (!firebase.auth().currentUser) {
                     UIModule.showToast('error', 'Sign in required', 'Please sign in to take the quiz.');
                     AuthModule.showLoginModal();
                     return;
                 }
                 
                 currentQuiz = [...postQuizQuestions];
                 quizType = 'post';
                 currentQuestion = 0;
                 score = 0;
                 selectedOption = null;
                 answerSubmitted = false;
                 
                 // Check if timer is enabled
                 const timerEnabled = document.getElementById('quizTimer').checked;
                 if (timerEnabled) {
                     timeRemaining = 900; // 15 minutes in seconds
                     document.getElementById('quizTimerContainer').style.display = 'block';
                     startQuizTimer();
                 } else {
                     document.getElementById('quizTimerContainer').style.display = 'none';
                 }
                 
                 showQuiz();
             };
             
             // Start quiz timer
             const startQuizTimer = () => {
                 updateTimerDisplay();
                 
                 quizTimer = setInterval(() => {
                     timeRemaining--;
                     updateTimerDisplay();
                     
                     if (timeRemaining <= 0) {
                         clearInterval(quizTimer);
                         // Time's up, show results
                         showResults();
                     }
                 }, 1000);
             };
             
             // Update timer display
             const updateTimerDisplay = () => {
                 const minutes = Math.floor(timeRemaining / 60);
                 const seconds = timeRemaining % 60;
                 const display = `${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
                 
                 const timerElement = document.getElementById('timerDisplay');
                 timerElement.textContent = display;
                 
                 // Add warning classes when time is running out
                 const timerContainer = document.getElementById('quizTimerContainer');
                 if (timeRemaining <= 60) { // Less than 1 minute
                     timerContainer.classList.add('danger');
                     timerContainer.classList.remove('warning');
                 } else if (timeRemaining <= 300) { // Less than 5 minutes
                     timerContainer.classList.add('warning');
                     timerContainer.classList.remove('danger');
                 }
             };
             
             // Show quiz modal
             const showQuiz = () => {
                 document.getElementById('quizModal').classList.add('active');
                 document.getElementById('quizModal').setAttribute('aria-hidden', 'false');
                 document.getElementById('quizProgress').style.display = 'block';
                 document.getElementById('quizContent').style.display = 'block';
                 document.getElementById('quizResults').style.display = 'none';
                 
                 document.getElementById('quizTitle').textContent = quizType === 'pre' ? 'Pre-Quiz' : 'Post-Quiz';
                 document.getElementById('currentQuestion').textContent = currentQuestion + 1;
                 document.getElementById('totalQuestions').textContent = currentQuiz.length;
                 document.getElementById('currentScore').textContent = score;
                 document.getElementById('progressFill').style.width = ((currentQuestion + 1) / currentQuiz.length * 100) + '%';
                 
                 loadQuestion();
             };
             
             // Load question
             const loadQuestion = () => {
                 const question = currentQuiz[currentQuestion];
                 document.getElementById('questionText').textContent = question.question;
                 
                 const optionsContainer = document.getElementById('optionsContainer');
                 optionsContainer.innerHTML = '';
                 
                 // Reset buttons and feedback
                 document.getElementById('submitButton').style.display = 'inline-flex';
                 document.getElementById('submitButton').disabled = true;
                 document.getElementById('nextButton').classList.add('hidden');
                 document.getElementById('feedback').classList.add('hidden');
                 answerSubmitted = false;
                 
                 // Load options based on question type
                 switch (question.type) {
                     case 'single':
                     case 'multiple':
                         loadMultipleChoiceQuestion(question, optionsContainer);
                         break;
                     case 'drag-drop':
                         loadDragDropQuestion(question, optionsContainer);
                         break;
                     case 'fill-blank':
                         loadFillBlankQuestion(question, optionsContainer);
                         break;
                     case 'matching':
                         loadMatchingQuestion(question, optionsContainer);
                         break;
                 }
                 
                 document.getElementById('prevButton').classList.toggle('hidden', currentQuestion === 0);
                 
                 selectedOption = null;
             };
             
             // Function to load multiple choice questions (single or multiple)
             const loadMultipleChoiceQuestion = (question, container) => {
                 question.options.forEach((option, index) => {
                     const optionDiv = document.createElement('div');
                     optionDiv.className = 'quiz-option';
                     optionDiv.dataset.index = index;
                     optionDiv.setAttribute('role', 'option');
                     
                     const input = document.createElement('input');
                     input.type = question.type === 'single' ? 'radio' : 'checkbox';
                     input.name = 'quiz-option';
                     input.id = `option-${index}`;
                     input.value = index;
                     
                     const label = document.createElement('label');
                     label.htmlFor = `option-${index}`;
                     label.textContent = option;
                     
                     optionDiv.appendChild(input);
                     optionDiv.appendChild(label);
                     
                     optionDiv.onclick = () => selectOption(index, question.type);
                     container.appendChild(optionDiv);
                 });
             };
             
             // Function to load drag and drop questions
             const loadDragDropQuestion = (question, container) => {
                 const dragItemsContainer = document.createElement('div');
                 dragItemsContainer.className = 'drag-items-container mb-4';
                 
                 question.dragItems.forEach((item, index) => {
                     const dragItem = document.createElement('div');
                     dragItem.className = 'drag-item';
                     dragItem.draggable = true;
                     dragItem.textContent = item;
                     dragItem.dataset.index = index;
                     dragItem.setAttribute('role', 'option');
                     dragItem.setAttribute('tabindex', '0');
                     
                     // Mouse events
                     dragItem.addEventListener('dragstart', handleDragStart);
                     dragItem.addEventListener('dragend', handleDragEnd);
                     
                     // Touch events
                     dragItem.addEventListener('touchstart', handleTouchStart, { passive: false });
                     dragItem.addEventListener('touchmove', handleTouchMove, { passive: false });
                     dragItem.addEventListener('touchend', handleTouchEnd);
                     
                     // Keyboard events
                     dragItem.addEventListener('keydown', (e) => {
                         if (e.key === 'Enter' || e.key === ' ') {
                             e.preventDefault();
                             handleDragStart({ target: dragItem, dataTransfer: { setData: () => {} } });
                         }
                     });
                     
                     dragItemsContainer.appendChild(dragItem);
                 });
                 
                 const dropTargetsContainer = document.createElement('div');
                 dropTargetsContainer.className = 'drop-targets-container';
                 
                 question.dropTargets.forEach((target, index) => {
                     const dropTarget = document.createElement('div');
                     dropTarget.className = 'drop-target';
                     dropTarget.textContent = target;
                     dropTarget.dataset.index = index;
                     dropTarget.setAttribute('role', 'option');
                     dropTarget.setAttribute('tabindex', '0');
                     
                     // Mouse events
                     dropTarget.addEventListener('dragover', handleDragOver);
                     dropTarget.addEventListener('drop', handleDrop);
                     
                     // Touch events
                     dropTarget.addEventListener('touchmove', handleTouchMove, { passive: false });
                     dropTarget.addEventListener('touchend', handleTouchEnd);
                     
                     dropTargetsContainer.appendChild(dropTarget);
                 });
                 
                 container.appendChild(dragItemsContainer);
                 container.appendChild(dropTargetsContainer);
                 
                 // Create a mapping object to store user's answers
                 window.dragDropAnswers = {};
             };
             
             // Function to load fill in the blank questions
             const loadFillBlankQuestion = (question, container) => {
                 const blankContainer = document.createElement('div');
                 blankContainer.className = 'blank-container';
                 
                 // Split the question by blanks
                 const parts = question.question.split('____');
                 
                 parts.forEach((part, index) => {
                     if (part) {
                         const textSpan = document.createElement('span');
                         textSpan.textContent = part;
                         blankContainer.appendChild(textSpan);
                     }
                     
                     // Add input field for each blank except the last one
                     if (index < parts.length - 1) {
                         const input = document.createElement('input');
                         input.type = 'text';
                         input.className = 'blank-input';
                         input.dataset.blankIndex = index;
                         input.setAttribute('aria-label', `Blank ${index + 1}`);
                         input.addEventListener('input', () => {
                             // Check if any blank has content
                             const blankInputs = document.querySelectorAll('.blank-input');
                             const hasContent = Array.from(blankInputs).some(input => input.value.trim() !== '');
                             
                             // Enable submit button if at least one blank has content
                             document.getElementById('submitButton').disabled = !hasContent;
                         });
                         blankContainer.appendChild(input);
                     }
                 });
                 
                 container.appendChild(blankContainer);
                 
                 // Create an array to store user's answers
                 window.fillBlankAnswers = [];
             };
             
             // Function to load matching questions
             const loadMatchingQuestion = (question, container) => {
                 const matchingContainer = document.createElement('div');
                 matchingContainer.className = 'matching-container';
                 
                 const leftColumn = document.createElement('div');
                 leftColumn.className = 'matching-column';
                 
                 const rightColumn = document.createElement('div');
                 rightColumn.className = 'matching-column';
                 
                 question.pairs.forEach((pair, index) => {
                     const leftItem = document.createElement('div');
                     leftItem.className = 'matching-item';
                     leftItem.textContent = pair.left;
                     leftItem.dataset.index = index;
                     leftItem.setAttribute('role', 'option');
                     leftItem.setAttribute('tabindex', '0');
                     leftColumn.appendChild(leftItem);
                     
                     const rightItem = document.createElement('div');
                     rightItem.className = 'matching-item';
                     rightItem.textContent = pair.right;
                     rightItem.dataset.index = index;
                     rightItem.setAttribute('role', 'option');
                     rightItem.setAttribute('tabindex', '0');
                     rightColumn.appendChild(rightItem);
                 });
                 
                 matchingContainer.appendChild(leftColumn);
                 matchingContainer.appendChild(rightColumn);
                 container.appendChild(matchingContainer);
                 
                 // Create an array to store user's matches
                 window.matchingAnswers = [];
                 
                 // Add event listeners for matching
                 const leftItems = leftColumn.querySelectorAll('.matching-item');
                 const rightItems = rightColumn.querySelectorAll('.matching-item');
                 
                 leftItems.forEach(item => {
                     item.addEventListener('click', () => handleMatchingSelect(item, 'left'));
                     item.addEventListener('keydown', (e) => {
                         if (e.key === 'Enter' || e.key === ' ') {
                             e.preventDefault();
                             handleMatchingSelect(item, 'left');
                         }
                     });
                 });
                 
                 rightItems.forEach(item => {
                     item.addEventListener('click', () => handleMatchingSelect(item, 'right'));
                     item.addEventListener('keydown', (e) => {
                         if (e.key === 'Enter' || e.key === ' ') {
                             e.preventDefault();
                             handleMatchingSelect(item, 'right');
                         }
                     });
                 });
             };
             
             // Touch handling for drag and drop
             let touchItem = null;
             
             const handleTouchStart = (e) => {
                 touchItem = e.target;
                 const touch = e.touches[0];
                 touchItem.initialX = touch.clientX;
                 touchItem.initialY = touch.clientY;
                 touchItem.style.opacity = '0.5';
                 e.preventDefault();
             };
             
             const handleTouchMove = (e) => {
                 if (!touchItem) return;
                 
                 const touch = e.touches[0];
                 const elementBelow = document.elementFromPoint(touch.clientX, touch.clientY);
                 
                 if (elementBelow && elementBelow.classList.contains('drop-target')) {
                     elementBelow.classList.add('drag-over');
                 }
                 
                 // Clean up drag-over class from other elements
                 document.querySelectorAll('.drop-target').forEach(el => {
                     if (el !== elementBelow) {
                         el.classList.remove('drag-over');
                     }
                 });
                 
                 e.preventDefault();
             };
             
             const handleTouchEnd = (e) => {
                 if (!touchItem) return;
                 
                 const touch = e.changedTouches[0];
                 const elementBelow = document.elementFromPoint(touch.clientX, touch.clientY);
                 
                 if (elementBelow && elementBelow.classList.contains('drop-target')) {
                     handleDrop({ 
                         target: elementBelow, 
                         dataTransfer: { getData: () => touchItem.dataset.index },
                         preventDefault: () => {}
                     });
                 }
                 
                 // Clean up visual states
                 touchItem.style.opacity = '';
                 document.querySelectorAll('.drag-over').forEach(el => {
                     el.classList.remove('drag-over');
                 });
                 
                 touchItem = null;
             };
             
             // Functions to handle drag and drop
             const handleDragStart = (e) => {
                 e.dataTransfer.setData('text/plain', e.target.dataset.index);
                 e.target.classList.add('dragging');
             };
             
             const handleDragEnd = (e) => {
                 e.target.classList.remove('dragging');
             };
             
             const handleDragOver = (e) => {
                 e.preventDefault();
                 e.target.classList.add('drag-over');
             };
             
             const handleDrop = (e) => {
                 e.preventDefault();
                 e.target.classList.remove('drag-over');
                 
                 const draggedIndex = e.dataTransfer.getData('text/plain');
                 const targetIndex = e.target.dataset.index;
                 
                 // Store the mapping
                 window.dragDropAnswers[draggedIndex] = targetIndex;
                 
                 // Visual feedback
                 e.target.textContent = currentQuiz[currentQuestion].dragItems[draggedIndex] + ' → ' + 
                           currentQuiz[currentQuestion].dropTargets[targetIndex];
                 
                 // Enable submit button
                 document.getElementById('submitButton').disabled = false;
             };
             
             // Function to handle matching selection
             let selectedMatchingItem = null;
             
             const handleMatchingSelect = (item, column) => {
                 if (selectedMatchingItem === null) {
                     // First selection
                     selectedMatchingItem = { item, column };
                     item.classList.add('selected');
                 } else if (selectedMatchingItem.column === column) {
                     // Deselect if clicking same item
                     selectedMatchingItem.item.classList.remove('selected');
                     selectedMatchingItem = null;
                     
                     // Disable submit button if no matches
                     document.getElementById('submitButton').disabled = true;
                 } else {
                     // Match items
                     const firstIndex = parseInt(selectedMatchingItem.item.dataset.index);
                     const secondIndex = parseInt(item.dataset.index);
                     
                     // Store the match
                     window.matchingAnswers[firstIndex] = secondIndex;
                     
                     // Visual feedback
                     selectedMatchingItem.item.classList.remove('selected');
                     selectedMatchingItem.item.classList.add('matched');
                     item.classList.add('matched');
                     
                     selectedMatchingItem = null;
                     
                     // Enable submit button
                     document.getElementById('submitButton').disabled = false;
                 }
             };
             
             // Updated selectOption function to handle multiple selection
             const selectOption = (index, type) => {
                 if (answerSubmitted) return;
                 
                 const options = document.querySelectorAll('.quiz-option');
                 
                 if (type === 'single') {
                     // Remove previous selection
                     options.forEach(option => {
                         option.classList.remove('selected');
                         const input = option.querySelector('input');
                         if (input) input.checked = false;
                     });
                     
                     // Add selection to clicked option
                     options[index].classList.add('selected');
                     const input = options[index].querySelector('input');
                     if (input) input.checked = true;
                     
                     selectedOption = index;
                 } else {
                     // Multiple selection
                     const input = options[index].querySelector('input');
                     input.checked = !input.checked;
                     
                     if (input.checked) {
                         options[index].classList.add('selected');
                         if (!selectedOption) selectedOption = [];
                         selectedOption.push(index);
                     } else {
                         options[index].classList.remove('selected');
                         if (selectedOption && selectedOption.includes(index)) {
                             selectedOption = selectedOption.filter(i => i !== index);
                             if (selectedOption.length === 0) selectedOption = null;
                         }
                     }
                 }
                 
                 // Enable submit button
                 document.getElementById('submitButton').disabled = false;
             };
             
             // Updated submitAnswer function to handle different question types
             const submitAnswer = () => {
                 if (answerSubmitted) return;
                 
                 // Check if button is disabled
                 if (document.getElementById('submitButton').disabled) {
                     UIModule.showToast('error', 'Incomplete Answer', 'Please provide an answer before submitting.');
                     return;
                 }
                 
                 const question = currentQuiz[currentQuestion];
                 let isCorrect = false;
                 const feedback = document.getElementById('feedback');
                 
                 switch (question.type) {
                     case 'single':
                         isCorrect = selectedOption === question.correct;
                         break;
                     case 'multiple':
                         if (!selectedOption || !Array.isArray(selectedOption)) {
                             isCorrect = false;
                         } else {
                             // Check if all selected options are correct and all correct options are selected
                             const correctSet = new Set(question.correct);
                             const selectedSet = new Set(selectedOption);
                             isCorrect = selectedOption.length === question.correct.length && 
                                          selectedOption.every(opt => correctSet.has(opt));
                         }
                         break;
                     case 'drag-drop':
                         // Check if all drag items are correctly matched
                         isCorrect = Object.keys(window.dragDropAnswers).length === question.dragItems.length &&
                                      Object.entries(window.dragDropAnswers).every(([dragIndex, dropIndex]) => {
                                          const dragItem = question.dragItems[dragIndex];
                                          const dropTarget = question.dropTargets[dropIndex];
                                          return question.correct[dragItem] === dropTarget;
                                      });
                         break;
                     case 'fill-blank':
                         // Check if all blanks are filled correctly
                         const blankInputs = document.querySelectorAll('.blank-input');
                         isCorrect = Array.from(blankInputs).every((input, index) => {
                             const userAnswer = input.value.trim().toLowerCase();
                             const correctAnswers = Array.isArray(question.correct) ? 
                                 question.correct.map(a => a.toLowerCase()) : 
                                 [question.correct.toLowerCase()];
                             return correctAnswers.includes(userAnswer);
                         });
                         break;
                     case 'matching':
                         // Check if all matches are correct
                         isCorrect = window.matchingAnswers.length === question.pairs.length &&
                                      window.matchingAnswers.every((rightIndex, leftIndex) => {
                                          return leftIndex === rightIndex; // Assuming correct pairs are in order
                                      });
                         break;
                 }
                 
                 if (isCorrect) {
                     feedback.className = 'mb-4 p-3 rounded-lg bg-green-100 text-green-800 text-sm';
                     feedback.textContent = 'Correct! ' + question.explanation;
                     score++;
                     
                     // Award points
                     AuthModule.awardPoints(10, 'Correct answer');
                 } else {
                     feedback.className = 'mb-4 p-3 rounded-lg bg-red-100 text-red-800 text-sm';
                     feedback.textContent = 'Incorrect. ' + question.explanation;
                 }
                 
                 feedback.classList.remove('hidden');
                 document.getElementById('submitButton').style.display = 'none';
                 document.getElementById('nextButton').classList.remove('hidden');
                 document.getElementById('currentScore').textContent = score;
                 
                 // Mark answer as submitted
                 answerSubmitted = true;
                 
                 // Show correct answers for visual feedback
                 if (question.type === 'single' || question.type === 'multiple') {
                     const options = document.querySelectorAll('.quiz-option');
                     
                     if (question.type === 'single') {
                         options[question.correct].classList.add('correct');
                         if (selectedOption !== null && selectedOption !== question.correct) {
                             options[selectedOption].classList.add('incorrect');
                         }
                     } else {
                         question.correct.forEach(correctIndex => {
                             options[correctIndex].classList.add('correct');
                         });
                         
                         if (selectedOption && Array.isArray(selectedOption)) {
                             selectedOption.forEach(selectedIndex => {
                                 if (!question.correct.includes(selectedIndex)) {
                                     options[selectedIndex].classList.add('incorrect');
                                 }
                             });
                         }
                     }
                 }
             };
             
             // Next question
             const nextQuestion = () => {
                 currentQuestion++;
                 
                 if (currentQuestion >= currentQuiz.length) {
                     showResults();
                     return;
                 }
                 
                 document.getElementById('currentQuestion').textContent = currentQuestion + 1;
                 document.getElementById('progressFill').style.width = ((currentQuestion + 1) / currentQuiz.length * 100) + '%';
                 loadQuestion();
             };
             
             // Previous question
             const previousQuestion = () => {
                 if (currentQuestion > 0) {
                     currentQuestion--;
                     document.getElementById('currentQuestion').textContent = currentQuestion + 1;
                     document.getElementById('progressFill').style.width = ((currentQuestion + 1) / currentQuiz.length * 100) + '%';
                     loadQuestion();
                 }
             };
             
             // Show quiz results
             const showResults = () => {
                 // Clear timer if it's running
                 if (quizTimer) {
                     clearInterval(quizTimer);
                     quizTimer = null;
                 }
                 
                 document.getElementById('quizProgress').style.display = 'none';
                 document.getElementById('quizContent').style.display = 'none';
                 document.getElementById('quizResults').style.display = 'block';
                 
                 const percentage = Math.round((score / currentQuiz.length) * 100);
                 document.getElementById('finalScore').textContent = `${score}/${currentQuiz.length}`;
                 
                 let message = '';
                 if (percentage >= 80) {
                     message = 'Excellent! You have a strong understanding of Group 1 elements.';
                 } else if (percentage >= 60) {
                     message = 'Good job! You have a solid foundation to build upon.';
                 } else if (percentage >= 40) {
                     message = 'Not bad! Pay attention to the learning materials to improve.';
                 } else {
                     message = 'Keep practicing! Review the materials carefully.';
                 }
                 
                 document.getElementById('scoreMessage').textContent = message;
                 
                 // Save quiz result
                 saveQuizResult(score, currentQuiz.length, quizType);
                 
                 // Show appropriate actions
                 if (quizType === 'pre') {
                     document.getElementById('postQuizActions').style.display = 'block';
                     document.getElementById('finalActions').style.display = 'none';
                 } else {
                     document.getElementById('postQuizActions').style.display = 'none';
                     document.getElementById('finalActions').style.display = 'block';
                 }
             };
             
             // Complete pre-quiz and unlock main content
             const completePreQuiz = () => {
                 // Check if user is authenticated
                 if (!AuthModule.authInitialized) {
                     // Wait for auth to initialize
                     setTimeout(() => {
                         completePreQuiz();
                     }, 500);
                     return;
                 }
                 
                 const user = firebase.auth().currentUser;
                 if (!user) {
                     UIModule.showToast('error', 'Sign in required', 'Please sign in to complete the quiz.');
                     AuthModule.showLoginModal();
                     return;
                 }
                 
                 const userRef = firebase.database().ref('users/' + user.uid);
                 
                 userRef.update({
                     preQuizCompleted: true,
                     preQuizScore: score,
                     preQuizDate: firebase.database.ServerValue.TIMESTAMP
                 }).then(() => {
                     AuthModule.userData.preQuizCompleted = true;
                     AuthModule.userData.preQuizScore = score;
                     
                     // Award points for completing pre-quiz
                     AuthModule.awardPoints(50, 'Completed pre-quiz');
                     
                     // Close quiz modal
                     closeQuiz();
                     
                     // Show main app
                     AuthModule.showMainApp();
                     
                     UIModule.showToast('success', 'Pre-Quiz Complete!', 'You can now access the learning materials.');
                 }).catch((error) => {
                     console.error("Error updating pre-quiz status:", error);
                     UIModule.showToast('error', 'Error', 'Failed to save pre-quiz results.');
                 });
             };
             
             // Save quiz result
             const saveQuizResult = (score, totalQuestions, quizType) => {
                 const resultsRef = firebase.database().ref('quizResults').push();
                 
                 resultsRef.set({
                     userId: firebase.auth().currentUser.uid,
                     userName: AuthModule.userData.displayName,
                     score: score,
                     totalQuestions: totalQuestions,
                     percentage: Math.round((score / totalQuestions) * 100),
                     quizType: quizType,
                     topic: 'Group 1 - Alkali Metals',
                     createdAt: firebase.database.ServerValue.TIMESTAMP
                 }).catch((error) => {
                     console.error("Error saving quiz result:", error);
                 });
             };
             
             // Close quiz
             const closeQuiz = () => {
                 // Clear timer if it's running
                 if (quizTimer) {
                     clearInterval(quizTimer);
                     quizTimer = null;
                 }
                 
                 document.getElementById('quizModal').classList.remove('active');
                 document.getElementById('quizModal').setAttribute('aria-hidden', 'true');
                 
                 // If user hasn't completed pre-quiz, show pre-quiz introduction
                 if (firebase.auth().currentUser && AuthModule.userData && !AuthModule.userData.preQuizCompleted) {
                     AuthModule.showPreQuizIntroduction();
                 }
             };
             
             return {
                 startPreQuiz,
                 startPostQuiz,
                 nextQuestion,
                 previousQuestion,
                 completePreQuiz,
                 closeQuiz,
                 submitAnswer,
                 selectOption
             };
         })();
         
         // Study Group Module
         const StudyGroupModule = (() => {
             // Load study groups
             const loadStudyGroups = () => {
                 const container = document.getElementById('studyGroupsContainer');
                 container.innerHTML = '<div class="spinner"></div>';
                 
                 const groupsRef = firebase.database().ref('studyGroups');
                 groupsRef.orderByChild('createdAt').once('value').then((snapshot) => {
                     container.innerHTML = '';
                     
                     if (!snapshot.exists()) {
                         container.innerHTML = `
                             <div class="empty-state">
                                 <div class="empty-state-icon" aria-hidden="true">
                                     <i class="fas fa-users"></i>
                                 </div>
                                 <h3 class="empty-state-title">No Study Groups Yet</h3>
                                 <p class="empty-state-description">Create your first study group to collaborate with peers on mastering Group 1 Alkali Metals.</p>
                             </div>`;
                         return;
                     }
                     
                     const groupsArray = [];
                     snapshot.forEach((childSnapshot) => {
                         groupsArray.push({
                             id: childSnapshot.key,
                             ...childSnapshot.val()
                         });
                     });
                     
                     // Sort by creation date (newest first)
                     groupsArray.sort((a, b) => {
                         return new Date(b.createdAt) - new Date(a.createdAt);
                     });
                     
                     groupsArray.forEach(group => {
                         const groupCard = createStudyGroupCard(group);
                         container.appendChild(groupCard);
                     });
                 }, (error) => {
                     console.error("Error loading study groups:", error);
                     container.innerHTML = '<p class="text-gray-500 text-center">Error loading study groups.</p>';
                 });
             };
             
             // Create study group card
             const createStudyGroupCard = (group) => {
                 const card = document.createElement('div');
                 card.className = 'study-group-card';
                 
                 const isMember = firebase.auth().currentUser && group.members && group.members.includes(firebase.auth().currentUser.uid);
                 const memberCount = group.members ? group.members.length : 0;
                 const maxMembers = group.maxMembers || 10;
                 const isFull = memberCount >= maxMembers;
                 
                 // Format creation date
                 const createdDate = group.createdAt ? new Date(group.createdAt) : new Date();
                 const formattedDate = Utils.formatDate(createdDate);
                 
                 card.innerHTML = `
                     <div class="flex justify-between items-start mb-3">
                         <div>
                             <h4 class="font-bold text-lg text-gray-800">${group.name}</h4>
                             <p class="text-sm text-gray-600">Created by ${group.creatorName}</p>
                         </div>
                         <button onclick="${isMember ? 'leaveStudyGroup' : 'joinStudyGroup'}('${group.id}')"
                                 class="btn ${isMember ? 'btn-danger' : 'btn-primary'} text-sm"
                                 ${isFull && !isMember ? 'disabled' : ''}>
                             ${isMember ? 'Leave' : isFull ? 'Full' : 'Join'}
                         </button>
                     </div>
                     <p class="text-gray-700 mb-3">${group.description}</p>
                     <div class="flex justify-between items-center mb-3">
                         <div>
                             <span class="text-sm font-medium text-gray-700">Goal:</span>
                             <span class="text-sm text-gray-600">${group.goal}</span>
                         </div>
                         <div class="text-sm text-gray-600">
                             ${memberCount}/${maxMembers} members
                         </div>
                     </div>
                     <div class="flex items-center justify-between">
                         <div class="flex items-center">
                             <div class="flex -space-x-2">
                                 ${(group.members || []).slice(0, 5).map(member =>
                                     `<div class="member-avatar" title="${member}">${member.charAt(0).toUpperCase()}</div>`
                                 ).join('')}
                                 ${(memberCount || 0) > 5 ?
                                     `<div class="member-avatar">+${(memberCount || 0) - 5}</div>` : ''
                                 }
                             </div>
                         </div>
                         <div class="study-group-activity">
                             Created on ${formattedDate}
                         </div>
                     </div>
                     <div class="mt-3">
                         <button onclick="viewGroupDetails('${group.id}')" class="btn btn-secondary text-sm w-full">
                             <i class="fas fa-eye mr-1"></i>
                             View Details
                         </button>
                     </div>
                 `;
                 
                 return card;
             };
             
             // Show create study group modal
             const showCreateStudyGroup = () => {
                 // Check if user is authenticated
                 if (!AuthModule.authInitialized) {
                     // Wait for auth to initialize
                     setTimeout(() => {
                         showCreateStudyGroup();
                     }, 500);
                     return;
                 }
                 
                 if (!firebase.auth().currentUser) {
                     UIModule.showToast('error', 'Sign in required', 'Please sign in to create study groups.');
                     AuthModule.showLoginModal();
                     return;
                 }
                 
                 document.getElementById('createStudyGroupModal').classList.add('active');
                 document.getElementById('createStudyGroupModal').setAttribute('aria-hidden', 'false');
             };
             
             // Close create study group modal
             const closeCreateStudyGroup = () => {
                 document.getElementById('createStudyGroupModal').classList.remove('active');
                 document.getElementById('createStudyGroupModal').setAttribute('aria-hidden', 'true');
             };
             
             // Handle create study group form submission
             const handleCreateStudyGroup = (event) => {
                 event.preventDefault();
                 
                 // Check if user is authenticated
                 if (!AuthModule.authInitialized) {
                     // Wait for auth to initialize
                     setTimeout(() => {
                         handleCreateStudyGroup(event);
                     }, 500);
                     return;
                 }
                 
                 const user = firebase.auth().currentUser;
                 if (!user) {
                     UIModule.showToast('error', 'Sign in required', 'Please sign in to create study groups.');
                     AuthModule.showLoginModal();
                     return;
                 }
                 
                 const name = document.getElementById('groupName').value.trim();
                 const description = document.getElementById('groupDescription').value.trim();
                 const goal = document.getElementById('groupGoal').value.trim();
                 const maxMembers = parseInt(document.getElementById('groupMaxMembers').value);
                 
                 if (!name || !description || !goal) {
                     UIModule.showToast('error', 'Missing Fields', 'Please fill in all fields.');
                     return;
                 }
                 
                 UIModule.showLoading();
                 
                 const groupsRef = firebase.database().ref('studyGroups').push();
                 const newGroup = {
                     name: name,
                     description: description,
                     goal: goal,
                     maxMembers: maxMembers,
                     creatorId: user.uid,
                     creatorName: AuthModule.userData.displayName,
                     members: [user.uid],
                     memberCount: 1,
                     createdAt: firebase.database.ServerValue.TIMESTAMP,
                     lastActivity: firebase.database.ServerValue.TIMESTAMP,
                     // Initialize group progress tracking
                     groupProgress: {
                         overview: false,
                         elements: false,
                         properties: false,
                         reactions: false
                     }
                 };
                 
                 groupsRef.set(newGroup).then(() => {
                     UIModule.showToast('success', 'Group Created', 'Your study group has been created successfully.');
                     closeCreateStudyGroup();
                     document.getElementById('createStudyGroupForm').reset();
                     
                     // Award points
                     AuthModule.awardPoints(20, 'Created study group');
                 }).catch((error) => {
                     console.error("Error creating study group:", error);
                     UIModule.showToast('error', 'Error', 'Failed to create study group.');
                 }).finally(() => {
                     UIModule.hideLoading();
                 });
             };
             
             // Join study group
             const joinStudyGroup = (groupId) => {
                 // Check if user is authenticated
                 if (!AuthModule.authInitialized) {
                     // Wait for auth to initialize
                     setTimeout(() => {
                         joinStudyGroup(groupId);
                     }, 500);
                     return;
                 }
                 
                 const user = firebase.auth().currentUser;
                 if (!user) {
                     UIModule.showToast('error', 'Sign in required', 'Please sign in to join study groups.');
                     AuthModule.showLoginModal();
                     return;
                 }
                 
                 const groupRef = firebase.database().ref('studyGroups/' + groupId);
                 groupRef.once('value').then((snapshot) => {
                     const group = snapshot.val();
                     
                     if (!group) {
                         UIModule.showToast('error', 'Error', 'Study group not found.');
                         return;
                     }
                     
                     // Make sure members is an array
                     const members = Array.isArray(group.members) ? [...group.members] : [];
                     
                     if (members.includes(user.uid)) {
                         UIModule.showToast('info', 'Already Member', 'You are already a member of this group.');
                         return;
                     }
                     
                     if ((group.memberCount || 0) >= (group.maxMembers || 10)) {
                         UIModule.showToast('error', 'Group Full', 'This study group is already full.');
                         return;
                     }
                     
                     // Add current user to members array
                     members.push(user.uid);
                     
                     const updates = {};
                     updates['/members'] = members;
                     updates['/memberCount'] = (group.memberCount || 0) + 1;
                     updates['/lastActivity'] = firebase.database.ServerValue.TIMESTAMP;
                     
                     groupRef.update(updates).then(() => {
                         UIModule.showToast('success', 'Joined Group', 'You have successfully joined the study group.');
                         
                         // Award points
                         AuthModule.awardPoints(10, 'Joined study group');
                         
                         // Send a welcome message to the group
                         sendGroupMessage(groupId, `${AuthModule.userData.displayName} joined the group!`);
                     }).catch((error) => {
                         console.error("Error joining study group:", error);
                         UIModule.showToast('error', 'Error', 'Failed to join study group.');
                     });
                 }).catch((error) => {
                     console.error("Error getting study group:", error);
                     UIModule.showToast('error', 'Error', 'Failed to join study group.');
                 });
             };
             
             // Leave study group
             const leaveStudyGroup = (groupId) => {
                 // Check if user is authenticated
                 if (!AuthModule.authInitialized) {
                     // Wait for auth to initialize
                     setTimeout(() => {
                         leaveStudyGroup(groupId);
                     }, 500);
                     return;
                 }
                 
                 const user = firebase.auth().currentUser;
                 if (!user) {
                     UIModule.showToast('error', 'Sign in required', 'Please sign in to leave study groups.');
                     AuthModule.showLoginModal();
                     return;
                 }
                 
                 const groupRef = firebase.database().ref('studyGroups/' + groupId);
                 groupRef.once('value').then((snapshot) => {
                     const group = snapshot.val();
                     
                     // Make sure members is an array
                     const members = Array.isArray(group.members) ? [...group.members] : [];
                     
                     // Filter out current user
                     const updatedMembers = members.filter(member => member !== user.uid);
                     
                     const updates = {};
                     updates['/members'] = updatedMembers;
                     updates['/memberCount'] = Math.max(0, (group.memberCount || 0) - 1);
                     updates['/lastActivity'] = firebase.database.ServerValue.TIMESTAMP;
                     
                     groupRef.update(updates).then(() => {
                         UIModule.showToast('success', 'Left Group', 'You have successfully left the study group.');
                         
                         // Send a goodbye message to the group
                         sendGroupMessage(groupId, `${AuthModule.userData.displayName} left the group.`);
                     }).catch((error) => {
                         console.error("Error leaving study group:", error);
                         UIModule.showToast('error', 'Error', 'Failed to leave study group.');
                     });
                 }).catch((error) => {
                     console.error("Error getting study group:", error);
                     UIModule.showToast('error', 'Error', 'Failed to leave study group.');
                 });
             };
             
             // View group details
             const viewGroupDetails = (groupId) => {
                 // Check if user is authenticated
                 if (!AuthModule.authInitialized) {
                     // Wait for auth to initialize
                     setTimeout(() => {
                         viewGroupDetails(groupId);
                     }, 500);
                     return;
                 }
                 
                 const user = firebase.auth().currentUser;
                 if (!user) {
                     UIModule.showToast('error', 'Sign in required', 'Please sign in to view group details.');
                     AuthModule.showLoginModal();
                     return;
                 }
                 
                 currentGroupId = groupId;
                 const groupRef = firebase.database().ref('studyGroups/' + groupId);
                 groupRef.once('value').then((snapshot) => {
                     const group = snapshot.val();
                     
                     if (!group) {
                         UIModule.showToast('error', 'Error', 'Study group not found.');
                         return;
                     }
                     
                     // Populate group details
                     document.getElementById('groupDetailTitle').textContent = group.name;
                     document.getElementById('groupDetailDescription').textContent = group.description;
                     document.getElementById('groupDetailGoal').textContent = group.goal;
                     
                     // Populate members list
                     const membersContainer = document.getElementById('groupDetailMembers');
                     membersContainer.innerHTML = '';
                     
                     if (group.members && group.members.length > 0) {
                         const membersList = document.createElement('div');
                         membersList.className = 'flex flex-wrap gap-2';
                         
                         group.members.forEach(memberId => {
                             const memberBadge = document.createElement('div');
                             memberBadge.className = 'bg-indigo-100 text-indigo-800 px-3 py-1 rounded-full text-sm';
                             memberBadge.textContent = memberId === user.uid ? 'You' : `Member ${memberId.charAt(0).toUpperCase()}`;
                             membersList.appendChild(memberBadge);
                         });
                         
                         membersContainer.appendChild(membersList);
                     } else {
                         membersContainer.innerHTML = '<p class="text-gray-500 text-sm">No members yet.</p>';
                     }
                     
                     // Calculate and display group progress
                     const groupProgress = group.groupProgress || {};
                     const completedSections = Object.keys(groupProgress).filter(section => groupProgress[section]).length;
                     const totalSections = Object.keys(groupProgress).length;
                     const progressPercentage = Math.round((completedSections / totalSections) * 100);
                     
                     document.getElementById('groupProgressFill').style.width = `${progressPercentage}%`;
                     document.getElementById('groupProgressText').textContent = `${progressPercentage}% completed`;
                     
                     // Load group messages
                     loadGroupMessages(groupId);
                     
                     // Show modal
                     document.getElementById('groupDetailModal').classList.add('active');
                     document.getElementById('groupDetailModal').setAttribute('aria-hidden', 'false');
                 }).catch((error) => {
                     console.error("Error getting study group:", error);
                     UIModule.showToast('error', 'Error', 'Failed to load group details.');
                 });
             };
             
             // Close group detail modal
             const closeGroupDetail = () => {
                 document.getElementById('groupDetailModal').classList.remove('active');
                 document.getElementById('groupDetailModal').setAttribute('aria-hidden', 'true');
                 currentGroupId = null;
             };
             
             // Load group messages
             const loadGroupMessages = (groupId) => {
                 const container = document.getElementById('groupMessagesContainer');
                 container.innerHTML = '<div class="spinner"></div>';
                 
                 const messagesRef = firebase.database().ref('groupMessages').orderByChild('groupId').equalTo(groupId);
                 messagesRef.on('value', (snapshot) => {
                     container.innerHTML = '';
                     
                     if (!snapshot.exists()) {
                         container.innerHTML = `
                             <div class="empty-state">
                                 <div class="empty-state-icon" aria-hidden="true">
                                     <i class="fas fa-comments"></i>
                                 </div>
                                 <h3 class="empty-state-title">No Messages Yet</h3>
                                 <p class="empty-state-description">Start a conversation with your group members.</p>
                             </div>`;
                         return;
                     }
                     
                     const messagesArray = [];
                     snapshot.forEach((childSnapshot) => {
                         messagesArray.push({
                             id: childSnapshot.key,
                             ...childSnapshot.val()
                         });
                     });
                     
                     // Sort by creation date (oldest first for chat-like experience)
                     messagesArray.sort((a, b) => {
                         return new Date(a.createdAt) - new Date(b.createdAt);
                     });
                     
                     messagesArray.forEach(message => {
                         const messageDiv = createGroupMessageElement(message);
                         container.appendChild(messageDiv);
                     });
                     
                     // Scroll to bottom
                     container.scrollTop = container.scrollHeight;
                 }, (error) => {
                     console.error("Error loading group messages:", error);
                     container.innerHTML = '<p class="text-gray-500 text-center">Error loading messages.</p>';
                 });
             };
             
             // Create group message element
             const createGroupMessageElement = (message) => {
                 const messageDiv = document.createElement('div');
                 messageDiv.className = 'group-message';
                 
                 const date = message.createdAt ? new Date(message.createdAt) : new Date();
                 const formattedDate = Utils.formatDate(date);
                 const formattedTime = Utils.formatTime(date);
                 const isAuthor = firebase.auth().currentUser && message.authorId === firebase.auth().currentUser.uid;
                 
                 messageDiv.innerHTML = `
                     <div class="group-message-author">
                         <div class="group-message-avatar">${message.authorName ? message.authorName.charAt(0).toUpperCase() : 'A'}</div>
                         ${message.authorName || 'Anonymous'}
                         ${isAuthor ? '<span style="font-size: 0.75rem; color: #6b7280; margin-left: 0.5rem;">(You)</span>' : ''}
                     </div>
                     <div class="group-message-text">${message.text}</div>
                     <div class="group-message-time">${formattedDate} at ${formattedTime}</div>
                     <div class="vote-container">
                         <button class="vote-button ${message.votes && message.votes[firebase.auth().currentUser?.uid] ? 'voted' : ''}" 
                                 onclick="toggleGroupMessageVote('${message.id}', 'up')"
                                 aria-label="Upvote message">
                             <i class="fas fa-thumbs-up vote-icon"></i>
                             <span class="vote-count">${message.upvotes || 0}</span>
                         </button>
                         <button class="vote-button ${message.votes && message.votes[firebase.auth().currentUser?.uid] === false ? 'voted' : ''}" 
                                 onclick="toggleGroupMessageVote('${message.id}', 'down')"
                                 aria-label="Downvote message">
                             <i class="fas fa-thumbs-down vote-icon"></i>
                             <span class="vote-count">${message.downvotes || 0}</span>
                         </button>
                     </div>
                 `;
                 
                 return messageDiv;
             };
             
             // Handle group message form submission
             const handleGroupMessage = (event) => {
                 event.preventDefault();
                 
                 // Check if user is authenticated
                 if (!AuthModule.authInitialized) {
                     // Wait for auth to initialize
                     setTimeout(() => {
                         handleGroupMessage(event);
                     }, 500);
                     return;
                 }
                 
                 const user = firebase.auth().currentUser;
                 if (!user) {
                     UIModule.showToast('error', 'Sign in required', 'Please sign in to send messages.');
                     AuthModule.showLoginModal();
                     return;
                 }
                 
                 const messageInput = document.getElementById('groupMessageInput');
                 const messageText = messageInput.value.trim();
                 
                 if (!messageText) {
                     UIModule.showToast('error', 'Empty Message', 'Please enter a message before sending.');
                     return;
                 }
                 
                 UIModule.showLoading();
                 
                 const messagesRef = firebase.database().ref('groupMessages').push();
                 const newMessage = {
                     groupId: currentGroupId,
                     authorId: user.uid,
                     authorName: AuthModule.userData.displayName,
                     text: messageText,
                     upvotes: 0,
                     downvotes: 0,
                     votes: {},
                     createdAt: firebase.database.ServerValue.TIMESTAMP
                 };
                 
                 messagesRef.set(newMessage).then(() => {
                     // Clear input
                     messageInput.value = '';
                     
                     // Update group last activity
                     const groupRef = firebase.database().ref('studyGroups/' + currentGroupId);
                     groupRef.update({
                         lastActivity: firebase.database.ServerValue.TIMESTAMP
                     });
                     
                     // Award points for user messages (not system messages)
                     AuthModule.awardPoints(2, 'Group message');
                 }).catch((error) => {
                     console.error("Error sending group message:", error);
                     UIModule.showToast('error', 'Error', 'Failed to send message.');
                 }).finally(() => {
                     UIModule.hideLoading();
                 });
             };
             
             // Send group message
             const sendGroupMessage = (groupId, messageText) => {
                 // Check if user is authenticated
                 if (!AuthModule.authInitialized) {
                     // Wait for auth to initialize
                     setTimeout(() => {
                         sendGroupMessage(groupId, messageText);
                     }, 500);
                     return;
                 }
                 
                 const user = firebase.auth().currentUser;
                 if (!user) {
                     UIModule.showToast('error', 'Sign in required', 'Please sign in to send messages.');
                     AuthModule.showLoginModal();
                     return;
                 }
                 
                 // If messageText is not provided, get it from the input
                 const text = messageText || document.getElementById('groupMessageInput').value.trim();
                 if (!text) {
                     UIModule.showToast('error', 'Empty Message', 'Please enter a message before sending.');
                     return;
                 }
                 
                 UIModule.showLoading();
                 
                 const messagesRef = firebase.database().ref('groupMessages').push();
                 const newMessage = {
                     groupId: groupId,
                     authorId: user.uid,
                     authorName: AuthModule.userData.displayName,
                     text: text,
                     upvotes: 0,
                     downvotes: 0,
                     votes: {},
                     createdAt: firebase.database.ServerValue.TIMESTAMP
                 };
                 
                 messagesRef.set(newMessage).then(() => {
                     // Clear input if it was from the form
                     if (!messageText) {
                         document.getElementById('groupMessageInput').value = '';
                     }
                     
                     // Update group last activity
                     const groupRef = firebase.database().ref('studyGroups/' + groupId);
                     groupRef.update({
                         lastActivity: firebase.database.ServerValue.TIMESTAMP
                     });
                     
                     // Award points for user messages (not system messages)
                     if (!messageText) {
                         AuthModule.awardPoints(2, 'Group message');
                     }
                 }).catch((error) => {
                     console.error("Error sending group message:", error);
                     UIModule.showToast('error', 'Error', 'Failed to send message.');
                 }).finally(() => {
                     UIModule.hideLoading();
                 });
             };
             
             // Toggle group message vote
             const toggleGroupMessageVote = (messageId, voteType) => {
                 // Check if user is authenticated
                 if (!AuthModule.authInitialized) {
                     // Wait for auth to initialize
                     setTimeout(() => {
                         toggleGroupMessageVote(messageId, voteType);
                     }, 500);
                     return;
                 }
                 
                 const user = firebase.auth().currentUser;
                 if (!user) {
                     UIModule.showToast('error', 'Sign in required', 'Please sign in to vote on messages.');
                     AuthModule.showLoginModal();
                     return;
                 }
                 
                 const messageRef = firebase.database().ref('groupMessages/' + messageId);
                 messageRef.once('value').then((snapshot) => {
                     const message = snapshot.val();
                     
                     if (!message) {
                         UIModule.showToast('error', 'Error', 'Message not found.');
                         return;
                     }
                     
                     // Get current votes
                     const votes = message.votes || {};
                     const currentVote = votes[user.uid];
                     const upvotes = message.upvotes || 0;
                     const downvotes = message.downvotes || 0;
                     
                     let newUpvotes = upvotes;
                     let newDownvotes = downvotes;
                     let newVotes = { ...votes };
                     
                     if (voteType === 'up') {
                         if (currentVote === true) {
                             // Remove upvote
                             delete newVotes[user.uid];
                             newUpvotes = Math.max(0, upvotes - 1);
                         } else {
                             // Add or change to upvote
                             newVotes[user.uid] = true;
                             newUpvotes = upvotes + 1;
                             if (currentVote === false) {
                                 // Was downvoted before
                                 newDownvotes = Math.max(0, downvotes - 1);
                             }
                         }
                     } else { // voteType === 'down'
                         if (currentVote === false) {
                             // Remove downvote
                             delete newVotes[user.uid];
                             newDownvotes = Math.max(0, downvotes - 1);
                         } else {
                             // Add or change to downvote
                             newVotes[user.uid] = false;
                             newDownvotes = downvotes + 1;
                             if (currentVote === true) {
                                 // Was upvoted before
                                 newUpvotes = Math.max(0, upvotes - 1);
                             }
                         }
                     }
                     
                     // Update the message
                     const updates = {};
                     updates['/upvotes'] = newUpvotes;
                     updates['/downvotes'] = newDownvotes;
                     updates['/votes'] = newVotes;
                     
                     messageRef.update(updates).then(() => {
                         // Update UI will be handled by the real-time listener
                     }).catch((error) => {
                         console.error("Error voting on group message:", error);
                         UIModule.showToast('error', 'Error', 'Failed to vote on message.');
                     });
                 }).catch((error) => {
                     console.error("Error getting group message:", error);
                     UIModule.showToast('error', 'Error', 'Failed to vote on message.');
                 });
             };
             
             // Update group progress when user completes a section
             const updateGroupProgress = () => {
                 // Check if user is authenticated
                 if (!AuthModule.authInitialized) {
                     // Wait for auth to initialize
                     setTimeout(() => {
                         updateGroupProgress();
                     }, 500);
                     return;
                 }
                 
                 const user = firebase.auth().currentUser;
                 if (!user || !AuthModule.userData) return;
                 
                 // Get user's completed sections
                 const completedSections = AuthModule.userData.completedSections || [];
                 if (completedSections.length === 0) return;
                 
                 // Get all groups the user is a member of
                 const groupsRef = firebase.database().ref('studyGroups');
                 groupsRef.once('value').then((snapshot) => {
                     if (!snapshot.exists()) return;
                     
                     const updates = {};
                     snapshot.forEach((childSnapshot) => {
                         const group = childSnapshot.val();
                         const groupId = childSnapshot.key;
                         
                         // Check if user is a member of this group
                         if (group.members && group.members.includes(user.uid)) {
                             // Get current group progress
                             const groupProgress = group.groupProgress || {};
                             let progressUpdated = false;
                             
                             // Update group progress based on user's completed sections
                             completedSections.forEach(section => {
                                 if (!groupProgress[section]) {
                                     groupProgress[section] = true;
                                     progressUpdated = true;
                                 }
                             });
                             
                             // If progress was updated, save it
                             if (progressUpdated) {
                                 updates[`/studyGroups/${groupId}/groupProgress`] = groupProgress;
                                 updates[`/studyGroups/${groupId}/lastActivity`] = firebase.database.ServerValue.TIMESTAMP;
                                 
                                 // Send a notification to the group
                                 const sectionName = section.charAt(0).toUpperCase() + section.slice(1);
                                 sendGroupMessage(groupId, `${AuthModule.userData.displayName} completed the ${sectionName} section!`);
                             }
                         }
                     });
                     
                     // Apply all updates
                     if (Object.keys(updates).length > 0) {
                         firebase.database().ref().update(updates).catch((error) => {
                             console.error("Error updating group progress:", error);
                         });
                     }
                 }).catch((error) => {
                     console.error("Error updating group progress:", error);
                 });
             };
             
             // Global variable for current group ID
             let currentGroupId = null;
             
             return {
                 loadStudyGroups,
                 showCreateStudyGroup,
                 closeCreateStudyGroup,
                 handleCreateStudyGroup,
                 joinStudyGroup,
                 leaveStudyGroup,
                 viewGroupDetails,
                 closeGroupDetail,
                 handleGroupMessage,
                 updateGroupProgress
             };
         })();
         
         // Discussion Module
         const DiscussionModule = (() => {
             // Load comments
             const loadComments = () => {
                 const container = document.getElementById('commentsContainer');
                 container.innerHTML = '<div class="spinner"></div>';
                 
                 const commentsRef = firebase.database().ref('comments');
                 commentsRef.orderByChild('createdAt').on('value', (snapshot) => {
                     container.innerHTML = '';
                     
                     if (!snapshot.exists()) {
                         container.innerHTML = `
                             <div class="empty-state">
                                 <div class="empty-state-icon" aria-hidden="true">
                                     <i class="fas fa-comments"></i>
                                 </div>
                                 <h3 class="empty-state-title">No Comments Yet</h3>
                                 <p class="empty-state-description">Be the first to share your thoughts about Group 1 Alkali Metals.</p>
                             </div>`;
                         return;
                     }
                     
                     const commentsArray = [];
                     snapshot.forEach((childSnapshot) => {
                         commentsArray.push({
                             id: childSnapshot.key,
                             ...childSnapshot.val()
                         });
                     });
                     
                     // Sort by creation date (newest first)
                     commentsArray.sort((a, b) => {
                         return new Date(b.createdAt) - new Date(a.createdAt);
                     });
                     
                     commentsArray.forEach(comment => {
                         const commentDiv = createCommentElement(comment);
                         container.appendChild(commentDiv);
                     });
                 }, (error) => {
                     console.error("Error loading comments:", error);
                     container.innerHTML = '<p class="text-gray-500 text-center">Error loading comments.</p>';
                 });
             };
             
             // Create comment element
             const createCommentElement = (comment) => {
                 const commentDiv = document.createElement('div');
                 commentDiv.className = 'comment';
                 
                 const date = comment.createdAt ? new Date(comment.createdAt) : new Date();
                 const formattedDate = Utils.formatDate(date);
                 const formattedTime = Utils.formatTime(date);
                 const isAuthor = firebase.auth().currentUser && comment.authorId === firebase.auth().currentUser.uid;
                 
                 commentDiv.innerHTML = `
                     <div class="comment-author">
                         <div class="comment-avatar">${comment.authorName ? comment.authorName.charAt(0).toUpperCase() : 'A'}</div>
                         ${comment.authorName || 'Anonymous'}
                         ${isAuthor ? '<span style="font-size: 0.75rem; color: #6b7280; margin-left: 0.5rem;">(You)</span>' : ''}
                     </div>
                     <div class="comment-time">${formattedDate} at ${formattedTime}</div>
                     <div class="comment-text">${comment.text}</div>
                     <div class="vote-container">
                         <button class="vote-button ${comment.votes && comment.votes[firebase.auth().currentUser?.uid] ? 'voted' : ''}" 
                                 onclick="toggleCommentVote('${comment.id}', 'up')"
                                 aria-label="Upvote comment">
                             <i class="fas fa-thumbs-up vote-icon"></i>
                             <span class="vote-count">${comment.upvotes || 0}</span>
                         </button>
                         <button class="vote-button ${comment.votes && comment.votes[firebase.auth().currentUser?.uid] === false ? 'voted' : ''}" 
                                 onclick="toggleCommentVote('${comment.id}', 'down')"
                                 aria-label="Downvote comment">
                             <i class="fas fa-thumbs-down vote-icon"></i>
                             <span class="vote-count">${comment.downvotes || 0}</span>
                         </button>
                         <button class="vote-button" onclick="toggleReplyForm('${comment.id}')" aria-label="Reply to comment">
                             <i class="fas fa-reply vote-icon"></i>
                             Reply
                         </button>
                     </div>
                     ${isAuthor ? `
                         <div class="comment-actions">
                             <div class="comment-action" onclick="deleteComment('${comment.id}')" title="Delete comment">
                                 <i class="fas fa-trash"></i>
                             </div>
                         </div>
                     ` : ''}
                     <div class="replies-container" id="replies-${comment.id}" style="display: none;">
                         <form class="reply-form" onsubmit="addReply(event, '${comment.id}')">
                             <input type="text" id="reply-input-${comment.id}" class="reply-input" placeholder="Write a reply..." aria-label="Write a reply">
                             <button type="submit" class="reply-submit">Reply</button>
                         </form>
                         <div id="replies-list-${comment.id}">
                             <!-- Replies will be loaded here -->
                         </div>
                     </div>
                 `;
                 
                 // Load replies for this comment
                 loadReplies(comment.id);
                 
                 return commentDiv;
             };
             
             // Load replies for a comment
             const loadReplies = (commentId) => {
                 const repliesContainer = document.getElementById(`replies-list-${commentId}`);
                 if (!repliesContainer) return;
                 
                 const repliesRef = firebase.database().ref('replies').orderByChild('commentId').equalTo(commentId);
                 repliesRef.on('value', (snapshot) => {
                     repliesContainer.innerHTML = '';
                     
                     if (!snapshot.exists()) return;
                     
                     const repliesArray = [];
                     snapshot.forEach((childSnapshot) => {
                         repliesArray.push({
                             id: childSnapshot.key,
                             ...childSnapshot.val()
                         });
                     });
                     
                     // Sort by creation date (oldest first)
                     repliesArray.sort((a, b) => {
                         return new Date(a.createdAt) - new Date(b.createdAt);
                     });
                     
                     repliesArray.forEach(reply => {
                         const replyDiv = createReplyElement(reply);
                         repliesContainer.appendChild(replyDiv);
                     });
                 });
             };
             
             // Create reply element
             const createReplyElement = (reply) => {
                 const replyDiv = document.createElement('div');
                 replyDiv.className = 'reply';
                 
                 const date = reply.createdAt ? new Date(reply.createdAt) : new Date();
                 const formattedDate = Utils.formatDate(date);
                 const formattedTime = Utils.formatTime(date);
                 const isAuthor = firebase.auth().currentUser && reply.authorId === firebase.auth().currentUser.uid;
                 
                 replyDiv.innerHTML = `
                     <div class="reply-author">
                         <div class="reply-avatar">${reply.authorName ? reply.authorName.charAt(0).toUpperCase() : 'A'}</div>
                         ${reply.authorName || 'Anonymous'}
                         ${isAuthor ? '<span style="font-size: 0.75rem; color: #6b7280; margin-left: 0.5rem;">(You)</span>' : ''}
                     </div>
                     <div class="reply-text">${reply.text}</div>
                     <div class="reply-time">${formattedDate} at ${formattedTime}</div>
                     ${isAuthor ? `
                         <div class="comment-actions">
                             <div class="comment-action" onclick="deleteReply('${reply.id}', '${reply.commentId}')" title="Delete reply">
                                 <i class="fas fa-trash"></i>
                             </div>
                         </div>
                     ` : ''}
                 `;
                 
                 return replyDiv;
             };
             
             // Toggle reply form visibility
             const toggleReplyForm = (commentId) => {
                 const repliesContainer = document.getElementById(`replies-${commentId}`);
                 if (repliesContainer.style.display === 'none') {
                     repliesContainer.style.display = 'block';
                     // Focus on the reply input
                     const replyInput = document.getElementById(`reply-input-${commentId}`);
                     if (replyInput) {
                         replyInput.focus();
                     }
                 } else {
                     repliesContainer.style.display = 'none';
                 }
             };
             
             // Add comment
             const addComment = (event) => {
                 event.preventDefault();
                 
                 // Check if user is authenticated
                 if (!AuthModule.authInitialized) {
                     // Wait for auth to initialize
                     setTimeout(() => {
                         addComment(event);
                     }, 500);
                     return;
                 }
                 
                 const user = firebase.auth().currentUser;
                 if (!user) {
                     UIModule.showToast('error', 'Sign in required', 'Please sign in to post comments.');
                     AuthModule.showLoginModal();
                     return;
                 }
                 
                 const commentInput = document.getElementById('commentInput');
                 const commentText = commentInput.value.trim();
                 
                 if (!commentText) {
                     UIModule.showToast('error', 'Empty Comment', 'Please enter a comment before posting.');
                     return;
                 }
                 
                 UIModule.showLoading();
                 
                 const commentsRef = firebase.database().ref('comments').push();
                 const newComment = {
                     authorId: user.uid,
                     authorName: AuthModule.userData.displayName,
                     text: commentText,
                     upvotes: 0,
                     downvotes: 0,
                     votes: {},
                     createdAt: firebase.database.ServerValue.TIMESTAMP
                 };
                 
                 commentsRef.set(newComment).then(() => {
                     commentInput.value = '';
                     UIModule.showToast('success', 'Comment Posted', 'Your comment has been posted successfully.');
                     
                     // Award points
                     AuthModule.awardPoints(5, 'Comment posted');
                 }).catch((error) => {
                     console.error("Error adding comment:", error);
                     UIModule.showToast('error', 'Error', 'Failed to post comment.');
                 }).finally(() => {
                     UIModule.hideLoading();
                 });
             };
             
             // Add reply to a comment
             const addReply = (event, commentId) => {
                 event.preventDefault();
                 
                 // Check if user is authenticated
                 if (!AuthModule.authInitialized) {
                     // Wait for auth to initialize
                     setTimeout(() => {
                         addReply(event, commentId);
                     }, 500);
                     return;
                 }
                 
                 const user = firebase.auth().currentUser;
                 if (!user) {
                     UIModule.showToast('error', 'Sign in required', 'Please sign in to post replies.');
                     AuthModule.showLoginModal();
                     return;
                 }
                 
                 const replyInput = document.getElementById(`reply-input-${commentId}`);
                 const replyText = replyInput.value.trim();
                 
                 if (!replyText) {
                     UIModule.showToast('error', 'Empty Reply', 'Please enter a reply before posting.');
                     return;
                 }
                 
                 UIModule.showLoading();
                 
                 const repliesRef = firebase.database().ref('replies').push();
                 const newReply = {
                     commentId: commentId,
                     authorId: user.uid,
                     authorName: AuthModule.userData.displayName,
                     text: replyText,
                     createdAt: firebase.database.ServerValue.TIMESTAMP
                 };
                 
                 repliesRef.set(newReply).then(() => {
                     replyInput.value = '';
                     UIModule.showToast('success', 'Reply Posted', 'Your reply has been posted successfully.');
                     
                     // Award points
                     AuthModule.awardPoints(3, 'Reply posted');
                 }).catch((error) => {
                     console.error("Error adding reply:", error);
                     UIModule.showToast('error', 'Error', 'Failed to post reply.');
                 }).finally(() => {
                     UIModule.hideLoading();
                 });
             };
             
             // Toggle comment vote
             const toggleCommentVote = (commentId, voteType) => {
                 // Check if user is authenticated
                 if (!AuthModule.authInitialized) {
                     // Wait for auth to initialize
                     setTimeout(() => {
                         toggleCommentVote(commentId, voteType);
                     }, 500);
                     return;
                 }
                 
                 const user = firebase.auth().currentUser;
                 if (!user) {
                     UIModule.showToast('error', 'Sign in required', 'Please sign in to vote on comments.');
                     AuthModule.showLoginModal();
                     return;
                 }
                 
                 const commentRef = firebase.database().ref('comments/' + commentId);
                 commentRef.once('value').then((snapshot) => {
                     const comment = snapshot.val();
                     
                     if (!comment) {
                         UIModule.showToast('error', 'Error', 'Comment not found.');
                         return;
                     }
                     
                     // Get current votes
                     const votes = comment.votes || {};
                     const currentVote = votes[user.uid];
                     const upvotes = comment.upvotes || 0;
                     const downvotes = comment.downvotes || 0;
                     
                     let newUpvotes = upvotes;
                     let newDownvotes = downvotes;
                     let newVotes = { ...votes };
                     
                     if (voteType === 'up') {
                         if (currentVote === true) {
                             // Remove upvote
                             delete newVotes[user.uid];
                             newUpvotes = Math.max(0, upvotes - 1);
                         } else {
                             // Add or change to upvote
                             newVotes[user.uid] = true;
                             newUpvotes = upvotes + 1;
                             if (currentVote === false) {
                                 // Was downvoted before
                                 newDownvotes = Math.max(0, downvotes - 1);
                             }
                         }
                     } else { // voteType === 'down'
                         if (currentVote === false) {
                             // Remove downvote
                             delete newVotes[user.uid];
                             newDownvotes = Math.max(0, downvotes - 1);
                         } else {
                             // Add or change to downvote
                             newVotes[user.uid] = false;
                             newDownvotes = downvotes + 1;
                             if (currentVote === true) {
                                 // Was upvoted before
                                 newUpvotes = Math.max(0, upvotes - 1);
                             }
                         }
                     }
                     
                     // Update the comment
                     const updates = {};
                     updates['/upvotes'] = newUpvotes;
                     updates['/downvotes'] = newDownvotes;
                     updates['/votes'] = newVotes;
                     
                     commentRef.update(updates).then(() => {
                         // Update UI will be handled by the real-time listener
                     }).catch((error) => {
                         console.error("Error voting on comment:", error);
                         UIModule.showToast('error', 'Error', 'Failed to vote on comment.');
                     });
                 }).catch((error) => {
                     console.error("Error getting comment:", error);
                     UIModule.showToast('error', 'Error', 'Failed to vote on comment.');
                 });
             };
             
             // Delete comment
             const deleteComment = (commentId) => {
                 // Check if user is authenticated
                 if (!AuthModule.authInitialized) {
                     // Wait for auth to initialize
                     setTimeout(() => {
                         deleteComment(commentId);
                     }, 500);
                     return;
                 }
                 
                 const user = firebase.auth().currentUser;
                 if (!user) {
                     UIModule.showToast('error', 'Sign in required', 'Please sign in to delete comments.');
                     AuthModule.showLoginModal();
                     return;
                 }
                 
                 if (!confirm('Are you sure you want to delete this comment?')) {
                     return;
                 }
                 
                 UIModule.showLoading();
                 
                 const commentRef = firebase.database().ref('comments/' + commentId);
                 commentRef.remove().then(() => {
                     UIModule.showToast('success', 'Comment Deleted', 'Your comment has been deleted successfully.');
                 }).catch((error) => {
                     console.error("Error deleting comment:", error);
                     UIModule.showToast('error', 'Error', 'Failed to delete comment.');
                 }).finally(() => {
                     UIModule.hideLoading();
                 });
             };
             
             // Delete reply
             const deleteReply = (replyId, commentId) => {
                 // Check if user is authenticated
                 if (!AuthModule.authInitialized) {
                     // Wait for auth to initialize
                     setTimeout(() => {
                         deleteReply(replyId, commentId);
                     }, 500);
                     return;
                 }
                 
                 const user = firebase.auth().currentUser;
                 if (!user) {
                     UIModule.showToast('error', 'Sign in required', 'Please sign in to delete replies.');
                     AuthModule.showLoginModal();
                     return;
                 }
                 
                 if (!confirm('Are you sure you want to delete this reply?')) {
                     return;
                 }
                 
                 UIModule.showLoading();
                 
                 const replyRef = firebase.database().ref('replies/' + replyId);
                 replyRef.remove().then(() => {
                     UIModule.showToast('success', 'Reply Deleted', 'Your reply has been deleted successfully.');
                 }).catch((error) => {
                     console.error("Error deleting reply:", error);
                     UIModule.showToast('error', 'Error', 'Failed to delete reply.');
                 }).finally(() => {
                     UIModule.hideLoading();
                 });
             };
             
             return {
                 loadComments,
                 addComment,
                 addReply,
                 toggleCommentVote,
                 deleteComment,
                 deleteReply
             };
         })();
         
         // Feedback Module
         const FeedbackModule = (() => {
             // Handle feedback form submission
             const handleFeedbackSubmit = (event) => {
                 event.preventDefault();
                 
                 // Check if user is authenticated
                 if (!AuthModule.authInitialized) {
                     // Wait for auth to initialize
                     setTimeout(() => {
                         handleFeedbackSubmit(event);
                     }, 500);
                     return;
                 }
                 
                 const user = firebase.auth().currentUser;
                 if (!user) {
                     UIModule.showToast('error', 'Sign in required', 'Please sign in to submit feedback.');
                     AuthModule.showLoginModal();
                     return;
                 }
                 
                 const name = document.getElementById('feedbackName').value.trim();
                 const email = document.getElementById('feedbackEmail').value.trim();
                 const rating = parseInt(document.getElementById('ratingValue').value);
                 const comment = document.getElementById('feedbackComment').value.trim();
                 const suggestion = document.getElementById('feedbackSuggestion').value.trim();
                 
                 if (!name || !email || !comment) {
                     UIModule.showToast('error', 'Missing Fields', 'Please fill in all required fields.');
                     return;
                 }
                 
                 if (!Utils.isValidEmail(email)) {
                     UIModule.showToast('error', 'Invalid Email', 'Please enter a valid email address.');
                     return;
                 }
                 
                 UIModule.showLoading();
                 
                 const feedbackRef = firebase.database().ref('feedback').push();
                 const newFeedback = {
                     userId: user.uid,
                     userName: name,
                     userEmail: email,
                     rating: rating,
                     comment: comment,
                     suggestion: suggestion,
                     createdAt: firebase.database.ServerValue.TIMESTAMP
                 };
                 
                 feedbackRef.set(newFeedback).then(() => {
                     // Reset form
                     document.getElementById('feedbackFormElement').reset();
                     document.getElementById('ratingValue').value = '0';
                     document.querySelectorAll('.rating-star').forEach(star => {
                         star.classList.remove('active');
                     });
                     
                     UIModule.showToast('success', 'Feedback Submitted', 'Thank you for your feedback!');
                     
                     // Award points
                     AuthModule.awardPoints(15, 'Submitted feedback');
                 }).catch((error) => {
                     console.error("Error submitting feedback:", error);
                     UIModule.showToast('error', 'Error', 'Failed to submit feedback.');
                 }).finally(() => {
                     UIModule.hideLoading();
                 });
             };
             
             return {
                 handleFeedbackSubmit
             };
         })();
         
         // Glossary Module
         const GlossaryModule = (() => {
             // Initialize glossary search
             const initGlossarySearch = () => {
                 const glossarySearch = document.getElementById('glossarySearch');
                 const glossaryTerms = document.getElementById('glossaryTerms');
                 
                 // Add event listener for glossary search
                 glossarySearch.addEventListener('input', Utils.debounce(handleGlossarySearch, 300));
             };
             
             // Handle glossary search
             const handleGlossarySearch = (e) => {
                 const query = e.target.value.trim().toLowerCase();
                 const glossaryTerms = document.getElementById('glossaryTerms');
                 const terms = glossaryTerms.querySelectorAll('.glossary-term');
                 
                 terms.forEach(term => {
                     const termName = term.querySelector('.glossary-term-name').textContent.toLowerCase();
                     const termDefinition = term.querySelector('.glossary-term-definition').textContent.toLowerCase();
                     
                     if (termName.includes(query) || termDefinition.includes(query)) {
                         term.style.display = 'block';
                     } else {
                         term.style.display = 'none';
                     }
                 });
             };
             
             return {
                 initGlossarySearch
             };
         })();
         
         // Melting Point Quiz Module
         const MeltingPointQuizModule = (() => {
             // Initialize melting point quiz functionality
             const initMeltingPointQuiz = () => {
                 // Add event listeners to all melting point quiz submit buttons
                 document.addEventListener('click', (e) => {
                     if (e.target.classList.contains('melting-quiz-submit')) {
                         const meltingPointCell = e.target.closest('.melting-point-cell');
                         const quizInput = meltingPointCell.querySelector('.melting-quiz-answer');
                         const quizResult = meltingPointCell.querySelector('.quiz-result');
                         
                         const userAnswer = quizInput.value.trim().toLowerCase();
                         const correctAnswers = [
                             'increasing atomic size',
                             'weaker metallic bonding',
                             'larger atomic radius',
                             'weaker bonds',
                             'atomic size increases',
                             'bonding weakens'
                         ];
                         
                         const isCorrect = correctAnswers.some(answer => userAnswer.includes(answer));
                         
                         if (isCorrect) {
                             quizResult.textContent = 'Correct! The melting point decreases down the group due to increasing atomic size, which weakens the metallic bonding.';
                             quizResult.className = 'quiz-result correct';
                         } else {
                             quizResult.textContent = 'Not quite. Think about how atomic size affects bonding strength.';
                             quizResult.className = 'quiz-result incorrect';
                         }
                         
                         // Award points for correct answer
                         if (isCorrect) {
                             AuthModule.awardPoints(5, 'Correct melting point quiz answer');
                         }
                     }
                 });
             };
             
             return {
                 initMeltingPointQuiz
             };
         })();
         
         // Initialize the app
         const initializeApp = () => {
             // Initialize theme
             UIModule.initTheme();
             
             // Initialize glossary search if glossary section exists
             if (document.getElementById('glossarySearch')) {
                 GlossaryModule.initGlossarySearch();
             }
             
             // Initialize melting point quiz functionality
             MeltingPointQuizModule.initMeltingPointQuiz();
             
             // Add keyboard navigation
             document.addEventListener('keydown', (e) => {
                 // Handle ESC key to close modals
                 if (e.key === 'Escape') {
                     const activeModal = document.querySelector('.modal.active');
                     if (activeModal) {
                         if (activeModal.id === 'loginModal') {
                             AuthModule.closeLoginModal();
                         } else if (activeModal.id === 'quizModal') {
                             QuizModule.closeQuiz();
                         } else if (activeModal.id === 'createStudyGroupModal') {
                             StudyGroupModule.closeCreateStudyGroup();
                         } else if (activeModal.id === 'groupDetailModal') {
                             StudyGroupModule.closeGroupDetail();
                         }
                     }
                 }
             });
             
             // Add click handlers for landing page buttons
             document.addEventListener('click', (e) => {
                 if (e.target.closest('#landingPage .btn-primary')) {
                     AuthModule.showLoginModal();
                 }
                 if (e.target.closest('#landingPage .btn-secondary')) {
                     AuthModule.signInWithGoogle();
                 }
             });
             
             // Add rating star click handlers
             document.addEventListener('click', (e) => {
                 if (e.target.classList.contains('rating-star')) {
                     const rating = parseInt(e.target.dataset.rating);
                     const ratingValue = document.getElementById('ratingValue');
                     const stars = document.querySelectorAll('.rating-star');
                     
                     // Update rating value
                     ratingValue.value = rating;
                     
                     // Update star display
                     stars.forEach((star, index) => {
                         if (index < rating) {
                             star.classList.add('active');
                         } else {
                             star.classList.remove('active');
                         }
                     });
                 }
             });
             
             // Handle URL hash for navigation
             if (window.location.hash) {
                 const section = window.location.hash.substring(1);
                 if (section && document.getElementById(`${section}-section`)) {
                     NavigationModule.navigateToSection(section);
                 }
             }
         };
         
         // Initialize when DOM is ready
         document.addEventListener('DOMContentLoaded', initializeApp);
         
         // Global functions for HTML onclick handlers
         window.toggleTheme = UIModule.toggleTheme;
         window.toggleSidebar = NavigationModule.toggleSidebar;
         window.navigateToSection = NavigationModule.navigateToSection;
         window.showTab = NavigationModule.showTab;
         window.completeSection = AuthModule.completeSection;
         window.saveNotes = AuthModule.saveNotes;
         window.showLoginModal = AuthModule.showLoginModal;
         window.closeLoginModal = AuthModule.closeLoginModal;
         window.switchAuthTab = AuthModule.switchAuthTab;
         window.signInWithGoogle = AuthModule.signInWithGoogle;
         window.signOut = AuthModule.signOut;
         window.startPreQuiz = QuizModule.startPreQuiz;
         window.startPostQuiz = QuizModule.startPostQuiz;
         window.submitAnswer = QuizModule.submitAnswer;
         window.selectOption = QuizModule.selectOption;
         window.nextQuestion = QuizModule.nextQuestion;
         window.previousQuestion = QuizModule.previousQuestion;
         window.completePreQuiz = QuizModule.completePreQuiz;
         window.closeQuiz = QuizModule.closeQuiz;
         window.showCreateStudyGroup = StudyGroupModule.showCreateStudyGroup;
         window.closeCreateStudyGroup = StudyGroupModule.closeCreateStudyGroup;
         window.handleCreateStudyGroup = StudyGroupModule.handleCreateStudyGroup;
         window.joinStudyGroup = StudyGroupModule.joinStudyGroup;
         window.leaveStudyGroup = StudyGroupModule.leaveStudyGroup;
         window.viewGroupDetails = StudyGroupModule.viewGroupDetails;
         window.closeGroupDetail = StudyGroupModule.closeGroupDetail;
         window.handleGroupMessage = StudyGroupModule.handleGroupMessage;
         window.toggleGroupMessageVote = StudyGroupModule.toggleGroupMessageVote;
         window.addComment = DiscussionModule.addComment;
         window.addReply = DiscussionModule.addReply;
         window.toggleCommentVote = DiscussionModule.toggleCommentVote;
         window.deleteComment = DiscussionModule.deleteComment;
         window.deleteReply = DiscussionModule.deleteReply;
         window.toggleReplyForm = DiscussionModule.toggleReplyForm;
         window.handleFeedbackSubmit = FeedbackModule.handleFeedbackSubmit;
      </script>
   </body>
</html>
