<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Group 1 & 2 Chemistry Explorer - Interactive Learning Platform</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/examples/js/controls/OrbitControls.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@500;700&display=swap');
        
        :root {
            --primary: #3b82f6;
            --secondary: #10b981;
            --accent: #8b5cf6;
            --dark: #1e293b;
            --light: #f8fafc;
            --gray: #e2e8f0;
            --warning: #f59e0b;
            --danger: #ef4444;
            --success: #22c55e;
            --info: #06b6d4;
            --group1: #3b82f6;
            --group2: #10b981;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: var(--light);
            overflow-x: hidden;
            position: relative;
            transition: background 0.3s ease;
        }
        
        body.light-mode {
            background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
            color: var(--dark);
        }
        
        /* Loading Spinner */
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Dark/Light Mode Toggle */
        .theme-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 50px;
            padding: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .theme-toggle:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .theme-toggle i {
            font-size: 1.2rem;
            color: white;
        }
        
        body.light-mode .theme-toggle {
            background: rgba(30, 41, 59, 0.1);
            border: 1px solid rgba(30, 41, 59, 0.2);
        }
        
        body.light-mode .theme-toggle i {
            color: var(--dark);
        }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
        }
        
        ::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.5);
        }
        
        /* Landing Page */
        .landing-page {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            position: relative;
            overflow: hidden;
        }
        
        .particles {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }
        
        .particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: rgba(255, 255, 255, 0.5);
            border-radius: 50%;
            animation: float 20s infinite linear;
        }
        
        @keyframes float {
            0% {
                transform: translateY(100vh) translateX(0);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            100% {
                transform: translateY(-100vh) translateX(100px);
                opacity: 0;
            }
        }
        
        .landing-content {
            position: relative;
            z-index: 10;
            text-align: center;
            max-width: 1200px;
            padding: 2rem;
        }
        
        .app-title {
            font-family: 'Poppins', sans-serif;
            font-size: clamp(3rem, 8vw, 6rem);
            font-weight: 700;
            margin-bottom: 1rem;
            background: linear-gradient(135deg, var(--group1), var(--group2), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            line-height: 1.1;
            letter-spacing: -0.02em;
        }
        
        .app-subtitle {
            font-size: clamp(1.2rem, 3vw, 2rem);
            color: #94a3b8;
            margin-bottom: 2rem;
            font-weight: 300;
        }
        
        .app-description {
            font-size: clamp(1rem, 2vw, 1.25rem);
            color: #cbd5e1;
            margin-bottom: 3rem;
            line-height: 1.6;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .enter-button {
            padding: 1rem 3rem;
            background: linear-gradient(135deg, var(--group1), var(--group2));
            color: white;
            border: none;
            border-radius: 50px;
            font-size: 1.2rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 10px 30px rgba(59, 130, 246, 0.4);
            position: relative;
            overflow: hidden;
            display: inline-flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .enter-button:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(59, 130, 246, 0.6);
        }
        
        .enter-button::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.2);
            transform: translateX(-100%);
            transition: transform 0.6s;
        }
        
        .enter-button:hover::before {
            transform: translateX(0);
        }
        
        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem;
            margin-top: 5rem;
            width: 100%;
        }
        
        .feature-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 2rem;
            text-align: center;
            transition: all 0.3s ease;
        }
        
        .feature-card:hover {
            transform: translateY(-10px);
            background: rgba(255, 255, 255, 0.08);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
        }
        
        .feature-icon {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--group1), var(--group2));
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 0 auto 1.5rem;
            color: white;
            font-size: 2rem;
            transition: all 0.3s ease;
        }
        
        .feature-card:hover .feature-icon {
            transform: scale(1.1) rotate(5deg);
            box-shadow: 0 10px 30px rgba(59, 130, 246, 0.5);
        }
        
        .feature-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 0.75rem;
            color: white;
        }
        
        .feature-description {
            color: #94a3b8;
            font-size: 0.95rem;
            line-height: 1.5;
        }
        
        /* Main App */
        .main-app {
            display: none;
            min-height: 100vh;
        }
        
        /* Sidebar Navigation */
        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            width: 280px;
            height: 100vh;
            background: rgba(30, 41, 59, 0.95);
            backdrop-filter: blur(10px);
            border-right: 1px solid rgba(255, 255, 255, 0.1);
            z-index: 100;
            overflow-y: auto;
            transition: transform 0.3s ease;
        }
        
        .sidebar-header {
            padding: 2rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .logo {
            font-family: 'Poppins', sans-serif;
            font-size: 1.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--group1), var(--group2));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .nav-menu {
            padding: 1.5rem 0;
        }
        
        .nav-item {
            display: flex;
            align-items: center;
            padding: 1rem 2rem;
            color: #94a3b8;
            text-decoration: none;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .nav-item:hover {
            color: white;
            background: rgba(255, 255, 255, 0.05);
        }
        
        .nav-item.active {
            color: white;
            background: linear-gradient(90deg, rgba(59, 130, 246, 0.2), transparent);
        }
        
        .nav-item.active::before {
            content: "";
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            width: 4px;
            background: var(--group1);
        }
        
        .nav-icon {
            margin-right: 1rem;
            font-size: 1.25rem;
            width: 24px;
            text-align: center;
        }
        
        .user-profile {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 1.5rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--group1), var(--group2));
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-weight: 600;
        }
        
        .user-info {
            flex: 1;
        }
        
        .user-name {
            font-weight: 600;
            font-size: 0.9rem;
            color: white;
        }
        
        .user-id {
            font-size: 0.75rem;
            color: #64748b;
        }
        
        .user-stats {
            display: flex;
            gap: 1rem;
            margin-top: 0.5rem;
        }
        
        .user-stat {
            display: flex;
            align-items: center;
            gap: 0.25rem;
            font-size: 0.75rem;
            color: #94a3b8;
        }
        
        /* Main Content */
        .main-content {
            margin-left: 280px;
            min-height: 100vh;
            padding: 2rem;
        }
        
        /* Dashboard */
        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .dashboard-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 1.5rem;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }
        
        .dashboard-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
            border-color: rgba(255, 255, 255, 0.2);
        }
        
        .dashboard-card::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, var(--group1), var(--group2), var(--accent));
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }
        
        .dashboard-card:hover::before {
            transform: scaleX(1);
        }
        
        .card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1rem;
        }
        
        .card-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: white;
        }
        
        .card-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-size: 1.5rem;
        }
        
        .card-content {
            color: #94a3b8;
            font-size: 0.95rem;
            line-height: 1.5;
        }
        
        .card-progress {
            margin-top: 1rem;
        }
        
        .progress-bar {
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--group1), var(--group2));
            border-radius: 4px;
            transition: width 0.5s ease;
        }
        
        /* Content Sections */
        .content-section {
            display: none;
            animation: fadeIn 0.5s ease;
        }
        
        .content-section.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 2rem;
        }
        
        .section-title {
            font-size: 2rem;
            font-weight: 700;
            color: white;
        }
        
        .section-actions {
            display: flex;
            gap: 1rem;
        }
        
        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--group1), var(--group2));
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(59, 130, 246, 0.3);
        }
        
        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.15);
        }
        
        /* Element Cards */
        .elements-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 1.5rem;
        }
        
        .element-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 1.5rem;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }
        
        .element-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
            border-color: rgba(255, 255, 255, 0.2);
        }
        
        .element-card::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, var(--group1), var(--group2), var(--accent));
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }
        
        .element-card:hover::before {
            transform: scaleX(1);
        }
        
        .element-image {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            margin: 0 auto 1rem;
            object-fit: cover;
            border: 3px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }
        
        .element-card:hover .element-image {
            border-color: var(--group1);
            transform: scale(1.05);
        }
        
        .element-symbol {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            color: white;
        }
        
        .element-name {
            font-size: 1rem;
            color: #94a3b8;
            margin-bottom: 0.5rem;
        }
        
        .element-number {
            font-size: 0.875rem;
            color: #64748b;
        }
        
        .element-group {
            position: absolute;
            top: 1rem;
            right: 1rem;
            font-size: 0.75rem;
            font-weight: 600;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            background: rgba(255, 255, 255, 0.1);
        }
        
        .group-1 {
            color: var(--group1);
        }
        
        .group-2 {
            color: var(--group2);
        }
        
        /* Atom Viewer */
        .atom-viewer-container {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }
        
        #atom-viewer {
            width: 100%;
            height: 400px;
            border-radius: 8px;
            overflow: hidden;
            position: relative;
        }
        
        .atom-loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1rem;
        }
        
        .atom-controls {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
            flex-wrap: wrap;
        }
        
        .atom-control-btn {
            padding: 0.5rem 1rem;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .atom-control-btn:hover {
            background: rgba(255, 255, 255, 0.15);
        }
        
        .visualization-modes {
            display: flex;
            gap: 0.5rem;
            margin-left: auto;
        }
        
        .viz-mode {
            padding: 0.5rem 1rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.875rem;
        }
        
        .viz-mode.active {
            background: var(--group1);
            border-color: var(--group1);
        }
        
        /* Element Details */
        .element-details {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 1.5rem;
        }
        
        .details-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        
        .detail-item {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            padding: 1rem;
        }
        
        .detail-label {
            font-size: 0.875rem;
            color: #64748b;
            margin-bottom: 0.25rem;
        }
        
        .detail-value {
            font-size: 1.125rem;
            font-weight: 600;
            color: white;
        }
        
        /* Applications */
        .applications {
            margin-top: 1.5rem;
        }
        
        .applications-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: white;
            margin-bottom: 1rem;
        }
        
        .applications-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
        }
        
        .application-item {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            padding: 1rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .application-icon {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: center;
            align-items: center;
            color: var(--group1);
        }
        
        .application-text {
            color: #94a3b8;
            font-size: 0.95rem;
        }
        
        /* Learn Section */
        .learn-content {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 2rem;
        }
        
        .learn-tabs {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .learn-tab {
            padding: 1rem 1.5rem;
            color: #94a3b8;
            cursor: pointer;
            position: relative;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
        }
        
        .learn-tab:hover {
            color: white;
        }
        
        .learn-tab.active {
            color: white;
            border-bottom-color: var(--group1);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        /* Comparison Tool */
        .comparison-tool {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 2rem;
            margin-top: 2rem;
        }
        
        .comparison-controls {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }
        
        .comparison-select {
            flex: 1;
            min-width: 200px;
            padding: 0.75rem 1rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: white;
        }
        
        .comparison-results {
            display: none;
        }
        
        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }
        
        .comparison-table th,
        .comparison-table td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .comparison-table th {
            color: white;
            font-weight: 600;
        }
        
        .comparison-table td {
            color: #94a3b8;
        }
        
        /* Reaction Simulator */
        .reaction-simulator {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 2rem;
        }
        
        .reaction-controls {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }
        
        .reaction-select {
            flex: 1;
            min-width: 200px;
            padding: 0.75rem 1rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: white;
        }
        
        .reaction-canvas {
            width: 100%;
            height: 400px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            margin-bottom: 1rem;
            position: relative;
            overflow: hidden;
        }
        
        .reaction-info {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            padding: 1.5rem;
        }
        
        .reaction-equation {
            font-size: 1.25rem;
            font-weight: 600;
            color: white;
            margin-bottom: 0.5rem;
        }
        
        .reaction-description {
            color: #94a3b8;
            line-height: 1.5;
        }
        
        /* Periodic Table */
        .periodic-table-container {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 2rem;
        }
        
        .periodic-table-wrapper {
            overflow-x: auto;
            margin-top: 1rem;
        }
        
        .periodic-table {
            display: grid;
            grid-template-columns: repeat(18, 1fr);
            gap: 2px;
            min-width: 900px;
        }
        
        .periodic-element {
            aspect-ratio: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            padding: 2px;
        }
        
        .periodic-element:hover {
            transform: scale(1.2);
            z-index: 10;
        }
        
        .periodic-element.group1 {
            background: rgba(59, 130, 246, 0.2);
            border: 1px solid var(--group1);
        }
        
        .periodic-element.group2 {
            background: rgba(16, 185, 129, 0.2);
            border: 1px solid var(--group2);
        }
        
        .periodic-element.other {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .periodic-element.highlighted {
            box-shadow: 0 0 20px var(--accent);
            transform: scale(1.3);
            z-index: 20;
        }
        
        .element-symbol-large {
            font-weight: 700;
            font-size: 1rem;
        }
        
        .element-number-small {
            font-size: 0.6rem;
            opacity: 0.7;
        }
        
        .periodic-element-info {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            padding: 1.5rem;
            margin-top: 2rem;
            display: none;
        }
        
        .periodic-element-info.active {
            display: block;
        }
        
        /* Molecular Builder */
        .molecular-builder {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 2rem;
            margin-top: 2rem;
        }
        
        .builder-canvas {
            width: 100%;
            height: 400px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            margin-bottom: 1rem;
            position: relative;
            overflow: hidden;
        }
        
        .element-palette {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }
        
        .palette-element {
            width: 60px;
            height: 60px;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }
        
        .palette-element:hover {
            transform: translateY(-5px);
        }
        
        .palette-element.selected {
            border-color: var(--group1);
            box-shadow: 0 0 10px var(--group1);
        }
        
        .palette-element.group1 {
            background: rgba(59, 130, 246, 0.2);
            border: 1px solid var(--group1);
        }
        
        .palette-element.group2 {
            background: rgba(16, 185, 129, 0.2);
            border: 1px solid var(--group2);
        }
        
        .palette-symbol {
            font-weight: 700;
            font-size: 1.2rem;
            color: white;
        }
        
        .palette-name {
            font-size: 0.7rem;
            color: #94a3b8;
        }
        
        /* Quiz Section */
        .quiz-container {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 2rem;
        }
        
        .quiz-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 2rem;
        }
        
        .quiz-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: white;
        }
        
        .quiz-progress {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .quiz-progress-text {
            color: #94a3b8;
            font-size: 0.95rem;
        }
        
        .quiz-questions {
            display: flex;
            flex-direction: column;
            gap: 2rem;
        }
        
        .quiz-question {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 1.5rem;
            border-left: 4px solid var(--accent);
        }
        
        .question-text {
            font-size: 1.125rem;
            font-weight: 600;
            color: white;
            margin-bottom: 1rem;
        }
        
        .quiz-options {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }
        
        .quiz-option {
            padding: 1rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            color: #94a3b8;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .quiz-option:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: var(--group1);
            color: white;
        }
        
        .quiz-option.selected {
            background: var(--group1);
            border-color: var(--group1);
            color: white;
        }
        
        .quiz-option.correct {
            background: var(--success);
            border-color: var(--success);
            color: white;
        }
        
        .quiz-option.incorrect {
            background: var(--danger);
            border-color: var(--danger);
            color: white;
        }
        
        /* Drag and Drop */
        .drag-container {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .drag-source {
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            min-height: 60px;
        }
        
        .drag-target {
            display: flex;
            gap: 0.75rem;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            min-height: 60px;
            border: 2px dashed rgba(255, 255, 255, 0.2);
        }
        
        .drag-item {
            padding: 0.5rem 1rem;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: white;
            cursor: move;
            transition: all 0.3s ease;
        }
        
        .drag-item:hover {
            transform: scale(1.05);
        }
        
        .drag-item.dragging {
            opacity: 0.5;
        }
        
        .drag-target.drag-over {
            background: rgba(59, 130, 246, 0.1);
            border-color: var(--group1);
        }
        
        /* Message Box */
        .message-box {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(30, 41, 59, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 16px;
            padding: 2rem;
            max-width: 500px;
            width: 90%;
            z-index: 1000;
            text-align: center;
            animation: popIn 0.5s ease-out;
        }
        
        @keyframes popIn {
            from { transform: translate(-50%, -50%) scale(0.8); opacity: 0; }
            to { transform: translate(-50%, -50%) scale(1); opacity: 1; }
        }
        
        .message-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
            color: white;
        }
        
        .message-text {
            margin-bottom: 1.5rem;
            color: #94a3b8;
        }
        
        .message-button {
            padding: 0.75rem 2rem;
            background: linear-gradient(135deg, var(--group1), var(--group2));
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .message-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(59, 130, 246, 0.3);
        }
        
        /* Mobile Menu Toggle */
        .mobile-menu-toggle {
            display: none;
            position: fixed;
            top: 1rem;
            left: 1rem;
            z-index: 1000;
            padding: 0.75rem;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: white;
            cursor: pointer;
        }
        
        /* Share Progress */
        .share-progress {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 50px;
            padding: 10px 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .share-progress:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        /* Help Button */
        .help-button {
            position: fixed;
            bottom: 20px;
            left: 20px;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .help-button:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.1);
        }
        
        /* Help Modal */
        .help-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .help-modal.active {
            opacity: 1;
            visibility: visible;
        }
        
        .help-content {
            background: rgba(30, 41, 59, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 16px;
            padding: 2rem;
            max-width: 800px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }
        
        .help-modal.active .help-content {
            transform: scale(1);
        }
        
        .help-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1.5rem;
        }
        
        .help-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: white;
        }
        
        .help-close {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        
        .help-close:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: rotate(90deg);
        }
        
        .help-section {
            margin-bottom: 2rem;
        }
        
        .help-section-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: white;
            margin-bottom: 1rem;
        }
        
        .help-section-content {
            color: #94a3b8;
            line-height: 1.6;
        }
        
        /* Search Bar */
        .search-container {
            position: relative;
            margin-bottom: 1.5rem;
        }
        
        .search-input {
            width: 100%;
            padding: 0.75rem 1rem 0.75rem 3rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: white;
            font-size: 1rem;
            transition: all 0.3s ease;
        }
        
        .search-input:focus {
            outline: none;
            border-color: var(--group1);
            background: rgba(255, 255, 255, 0.08);
        }
        
        .search-icon {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: #94a3b8;
        }
        
        /* Filter Buttons */
        .filter-buttons {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }
        
        .filter-btn {
            padding: 0.5rem 1rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.875rem;
        }
        
        .filter-btn:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .filter-btn.active {
            background: var(--group1);
            border-color: var(--group1);
        }
        
        /* Audio Toggle */
        .audio-toggle {
            position: fixed;
            bottom: 80px;
            right: 20px;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 50px;
            padding: 10px 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .audio-toggle:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        /* Element Tooltip */
        .element-tooltip {
            position: absolute;
            background: rgba(30, 41, 59, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            padding: 0.75rem;
            z-index: 100;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s ease;
            max-width: 200px;
        }
        
        .element-tooltip.active {
            opacity: 1;
        }
        
        .element-tooltip-title {
            font-weight: 600;
            color: white;
            margin-bottom: 0.25rem;
        }
        
        .element-tooltip-text {
            font-size: 0.875rem;
            color: #94a3b8;
        }
        
        /* Notification Toast */
        .notification-toast {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: rgba(30, 41, 59, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            padding: 1rem 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            z-index: 1000;
            opacity: 0;
            transition: all 0.3s ease;
        }
        
        .notification-toast.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }
        
        .notification-icon {
            font-size: 1.25rem;
        }
        
        .notification-icon.success {
            color: var(--success);
        }
        
        .notification-icon.error {
            color: var(--danger);
        }
        
        .notification-icon.info {
            color: var(--info);
        }
        
        .notification-text {
            color: white;
            font-weight: 500;
        }
        
        /* Group 1 & 2 specific styles */
        .group1-element {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.8), rgba(37, 99, 235, 0.8));
            box-shadow: 0 0 15px rgba(59, 130, 246, 0.5);
        }
        
        .group1-flame {
            background: linear-gradient(to top, #f59e0b, #fbbf24);
            box-shadow: 0 0 20px rgba(245, 158, 11, 0.7);
        }
        
        .group1-reaction {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(37, 99, 235, 0.1));
            border: 1px solid rgba(59, 130, 246, 0.2);
        }
        
        .group2-element {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.8), rgba(5, 150, 105, 0.8));
            box-shadow: 0 0 15px rgba(16, 185, 129, 0.5);
        }
        
        .group2-reaction {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(5, 150, 105, 0.1));
            border: 1px solid rgba(16, 185, 129, 0.2);
        }
        
        /* Reaction step highlighting */
        #reaction-steps .flex.text-green-400 .w-6 {
            background-color: #10b981 !important;
        }
        
        #reaction-steps .flex.text-blue-400 .w-6 {
            background-color: #3b82f6 !important;
        }
        
        /* Periodic table group headers */
        .periodic-table .col-start-1 {
            grid-column: 1;
        }
        
        .periodic-table .col-start-2 {
            grid-column: 2;
        }
        
        /* Responsive Design */
        @media (max-width: 1024px) {
            .sidebar {
                transform: translateX(-100%);
            }
            
            .sidebar.active {
                transform: translateX(0);
            }
            
            .main-content {
                margin-left: 0;
            }
            
            .mobile-menu-toggle {
                display: block;
            }
        }
        
        @media (max-width: 768px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
            
            .elements-grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            }
            
            .details-grid {
                grid-template-columns: 1fr;
            }
            
            .applications-list {
                grid-template-columns: 1fr;
            }
            
            .comparison-controls {
                flex-direction: column;
            }
            
            .periodic-table {
                grid-template-columns: repeat(9, 1fr);
            }
        }
        
        @media (max-width: 480px) {
            .app-title {
                font-size: 2.5rem;
            }
            
            .app-subtitle {
                font-size: 1.2rem;
            }
            
            .features-grid {
                grid-template-columns: 1fr;
            }
            
            .periodic-table {
                grid-template-columns: repeat(6, 1fr);
            }
        }
        
        /* Dark mode support */
        @media (prefers-color-scheme: dark) {
            body {
                background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            }
        }
        
        /* High contrast mode */
        @media (prefers-contrast: high) {
            :root {
                --primary: #0066cc;
                --secondary: #009944;
                --accent: #6633cc;
            }
        }
        
        /* Reduced motion */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }
    </style>
</head>
<body>
    <!-- Theme Toggle -->
    <div class="theme-toggle" id="theme-toggle">
        <i class="fas fa-moon" id="theme-icon"></i>
        <span id="theme-text">Dark</span>
    </div>
    
    <!-- Landing Page -->
    <div id="landing-page" class="landing-page">
        <div class="particles" id="particles"></div>
        
        <div class="landing-content">
            <h1 class="app-title">Group 1 & 2 Chemistry Explorer</h1>
            <h2 class="app-subtitle">Interactive Alkali & Alkaline Earth Metals Learning Platform</h2>
            <p class="app-description">
                Master the properties and reactions of Group 1 (alkali metals) and Group 2 (alkaline earth metals) 
                through interactive 3D models, virtual experiments, and engaging assessments.
            </p>
            
            <button id="enter-app-btn" class="enter-button">
                <span>Start Learning</span>
                <i class="fas fa-arrow-right"></i>
            </button>
            
            <div class="features-grid">
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-atom"></i>
                    </div>
                    <h3 class="feature-title">3D Atom Models</h3>
                    <p class="feature-description">
                        Explore atomic structures of Group 1 & 2 elements with interactive 3D visualizations
                    </p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-flask"></i>
                    </div>
                    <h3 class="feature-title">Virtual Lab</h3>
                    <p class="feature-description">
                        Conduct safe virtual experiments showing the characteristic reactions of alkali and alkaline earth metals
                    </p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-th"></i>
                    </div>
                    <h3 class="feature-title">Periodic Table</h3>
                    <p class="feature-description">
                        Interactive periodic table with special focus on Groups 1 and 2 elements
                    </p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-brain"></i>
                    </div>
                    <h3 class="feature-title">Adaptive Quizzes</h3>
                    <p class="feature-description">
                        Test your knowledge with specialized questions about Group 1 and Group 2 chemistry
                    </p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Main App -->
    <div id="main-app" class="main-app">
        <!-- Mobile Menu Toggle -->
        <button id="mobile-menu-toggle" class="mobile-menu-toggle">
            <i class="fas fa-bars"></i>
        </button>
        
        <!-- Sidebar Navigation -->
        <nav id="sidebar" class="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <i class="fas fa-atom"></i>
                    <span>Group 1 & 2 Explorer</span>
                </div>
            </div>
            
            <div class="nav-menu">
                <a href="#" class="nav-item active" data-section="dashboard">
                    <i class="fas fa-home nav-icon"></i>
                    <span>Dashboard</span>
                </a>
                <a href="#" class="nav-item" data-section="elements">
                    <i class="fas fa-flask nav-icon"></i>
                    <span>Elements</span>
                </a>
                <a href="#" class="nav-item" data-section="learn">
                    <i class="fas fa-book nav-icon"></i>
                    <span>Learn</span>
                </a>
                <a href="#" class="nav-item" data-section="reactions">
                    <i class="fas fa-vial nav-icon"></i>
                    <span>Reactions</span>
                </a>
                <a href="#" class="nav-item" data-section="periodic">
                    <i class="fas fa-th nav-icon"></i>
                    <span>Periodic Table</span>
                </a>
                <a href="#" class="nav-item" data-section="molecular">
                    <i class="fas fa-project-diagram nav-icon"></i>
                    <span>Molecular Builder</span>
                </a>
                <a href="#" class="nav-item" data-section="prequiz">
                    <i class="fas fa-question-circle nav-icon"></i>
                    <span>Pre-Quiz</span>
                </a>
                <a href="#" class="nav-item" data-section="postquiz">
                    <i class="fas fa-graduation-cap nav-icon"></i>
                    <span>Post-Quiz</span>
                </a>
                <a href="#" class="nav-item" data-section="achievements">
                    <i class="fas fa-trophy nav-icon"></i>
                    <span>Achievements</span>
                </a>
            </div>
            
            <div class="user-profile">
                <div class="user-avatar">
                    <i class="fas fa-user"></i>
                </div>
                <div class="user-info">
                    <div class="user-name">Student</div>
                    <div class="user-id">ID: <span id="user-id-display">Connecting...</span></div>
                    <div class="user-stats">
                        <div class="user-stat">
                            <i class="fas fa-star text-yellow-500"></i>
                            <span id="user-points">0</span>
                        </div>
                        <div class="user-stat">
                            <i class="fas fa-fire text-orange-500"></i>
                            <span id="user-streak">0</span>
                        </div>
                    </div>
                </div>
            </div>
        </nav>
        
        <!-- Main Content -->
        <main class="main-content">
            <!-- Dashboard Section -->
            <section id="dashboard-section" class="content-section active">
                <div class="section-header">
                    <h1 class="section-title">Learning Dashboard</h1>
                    <div class="section-actions">
                        <button class="btn btn-secondary">
                            <i class="fas fa-cog"></i>
                            Settings
                        </button>
                    </div>
                </div>
                
                <div class="dashboard">
                    <div class="dashboard-card" data-section="elements">
                        <div class="card-header">
                            <h3 class="card-title">Elements Explorer</h3>
                            <div class="card-icon">
                                <i class="fas fa-flask"></i>
                            </div>
                        </div>
                        <p class="card-content">
                            Explore Group 1 (alkali metals) and Group 2 (alkaline earth metals) properties
                        </p>
                        <div class="card-progress">
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: 75%"></div>
                            </div>
                            <p class="text-sm text-gray-400 mt-1">75% Complete</p>
                        </div>
                    </div>
                    
                    <div class="dashboard-card" data-section="learn">
                        <div class="card-header">
                            <h3 class="card-title">Learning Modules</h3>
                            <div class="card-icon">
                                <i class="fas fa-book"></i>
                            </div>
                        </div>
                        <p class="card-content">
                            Comprehensive lessons on Group 1 and Group 2 chemistry
                        </p>
                        <div class="card-progress">
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: 60%"></div>
                            </div>
                            <p class="text-sm text-gray-400 mt-1">60% Complete</p>
                        </div>
                    </div>
                    
                    <div class="dashboard-card" data-section="reactions">
                        <div class="card-header">
                            <h3 class="card-title">Virtual Lab</h3>
                            <div class="card-icon">
                                <i class="fas fa-vial"></i>
                            </div>
                        </div>
                        <p class="card-content">
                            Simulate characteristic reactions of alkali and alkaline earth metals
                        </p>
                        <div class="card-progress">
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: 40%"></div>
                            </div>
                            <p class="text-sm text-gray-400 mt-1">40% Complete</p>
                        </div>
                    </div>
                    
                    <div class="dashboard-card" data-section="prequiz">
                        <div class="card-header">
                            <h3 class="card-title">Pre-Assessment</h3>
                            <div class="card-icon">
                                <i class="fas fa-question-circle"></i>
                            </div>
                        </div>
                        <p class="card-content">
                            Test your current knowledge of Group 1 and Group 2 chemistry
                        </p>
                        <div class="card-progress">
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: 0%"></div>
                            </div>
                            <p class="text-sm text-gray-400 mt-1">Not Started</p>
                        </div>
                    </div>
                    
                    <div class="dashboard-card" data-section="periodic">
                        <div class="card-header">
                            <h3 class="card-title">Periodic Table</h3>
                            <div class="card-icon">
                                <i class="fas fa-th"></i>
                            </div>
                        </div>
                        <p class="card-content">
                            Interactive periodic table focusing on Groups 1 and 2
                        </p>
                        <div class="card-progress">
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: 85%"></div>
                            </div>
                            <p class="text-sm text-gray-400 mt-1">85% Complete</p>
                        </div>
                    </div>
                    
                    <div class="dashboard-card" data-section="achievements">
                        <div class="card-header">
                            <h3 class="card-title">Achievements</h3>
                            <div class="card-icon">
                                <i class="fas fa-trophy"></i>
                            </div>
                        </div>
                        <p class="card-content">
                            Earn badges as you master Group 1 and Group 2 chemistry
                        </p>
                        <div class="card-progress">
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: 30%"></div>
                            </div>
                            <p class="text-sm text-gray-400 mt-1">3/10 Badges</p>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- Elements Section -->
            <section id="elements-section" class="content-section">
                <div class="section-header">
                    <h1 class="section-title">Elements Explorer</h1>
                    <div class="section-actions">
                        <button class="btn btn-secondary" id="view-3d-btn">
                            <i class="fas fa-cube"></i>
                            3D View
                        </button>
                    </div>
                </div>
                
                <div class="search-container">
                    <i class="fas fa-search search-icon"></i>
                    <input type="text" class="search-input" id="elements-search" placeholder="Search elements...">
                </div>
                
                <div class="filter-buttons">
                    <button class="filter-btn active" data-filter="all">All Elements</button>
                    <button class="filter-btn" data-filter="group1">Group 1</button>
                    <button class="filter-btn" data-filter="group2">Group 2</button>
                    <button class="filter-btn" data-filter="low-reactivity">Low Reactivity</button>
                    <button class="filter-btn" data-filter="high-reactivity">High Reactivity</button>
                </div>
                
                <div class="elements-grid" id="elements-grid">
                    <!-- Elements will be dynamically loaded here -->
                </div>
                
                <!-- Atom Viewer -->
                <div class="atom-viewer-container">
                    <div id="atom-viewer">
                        <div class="atom-loading">
                            <div class="loading-spinner"></div>
                            <p>Loading 3D model...</p>
                        </div>
                    </div>
                    <div class="atom-controls">
                        <button class="atom-control-btn" id="rotate-left-btn">
                            <i class="fas fa-undo"></i>
                            Rotate Left
                        </button>
                        <button class="atom-control-btn" id="rotate-right-btn">
                            <i class="fas fa-redo"></i>
                            Rotate Right
                        </button>
                        <button class="atom-control-btn" id="zoom-in-btn">
                            <i class="fas fa-search-plus"></i>
                            Zoom In
                        </button>
                        <button class="atom-control-btn" id="zoom-out-btn">
                            <i class="fas fa-search-minus"></i>
                            Zoom Out
                        </button>
                        <button class="atom-control-btn" id="reset-view-btn">
                            <i class="fas fa-sync"></i>
                            Reset View
                        </button>
                        <button class="atom-control-btn" id="animate-electrons-btn">
                            <i class="fas fa-play"></i>
                            Animate Electrons
                        </button>
                        <div class="visualization-modes">
                            <button class="viz-mode active" data-mode="default">Default</button>
                            <button class="viz-mode" data-mode="orbital">Orbital</button>
                            <button class="viz-mode" data-mode="simplified">Simplified</button>
                            <button class="viz-mode" data-mode="electron-cloud">Electron Cloud</button>
                        </div>
                    </div>
                </div>
                
                <!-- Element Details -->
                <div class="element-details" id="element-details">
                    <h3 class="text-xl font-semibold text-white mb-4">Select an element to view details</h3>
                    <p class="text-gray-400">Click on any element card above to see its properties and applications.</p>
                </div>
            </section>
            
            <!-- Learn Section -->
            <section id="learn-section" class="content-section">
                <div class="section-header">
                    <h1 class="section-title">Learning Modules</h1>
                    <div class="section-actions">
                        <button class="btn btn-primary" id="compare-btn">
                            <i class="fas fa-balance-scale"></i>
                            Compare Elements
                        </button>
                    </div>
                </div>
                
                <div class="learn-content">
                    <div class="learn-tabs">
                        <div class="learn-tab active" data-tab="group1">Group 1: Alkali Metals</div>
                        <div class="learn-tab" data-tab="group2">Group 2: Alkaline Earth Metals</div>
                    </div>
                    
                    <div class="tab-content active" id="group1-content">
                        <!-- Group 1 content will be loaded here -->
                    </div>
                    
                    <div class="tab-content" id="group2-content">
                        <!-- Group 2 content will be loaded here -->
                    </div>
                </div>
                
                <!-- Comparison Tool -->
                <div class="comparison-tool" id="comparison-tool">
                    <h3 class="text-xl font-semibold text-white mb-4">Element Comparison</h3>
                    <div class="comparison-controls">
                        <select class="comparison-select" id="compare-element-1">
                            <option value="">Select first element</option>
                        </select>
                        <select class="comparison-select" id="compare-element-2">
                            <option value="">Select second element</option>
                        </select>
                        <button class="btn btn-primary" id="compare-elements-btn">
                            <i class="fas fa-exchange-alt"></i>
                            Compare
                        </button>
                    </div>
                    
                    <div class="comparison-results" id="comparison-results">
                        <!-- Comparison results will be displayed here -->
                    </div>
                </div>
            </section>
            
            <!-- Reactions Section -->
            <section id="reactions-section" class="content-section">
                <div class="section-header">
                    <h1 class="section-title">Virtual Lab</h1>
                    <div class="section-actions">
                        <button class="btn btn-secondary" id="safety-guide-btn">
                            <i class="fas fa-info-circle"></i>
                            Safety Guide
                        </button>
                    </div>
                </div>
                
                <div class="reaction-simulator">
                    <div class="reaction-controls">
                        <select class="reaction-select" id="reaction-select">
                            <option value="na-water">Sodium + Water</option>
                            <option value="k-water">Potassium + Water</option>
                            <option value="ca-water">Calcium + Water</option>
                            <option value="mg-water">Magnesium + Steam</option>
                            <option value="li-oxygen">Lithium + Oxygen</option>
                            <option value="na-chlorine">Sodium + Chlorine</option>
                        </select>
                        <button class="btn btn-primary" id="start-reaction-btn">
                            <i class="fas fa-play"></i>
                            Start Reaction
                        </button>
                        <button class="btn btn-secondary" id="reset-reaction-btn">
                            <i class="fas fa-redo"></i>
                            Reset
                        </button>
                        <button class="btn btn-secondary" id="slow-motion-btn">
                            <i class="fas fa-turtle"></i>
                            Slow Motion
                        </button>
                    </div>
                    
                    <div class="reaction-canvas" id="reaction-canvas">
                        <!-- Reaction animation will be displayed here -->
                    </div>
                    
                    <div class="reaction-info">
                        <div class="reaction-equation" id="reaction-equation">
                            2Na + 2HO  2NaOH + H
                        </div>
                        <div class="reaction-description" id="reaction-description">
                            Sodium reacts vigorously with water, producing sodium hydroxide and hydrogen gas. The reaction is exothermic and may cause the hydrogen to ignite.
                        </div>
                        <div class="mt-4">
                            <h4 class="text-lg font-semibold text-white mb-2">Reaction Steps</h4>
                            <div class="reaction-steps" id="reaction-steps">
                                <div class="flex items-center mb-2">
                                    <div class="w-6 h-6 rounded-full bg-blue-500 flex items-center justify-center text-white text-xs mr-2">1</div>
                                    <span class="text-gray-300">Sodium metal is placed in water</span>
                                </div>
                                <div class="flex items-center mb-2">
                                    <div class="w-6 h-6 rounded-full bg-blue-500 flex items-center justify-center text-white text-xs mr-2">2</div>
                                    <span class="text-gray-300">Sodium begins to react, producing hydrogen bubbles</span>
                                </div>
                                <div class="flex items-center">
                                    <div class="w-6 h-6 rounded-full bg-blue-500 flex items-center justify-center text-white text-xs mr-2">3</div>
                                    <span class="text-gray-300">Reaction completes with sodium hydroxide solution</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- Periodic Table Section -->
            <section id="periodic-section" class="content-section">
                <div class="section-header">
                    <h1 class="section-title">Interactive Periodic Table</h1>
                    <div class="section-actions">
                        <button class="btn btn-secondary" id="download-table-btn">
                            <i class="fas fa-download"></i>
                            Download
                        </button>
                    </div>
                </div>
                
                <div class="periodic-table-container">
                    <p class="text-gray-400 mb-4">Click on Group 1 or Group 2 elements to explore their properties.</p>
                    <div class="flex flex-wrap gap-4 mb-4">
                        <div class="flex items-center">
                            <span class="w-4 h-4 bg-blue-500 rounded mr-2"></span>
                            <span class="text-sm">Group 1 (Alkali Metals)</span>
                        </div>
                        <div class="flex items-center">
                            <span class="w-4 h-4 bg-green-500 rounded mr-2"></span>
                            <span class="text-sm">Group 2 (Alkaline Earth Metals)</span>
                        </div>
                    </div>
                    
                    <div class="periodic-table-wrapper">
                        <div class="periodic-table" id="periodic-table">
                            <!-- Periodic table will be generated here -->
                        </div>
                    </div>
                    
                    <div class="periodic-element-info" id="periodic-element-info">
                        <!-- Element details will be displayed here -->
                    </div>
                </div>
            </section>
            
            <!-- Molecular Builder Section -->
            <section id="molecular-section" class="content-section">
                <div class="section-header">
                    <h1 class="section-title">Molecular Builder</h1>
                    <div class="section-actions">
                        <button class="btn btn-primary" id="clear-molecule-btn">
                            <i class="fas fa-trash"></i>
                            Clear
                        </button>
                        <button class="btn btn-secondary" id="save-molecule-btn">
                            <i class="fas fa-save"></i>
                            Save
                        </button>
                        <button class="btn btn-secondary" id="bond-mode-btn">
                            <i class="fas fa-link"></i>
                            Bond Mode
                        </button>
                    </div>
                </div>
                
                <div class="molecular-builder">
                    <h3 class="text-xl font-semibold text-white mb-4">Build Simple Molecules</h3>
                    <div class="element-palette" id="element-palette">
                        <!-- Elements will be loaded here -->
                    </div>
                    
                    <div class="builder-canvas" id="builder-canvas">
                        <div class="flex items-center justify-center h-full text-gray-400">
                            <div class="text-center">
                                <i class="fas fa-project-diagram text-4xl mb-2"></i>
                                <p>Click on elements above and then click on the canvas to build molecules</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-4">
                        <h4 class="text-lg font-semibold text-white mb-2">Instructions:</h4>
                        <ul class="text-gray-400 space-y-1">
                            <li> Select an element from the palette</li>
                            <li> Click on the canvas to place the element</li>
                            <li> Click on another element to create a bond</li>
                            <li> Use the Clear button to start over</li>
                            <li> Enable Bond Mode to create bonds between elements</li>
                        </ul>
                    </div>
                </div>
            </section>
            
            <!-- Pre-Quiz Section -->
            <section id="prequiz-section" class="content-section">
                <div class="section-header">
                    <h1 class="section-title">Pre-Assessment Quiz</h1>
                    <div class="section-actions">
                        <div class="quiz-progress">
                            <span class="quiz-progress-text">Progress: <span id="prequiz-progress-text">0/7</span></span>
                            <div class="progress-bar" style="width: 200px;">
                                <div class="progress-fill" id="prequiz-progress-bar" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="quiz-container">
                    <div class="quiz-questions" id="prequiz-questions">
                        <!-- Quiz questions will be loaded here -->
                    </div>
                    
                    <div class="mt-6 text-center">
                        <button class="btn btn-primary" id="prequiz-submit-btn">
                            <i class="fas fa-check"></i>
                            Submit Answers
                        </button>
                        <div id="prequiz-results" class="mt-4 text-xl font-semibold"></div>
                    </div>
                </div>
            </section>
            
            <!-- Post-Quiz Section -->
            <section id="postquiz-section" class="content-section">
                <div class="section-header">
                    <h1 class="section-title">Final Assessment</h1>
                    <div class="section-actions">
                        <div class="quiz-progress">
                            <span class="quiz-progress-text">Progress: <span id="postquiz-progress-text">0/11</span></span>
                            <div class="progress-bar" style="width: 200px;">
                                <div class="progress-fill" id="postquiz-progress-bar" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="quiz-container">
                    <div class="quiz-questions" id="postquiz-questions">
                        <!-- Quiz questions will be loaded here -->
                    </div>
                    
                    <div class="mt-6 text-center">
                        <button class="btn btn-primary" id="postquiz-submit-btn">
                            <i class="fas fa-check"></i>
                            Submit Answers
                        </button>
                        <div id="postquiz-results" class="mt-4 text-xl font-semibold"></div>
                    </div>
                </div>
            </section>
            
            <!-- Achievements Section -->
            <section id="achievements-section" class="content-section">
                <div class="section-header">
                    <h1 class="section-title">Achievements</h1>
                    <div class="section-actions">
                        <button class="btn btn-secondary" id="share-achievements-btn">
                            <i class="fas fa-share-alt"></i>
                            Share
                        </button>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <div class="bg-white bg-opacity-5 backdrop-filter backdrop-blur-lg border border-white border-opacity-10 rounded-xl p-6 text-center">
                        <div class="w-20 h-20 bg-yellow-500 bg-opacity-20 rounded-full flex items-center justify-center mx-auto mb-4">
                            <i class="fas fa-star text-yellow-500 text-3xl"></i>
                        </div>
                        <h3 class="text-xl font-semibold text-white mb-2">First Steps</h3>
                        <p class="text-gray-400">Complete your first lesson</p>
                        <div class="mt-4">
                            <span class="text-yellow-500"><i class="fas fa-check-circle"></i> Unlocked</span>
                        </div>
                    </div>
                    
                    <div class="bg-white bg-opacity-5 backdrop-filter backdrop-blur-lg border border-white border-opacity-10 rounded-xl p-6 text-center">
                        <div class="w-20 h-20 bg-blue-500 bg-opacity-20 rounded-full flex items-center justify-center mx-auto mb-4">
                            <i class="fas fa-flask text-blue-500 text-3xl"></i>
                        </div>
                        <h3 class="text-xl font-semibold text-white mb-2">Group 1 Expert</h3>
                        <p class="text-gray-400">Master all Group 1 elements</p>
                        <div class="mt-4">
                            <span class="text-gray-500"><i class="fas fa-lock"></i> Locked</span>
                        </div>
                    </div>
                    
                    <div class="bg-white bg-opacity-5 backdrop-filter backdrop-blur-lg border border-white border-opacity-10 rounded-xl p-6 text-center">
                        <div class="w-20 h-20 bg-green-500 bg-opacity-20 rounded-full flex items-center justify-center mx-auto mb-4">
                            <i class="fas fa-graduation-cap text-green-500 text-3xl"></i>
                        </div>
                        <h3 class="text-xl font-semibold text-white mb-2">Group 2 Expert</h3>
                        <p class="text-gray-400">Master all Group 2 elements</p>
                        <div class="mt-4">
                            <span class="text-gray-500"><i class="fas fa-lock"></i> Locked</span>
                        </div>
                    </div>
                    
                    <div class="bg-white bg-opacity-5 backdrop-filter backdrop-blur-lg border border-white border-opacity-10 rounded-xl p-6 text-center">
                        <div class="w-20 h-20 bg-purple-500 bg-opacity-20 rounded-full flex items-center justify-center mx-auto mb-4">
                            <i class="fas fa-atom text-purple-500 text-3xl"></i>
                        </div>
                        <h3 class="text-xl font-semibold text-white mb-2">Element Explorer</h3>
                        <p class="text-gray-400">Explore all elements in detail</p>
                        <div class="mt-4">
                            <span class="text-gray-500"><i class="fas fa-lock"></i> Locked</span>
                        </div>
                    </div>
                    
                    <div class="bg-white bg-opacity-5 backdrop-filter backdrop-blur-lg border border-white border-opacity-10 rounded-xl p-6 text-center">
                        <div class="w-20 h-20 bg-red-500 bg-opacity-20 rounded-full flex items-center justify-center mx-auto mb-4">
                            <i class="fas fa-fire text-red-500 text-3xl"></i>
                        </div>
                        <h3 class="text-xl font-semibold text-white mb-2">7-Day Streak</h3>
                        <p class="text-gray-400">Learn for 7 consecutive days</p>
                        <div class="mt-4">
                            <span class="text-gray-500"><i class="fas fa-lock"></i> Locked</span>
                        </div>
                    </div>
                    
                    <div class="bg-white bg-opacity-5 backdrop-filter backdrop-blur-lg border border-white border-opacity-10 rounded-xl p-6 text-center">
                        <div class="w-20 h-20 bg-indigo-500 bg-opacity-20 rounded-full flex items-center justify-center mx-auto mb-4">
                            <i class="fas fa-project-diagram text-indigo-500 text-3xl"></i>
                        </div>
                        <h3 class="text-xl font-semibold text-white mb-2">Molecular Architect</h3>
                        <p class="text-gray-400">Build 5 different molecules</p>
                        <div class="mt-4">
                            <span class="text-gray-500"><i class="fas fa-lock"></i> Locked</span>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>
    
    <!-- Share Progress Button -->
    <div class="share-progress" id="share-progress">
        <i class="fas fa-share-alt"></i>
        <span>Share Progress</span>
    </div>
    
    <!-- Audio Toggle -->
    <div class="audio-toggle" id="audio-toggle">
        <i class="fas fa-volume-up" id="audio-icon"></i>
        <span id="audio-text">Sound On</span>
    </div>
    
    <!-- Help Button -->
    <div class="help-button" id="help-button">
        <i class="fas fa-question"></i>
    </div>
    
    <!-- Help Modal -->
    <div class="help-modal" id="help-modal">
        <div class="help-content">
            <div class="help-header">
                <h2 class="help-title">Help & Tutorial</h2>
                <button class="help-close" id="help-close">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="help-section">
                <h3 class="help-section-title">Getting Started</h3>
                <div class="help-section-content">
                    <p>Welcome to Group 1 & 2 Chemistry Explorer! This interactive learning platform focuses on the properties and reactions of alkali metals (Group 1) and alkaline earth metals (Group 2).</p>
                    <p class="mt-2">Start by exploring the Elements section to learn about individual elements, then move on to the Learning Modules for detailed explanations.</p>
                </div>
            </div>
            
            <div class="help-section">
                <h3 class="help-section-title">Navigation</h3>
                <div class="help-section-content">
                    <p>Use the sidebar menu to navigate between different sections of the app. On mobile devices, tap the menu button in the top-left corner to access the sidebar.</p>
                    <p class="mt-2">Each section has its own set of tools and features designed to enhance your learning experience.</p>
                </div>
            </div>
            
            <div class="help-section">
                <h3 class="help-section-title">3D Atom Viewer</h3>
                <div class="help-section-content">
                    <p>In the Elements section, you can explore 3D models of atoms. Use the controls to rotate, zoom, and change visualization modes.</p>
                    <p class="mt-2">Click on any element card to view its detailed information and see its 3D model.</p>
                </div>
            </div>
            
            <div class="help-section">
                <h3 class="help-section-title">Virtual Lab</h3>
                <div class="help-section-content">
                    <p>The Virtual Lab allows you to simulate chemical reactions safely. Select a reaction from the dropdown and click "Start Reaction" to begin.</p>
                    <p class="mt-2">You can use the Slow Motion button to observe the reaction steps in detail.</p>
                </div>
            </div>
            
            <div class="help-section">
                <h3 class="help-section-title">Quizzes</h3>
                <div class="help-section-content">
                    <p>Test your knowledge with the Pre-Quiz and Post-Quiz. The Pre-Assessment helps gauge your current understanding, while the Final Assessment measures your progress after completing the learning modules.</p>
                    <p class="mt-2">Quiz questions include multiple choice, drag-and-drop, and fill-in-the-blank formats.</p>
                </div>
            </div>
            
            <div class="help-section">
                <h3 class="help-section-title">Achievements</h3>
                <div class="help-section-content">
                    <p>Earn achievements as you progress through the learning materials. Complete activities, score well on quizzes, and maintain a learning streak to unlock all achievements.</p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Message Box -->
    <div id="message-box" class="message-box hidden">
        <h3 class="message-title">Notification</h3>
        <p class="message-text">This feature is coming soon!</p>
        <button id="close-message-btn" class="message-button">Close</button>
    </div>
    
    <!-- Notification Toast -->
    <div id="notification-toast" class="notification-toast">
        <i class="fas fa-check-circle notification-icon success"></i>
        <span class="notification-text">Notification text</span>
    </div>
    
    <!-- Element Tooltip -->
    <div id="element-tooltip" class="element-tooltip">
        <div class="element-tooltip-title">Element Name</div>
        <div class="element-tooltip-text">Element description</div>
    </div>
    
    <!-- Safety Guide Modal -->
    <div class="help-modal" id="safety-modal">
        <div class="help-content">
            <div class="help-header">
                <h2 class="help-title">Laboratory Safety Guide</h2>
                <button class="help-close" id="safety-close">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="help-section">
                <h3 class="help-section-title">Group 1: Alkali Metals Safety</h3>
                <div class="help-section-content">
                    <p>Alkali metals are highly reactive and require special handling precautions:</p>
                    <ul class="list-disc list-inside mt-2 space-y-1">
                        <li>Store under oil to prevent reaction with air and moisture</li>
                        <li>Handle with tongs and wear protective equipment</li>
                        <li>Keep away from water as reactions can be violent</li>
                        <li>Use small quantities for experiments</li>
                        <li>Have a fire extinguisher nearby</li>
                    </ul>
                </div>
            </div>
            
            <div class="help-section">
                <h3 class="help-section-title">Group 2: Alkaline Earth Metals Safety</h3>
                <div class="help-section-content">
                    <p>While less reactive than alkali metals, alkaline earth metals still require caution:</p>
                    <ul class="list-disc list-inside mt-2 space-y-1">
                        <li>Store in a dry environment</li>
                        <li>Avoid contact with water, especially powdered forms</li>
                        <li>Barium compounds are toxic - handle with gloves</li>
                        <li>Use in well-ventilated areas</li>
                    </ul>
                </div>
            </div>
            
            <div class="help-section">
                <h3 class="help-section-title">General Safety Practices</h3>
                <div class="help-section-content">
                    <ul class="list-disc list-inside mt-2 space-y-1">
                        <li>Always wear safety goggles and lab coat</li>
                        <li>Know the location of safety equipment</li>
                        <li>Never work alone in the lab</li>
                        <li>Dispose of chemicals properly</li>
                        <li>Wash hands thoroughly after experiments</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Firebase SDKs and all application logic -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInWithCustomToken, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, onSnapshot, collection, query, doc, setDoc, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        
        // Firebase Global Variables
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
        
        let db, auth, userId;
        let isAuthReady = false;
        
        // Elements Data
        const elementsData = {
            "Lithium": { 
                group: 'I', 
                atomicNumber: 3, 
                protons: 3, 
                neutrons: 4, 
                electrons: 3, 
                symbol: 'Li', 
                electronConfiguration: "2,1",
                meltingPoint: "181 C", 
                boilingPoint: "1342 C",
                period: 2,
                funFact: "The least reactive alkali metal, used in rechargeable batteries.",
                image: "https://upload.wikimedia.org/wikipedia/commons/thumb/e/ed/Lithiumcut_cropped.jpg/1198px-Lithiumcut_cropped.jpg",
                applications: [
                    "Rechargeable batteries (lithium-ion)",
                    "Treatment for bipolar disorder",
                    "Alloying agent to improve strength and lightness",
                    "Grease lubricants"
                ],
                reactivity: "low"
            },
            "Sodium": { 
                group: 'I', 
                atomicNumber: 11, 
                protons: 11, 
                neutrons: 12, 
                electrons: 11, 
                symbol: 'Na', 
                electronConfiguration: "2,8,1",
                meltingPoint: "98 C", 
                boilingPoint: "883 C",
                period: 3,
                funFact: "Reacts vigorously with water, producing hydrogen gas and sodium hydroxide.",
                image: "https://upload.wikimedia.org/wikipedia/commons/2/27/Na_%28Sodium%29.jpg",
                applications: [
                    "Table salt (sodium chloride)",
                    "Street lighting (sodium vapor lamps)",
                    "Soap manufacturing",
                    "Food preservation"
                ],
                reactivity: "medium"
            },
            "Potassium": { 
                group: 'I', 
                atomicNumber: 19, 
                protons: 19, 
                neutrons: 20, 
                electrons: 19, 
                symbol: 'K', 
                electronConfiguration: "2,8,8,1",
                meltingPoint: "63 C", 
                boilingPoint: "759 C",
                period: 4,
                funFact: "More reactive than sodium, burns with a lilac flame.",
                image: "https://cdn.britannica.com/77/131177-050-79292189/fragments-Potassium-metal.jpg",
                applications: [
                    "Fertilizers (potassium compounds)",
                    "Soap manufacturing",
                    "Glass production",
                    "Essential nutrient for plants and animals"
                ],
                reactivity: "high"
            },
            "Rubidium": { 
                group: 'I', 
                atomicNumber: 37, 
                protons: 37, 
                neutrons: 48, 
                electrons: 37, 
                symbol: 'Rb', 
                electronConfiguration: "2,8,18,8,1",
                meltingPoint: "39 C", 
                boilingPoint: "688 C",
                period: 5,
                funFact: "Very reactive, ignites spontaneously in air.",
                image: "https://upload.wikimedia.org/wikipedia/commons/c/c9/Rb5.JPG",
                applications: [
                    "Specialty glasses",
                    "Atomic clocks",
                    "Photoelectric cells",
                    "Research in ion propulsion systems"
                ],
                reactivity: "very-high"
            },
            "Cesium": { 
                group: 'I', 
                atomicNumber: 55, 
                protons: 55, 
                neutrons: 78, 
                electrons: 55, 
                symbol: 'Cs', 
                electronConfiguration: "2,8,18,18,8,1",
                meltingPoint: "28.5 C", 
                boilingPoint: "671 C",
                period: 6,
                funFact: "Used in atomic clocks, the most reactive alkali metal studied in school labs.",
                image: "https://upload.wikimedia.org/wikipedia/commons/3/3d/Cesium.jpg",
                applications: [
                    "Atomic clocks (most accurate timekeeping)",
                    "Photoelectric cells",
                    "Drilling fluids",
                    "Ion propulsion spacecraft engines"
                ],
                reactivity: "very-high"
            },
            "Francium": { 
                group: 'I', 
                atomicNumber: 87, 
                protons: 87, 
                neutrons: 136, 
                electrons: 87, 
                symbol: 'Fr', 
                electronConfiguration: "2,8,18,32,18,8,1",
                meltingPoint: "27 C", 
                boilingPoint: "677 C",
                period: 7,
                funFact: "So radioactive it's almost never seen; the most reactive alkali metal.",
                image: "https://www.arhse.com/wp-content/uploads/2023/01/francium.png",
                applications: [
                    "Scientific research only",
                    "Potential use in cancer treatment (under research)",
                    "No commercial applications due to extreme rarity and radioactivity"
                ],
                reactivity: "very-high"
            },
            "Beryllium": { 
                group: 'II', 
                atomicNumber: 4, 
                protons: 4, 
                neutrons: 5, 
                electrons: 4, 
                symbol: 'Be', 
                electronConfiguration: "2,2",
                meltingPoint: "1287 C", 
                boilingPoint: "2471 C",
                period: 2,
                funFact: "Lightweight and very strong, used in aerospace materials.",
                image: "https://upload.wikimedia.org/wikipedia/commons/0/0c/Be-140g.jpg",
                applications: [
                    "Aerospace components (lightweight and strong)",
                    "X-ray equipment windows",
                    "Alloys with copper for springs and electrical contacts",
                    "Nuclear reactors as a neutron reflector"
                ],
                reactivity: "very-low"
            },
            "Magnesium": { 
                group: 'II', 
                atomicNumber: 12, 
                protons: 12, 
                neutrons: 12, 
                electrons: 12, 
                symbol: 'Mg', 
                electronConfiguration: "2,8,2",
                meltingPoint: "650 C", 
                boilingPoint: "1090 C",
                period: 3,
                funFact: "Burns with a brilliant white flame, used in fireworks.",
                image: "https://upload.wikimedia.org/wikipedia/commons/thumb/5/5c/CSIRO_ScienceImage_2893_Crystalised_magnesium.jpg/1196px-CSIRO_ScienceImage_2893_Crystalised_magnesium.jpg",
                applications: [
                    "Fireworks and flares (white flame)",
                    "Lightweight alloys (aircraft, cars)",
                    "Antacid medications",
                    "Photography flashbulbs"
                ],
                reactivity: "low"
            },
            "Calcium": { 
                group: 'II', 
                atomicNumber: 20, 
                protons: 20, 
                neutrons: 20, 
                electrons: 20, 
                symbol: 'Ca', 
                electronConfiguration: "2,8,8,2",
                meltingPoint: "842 C", 
                boilingPoint: "1484 C",
                period: 4,
                funFact: "Important for bones and teeth, reacts with water to form calcium hydroxide.",
                image: "https://upload.wikimedia.org/wikipedia/commons/thumb/9/96/Calcium_unter_Argon_Schutzgasatmosph%C3%A4re.jpg/1280px-Calcium_unter_Argon_Schutzgasatmosph%C3%A4re.jpg",
                applications: [
                    "Building materials (cement, concrete)",
                    "Dietary supplements for bone health",
                    "Food preservation",
                    "Water treatment"
                ],
                reactivity: "medium"
            },
            "Strontium": { 
                group: 'II', 
                atomicNumber: 38, 
                protons: 38, 
                neutrons: 50, 
                electrons: 38, 
                symbol: 'Sr', 
                electronConfiguration: "2,8,18,8,2",
                meltingPoint: "777 C", 
                boilingPoint: "1382 C",
                period: 5,
                funFact: "Produces a bright red flame, used in fireworks and flares.",
                image: "https://upload.wikimedia.org/wikipedia/commons/thumb/4/41/Strontium_destilled_crystals.jpg/1280px-Strontium_destilled_crystals.jpg",
                applications: [
                    "Fireworks (red flame)",
                    "Flares",
                    "Ferrite magnets",
                    "Treatment for osteoporosis"
                ],
                reactivity: "medium"
            },
            "Barium": { 
                group: 'II', 
                atomicNumber: 56, 
                protons: 56, 
                neutrons: 81, 
                electrons: 56, 
                symbol: 'Ba', 
                electronConfiguration: "2,8,18,18,8,2",
                meltingPoint: "727 C", 
                boilingPoint: "1870 C",
                period: 6,
                funFact: "Gives a green flame, used in fireworks.",
                image: "https://upload.wikimedia.org/wikipedia/commons/1/16/Barium_unter_Argon_Schutzgas_Atmosph%C3%A4re.jpg",
                applications: [
                    "Fireworks (green flame)",
                    "Medical imaging (barium meals for X-rays)",
                    "Drilling fluids",
                    "Glass manufacturing"
                ],
                reactivity: "high"
            },
            "Radium": { 
                group: 'II', 
                atomicNumber: 88, 
                protons: 88, 
                neutrons: 138, 
                electrons: 88, 
                symbol: 'Ra', 
                electronConfiguration: "2,8,18,32,18,8,2",
                meltingPoint: "700 C", 
                boilingPoint: "1737 C",
                period: 7,
                funFact: "Highly radioactive, once used in glow-in-the-dark paint but now considered too dangerous.",
                image: "https://upload.wikimedia.org/wikipedia/commons/thumb/b/bb/Radium226.jpg/500px-Radium226.jpg",
                applications: [
                    "Historical use in luminous paints (discontinued)",
                    "Cancer treatment (radiotherapy)",
                    "Scientific research",
                    "No commercial applications due to extreme radioactivity"
                ],
                reactivity: "high"
            }
        };
        
        // Learn Content
        const learnContent = {
            group1: `
                <h2 class="text-2xl font-bold text-white mb-6">Group 1: Alkali Metals (Li, Na, K, Rb, Cs, Fr)</h2>
                
                <div class="bg-white bg-opacity-5 backdrop-filter backdrop-blur-lg border border-white border-opacity-10 rounded-xl p-6 mb-6">
                    <h3 class="text-xl font-semibold text-white mb-4">General Properties</h3>
                    <ul class="space-y-3 text-gray-300">
                        <li class="flex items-start">
                            <i class="fas fa-check-circle text-green-500 mt-1 mr-3"></i>
                            <span><strong class="text-white">Shiny and soft:</strong> Fresh metals have a metallic luster but are soft and can be cut with a knife.</span>
                        </li>
                        <li class="flex items-start">
                            <i class="fas fa-check-circle text-green-500 mt-1 mr-3"></i>
                            <span><strong class="text-white">Low density:</strong> Li, Na, and K are less dense than water (they float!).</span>
                        </li>
                        <li class="flex items-start">
                            <i class="fas fa-check-circle text-green-500 mt-1 mr-3"></i>
                            <span><strong class="text-white">Low melting and boiling points:</strong> Decrease down the group (Li highest, Cs lowest).</span>
                        </li>
                        <li class="flex items-start">
                            <i class="fas fa-check-circle text-green-500 mt-1 mr-3"></i>
                            <span><strong class="text-white">Form basic oxides and hydroxides:</strong> React with water to produce alkaline solutions.</span>
                        </li>
                        <li class="flex items-start">
                            <i class="fas fa-check-circle text-green-500 mt-1 mr-3"></i>
                            <span><strong class="text-white">Highly reactive:</strong> Reactivity increases down the group (Li < Na < K < Rb < Cs).</span>
                        </li>
                    </ul>
                </div>
                
                <div class="bg-white bg-opacity-5 backdrop-filter backdrop-blur-lg border border-white border-opacity-10 rounded-xl p-6 mb-6">
                    <h3 class="text-xl font-semibold text-white mb-4">Physical Properties</h3>
                    <div class="overflow-x-auto">
                        <table class="w-full text-left">
                            <thead>
                                <tr class="border-b border-white border-opacity-10">
                                    <th class="pb-3 text-gray-400">Property</th>
                                    <th class="pb-3 text-gray-400">Trend Down the Group</th>
                                    <th class="pb-3 text-gray-400">Example</th>
                                </tr>
                            </thead>
                            <tbody class="text-gray-300">
                                <tr class="border-b border-white border-opacity-5">
                                    <td class="py-3">Density</td>
                                    <td class="py-3">Increases (except K < Na)</td>
                                    <td class="py-3">Li: 0.53 g/cm, Na: 0.97 g/cm, K: 0.86 g/cm</td>
                                </tr>
                                <tr class="border-b border-white border-opacity-5">
                                    <td class="py-3">Melting/Boiling point</td>
                                    <td class="py-3">Decreases</td>
                                    <td class="py-3">Li: 180C, Na: 98C, K: 63C</td>
                                </tr>
                                <tr>
                                    <td class="py-3">Hardness</td>
                                    <td class="py-3">Decreases</td>
                                    <td class="py-3">Li: hard, Cs: very soft</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <div class="bg-white bg-opacity-5 backdrop-filter backdrop-blur-lg border border-white border-opacity-10 rounded-xl p-6 mb-6">
                    <h3 class="text-xl font-semibold text-white mb-4">Chemical Properties</h3>
                    
                    <div class="mb-6">
                        <h4 class="text-lg font-semibold text-blue-400 mb-3">Reaction with Water</h4>
                        <p class="text-gray-300 mb-3">Produces hydrogen gas and an alkaline solution of metal hydroxide.</p>
                        <div class="bg-gray-800 bg-opacity-50 rounded-lg p-4 mb-3">
                            <p class="text-white font-mono">2Na + 2HO  2NaOH + H</p>
                        </div>
                        <div class="bg-blue-900 bg-opacity-20 border-l-4 border-blue-500 p-4 rounded">
                            <p class="text-blue-300"><strong>Observation:</strong></p>
                            <ul class="mt-2 space-y-1 text-gray-300">
                                <li> Effervescence (bubbles of H)</li>
                                <li> Metal moves on water surface</li>
                                <li> Heat released (sometimes ignites H, especially K, Rb, Cs)</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="mb-6">
                        <h4 class="text-lg font-semibold text-blue-400 mb-3">Reaction with Oxygen</h4>
                        <div class="bg-gray-800 bg-opacity-50 rounded-lg p-4">
                            <p class="text-white font-mono">4Li + O  2LiO (lithium oxide)</p>
                            <p class="text-white font-mono">2Na + O  NaO (sodium peroxide)</p>
                            <p class="text-white font-mono">K + O  KO (potassium superoxide)</p>
                        </div>
                    </div>
                </div>
                
                <div class="bg-yellow-900 bg-opacity-20 border-l-4 border-yellow-500 p-6 rounded-xl">
                    <h3 class="text-xl font-semibold text-white mb-4">Safety Notes</h3>
                    <ul class="space-y-2 text-yellow-200">
                        <li class="flex items-start">
                            <i class="fas fa-exclamation-triangle mt-1 mr-3"></i>
                            <span>Alkali metals are very reactive, especially with water.</span>
                        </li>
                        <li class="flex items-start">
                            <i class="fas fa-exclamation-triangle mt-1 mr-3"></i>
                            <span>Store under oil to prevent reaction with air/moisture.</span>
                        </li>
                        <li class="flex items-start">
                            <i class="fas fa-exclamation-triangle mt-1 mr-3"></i>
                            <span>Handle with tongs and protective equipment in labs.</span>
                        </li>
                    </ul>
                </div>
            `,
            group2: `
                <h2 class="text-2xl font-bold text-white mb-6">Group 2: Alkaline Earth Metals (Be, Mg, Ca, Sr, Ba, Ra)</h2>
                
                <div class="bg-white bg-opacity-5 backdrop-filter backdrop-blur-lg border border-white border-opacity-10 rounded-xl p-6 mb-6">
                    <h3 class="text-xl font-semibold text-white mb-4">General Properties</h3>
                    <ul class="space-y-3 text-gray-300">
                        <li class="flex items-start">
                            <i class="fas fa-check-circle text-green-500 mt-1 mr-3"></i>
                            <span><strong class="text-white">Shiny and metallic:</strong> Fresh metals have a metallic luster; slightly harder than Group 1 metals.</span>
                        </li>
                        <li class="flex items-start">
                            <i class="fas fa-check-circle text-green-500 mt-1 mr-3"></i>
                            <span><strong class="text-white">Reactive, but less than Group 1:</strong> Reactivity increases down the group.</span>
                        </li>
                        <li class="flex items-start">
                            <i class="fas fa-check-circle text-green-500 mt-1 mr-3"></i>
                            <span><strong class="text-white">Form basic oxides and hydroxides:</strong> Produce alkaline solutions in water.</span>
                        </li>
                        <li class="flex items-start">
                            <i class="fas fa-check-circle text-green-500 mt-1 mr-3"></i>
                            <span><strong class="text-white">Divalent metals:</strong> Form ions with a +2 charge (e.g., Ca, Mg).</span>
                        </li>
                    </ul>
                </div>
                
                <div class="bg-white bg-opacity-5 backdrop-filter backdrop-blur-lg border border-white border-opacity-10 rounded-xl p-6 mb-6">
                    <h3 class="text-xl font-semibold text-white mb-4">Physical Properties</h3>
                    <div class="overflow-x-auto">
                        <table class="w-full text-left">
                            <thead>
                                <tr class="border-b border-white border-opacity-10">
                                    <th class="pb-3 text-gray-400">Property</th>
                                    <th class="pb-3 text-gray-400">Trend Down the Group</th>
                                    <th class="pb-3 text-gray-400">Example</th>
                                </tr>
                            </thead>
                            <tbody class="text-gray-300">
                                <tr class="border-b border-white border-opacity-5">
                                    <td class="py-3">Density</td>
                                    <td class="py-3">Increases</td>
                                    <td class="py-3">Be: 1.85 g/cm, Mg: 1.74 g/cm, Ca: 1.55 g/cm</td>
                                </tr>
                                <tr class="border-b border-white border-opacity-5">
                                    <td class="py-3">Melting/Boiling point</td>
                                    <td class="py-3">Decreases</td>
                                    <td class="py-3">Be: 1287C, Mg: 650C, Ba: 725C</td>
                                </tr>
                                <tr>
                                    <td class="py-3">Hardness</td>
                                    <td class="py-3">Decreases</td>
                                    <td class="py-3">Be: hard, Ba: soft</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <div class="bg-white bg-opacity-5 backdrop-filter backdrop-blur-lg border border-white border-opacity-10 rounded-xl p-6 mb-6">
                    <h3 class="text-xl font-semibold text-white mb-4">Chemical Properties</h3>
                    
                    <div class="mb-6">
                        <h4 class="text-lg font-semibold text-green-400 mb-3">Reaction with Water</h4>
                        <p class="text-gray-300 mb-3">Be and Mg: Do not react with cold water; react slowly with steam.</p>
                        <p class="text-gray-300 mb-3">Ca, Sr, Ba: React with cold water to form hydroxides and hydrogen gas.</p>
                        <div class="bg-gray-800 bg-opacity-50 rounded-lg p-4 mb-3">
                            <p class="text-white font-mono">Ca + 2HO  Ca(OH) + H</p>
                            <p class="text-white font-mono">Mg + HO(steam)  MgO + H</p>
                        </div>
                        <div class="bg-green-900 bg-opacity-20 border-l-4 border-green-500 p-4 rounded">
                            <p class="text-green-300"><strong>Observation:</strong></p>
                            <ul class="mt-2 space-y-1 text-gray-300">
                                <li> Effervescence (bubbles of H)</li>
                                <li> Metal dissolves slowly or floats on water</li>
                            </ul>
                        </div>
                    </div>
                </div>
                
                <div class="bg-yellow-900 bg-opacity-20 border-l-4 border-yellow-500 p-6 rounded-xl">
                    <h3 class="text-xl font-semibold text-white mb-4">Safety Notes</h3>
                    <ul class="space-y-2 text-yellow-200">
                        <li class="flex items-start">
                            <i class="fas fa-exclamation-triangle mt-1 mr-3"></i>
                            <span>Store metals away from moisture to prevent unwanted reactions.</span>
                        </li>
                        <li class="flex items-start">
                            <i class="fas fa-exclamation-triangle mt-1 mr-3"></i>
                            <span>Ba compounds (except BaSO) are toxic  handle with care.</span>
                        </li>
                        <li class="flex items-start">
                            <i class="fas fa-exclamation-triangle mt-1 mr-3"></i>
                            <span>Use protective equipment during experiments.</span>
                        </li>
                    </ul>
                </div>
            `
        };
        
        // Quiz Questions
        const preQuizQuestions = [
            {
                type: 'multiple-choice',
                question: "Which Group 1 metal floats on water?",
                options: ["Lithium", "Sodium", "Potassium", "Cesium"],
                answer: "Lithium"
            },
            {
                type: 'multiple-choice',
                question: "Which metal reacts most vigorously with water?",
                options: ["Sodium", "Potassium", "Lithium", "Magnesium"],
                answer: "Potassium"
            },
            {
                type: 'drag-and-drop',
                question: "Match the metal to the gas released when reacting with water:",
                items: ["Li", "Na", "K", "Ca", "Mg"],
                answer: ["Li  H", "Na  H", "K  H", "Ca  H", "Mg  H"]
            },
            {
                type: 'multiple-choice',
                question: "Which Group 2 metal reacts very slowly with cold water but faster with steam?",
                options: ["Calcium", "Magnesium", "Barium", "Strontium"],
                answer: "Magnesium"
            },
            {
                type: 'click-to-select',
                question: "Which oxide is formed when potassium reacts with oxygen?",
                options: ["KO", "KO", "KO", "KO"],
                answer: "KO"
            },
            {
                type: 'multiple-choice',
                question: "Which hydroxide is most soluble in water?",
                options: ["Mg(OH)", "Ca(OH)", "Ba(OH)", "Be(OH)"],
                answer: "Ba(OH)"
            },
            {
                type: 'drag-and-drop',
                question: "Arrange these metals from least reactive to most reactive with water:",
                items: ["Li", "Na", "K", "Ca"],
                answer: ["Li", "Ca", "Na", "K"]
            }
        ];
        
        const postQuizQuestions = [
            {
                type: 'multiple-choice',
                question: "Which statement correctly describes the outer electron configuration?",
                options: ["A. Group 1  ns, Group 2  ns", "B. Group 1  ns, Group 2  ns", "C. Both  ns", "D. Both  ns"],
                answer: "B. Group 1  ns, Group 2  ns"
            },
            {
                type: 'fill-in-the-blank',
                question: "Complete the equation for calcium reacting with water:",
                textBefore: "Equation: ",
                equation: "Ca + 2HO  ",
                blanks: [
                    { name: 'product', answer: 'Ca(OH)' },
                    { name: 'gas', answer: 'H' }
                ]
            },
            {
                type: 'drag-and-drop',
                question: "Place the metals in order of increasing reactivity:",
                items: ["Lithium (Li)", "Sodium (Na)", "Potassium (K)", "Cesium (Cs)"],
                answer: ["Lithium (Li)", "Sodium (Na)", "Potassium (K)", "Cesium (Cs)"]
            },
            {
                type: 'mcq-flame-colours',
                question: "Match the correct flame colour to each:",
                subQuestions: [
                    { label: "Lithium", options: ["Crimson red", "Lilac", "Brick red", "Apple green"], answer: "Crimson red" },
                    { label: "Potassium", options: ["Crimson red", "Lilac", "Brick red", "Apple green"], answer: "Lilac" },
                    { label: "Calcium", options: ["Crimson red", "Lilac", "Brick red", "Apple green"], answer: "Brick red" },
                    { label: "Barium", options: ["Crimson red", "Lilac", "Brick red", "Apple green"], answer: "Apple green" },
                ]
            },
            {
                type: 'short-answer',
                question: "What is the charge on the ion formed by:",
                subQuestions: [
                    { label: "Magnesium", answer: "+2" },
                    { label: "Sodium", answer: "+1" },
                ]
            },
            {
                type: 'true-or-false',
                question: "Group 1 density increases steadily with atomic number.",
                answer: "False",
                explanation: "(Irregular trend)"
            },
            {
                type: 'true-or-false',
                question: "Group 2 hydroxides become more soluble down the group.",
                answer: "True"
            },
            {
                type: 'multiple-choice',
                question: "Why is potassium stored under oil?",
                options: ["A. To reduce melting point", "B. To prevent contact with oxygen and moisture in air", "C. To make it more reactive", "D. To slow tarnishing only"],
                answer: "B. To prevent contact with oxygen and moisture in air"
            },
            {
                type: 'equation-balancing',
                question: "Balance the equation for the decomposition of magnesium carbonate:",
                equation: "MgCO  MgO + CO",
                blanks: [
                    { name: 'MgCO', answer: '1' },
                    { name: 'MgO', answer: '1' },
                    { name: 'CO', answer: '1' }
                ]
            },
            {
                type: 'match-the-pair',
                question: "Match the observation to the metal:",
                items: [
                    { observation: "Fizzes gently, moves slowly", metal: "Lithium" },
                    { observation: "Lilac flame during reaction", metal: "Potassium" },
                    { observation: "Brick red flame, steady bubbling", metal: "Calcium" }
                ],
                matches: {
                    "Fizzes gently, moves slowly": "Lithium",
                    "Lilac flame during reaction": "Potassium",
                    "Brick red flame, steady bubbling": "Calcium"
                }
            },
            {
                type: 'extended-response',
                question: "Explain two differences in chemical reactivity between Group 1 and Group 2 metals, relating your answer to their electronic structures.",
                answer: "Group 1 metals have one outer electron, Group 2 have two; Group 1 metals lose their outer electron more easily, so they are more reactive; Group 2 metals form hydroxides that are less soluble than those of Group 1."
            }
        ];
        
        // Reaction Data
        const reactionData = {
            "na-water": {
                equation: "2Na + 2HO  2NaOH + H",
                description: "Sodium reacts vigorously with water, producing sodium hydroxide and hydrogen gas. The reaction is exothermic and may cause the hydrogen to ignite.",
                animationSteps: [
                    { time: 0, description: "Sodium metal is placed in water" },
                    { time: 1000, description: "Sodium begins to react, producing hydrogen bubbles" },
                    { time: 2000, description: "Reaction intensifies, sodium may melt and move rapidly" },
                    { time: 3000, description: "Hydrogen gas may ignite if reaction is vigorous enough" }
                ]
            },
            "k-water": {
                equation: "2K + 2HO  2KOH + H",
                description: "Potassium reacts very vigorously with water, producing potassium hydroxide and hydrogen gas. The reaction is highly exothermic and usually ignites the hydrogen gas, producing a lilac flame.",
                animationSteps: [
                    { time: 0, description: "Potassium metal is placed in water" },
                    { time: 500, description: "Immediate vigorous reaction with hydrogen bubbles" },
                    { time: 1000, description: "Hydrogen gas ignites, producing a lilac flame" },
                    { time: 2000, description: "Reaction completes with potassium hydroxide solution" }
                ]
            },
            "ca-water": {
                equation: "Ca + 2HO  Ca(OH) + H",
                description: "Calcium reacts steadily with cold water, producing calcium hydroxide and hydrogen gas. The reaction is less vigorous than with Group 1 metals.",
                animationSteps: [
                    { time: 0, description: "Calcium metal is placed in water" },
                    { time: 1000, description: "Steady reaction produces hydrogen bubbles" },
                    { time: 2000, description: "Solution becomes cloudy due to calcium hydroxide formation" },
                    { time: 3000, description: "Reaction continues until calcium is consumed" }
                ]
            },
            "mg-water": {
                equation: "Mg + HO  MgO + H",
                description: "Magnesium reacts very slowly with cold water but reacts with steam to produce magnesium oxide and hydrogen gas.",
                animationSteps: [
                    { time: 0, description: "Magnesium metal is exposed to steam" },
                    { time: 1000, description: "Reaction begins, producing hydrogen gas" },
                    { time: 2000, description: "White magnesium oxide powder forms" },
                    { time: 3000, description: "Reaction completes with magnesium oxide residue" }
                ]
            },
            "li-oxygen": {
                equation: "4Li + O  2LiO",
                description: "Lithium burns in oxygen with a crimson-red flame to form lithium oxide.",
                animationSteps: [
                    { time: 0, description: "Lithium metal is heated in oxygen" },
                    { time: 1000, description: "Lithium begins to burn with crimson-red flame" },
                    { time: 2000, description: "White lithium oxide powder forms" },
                    { time: 3000, description: "Reaction completes with lithium oxide residue" }
                ]
            },
            "na-chlorine": {
                equation: "2Na + Cl  2NaCl",
                description: "Sodium reacts vigorously with chlorine gas to form sodium chloride (table salt). The reaction is highly exothermic.",
                animationSteps: [
                    { time: 0, description: "Sodium metal is exposed to chlorine gas" },
                    { time: 500, description: "Immediate vigorous reaction with bright flame" },
                    { time: 1000, description: "White sodium chloride crystals form" },
                    { time: 2000, description: "Reaction completes with sodium chloride product" }
                ]
            }
        };
        
        // Periodic Table Data
        const periodicTableData = [
            { symbol: "H", name: "Hydrogen", number: 1, group: 1, period: 1, type: "other" },
            { symbol: "He", name: "Helium", number: 2, group: 18, period: 1, type: "other" },
            { symbol: "Li", name: "Lithium", number: 3, group: 1, period: 2, type: "group1" },
            { symbol: "Be", name: "Beryllium", number: 4, group: 2, period: 2, type: "group2" },
            { symbol: "B", name: "Boron", number: 5, group: 13, period: 2, type: "other" },
            { symbol: "C", name: "Carbon", number: 6, group: 14, period: 2, type: "other" },
            { symbol: "N", name: "Nitrogen", number: 7, group: 15, period: 2, type: "other" },
            { symbol: "O", name: "Oxygen", number: 8, group: 16, period: 2, type: "other" },
            { symbol: "F", name: "Fluorine", number: 9, group: 17, period: 2, type: "other" },
            { symbol: "Ne", name: "Neon", number: 10, group: 18, period: 2, type: "other" },
            { symbol: "Na", name: "Sodium", number: 11, group: 1, period: 3, type: "group1" },
            { symbol: "Mg", name: "Magnesium", number: 12, group: 2, period: 3, type: "group2" },
            { symbol: "Al", name: "Aluminum", number: 13, group: 13, period: 3, type: "other" },
            { symbol: "Si", name: "Silicon", number: 14, group: 14, period: 3, type: "other" },
            { symbol: "P", name: "Phosphorus", number: 15, group: 15, period: 3, type: "other" },
            { symbol: "S", name: "Sulfur", number: 16, group: 16, period: 3, type: "other" },
            { symbol: "Cl", name: "Chlorine", number: 17, group: 17, period: 3, type: "other" },
            { symbol: "Ar", name: "Argon", number: 18, group: 18, period: 3, type: "other" },
            { symbol: "K", name: "Potassium", number: 19, group: 1, period: 4, type: "group1" },
            { symbol: "Ca", name: "Calcium", number: 20, group: 2, period: 4, type: "group2" },
            { symbol: "Sc", name: "Scandium", number: 21, group: 3, period: 4, type: "other" },
            { symbol: "Ti", name: "Titanium", number: 22, group: 4, period: 4, type: "other" },
            { symbol: "V", name: "Vanadium", number: 23, group: 5, period: 4, type: "other" },
            { symbol: "Cr", name: "Chromium", number: 24, group: 6, period: 4, type: "other" },
            { symbol: "Mn", name: "Manganese", number: 25, group: 7, period: 4, type: "other" },
            { symbol: "Fe", name: "Iron", number: 26, group: 8, period: 4, type: "other" },
            { symbol: "Co", name: "Cobalt", number: 27, group: 9, period: 4, type: "other" },
            { symbol: "Ni", name: "Nickel", number: 28, group: 10, period: 4, type: "other" },
            { symbol: "Cu", name: "Copper", number: 29, group: 11, period: 4, type: "other" },
            { symbol: "Zn", name: "Zinc", number: 30, group: 12, period: 4, type: "other" },
            { symbol: "Ga", name: "Gallium", number: 31, group: 13, period: 4, type: "other" },
            { symbol: "Ge", name: "Germanium", number: 32, group: 14, period: 4, type: "other" },
            { symbol: "As", name: "Arsenic", number: 33, group: 15, period: 4, type: "other" },
            { symbol: "Se", name: "Selenium", number: 34, group: 16, period: 4, type: "other" },
            { symbol: "Br", name: "Bromine", number: 35, group: 17, period: 4, type: "other" },
            { symbol: "Kr", name: "Krypton", number: 36, group: 18, period: 4, type: "other" },
            { symbol: "Rb", name: "Rubidium", number: 37, group: 1, period: 5, type: "group1" },
            { symbol: "Sr", name: "Strontium", number: 38, group: 2, period: 5, type: "group2" },
            { symbol: "Y", name: "Yttrium", number: 39, group: 3, period: 5, type: "other" },
            { symbol: "Zr", name: "Zirconium", number: 40, group: 4, period: 5, type: "other" },
            { symbol: "Nb", name: "Niobium", number: 41, group: 5, period: 5, type: "other" },
            { symbol: "Mo", name: "Molybdenum", number: 42, group: 6, period: 5, type: "other" },
            { symbol: "Tc", name: "Technetium", number: 43, group: 7, period: 5, type: "other" },
            { symbol: "Ru", name: "Ruthenium", number: 44, group: 8, period: 5, type: "other" },
            { symbol: "Rh", name: "Rhodium", number: 45, group: 9, period: 5, type: "other" },
            { symbol: "Pd", name: "Palladium", number: 46, group: 10, period: 5, type: "other" },
            { symbol: "Ag", name: "Silver", number: 47, group: 11, period: 5, type: "other" },
            { symbol: "Cd", name: "Cadmium", number: 48, group: 12, period: 5, type: "other" },
            { symbol: "In", name: "Indium", number: 49, group: 13, period: 5, type: "other" },
            { symbol: "Sn", name: "Tin", number: 50, group: 14, period: 5, type: "other" },
            { symbol: "Sb", name: "Antimony", number: 51, group: 15, period: 5, type: "other" },
            { symbol: "Te", name: "Tellurium", number: 52, group: 16, period: 5, type: "other" },
            { symbol: "I", name: "Iodine", number: 53, group: 17, period: 5, type: "other" },
            { symbol: "Xe", name: "Xenon", number: 54, group: 18, period: 5, type: "other" },
            { symbol: "Cs", name: "Cesium", number: 55, group: 1, period: 6, type: "group1" },
            { symbol: "Ba", name: "Barium", number: 56, group: 2, period: 6, type: "group2" },
            { symbol: "La", name: "Lanthanum", number: 57, group: 3, period: 6, type: "other" },
            { symbol: "Ce", name: "Cerium", number: 58, group: 4, period: 6, type: "other" },
            { symbol: "Pr", name: "Praseodymium", number: 59, group: 5, period: 6, type: "other" },
            { symbol: "Nd", name: "Neodymium", number: 60, group: 6, period: 6, type: "other" },
            { symbol: "Pm", name: "Promethium", number: 61, group: 7, period: 6, type: "other" },
            { symbol: "Sm", name: "Samarium", number: 62, group: 8, period: 6, type: "other" },
            { symbol: "Eu", name: "Europium", number: 63, group: 9, period: 6, type: "other" },
            { symbol: "Gd", name: "Gadolinium", number: 64, group: 10, period: 6, type: "other" },
            { symbol: "Tb", name: "Terbium", number: 65, group: 11, period: 6, type: "other" },
            { symbol: "Dy", name: "Dysprosium", number: 66, group: 12, period: 6, type: "other" },
            { symbol: "Ho", name: "Holmium", number: 67, group: 13, period: 6, type: "other" },
            { symbol: "Er", name: "Erbium", number: 68, group: 14, period: 6, type: "other" },
            { symbol: "Tm", name: "Thulium", number: 69, group: 15, period: 6, type: "other" },
            { symbol: "Yb", name: "Ytterbium", number: 70, group: 16, period: 6, type: "other" },
            { symbol: "Lu", name: "Lutetium", number: 71, group: 17, period: 6, type: "other" },
            { symbol: "Hf", name: "Hafnium", number: 72, group: 4, period: 6, type: "other" },
            { symbol: "Ta", name: "Tantalum", number: 73, group: 5, period: 6, type: "other" },
            { symbol: "W", name: "Tungsten", number: 74, group: 6, period: 6, type: "other" },
            { symbol: "Re", name: "Rhenium", number: 75, group: 7, period: 6, type: "other" },
            { symbol: "Os", name: "Osmium", number: 76, group: 8, period: 6, type: "other" },
            { symbol: "Ir", name: "Iridium", number: 77, group: 9, period: 6, type: "other" },
            { symbol: "Pt", name: "Platinum", number: 78, group: 10, period: 6, type: "other" },
            { symbol: "Au", name: "Gold", number: 79, group: 11, period: 6, type: "other" },
            { symbol: "Hg", name: "Mercury", number: 80, group: 12, period: 6, type: "other" },
            { symbol: "Tl", name: "Thallium", number: 81, group: 13, period: 6, type: "other" },
            { symbol: "Pb", name: "Lead", number: 82, group: 14, period: 6, type: "other" },
            { symbol: "Bi", name: "Bismuth", number: 83, group: 15, period: 6, type: "other" },
            { symbol: "Po", name: "Polonium", number: 84, group: 16, period: 6, type: "other" },
            { symbol: "At", name: "Astatine", number: 85, group: 17, period: 6, type: "other" },
            { symbol: "Rn", name: "Radon", number: 86, group: 18, period: 6, type: "other" },
            { symbol: "Fr", name: "Francium", number: 87, group: 1, period: 7, type: "group1" },
            { symbol: "Ra", name: "Radium", number: 88, group: 2, period: 7, type: "group2" },
            { symbol: "Ac", name: "Actinium", number: 89, group: 3, period: 7, type: "other" },
            { symbol: "Th", name: "Thorium", number: 90, group: 4, period: 7, type: "other" },
            { symbol: "Pa", name: "Protactinium", number: 91, group: 5, period: 7, type: "other" },
            { symbol: "U", name: "Uranium", number: 92, group: 6, period: 7, type: "other" }
        ];
        
        // UI References
        const ui = {
            landingPage: document.getElementById('landing-page'),
            mainApp: document.getElementById('main-app'),
            sidebar: document.getElementById('sidebar'),
            mobileMenuToggle: document.getElementById('mobile-menu-toggle'),
            userIdDisplay: document.getElementById('user-id-display'),
            userPoints: document.getElementById('user-points'),
            userStreak: document.getElementById('user-streak'),
            enterAppBtn: document.getElementById('enter-app-btn'),
            particles: document.getElementById('particles'),
            messageBox: document.getElementById('message-box'),
            messageText: document.querySelector('.message-text'),
            closeMessageBtn: document.getElementById('close-message-btn'),
            atomViewer: document.getElementById('atom-viewer'),
            elementsGrid: document.getElementById('elements-grid'),
            elementDetails: document.getElementById('element-details'),
            group1Content: document.getElementById('group1-content'),
            group2Content: document.getElementById('group2-content'),
            comparisonElement1: document.getElementById('compare-element-1'),
            comparisonElement2: document.getElementById('compare-element-2'),
            compareElementsBtn: document.getElementById('compare-elements-btn'),
            comparisonResults: document.getElementById('comparison-results'),
            reactionSelect: document.getElementById('reaction-select'),
            reactionCanvas: document.getElementById('reaction-canvas'),
            startReactionBtn: document.getElementById('start-reaction-btn'),
            resetReactionBtn: document.getElementById('reset-reaction-btn'),
            reactionEquation: document.getElementById('reaction-equation'),
            reactionDescription: document.getElementById('reaction-description'),
            periodicTable: document.getElementById('periodic-table'),
            periodicElementInfo: document.getElementById('periodic-element-info'),
            builderCanvas: document.getElementById('builder-canvas'),
            elementPalette: document.getElementById('element-palette'),
            clearMoleculeBtn: document.getElementById('clear-molecule-btn'),
            saveMoleculeBtn: document.getElementById('save-molecule-btn'),
            bondModeBtn: document.getElementById('bond-mode-btn'),
            prequizQuestions: document.getElementById('prequiz-questions'),
            prequizResults: document.getElementById('prequiz-results'),
            prequizSubmitBtn: document.getElementById('prequiz-submit-btn'),
            prequizProgressText: document.getElementById('prequiz-progress-text'),
            prequizProgressBar: document.getElementById('prequiz-progress-bar'),
            postquizQuestions: document.getElementById('postquiz-questions'),
            postquizResults: document.getElementById('postquiz-results'),
            postquizSubmitBtn: document.getElementById('postquiz-submit-btn'),
            postquizProgressText: document.getElementById('postquiz-progress-text'),
            postquizProgressBar: document.getElementById('postquiz-progress-bar'),
            shareAchievementsBtn: document.getElementById('share-achievements-btn'),
            shareProgress: document.getElementById('share-progress'),
            themeToggle: document.getElementById('theme-toggle'),
            themeIcon: document.getElementById('theme-icon'),
            themeText: document.getElementById('theme-text'),
            helpButton: document.getElementById('help-button'),
            helpModal: document.getElementById('help-modal'),
            helpClose: document.getElementById('help-close'),
            safetyGuideBtn: document.getElementById('safety-guide-btn'),
            safetyModal: document.getElementById('safety-modal'),
            safetyClose: document.getElementById('safety-close'),
            audioToggle: document.getElementById('audio-toggle'),
            audioIcon: document.getElementById('audio-icon'),
            audioText: document.getElementById('audio-text'),
            elementsSearch: document.getElementById('elements-search'),
            slowMotionBtn: document.getElementById('slow-motion-btn'),
            animateElectronsBtn: document.getElementById('animate-electrons-btn'),
            notificationToast: document.getElementById('notification-toast'),
            notificationText: document.querySelector('.notification-text'),
            notificationIcon: document.querySelector('.notification-icon'),
            elementTooltip: document.getElementById('element-tooltip'),
            elementTooltipTitle: document.querySelector('.element-tooltip-title'),
            elementTooltipText: document.querySelector('.element-tooltip-text')
        };
        
        // Global Variables
        let scene, camera, renderer, atom, controls, orbitControls;
        let currentElement = null;
        let reactionAnimationId = null;
        let reactionRunning = false;
        let visualizationMode = 'default';
        let selectedPaletteElement = null;
        let moleculeElements = [];
        let bondMode = false;
        let audioEnabled = true;
        let slowMotion = false;
        let electronAnimation = null;
        let userProgress = {
            points: 0,
            streak: 0,
            lastVisit: null,
            achievements: ['first-steps'],
            completedSections: [],
            quizScores: {}
        };
        
        // Audio Context for sound effects
        let audioContext = null;
        
        // Initialize Firebase
        async function firebaseInit() {
            try {
                const app = initializeApp(firebaseConfig);
                auth = getAuth(app);
                db = getFirestore(app);
                
                if (initialAuthToken) {
                    await signInWithCustomToken(auth, initialAuthToken);
                } else {
                    await signInAnonymously(auth);
                }
                
                onAuthStateChanged(auth, async (user) => {
                    if (user) {
                        userId = user.uid;
                        ui.userIdDisplay.textContent = userId;
                        isAuthReady = true;
                        console.log("Firebase initialized and user authenticated:", userId);
                        
                        // Load user progress
                        await loadUserProgress();
                    } else {
                        console.log("Firebase initialized, no user authenticated.");
                    }
                });
            } catch (error) {
                console.error("Firebase initialization failed:", error);
            }
        }
        
        // Load user progress from Firebase
        async function loadUserProgress() {
            if (!userId || !db) return;
            
            try {
                const userDoc = doc(db, 'users', userId);
                const docSnap = await getDoc(userDoc);
                
                if (docSnap.exists()) {
                    userProgress = docSnap.data();
                    updateUserStats();
                } else {
                    // Initialize user progress
                    await setDoc(userDoc, userProgress);
                }
                
                // Check streak
                checkAndUpdateStreak();
            } catch (error) {
                console.error("Error loading user progress:", error);
            }
        }
        
        // Save user progress to Firebase
        async function saveUserProgress() {
            if (!userId || !db) return;
            
            try {
                const userDoc = doc(db, 'users', userId);
                await updateDoc(userDoc, userProgress);
            } catch (error) {
                console.error("Error saving user progress:", error);
            }
        }
        
        // Update user stats display
        function updateUserStats() {
            ui.userPoints.textContent = userProgress.points;
            ui.userStreak.textContent = userProgress.streak;
        }
        
        // Check and update streak
        function checkAndUpdateStreak() {
            const today = new Date().toDateString();
            const lastVisit = userProgress.lastVisit;
            
            if (lastVisit !== today) {
                const yesterday = new Date();
                yesterday.setDate(yesterday.getDate() - 1);
                
                if (lastVisit === yesterday.toDateString()) {
                    userProgress.streak++;
                } else if (lastVisit !== today) {
                    userProgress.streak = 1;
                }
                
                userProgress.lastVisit = today;
                saveUserProgress();
                updateUserStats();
                
                // Check for 7-day streak achievement
                if (userProgress.streak >= 7) {
                    awardAchievement('7-day-streak');
                }
            }
        }
        
        // Award points to user
        function awardPoints(points) {
            userProgress.points += points;
            updateUserStats();
            saveUserProgress();
            
            // Play sound effect
            playSound('points');
            
            // Show points notification
            showNotification(`+${points} points earned!`, 'success');
        }
        
        // Award achievement to user
        function awardAchievement(achievementId) {
            if (!userProgress.achievements.includes(achievementId)) {
                userProgress.achievements.push(achievementId);
                saveUserProgress();
                
                // Play achievement sound
                playSound('achievement');
                
                // Show achievement notification
                const achievementNames = {
                    'first-steps': 'First Steps',
                    'group1-expert': 'Group 1 Expert',
                    'group2-expert': 'Group 2 Expert',
                    'element-explorer': 'Element Explorer',
                    '7-day-streak': '7-Day Streak',
                    'molecular-architect': 'Molecular Architect'
                };
                
                showNotification(`Achievement Unlocked: ${achievementNames[achievementId]}!`, 'success');
            }
        }
        
        // Show notification
        function showNotification(message, type = 'info') {
            ui.notificationText.textContent = message;
            
            // Set icon based on type
            ui.notificationIcon.className = 'notification-icon';
            if (type === 'success') {
                ui.notificationIcon.classList.add('success');
                ui.notificationIcon.className = 'fas fa-check-circle';
            } else if (type === 'error') {
                ui.notificationIcon.classList.add('error');
                ui.notificationIcon.className = 'fas fa-exclamation-circle';
            } else {
                ui.notificationIcon.classList.add('info');
                ui.notificationIcon.className = 'fas fa-info-circle';
            }
            
            // Show notification
            ui.notificationToast.classList.add('show');
            
            // Hide after 3 seconds
            setTimeout(() => {
                ui.notificationToast.classList.remove('show');
            }, 3000);
        }
        
        // Play sound effect
        function playSound(type) {
            if (!audioEnabled || !audioContext) return;
            
            // Create simple sound effects using Web Audio API
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            // Set different sounds based on type
            switch(type) {
                case 'points':
                    oscillator.frequency.value = 523.25; // C5
                    gainNode.gain.value = 0.3;
                    oscillator.type = 'sine';
                    break;
                case 'achievement':
                    oscillator.frequency.value = 659.25; // E5
                    gainNode.gain.value = 0.3;
                    oscillator.type = 'sine';
                    break;
                case 'click':
                    oscillator.frequency.value = 800;
                    gainNode.gain.value = 0.1;
                    oscillator.type = 'square';
                    break;
                case 'error':
                    oscillator.frequency.value = 200;
                    gainNode.gain.value = 0.2;
                    oscillator.type = 'sawtooth';
                    break;
            }
            
            oscillator.start();
            oscillator.stop(audioContext.currentTime + 0.1);
        }
        
        // Initialize Audio Context
        function initAudio() {
            try {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            } catch (e) {
                console.error("Web Audio API is not supported in this browser");
            }
        }
        
        // Create Particles
        function createParticles() {
            const particlesContainer = ui.particles;
            const particleCount = 50;
            
            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                
                // Random position
                particle.style.left = `${Math.random() * 100}%`;
                particle.style.top = `${Math.random() * 100}%`;
                
                // Random size
                const size = Math.random() * 4 + 2;
                particle.style.width = `${size}px`;
                particle.style.height = `${size}px`;
                
                // Random animation duration
                const duration = Math.random() * 20 + 10;
                particle.style.animationDuration = `${duration}s`;
                
                // Random animation delay
                const delay = Math.random() * 20;
                particle.style.animationDelay = `${delay}s`;
                
                particlesContainer.appendChild(particle);
            }
        }
        
        // Initialize 3D Atom Viewer
        function init3DAtomViewer() {
            const container = ui.atomViewer;
            
            // Scene
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x0f172a);
            
            // Camera
            camera = new THREE.PerspectiveCamera(
                75,
                container.clientWidth / container.clientHeight,
                0.1,
                1000
            );
            camera.position.z = 5;
            
            // Renderer
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(container.clientWidth, container.clientHeight);
            container.innerHTML = '';
            container.appendChild(renderer.domElement);
            
            // Lights
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
            scene.add(ambientLight);
            
            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(5, 5, 5);
            scene.add(directionalLight);
            
            // Orbit Controls
            orbitControls = new THREE.OrbitControls(camera, renderer.domElement);
            orbitControls.enableDamping = true;
            orbitControls.dampingFactor = 0.05;
            
            // Controls
            controls = {
                rotateLeft: false,
                rotateRight: false,
                zoomIn: false,
                zoomOut: false
            };
            
            // Handle window resize
            window.addEventListener('resize', () => {
                camera.aspect = container.clientWidth / container.clientHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(container.clientWidth, container.clientHeight);
            });
            
            // Start animation loop
            animate3D();
        }
        
        // Create 3D Atom
        function create3DAtom(element) {
            // Clear previous atom
            while(scene.children.length > 2) {
                scene.remove(scene.children[2]);
            }
            
            // Nucleus
            const nucleusGeometry = new THREE.SphereGeometry(0.5, 32, 32);
            const nucleusMaterial = new THREE.MeshPhongMaterial({ 
                color: 0xef4444,
                emissive: 0xef4444,
                emissiveIntensity: 0.2
            });
            const nucleus = new THREE.Mesh(nucleusGeometry, nucleusMaterial);
            scene.add(nucleus);
            
            // Add element symbol to nucleus
            const canvas = document.createElement('canvas');
            canvas.width = 128;
            canvas.height = 128;
            const context = canvas.getContext('2d');
            context.fillStyle = 'white';
            context.font = 'bold 80px Arial';
            context.textAlign = 'center';
            context.textBaseline = 'middle';
            context.fillText(element.symbol, 64, 64);
            
            const texture = new THREE.CanvasTexture(canvas);
            const spriteMaterial = new THREE.SpriteMaterial({ map: texture });
            const sprite = new THREE.Sprite(spriteMaterial);
            sprite.scale.set(1, 1, 1);
            nucleus.add(sprite);
            
            // Electron shells based on visualization mode
            const { electrons: numElectrons, group } = element;
            const numValenceElectrons = (group === 'I' || group === 'i') ? 1 : 2;
            const numInnerElectrons = numElectrons - numValenceElectrons;
            
            const electronGroup = new THREE.Group();
            scene.add(electronGroup);
            
            if (visualizationMode === 'default' || visualizationMode === 'simplified') {
                // Create electron shells
                const shellCapacities = [2, 8, 18, 32, 18, 8, 2];
                let remainingInnerElectrons = numInnerElectrons;
                let shellRadius = 1.5;
                
                // Inner electron shells
                for (let i = 0; i < shellCapacities.length && remainingInnerElectrons > 0; i++) {
                    const electronsInShell = Math.min(shellCapacities[i], remainingInnerElectrons);
                    
                    for (let j = 0; j < electronsInShell; j++) {
                        const angle = (j / electronsInShell) * Math.PI * 2;
                        const electronGeometry = new THREE.SphereGeometry(0.1, 16, 16);
                        const electronMaterial = new THREE.MeshPhongMaterial({ 
                            color: 0x10b981,
                            emissive: 0x10b981,
                            emissiveIntensity: 0.3
                        });
                        const electron = new THREE.Mesh(electronGeometry, electronMaterial);
                        
                        electron.position.x = Math.cos(angle) * shellRadius;
                        electron.position.y = Math.sin(angle) * shellRadius;
                        electron.position.z = 0;
                        
                        electronGroup.add(electron);
                    }
                    
                    remainingInnerElectrons -= electronsInShell;
                    shellRadius += 0.8;
                }
                
                // Valence electron shell
                for (let i = 0; i < numValenceElectrons; i++) {
                    const angle = (i / numValenceElectrons) * Math.PI * 2;
                    const electronGeometry = new THREE.SphereGeometry(0.15, 16, 16);
                    const electronMaterial = new THREE.MeshPhongMaterial({ 
                        color: 0xf59e0b,
                        emissive: 0xf59e0b,
                        emissiveIntensity: 0.3
                    });
                    const electron = new THREE.Mesh(electronGeometry, electronMaterial);
                    
                    electron.position.x = Math.cos(angle) * shellRadius;
                    electron.position.y = Math.sin(angle) * shellRadius;
                    electron.position.z = 0;
                    
                    electronGroup.add(electron);
                }
            } else if (visualizationMode === 'orbital') {
                // Create orbital paths
                const orbitalMaterial = new THREE.LineBasicMaterial({ color: 0x3b82f6, transparent: true, opacity: 0.3 });
                
                // s orbital
                const sOrbitGeometry = new THREE.RingGeometry(1.4, 1.6, 32);
                const sOrbit = new THREE.LineLoop(
                    new THREE.EdgesGeometry(sOrbitGeometry),
                    orbitalMaterial
                );
                sOrbit.rotation.x = Math.PI / 2;
                electronGroup.add(sOrbit);
                
                // p orbitals
                for (let i = 0; i < 3; i++) {
                    const pOrbitCurve = new THREE.EllipseCurve(
                        0, 0,
                        2, 0.5,
                        0, 2 * Math.PI,
                        false,
                        0
                    );
                    
                    const pOrbitPoints = pOrbitCurve.getPoints(50);
                    const pOrbitGeometry = new THREE.BufferGeometry().setFromPoints(pOrbitPoints);
                    const pOrbit = new THREE.Line(pOrbitGeometry, orbitalMaterial);
                    
                    if (i === 0) pOrbit.rotation.x = Math.PI / 2;
                    if (i === 1) pOrbit.rotation.y = Math.PI / 2;
                    
                    electronGroup.add(pOrbit);
                }
                
                // Add electrons to orbitals
                for (let i = 0; i < numElectrons; i++) {
                    const electronGeometry = new THREE.SphereGeometry(0.1, 16, 16);
                    const electronMaterial = new THREE.MeshPhongMaterial({ 
                        color: 0xf59e0b,
                        emissive: 0xf59e0b,
                        emissiveIntensity: 0.3
                    });
                    const electron = new THREE.Mesh(electronGeometry, electronMaterial);
                    
                    // Position electrons in orbitals
                    if (i < 2) {
                        // s orbital
                        const angle = (i / 2) * Math.PI * 2;
                        electron.position.x = Math.cos(angle) * 1.5;
                        electron.position.y = Math.sin(angle) * 1.5;
                        electron.position.z = 0;
                    } else {
                        // p orbitals
                        const orbitalIndex = (i - 2) % 3;
                        const electronInOrbital = Math.floor((i - 2) / 3);
                        const angle = electronInOrbital * Math.PI;
                        
                        if (orbitalIndex === 0) {
                            electron.position.x = Math.cos(angle) * 2;
                            electron.position.y = Math.sin(angle) * 0.5;
                            electron.position.z = 0;
                        } else if (orbitalIndex === 1) {
                            electron.position.x = 0;
                            electron.position.y = Math.cos(angle) * 2;
                            electron.position.z = Math.sin(angle) * 0.5;
                        } else {
                            electron.position.x = Math.cos(angle) * 0.5;
                            electron.position.y = 0;
                            electron.position.z = Math.sin(angle) * 2;
                        }
                    }
                    
                    electronGroup.add(electron);
                }
            } else if (visualizationMode === 'electron-cloud') {
                // Create electron cloud representation
                const cloudGeometry = new THREE.SphereGeometry(2, 32, 32);
                const cloudMaterial = new THREE.MeshPhongMaterial({
                    color: 0x3b82f6,
                    transparent: true,
                    opacity: 0.2,
                    wireframe: true
                });
                const cloud = new THREE.Mesh(cloudGeometry, cloudMaterial);
                electronGroup.add(cloud);
                
                // Add some electrons as particles within the cloud
                for (let i = 0; i < numElectrons; i++) {
                    const electronGeometry = new THREE.SphereGeometry(0.08, 16, 16);
                    const electronMaterial = new THREE.MeshPhongMaterial({ 
                        color: 0xf59e0b,
                        emissive: 0xf59e0b,
                        emissiveIntensity: 0.3
                    });
                    const electron = new THREE.Mesh(electronGeometry, electronMaterial);
                    
                    // Random position within the cloud
                    const radius = Math.random() * 1.8;
                    const theta = Math.random() * Math.PI * 2;
                    const phi = Math.random() * Math.PI;
                    
                    electron.position.x = radius * Math.sin(phi) * Math.cos(theta);
                    electron.position.y = radius * Math.sin(phi) * Math.sin(theta);
                    electron.position.z = radius * Math.cos(phi);
                    
                    electronGroup.add(electron);
                }
            }
            
            // Store reference to electron group for animation
            atom = {
                nucleus: nucleus,
                electrons: electronGroup,
                shellRadius: shellRadius || 2
            };
            
            // Award achievement for exploring elements
            awardPoints(10);
            if (!userProgress.completedSections.includes('elements-explored')) {
                userProgress.completedSections.push('elements-explored');
                if (userProgress.completedSections.length >= 5) {
                    awardAchievement('element-explorer');
                }
            }
        }
        
        // 3D Animation Loop
        function animate3D() {
            requestAnimationFrame(animate3D);
            
            // Update orbit controls
            if (orbitControls) {
                orbitControls.update();
            }
            
            // Rotate atom
            if (atom) {
                if (controls.rotateLeft) {
                    atom.nucleus.rotation.y += 0.02;
                    atom.electrons.rotation.y += 0.02;
                }
                if (controls.rotateRight) {
                    atom.nucleus.rotation.y -= 0.02;
                    atom.electrons.rotation.y -= 0.02;
                }
                
                // Rotate electrons
                if (electronAnimation) {
                    atom.electrons.rotation.z += 0.005;
                }
            }
            
            // Zoom
            if (controls.zoomIn && camera.position.z > 2) {
                camera.position.z -= 0.1;
            }
            if (controls.zoomOut && camera.position.z < 10) {
                camera.position.z += 0.1;
            }
            
            renderer.render(scene, camera);
        }
        
        // Initialize Elements Grid
        function initElementsGrid() {
            const grid = ui.elementsGrid;
            grid.innerHTML = '';
            
            Object.entries(elementsData).forEach(([name, data]) => {
                const card = document.createElement('div');
                card.className = 'element-card';
                card.dataset.element = name;
                card.dataset.group = data.group === 'I' ? 'group1' : 'group2';
                card.dataset.reactivity = data.reactivity;
                
                const groupClass = data.group === 'I' ? 'group-1' : 'group-2';
                
                card.innerHTML = `
                    <div class="element-group ${groupClass}">Group ${data.group}</div>
                    <img src="${data.image}" alt="${name}" class="element-image">
                    <div class="element-number">${data.atomicNumber}</div>
                    <div class="element-symbol">${data.symbol}</div>
                    <div class="element-name">${name}</div>
                `;
                
                // Add hover effect for tooltip
                card.addEventListener('mouseenter', (e) => {
                    showElementTooltip(e, name, data);
                });
                
                card.addEventListener('mouseleave', () => {
                    hideElementTooltip();
                });
                
                card.addEventListener('click', () => {
                    showElementDetails(name);
                    create3DAtom(data);
                    playSound('click');
                });
                
                grid.appendChild(card);
            });
            
            // Initialize search functionality
            ui.elementsSearch.addEventListener('input', filterElements);
            
            // Initialize filter buttons
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    // Update active filter button
                    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    
                    // Filter elements
                    filterElements();
                });
            });
        }
        
        // Filter elements based on search and filter buttons
        function filterElements() {
            const searchTerm = ui.elementsSearch.value.toLowerCase();
            const activeFilter = document.querySelector('.filter-btn.active').dataset.filter;
            
            document.querySelectorAll('.element-card').forEach(card => {
                const elementName = card.dataset.element.toLowerCase();
                const elementGroup = card.dataset.group;
                const elementReactivity = card.dataset.reactivity;
                
                // Check if element matches search term
                const matchesSearch = elementName.includes(searchTerm);
                
                // Check if element matches active filter
                let matchesFilter = true;
                if (activeFilter === 'group1') {
                    matchesFilter = elementGroup === 'group1';
                } else if (activeFilter === 'group2') {
                    matchesFilter = elementGroup === 'group2';
                } else if (activeFilter === 'low-reactivity') {
                    matchesFilter = elementReactivity === 'low' || elementReactivity === 'very-low';
                } else if (activeFilter === 'high-reactivity') {
                    matchesFilter = elementReactivity === 'high' || elementReactivity === 'very-high';
                }
                
                // Show or hide card based on filters
                if (matchesSearch && matchesFilter) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        }
        
        // Show element tooltip
        function showElementTooltip(event, elementName, elementData) {
            ui.elementTooltipTitle.textContent = elementName;
            ui.elementTooltipText.textContent = elementData.funFact;
            
            // Position tooltip near the mouse
            ui.elementTooltip.style.left = `${event.pageX + 10}px`;
            ui.elementTooltip.style.top = `${event.pageY + 10}px`;
            
            // Show tooltip
            ui.elementTooltip.classList.add('active');
        }
        
        // Hide element tooltip
        function hideElementTooltip() {
            ui.elementTooltip.classList.remove('active');
        }
        
        // Show Element Details
        function showElementDetails(elementName) {
            const element = elementsData[elementName];
            if (!element) return;
            
            const detailsContainer = ui.elementDetails;
            const groupClass = element.group === 'I' ? 'group1' : 'group2';
            const groupColor = element.group === 'I' ? 'blue' : 'green';
            
            detailsContainer.innerHTML = `
                <div class="flex items-center justify-between mb-6">
                    <h3 class="text-2xl font-bold text-white">${elementName} (${element.symbol})</h3>
                    <div class="text-4xl font-bold text-white">${element.symbol}</div>
                </div>
                
                <div class="mb-4 p-3 bg-${groupColor}-900 bg-opacity-20 border-l-4 border-${groupColor}-500 rounded">
                    <h4 class="text-lg font-semibold text-white mb-2">Group ${element.group} Properties</h4>
                    <p class="text-gray-300">
                        ${element.group === 'I' ? 
                            'Alkali metals are highly reactive, soft metals with one valence electron. They react vigorously with water to form alkaline solutions.' :
                            'Alkaline earth metals are reactive but less so than alkali metals. They have two valence electrons and form +2 ions.'}
                    </p>
                </div>
                
                <div class="details-grid">
                    <div class="detail-item">
                        <div class="detail-label">Atomic Number</div>
                        <div class="detail-value">${element.atomicNumber}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Protons</div>
                        <div class="detail-value">${element.protons}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Neutrons</div>
                        <div class="detail-value">${element.neutrons}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Electrons</div>
                        <div class="detail-value">${element.electrons}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Electron Configuration</div>
                        <div class="detail-value">${element.electronConfiguration}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Group</div>
                        <div class="detail-value text-${groupColor}-400">Group ${element.group}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Period</div>
                        <div class="detail-value">${element.period}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Melting Point</div>
                        <div class="detail-value">${element.meltingPoint}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Boiling Point</div>
                        <div class="detail-value">${element.boilingPoint}</div>
                    </div>
                </div>
                
                <div class="mt-6 p-4 bg-${groupColor}-900 bg-opacity-20 border-l-4 border-${groupColor}-500 rounded">
                    <h4 class="text-lg font-semibold text-white mb-2">Fun Fact</h4>
                    <p class="text-gray-300">${element.funFact}</p>
                </div>
            `;
            
            // Add applications if available
            if (element.applications && element.applications.length > 0) {
                const applicationsHtml = element.applications.map(app => `
                    <div class="application-item">
                        <div class="application-icon">
                            <i class="fas fa-flask"></i>
                        </div>
                        <div class="application-text">${app}</div>
                    </div>
                `).join('');
                
                detailsContainer.innerHTML += `
                    <div class="applications mt-6">
                        <h4 class="text-xl font-semibold text-white mb-4">Real-world Applications</h4>
                        <div class="applications-list">
                            ${applicationsHtml}
                        </div>
                    </div>
                `;
            }
        }
        
        // Initialize Learn Content
        function initLearnContent() {
            ui.group1Content.innerHTML = learnContent.group1;
            ui.group2Content.innerHTML = learnContent.group2;
            
            // Tab switching
            document.querySelectorAll('.learn-tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    document.querySelectorAll('.learn-tab').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                    
                    tab.classList.add('active');
                    document.getElementById(`${tab.dataset.tab}-content`).classList.add('active');
                    playSound('click');
                });
            });
            
            // Populate comparison dropdowns
            Object.keys(elementsData).forEach(elementName => {
                const option1 = document.createElement('option');
                option1.value = elementName;
                option1.textContent = elementName;
                ui.comparisonElement1.appendChild(option1);
                
                const option2 = document.createElement('option');
                option2.value = elementName;
                option2.textContent = elementName;
                ui.comparisonElement2.appendChild(option2);
            });
            
            // Compare elements button
            ui.compareElementsBtn.addEventListener('click', compareElements);
        }
        
        // Compare Elements
        function compareElements() {
            const element1Name = ui.comparisonElement1.value;
            const element2Name = ui.comparisonElement2.value;
            
            if (!element1Name || !element2Name) {
                showMessage("Please select two elements to compare.");
                return;
            }
            
            if (element1Name === element2Name) {
                showMessage("Please select two different elements to compare.");
                return;
            }
            
            const element1 = elementsData[element1Name];
            const element2 = elementsData[element2Name];
            
            ui.comparisonResults.innerHTML = `
                <h4 class="text-xl font-semibold text-white mb-4">Comparison: ${element1Name} vs ${element2Name}</h4>
                <div class="overflow-x-auto">
                    <table class="comparison-table">
                        <thead>
                            <tr>
                                <th>Property</th>
                                <th>${element1Name}</th>
                                <th>${element2Name}</th>
                                <th>Comparison</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Atomic Number</td>
                                <td>${element1.atomicNumber}</td>
                                <td>${element2.atomicNumber}</td>
                                <td>${element1.atomicNumber < element2.atomicNumber ? `${element1Name} has fewer protons` : `${element2Name} has fewer protons`}</td>
                            </tr>
                            <tr>
                                <td>Group</td>
                                <td>${element1.group}</td>
                                <td>${element2.group}</td>
                                <td>${element1.group === element2.group ? 'Same group' : 'Different groups'}</td>
                            </tr>
                            <tr>
                                <td>Period</td>
                                <td>${element1.period}</td>
                                <td>${element2.period}</td>
                                <td>${element1.period < element2.period ? `${element1Name} is in a higher period` : `${element2Name} is in a higher period`}</td>
                            </tr>
                            <tr>
                                <td>Melting Point</td>
                                <td>${element1.meltingPoint}</td>
                                <td>${element2.meltingPoint}</td>
                                <td>${parseFloat(element1.meltingPoint) < parseFloat(element2.meltingPoint) ? `${element1Name} has a lower melting point` : `${element2Name} has a lower melting point`}</td>
                            </tr>
                            <tr>
                                <td>Boiling Point</td>
                                <td>${element1.boilingPoint}</td>
                                <td>${element2.boilingPoint}</td>
                                <td>${parseFloat(element1.boilingPoint) < parseFloat(element2.boilingPoint) ? `${element1Name} has a lower boiling point` : `${element2Name} has a lower boiling point`}</td>
                            </tr>
                            <tr>
                                <td>Reactivity</td>
                                <td>${getReactivityLevel(element1)}</td>
                                <td>${getReactivityLevel(element2)}</td>
                                <td>${getReactivityComparison(element1, element2)}</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-6">
                    <div class="bg-blue-900 bg-opacity-20 p-4 rounded-lg">
                        <h5 class="font-semibold mb-2 text-white">${element1Name} Fun Fact</h5>
                        <p class="text-gray-300">${element1.funFact}</p>
                    </div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg">
                        <h5 class="font-semibold mb-2 text-white">${element2Name} Fun Fact</h5>
                        <p class="text-gray-300">${element2.funFact}</p>
                    </div>
                </div>
            `;
            
            ui.comparisonResults.style.display = 'block';
            
            // Award points for using comparison tool
            awardPoints(5);
        }
        
        function getReactivityLevel(element) {
            if (element.group === 'I') {
                if (element.atomicNumber <= 3) return 'Low (for alkali metals)';
                if (element.atomicNumber <= 19) return 'Moderate';
                return 'High';
            } else {
                if (element.atomicNumber <= 4) return 'Very Low';
                if (element.atomicNumber <= 12) return 'Low';
                if (element.atomicNumber <= 20) return 'Moderate';
                return 'High (for alkaline earth metals)';
            }
        }
        
        function getReactivityComparison(element1, element2) {
            if (element1.group !== element2.group) {
                return element1.group === 'I' ? `${element1.name} is more reactive (Group 1 vs Group 2)` : `${element2.name} is more reactive (Group 1 vs Group 2)`;
            }
            
            // Same group, compare by atomic number
            if (element1.group === 'I') {
                return element1.atomicNumber < element2.atomicNumber ? 
                    `${element2.name} is more reactive (further down the group)` : 
                    `${element1.name} is more reactive (further down the group)`;
            } else {
                return element1.atomicNumber < element2.atomicNumber ? 
                    `${element2.name} is more reactive (further down the group)` : 
                    `${element1.name} is more reactive (further down the group)`;
            }
        }
        
        // Initialize Reaction Simulator
        function initReactionSimulator() {
            ui.reactionSelect.addEventListener('change', updateReactionInfo);
            ui.startReactionBtn.addEventListener('click', startReaction);
            ui.resetReactionBtn.addEventListener('click', resetReaction);
            ui.slowMotionBtn.addEventListener('click', toggleSlowMotion);
            
            updateReactionInfo();
        }
        
        function updateReactionInfo() {
            const reactionKey = ui.reactionSelect.value;
            const reaction = reactionData[reactionKey];
            
            ui.reactionEquation.textContent = reaction.equation;
            ui.reactionDescription.textContent = reaction.description;
            
            // Update reaction steps
            const stepsContainer = document.getElementById('reaction-steps');
            stepsContainer.innerHTML = reaction.animationSteps.map((step, index) => `
                <div class="flex items-center mb-2">
                    <div class="w-6 h-6 rounded-full bg-blue-500 flex items-center justify-center text-white text-xs mr-2">${index + 1}</div>
                    <span class="text-gray-300">${step.description}</span>
                </div>
            `).join('');
        }
        
        function startReaction() {
            if (reactionRunning) return;
            
            reactionRunning = true;
            ui.startReactionBtn.disabled = true;
            playSound('click');
            
            const reactionKey = ui.reactionSelect.value;
            const reaction = reactionData[reactionKey];
            
            runReactionAnimation(reaction);
        }
        
        function resetReaction() {
            reactionRunning = false;
            ui.startReactionBtn.disabled = false;
            
            if (reactionAnimationId) {
                cancelAnimationFrame(reactionAnimationId);
            }
            
            ui.reactionCanvas.innerHTML = `
                <div class="flex items-center justify-center h-full text-gray-400">
                    <div class="text-center">
                        <i class="fas fa-play-circle text-4xl mb-2"></i>
                        <p>Click "Start Reaction" to begin the simulation</p>
                    </div>
                </div>
            `;
        }
        
        function toggleSlowMotion() {
            slowMotion = !slowMotion;
            ui.slowMotionBtn.classList.toggle('bg-blue-600');
            playSound('click');
        }
        
        function runReactionAnimation(reaction) {
            const canvas = ui.reactionCanvas;
            canvas.innerHTML = '';
            
            // Add group-specific styling
            const reactionKey = ui.reactionSelect.value;
            if (reactionKey.includes('na') || reactionKey.includes('k') || reactionKey.includes('li')) {
                canvas.classList.add('group1-reaction');
            } else if (reactionKey.includes('ca') || reactionKey.includes('mg') || reactionKey.includes('ba')) {
                canvas.classList.add('group2-reaction');
            }
            
            // Create reaction visualization based on reaction type
            if (reactionKey === 'na-water') {
                createSodiumWaterReaction(canvas);
            } else if (reactionKey === 'k-water') {
                createPotassiumWaterReaction(canvas);
            } else if (reactionKey === 'ca-water') {
                createCalciumWaterReaction(canvas);
            } else if (reactionKey === 'mg-water') {
                createMagnesiumWaterReaction(canvas);
            } else if (reactionKey === 'li-oxygen') {
                createLithiumOxygenReaction(canvas);
            } else if (reactionKey === 'na-chlorine') {
                createSodiumChlorineReaction(canvas);
            }
            
            // Award points for completing reaction
            setTimeout(() => {
                awardPoints(15);
                if (!userProgress.completedSections.includes('reactions-completed')) {
                    userProgress.completedSections.push('reactions-completed');
                    if (userProgress.completedSections.length >= 5) {
                        awardAchievement('element-explorer');
                    }
                }
            }, slowMotion ? 10000 : 5000);
        }
        
        function createSodiumWaterReaction(canvas) {
            // Create water container
            const waterContainer = document.createElement('div');
            waterContainer.className = 'absolute bottom-0 left-0 right-0 h-1/2 bg-blue-500 bg-opacity-30';
            canvas.appendChild(waterContainer);
            
            // Create sodium metal with Group 1 styling
            const sodium = document.createElement('div');
            sodium.className = 'absolute w-12 h-12 bg-gray-200 rounded-full top-1/4 left-1/2 transform -translate-x-1/2 flex items-center justify-center text-gray-800 font-bold group1-element';
            sodium.textContent = 'Na';
            sodium.innerHTML += '<div class="absolute -top-6 text-xs font-semibold text-blue-400">Group 1</div>';
            canvas.appendChild(sodium);
            
            // Animate reaction with Group 1 characteristics
            let step = 0;
            const steps = [
                () => {
                    // Sodium moves to water with vigorous reaction
                    sodium.style.transition = 'all 1s ease-in';
                    sodium.style.top = '45%';
                    updateReactionStep(1);
                },
                () => {
                    // Create vigorous hydrogen bubbles (Group 1 characteristic)
                    for (let i = 0; i < 20; i++) {
                        setTimeout(() => {
                            const bubble = document.createElement('div');
                            bubble.className = 'absolute w-4 h-4 bg-white rounded-full opacity-70';
                            bubble.style.left = `${45 + Math.random() * 10}%`;
                            bubble.style.bottom = '50%';
                            bubble.style.transition = 'all 2s ease-out';
                            canvas.appendChild(bubble);
                            
                            setTimeout(() => {
                                bubble.style.bottom = '100%';
                                bubble.style.opacity = '0';
                            }, 100);
                            
                            setTimeout(() => {
                                bubble.remove();
                            }, 2100);
                        }, i * 100);
                    }
                    updateReactionStep(2);
                },
                () => {
                    // Create flame effect (Group 1 characteristic - exothermic reaction)
                    const flame = document.createElement('div');
                    flame.className = 'absolute w-8 h-12 bg-yellow-500 rounded-t-full opacity-80 group1-flame';
                    flame.style.left = '50%';
                    flame.style.top = '40%';
                    flame.style.transform = 'translateX(-50%)';
                    flame.style.transition = 'all 0.5s ease-in-out';
                    canvas.appendChild(flame);
                    
                    // Animate flame
                    let flameHeight = 12;
                    const flameInterval = setInterval(() => {
                        flameHeight = 8 + Math.random() * 8;
                        flame.style.height = `${flameHeight}px`;
                    }, 100);
                    
                    setTimeout(() => {
                        clearInterval(flameInterval);
                        flame.style.opacity = '0';
                        setTimeout(() => flame.remove(), 500);
                    }, 2000);
                    updateReactionStep(3);
                },
                () => {
                    // Show products with Group 1 hydroxide
                    sodium.style.opacity = '0';
                    setTimeout(() => sodium.remove(), 500);
                    
                    const products = document.createElement('div');
                    products.className = 'absolute bottom-1/4 left-1/2 transform -translate-x-1/2 text-white text-center';
                    products.innerHTML = '<div>NaOH + H</div><div class="text-xs text-blue-300 mt-1">Sodium Hydroxide (Group 1)</div>';
                    canvas.appendChild(products);
                    updateReactionStep(4);
                }
            ];
            
            // Execute steps with delays
            const delay = slowMotion ? 3000 : 1500;
            steps.forEach((step, index) => {
                setTimeout(step, index * delay);
            });
            
            // Reset after animation
            setTimeout(() => {
                reactionRunning = false;
                ui.startReactionBtn.disabled = false;
            }, steps.length * delay + 2000);
        }
        
        function createPotassiumWaterReaction(canvas) {
            // Similar to sodium but more vigorous
            createSodiumWaterReaction(canvas);
        }
        
        function createCalciumWaterReaction(canvas) {
            // Create water container
            const waterContainer = document.createElement('div');
            waterContainer.className = 'absolute bottom-0 left-0 right-0 h-1/2 bg-blue-500 bg-opacity-30';
            canvas.appendChild(waterContainer);
            
            // Create calcium metal with Group 2 styling
            const calcium = document.createElement('div');
            calcium.className = 'absolute w-12 h-12 bg-gray-300 rounded-full top-1/4 left-1/2 transform -translate-x-1/2 flex items-center justify-center text-gray-800 font-bold group2-element';
            calcium.textContent = 'Ca';
            calcium.innerHTML += '<div class="absolute -top-6 text-xs font-semibold text-green-400">Group 2</div>';
            canvas.appendChild(calcium);
            
            // Animate reaction with Group 2 characteristics (less vigorous than Group 1)
            setTimeout(() => {
                // Calcium moves to water with moderate reaction
                calcium.style.transition = 'all 2s ease-in';
                calcium.style.top = '50%';
                updateReactionStep(1);
            }, 500);
            
            setTimeout(() => {
                // Create fewer bubbles (Group 2 characteristic - less reactive)
                for (let i = 0; i < 15; i++) {
                    setTimeout(() => {
                        const bubble = document.createElement('div');
                        bubble.className = 'absolute w-3 h-3 bg-white rounded-full opacity-70';
                        bubble.style.left = `${45 + Math.random() * 10}%`;
                        bubble.style.bottom = '50%';
                        bubble.style.transition = 'all 3s ease-out';
                        canvas.appendChild(bubble);
                        
                        setTimeout(() => {
                            bubble.style.bottom = '100%';
                            bubble.style.opacity = '0';
                        }, 100);
                        
                        setTimeout(() => {
                            bubble.remove();
                        }, 3100);
                    }, i * 200);
                }
                updateReactionStep(2);
            }, 2500);
            
            setTimeout(() => {
                // Show products with Group 2 hydroxide
                calcium.style.opacity = '0';
                setTimeout(() => calcium.remove(), 500);
                
                const products = document.createElement('div');
                products.className = 'absolute bottom-1/4 left-1/2 transform -translate-x-1/2 text-white text-center';
                products.innerHTML = '<div>Ca(OH) + H</div><div class="text-xs text-green-300 mt-1">Calcium Hydroxide (Group 2)</div>';
                canvas.appendChild(products);
                updateReactionStep(3);
            }, 6000);
            
            // Reset after animation
            setTimeout(() => {
                reactionRunning = false;
                ui.startReactionBtn.disabled = false;
            }, slowMotion ? 16000 : 8000);
        }
        
        function createMagnesiumWaterReaction(canvas) {
            // Create steam container
            const steamContainer = document.createElement('div');
            steamContainer.className = 'absolute bottom-0 left-0 right-0 h-1/2 bg-gray-300 bg-opacity-20';
            canvas.appendChild(steamContainer);
            
            // Create magnesium metal
            const magnesium = document.createElement('div');
            magnesium.className = 'absolute w-12 h-12 bg-gray-400 rounded-full top-1/2 left-1/2 transform -translate-x-1/2 flex items-center justify-center text-gray-800 font-bold group2-element';
            magnesium.textContent = 'Mg';
            magnesium.innerHTML += '<div class="absolute -top-6 text-xs font-semibold text-green-400">Group 2</div>';
            canvas.appendChild(magnesium);
            
            // Animate reaction
            setTimeout(() => {
                // Create bubbles (very slow)
                for (let i = 0; i < 10; i++) {
                    setTimeout(() => {
                        const bubble = document.createElement('div');
                        bubble.className = 'absolute w-2 h-2 bg-white rounded-full opacity-70';
                        bubble.style.left = `${45 + Math.random() * 10}%`;
                        bubble.style.bottom = '50%';
                        bubble.style.transition = 'all 4s ease-out';
                        canvas.appendChild(bubble);
                        
                        setTimeout(() => {
                            bubble.style.bottom = '100%';
                            bubble.style.opacity = '0';
                        }, 100);
                        
                        setTimeout(() => {
                            bubble.remove();
                        }, 4100);
                    }, i * 300);
                }
            }, 1000);
            
            setTimeout(() => {
                // Show products
                magnesium.style.opacity = '0';
                setTimeout(() => magnesium.remove(), 500);
                
                const products = document.createElement('div');
                products.className = 'absolute bottom-1/4 left-1/2 transform -translate-x-1/2 text-white text-center';
                products.innerHTML = '<div>MgO + H</div><div class="text-xs text-green-300 mt-1">Magnesium Oxide (Group 2)</div>';
                canvas.appendChild(products);
            }, 5000);
            
            // Reset after animation
            setTimeout(() => {
                reactionRunning = false;
                ui.startReactionBtn.disabled = false;
            }, slowMotion ? 14000 : 7000);
        }
        
        function createLithiumOxygenReaction(canvas) {
            // Create oxygen container
            const oxygenContainer = document.createElement('div');
            oxygenContainer.className = 'absolute inset-0 bg-blue-200 bg-opacity-10';
            canvas.appendChild(oxygenContainer);
            
            // Create lithium metal
            const lithium = document.createElement('div');
            lithium.className = 'absolute w-12 h-12 bg-gray-200 rounded-full top-1/2 left-1/2 transform -translate-x-1/2 flex items-center justify-center text-gray-800 font-bold group1-element';
            lithium.textContent = 'Li';
            lithium.innerHTML += '<div class="absolute -top-6 text-xs font-semibold text-blue-400">Group 1</div>';
            canvas.appendChild(lithium);
            
            // Animate reaction
            setTimeout(() => {
                // Create flame effect (crimson)
                const flame = document.createElement('div');
                flame.className = 'absolute w-16 h-16 bg-red-600 rounded-full opacity-80';
                flame.style.left = '50%';
                flame.style.top = '50%';
                flame.style.transform = 'translate(-50%, -50%)';
                flame.style.transition = 'all 1s ease-in-out';
                canvas.appendChild(flame);
                
                // Animate flame
                let flameSize = 16;
                const flameInterval = setInterval(() => {
                    flameSize = 12 + Math.random() * 8;
                    flame.style.width = `${flameSize}px`;
                    flame.style.height = `${flameSize}px`;
                }, 100);
                
                setTimeout(() => {
                    clearInterval(flameInterval);
                    flame.style.opacity = '0';
                    setTimeout(() => flame.remove(), 500);
                }, 3000);
            }, 1000);
            
            setTimeout(() => {
                // Show products
                lithium.style.opacity = '0';
                setTimeout(() => lithium.remove(), 500);
                
                const products = document.createElement('div');
                products.className = 'absolute top-1/2 left-1/2 transform -translate-x-1/2 text-white text-center';
                products.innerHTML = '<div>LiO</div><div class="text-xs text-blue-300 mt-1">Lithium Oxide (Group 1)</div>';
                canvas.appendChild(products);
            }, 4000);
            
            // Reset after animation
            setTimeout(() => {
                reactionRunning = false;
                ui.startReactionBtn.disabled = false;
            }, slowMotion ? 12000 : 6000);
        }
        
        function createSodiumChlorineReaction(canvas) {
            // Create chlorine gas
            const chlorineContainer = document.createElement('div');
            chlorineContainer.className = 'absolute inset-0 bg-green-200 bg-opacity-10';
            canvas.appendChild(chlorineContainer);
            
            // Create sodium metal
            const sodium = document.createElement('div');
            sodium.className = 'absolute w-12 h-12 bg-gray-200 rounded-full top-1/2 left-1/3 flex items-center justify-center text-gray-800 font-bold group1-element';
            sodium.textContent = 'Na';
            sodium.innerHTML += '<div class="absolute -top-6 text-xs font-semibold text-blue-400">Group 1</div>';
            canvas.appendChild(sodium);
            
            // Create chlorine representation
            const chlorine = document.createElement('div');
            chlorine.className = 'absolute w-12 h-12 bg-green-300 rounded-full top-1/2 right-1/3 flex items-center justify-center text-gray-800 font-bold';
            chlorine.textContent = 'Cl';
            canvas.appendChild(chlorine);
            
            // Animate reaction
            setTimeout(() => {
                // Move elements together
                sodium.style.transition = 'all 1s ease-in';
                sodium.style.left = '50%';
                sodium.style.transform = 'translateX(-50%)';
                
                chlorine.style.transition = 'all 1s ease-in';
                chlorine.style.left = '50%';
                chlorine.style.transform = 'translateX(-50%)';
            }, 500);
            
            setTimeout(() => {
                // Create flash effect
                const flash = document.createElement('div');
                flash.className = 'absolute inset-0 bg-yellow-300 opacity-80';
                canvas.appendChild(flash);
                
                setTimeout(() => {
                    flash.style.opacity = '0';
                    setTimeout(() => flash.remove(), 500);
                }, 200);
            }, 1500);
            
            setTimeout(() => {
                // Show products
                sodium.style.opacity = '0';
                chlorine.style.opacity = '0';
                setTimeout(() => {
                    sodium.remove();
                    chlorine.remove();
                }, 500);
                
                const products = document.createElement('div');
                products.className = 'absolute top-1/2 left-1/2 transform -translate-x-1/2 text-white text-center';
                products.innerHTML = '<div>NaCl</div><div class="text-xs text-blue-300 mt-1">Sodium Chloride</div>';
                canvas.appendChild(products);
            }, 2000);
            
            // Reset after animation
            setTimeout(() => {
                reactionRunning = false;
                ui.startReactionBtn.disabled = false;
            }, slowMotion ? 8000 : 4000);
        }
        
        // Add this function to update the current reaction step
        function updateReactionStep(stepIndex) {
            const steps = document.querySelectorAll('#reaction-steps .flex');
            steps.forEach((step, index) => {
                if (index < stepIndex) {
                    step.classList.add('text-green-400');
                    step.querySelector('.w-6').classList.remove('bg-blue-500');
                    step.querySelector('.w-6').classList.add('bg-green-500');
                } else if (index === stepIndex) {
                    step.classList.add('text-blue-400');
                    step.querySelector('.w-6').classList.add('ring-2', 'ring-blue-300');
                }
            });
        }
        
        // Initialize Periodic Table
        function initPeriodicTable() {
            const table = ui.periodicTable;
            table.innerHTML = '';
            
            // Create placeholder elements for proper positioning
            for (let i = 1; i <= 118; i++) {
                const placeholder = document.createElement('div');
                placeholder.className = 'periodic-element other';
                placeholder.style.visibility = 'hidden';
                table.appendChild(placeholder);
            }
            
            // Add Group 1 and Group 2 highlighting
            const group1Header = document.createElement('div');
            group1Header.className = 'col-start-1 text-center font-semibold text-blue-400 mb-2';
            group1Header.textContent = 'Group 1: Alkali Metals';
            table.appendChild(group1Header);
            
            const group2Header = document.createElement('div');
            group2Header.className = 'col-start-2 text-center font-semibold text-green-400 mb-2';
            group2Header.textContent = 'Group 2: Alkaline Earth Metals';
            table.appendChild(group2Header);
            
            // Add actual elements
            periodicTableData.forEach(element => {
                const elementDiv = document.createElement('div');
                elementDiv.className = `periodic-element ${element.type}`;
                elementDiv.style.gridColumn = element.group;
                elementDiv.style.gridRow = element.period;
                elementDiv.style.visibility = 'visible';
                
                // Add special styling for Group 1 and Group 2
                if (element.type === 'group1') {
                    elementDiv.innerHTML = `
                        <div class="element-number-small">${element.number}</div>
                        <div class="element-symbol-large">${element.symbol}</div>
                        <div class="text-xs text-blue-300 mt-1">Group 1</div>
                    `;
                } else if (element.type === 'group2') {
                    elementDiv.innerHTML = `
                        <div class="element-number-small">${element.number}</div>
                        <div class="element-symbol-large">${element.symbol}</div>
                        <div class="text-xs text-green-300 mt-1">Group 2</div>
                    `;
                } else {
                    elementDiv.innerHTML = `
                        <div class="element-number-small">${element.number}</div>
                        <div class="element-symbol-large">${element.symbol}</div>
                    `;
                }
                
                elementDiv.addEventListener('click', () => {
                    showPeriodicElementInfo(element);
                    playSound('click');
                });
                
                // Replace placeholder with actual element
                const placeholder = table.children[element.number - 1];
                table.replaceChild(elementDiv, placeholder);
            });
        }
        
        function showPeriodicElementInfo(element) {
            const infoContainer = ui.periodicElementInfo;
            const elementName = element.name;
            const elementSymbol = element.symbol;
            
            // Check if we have detailed data for this element
            const detailedData = elementsData[elementName];
            
            if (detailedData) {
                infoContainer.innerHTML = `
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-xl font-semibold text-white">${elementName} (${elementSymbol})</h3>
                        <div class="text-3xl font-bold text-white">${elementSymbol}</div>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <p class="text-gray-400">Atomic Number</p>
                            <p class="text-white font-semibold">${detailedData.atomicNumber}</p>
                        </div>
                        <div>
                            <p class="text-gray-400">Group</p>
                            <p class="text-white font-semibold">Group ${detailedData.group}</p>
                        </div>
                        <div>
                            <p class="text-gray-400">Period</p>
                            <p class="text-white font-semibold">${detailedData.period}</p>
                        </div>
                        <div>
                            <p class="text-gray-400">Electron Config</p>
                            <p class="text-white font-semibold">${detailedData.electronConfiguration}</p>
                        </div>
                    </div>
                    <div class="mt-4">
                        <p class="text-gray-400">Fun Fact</p>
                        <p class="text-gray-300">${detailedData.funFact}</p>
                    </div>
                `;
                
                // Show applications if available
                if (detailedData.applications && detailedData.applications.length > 0) {
                    const applicationsHtml = detailedData.applications.map(app => `<li class="text-gray-300">${app}</li>`).join('');
                    infoContainer.innerHTML += `
                        <div class="mt-4">
                            <p class="text-gray-400">Applications</p>
                            <ul class="list-disc list-inside text-gray-300">
                                ${applicationsHtml}
                            </ul>
                        </div>
                    `;
                }
            } else {
                infoContainer.innerHTML = `
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-xl font-semibold text-white">${elementName} (${elementSymbol})</h3>
                        <div class="text-3xl font-bold text-white">${elementSymbol}</div>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <p class="text-gray-400">Atomic Number</p>
                            <p class="text-white font-semibold">${element.number}</p>
                        </div>
                        <div>
                            <p class="text-gray-400">Group</p>
                            <p class="text-white font-semibold">${element.group}</p>
                        </div>
                    </div>
                    <div class="mt-4 p-3 bg-yellow-900 bg-opacity-20 border-l-4 border-yellow-500 rounded">
                        <p class="text-yellow-300">Detailed information not available for this element in the current module.</p>
                    </div>
                `;
            }
            
            infoContainer.classList.add('active');
            
            // Highlight the selected element
            document.querySelectorAll('.periodic-element').forEach(el => {
                el.classList.remove('highlighted');
            });
            
            // Find and highlight the element
            const elementToHighlight = Array.from(document.querySelectorAll('.periodic-element')).find(el => 
                el.querySelector('.element-symbol-large').textContent === elementSymbol
            );
            
            if (elementToHighlight) {
                elementToHighlight.classList.add('highlighted');
            }
        }
        
        // Initialize Molecular Builder
        function initMolecularBuilder() {
            const palette = ui.elementPalette;
            palette.innerHTML = '';
            
            // Add group labels
            const group1Label = document.createElement('div');
            group1Label.className = 'w-full text-center font-semibold text-blue-400 mb-2';
            group1Label.textContent = 'Group 1: Alkali Metals';
            palette.appendChild(group1Label);
            
            // Add Group 1 elements
            Object.entries(elementsData).forEach(([name, data]) => {
                if (data.group === 'I') {
                    const elementDiv = document.createElement('div');
                    elementDiv.className = 'palette-element group1';
                    elementDiv.dataset.element = name;
                    
                    elementDiv.innerHTML = `
                        <div class="palette-symbol">${data.symbol}</div>
                        <div class="palette-name">${name}</div>
                        <div class="text-xs text-blue-300 mt-1">Group 1</div>
                    `;
                    
                    elementDiv.addEventListener('click', () => {
                        document.querySelectorAll('.palette-element').forEach(el => {
                            el.classList.remove('selected');
                        });
                        elementDiv.classList.add('selected');
                        selectedPaletteElement = name;
                        playSound('click');
                    });
                    
                    palette.appendChild(elementDiv);
                }
            });
            
            // Add Group 2 label
            const group2Label = document.createElement('div');
            group2Label.className = 'w-full text-center font-semibold text-green-400 mt-4 mb-2';
            group2Label.textContent = 'Group 2: Alkaline Earth Metals';
            palette.appendChild(group2Label);
            
            // Add Group 2 elements
            Object.entries(elementsData).forEach(([name, data]) => {
                if (data.group === 'II') {
                    const elementDiv = document.createElement('div');
                    elementDiv.className = 'palette-element group2';
                    elementDiv.dataset.element = name;
                    
                    elementDiv.innerHTML = `
                        <div class="palette-symbol">${data.symbol}</div>
                        <div class="palette-name">${name}</div>
                        <div class="text-xs text-green-300 mt-1">Group 2</div>
                    `;
                    
                    elementDiv.addEventListener('click', () => {
                        document.querySelectorAll('.palette-element').forEach(el => {
                            el.classList.remove('selected');
                        });
                        elementDiv.classList.add('selected');
                        selectedPaletteElement = name;
                        playSound('click');
                    });
                    
                    palette.appendChild(elementDiv);
                }
            });
            
            // Canvas click handler with group-specific styling
            ui.builderCanvas.addEventListener('click', (e) => {
                if (!selectedPaletteElement && !bondMode) {
                    showMessage("Please select an element from the palette first.");
                    return;
                }
                
                const rect = ui.builderCanvas.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                
                if (bondMode) {
                    // Bond mode - find nearest element and create bond
                    const nearestElement = findNearestElement(x, y);
                    if (nearestElement) {
                        createBond(nearestElement);
                    }
                } else {
                    // Create element on canvas with group-specific styling
                    const element = elementsData[selectedPaletteElement];
                    const elementDiv = document.createElement('div');
                    elementDiv.className = `absolute w-12 h-12 rounded-full flex items-center justify-center text-white font-bold cursor-pointer ${element.group === 'I' ? 'group1-element' : 'group2-element'}`;
                    elementDiv.style.left = `${x - 24}px`;
                    elementDiv.style.top = `${y - 24}px`;
                    elementDiv.textContent = element.symbol;
                    elementDiv.dataset.element = selectedPaletteElement;
                    
                    // Add group label
                    const groupLabel = document.createElement('div');
                    groupLabel.className = `absolute -top-6 text-xs font-semibold ${element.group === 'I' ? 'text-blue-400' : 'text-green-400'}`;
                    groupLabel.textContent = `Group ${element.group}`;
                    elementDiv.appendChild(groupLabel);
                    
                    // Add click handler to remove element
                    elementDiv.addEventListener('click', (e) => {
                        e.stopPropagation();
                        elementDiv.remove();
                        moleculeElements = moleculeElements.filter(el => el !== elementDiv);
                        playSound('click');
                    });
                    
                    ui.builderCanvas.appendChild(elementDiv);
                    moleculeElements.push(elementDiv);
                    
                    // Award points for building molecules
                    awardPoints(5);
                }
            });
            
            // Clear button
            ui.clearMoleculeBtn.addEventListener('click', () => {
                ui.builderCanvas.innerHTML = `
                    <div class="flex items-center justify-center h-full text-gray-400">
                        <div class="text-center">
                            <i class="fas fa-project-diagram text-4xl mb-2"></i>
                            <p>Click on elements above and then click on the canvas to build molecules</p>
                        </div>
                    </div>
                `;
                moleculeElements = [];
                playSound('click');
            });
            
            // Save button
            ui.saveMoleculeBtn.addEventListener('click', () => {
                if (moleculeElements.length === 0) {
                    showMessage("Please build a molecule first.");
                    return;
                }
                
                // Save molecule (simplified - just show a message)
                showMessage("Molecule saved successfully!");
                playSound('click');
                
                // Award achievement for building molecules
                if (!userProgress.completedSections.includes('molecules-built')) {
                    userProgress.completedSections.push('molecules-built');
                    if (userProgress.completedSections.length >= 5) {
                        awardAchievement('molecular-architect');
                    }
                }
            });
            
            // Bond mode button
            ui.bondModeBtn.addEventListener('click', () => {
                bondMode = !bondMode;
                ui.bondModeBtn.classList.toggle('bg-blue-600');
                playSound('click');
            });
        }
        
        // Find nearest element to coordinates
        function findNearestElement(x, y) {
            let nearestElement = null;
            let minDistance = Infinity;
            
            moleculeElements.forEach(element => {
                const rect = element.getBoundingClientRect();
                const canvasRect = ui.builderCanvas.getBoundingClientRect();
                const elementX = rect.left - canvasRect.left + rect.width / 2;
                const elementY = rect.top - canvasRect.top + rect.height / 2;
                
                const distance = Math.sqrt(Math.pow(x - elementX, 2) + Math.pow(y - elementY, 2));
                
                if (distance < minDistance && distance < 50) {
                    minDistance = distance;
                    nearestElement = element;
                }
            });
            
            return nearestElement;
        }
        
        // Create bond between elements
        function createBond(element) {
            // Find another element to bond with
            const otherElements = moleculeElements.filter(el => el !== element);
            
            if (otherElements.length === 0) {
                showMessage("Need at least two elements to create a bond.");
                return;
            }
            
            // For simplicity, bond with the first other element
            const otherElement = otherElements[0];
            
            // Get positions
            const elementRect = element.getBoundingClientRect();
            const otherRect = otherElement.getBoundingClientRect();
            const canvasRect = ui.builderCanvas.getBoundingClientRect();
            
            const x1 = elementRect.left - canvasRect.left + elementRect.width / 2;
            const y1 = elementRect.top - canvasRect.top + elementRect.height / 2;
            const x2 = otherRect.left - canvasRect.left + otherRect.width / 2;
            const y2 = otherRect.top - canvasRect.top + otherRect.height / 2;
            
            // Calculate line length and angle
            const length = Math.sqrt(Math.pow(x2 - x1, 2) + Math.pow(y2 - y1, 2));
            const angle = Math.atan2(y2 - y1, x2 - x1) * 180 / Math.PI;
            
            // Create bond line
            const bond = document.createElement('div');
            bond.className = 'absolute bg-white';
            bond.style.width = `${length}px`;
            bond.style.height = '2px';
            bond.style.left = `${x1}px`;
            bond.style.top = `${y1}px`;
            bond.style.transform = `rotate(${angle}deg)`;
            bond.style.transformOrigin = '0 0';
            
            ui.builderCanvas.appendChild(bond);
            
            // Award points for creating bonds
            awardPoints(3);
        }
        
        // Initialize Quizzes
        function initQuizzes() {
            // Pre-Quiz
            generateQuizUI(preQuizQuestions, ui.prequizQuestions, 'prequiz');
            ui.prequizSubmitBtn.addEventListener('click', () => checkAnswers(preQuizQuestions, ui.prequizQuestions, ui.prequizResults, false));
            
            // Post-Quiz
            generatePostQuizUI();
            ui.postquizSubmitBtn.addEventListener('click', () => checkAnswers(postQuizQuestions, ui.postquizQuestions, ui.postquizResults, true));
        }
        
        function generateQuizUI(questions, container, quizType) {
            container.innerHTML = '';
            
            questions.forEach((q, index) => {
                const questionDiv = document.createElement('div');
                questionDiv.className = 'quiz-question';
                questionDiv.innerHTML = `<div class="question-text">${index + 1}. ${q.question}</div>`;
                
                if (q.type === 'multiple-choice' || q.type === 'click-to-select') {
                    const optionsDiv = document.createElement('div');
                    optionsDiv.className = 'quiz-options';
                    
                    q.options.forEach(option => {
                        const optionBtn = document.createElement('button');
                        optionBtn.className = 'quiz-option';
                        optionBtn.textContent = option;
                        optionBtn.dataset.questionIndex = index;
                        optionBtn.dataset.answer = option;
                        
                        optionBtn.addEventListener('click', function() {
                            // Remove selected class from all options for this question
                            container.querySelectorAll(`.quiz-option[data-question-index="${index}"]`).forEach(btn => {
                                btn.classList.remove('selected');
                            });
                            
                            // Add selected class to clicked option
                            this.classList.add('selected');
                            
                            // Update progress
                            updateQuizProgress(quizType);
                            playSound('click');
                        });
                        
                        optionsDiv.appendChild(optionBtn);
                    });
                    
                    questionDiv.appendChild(optionsDiv);
                } else if (q.type === 'drag-and-drop') {
                    const dragContainer = document.createElement('div');
                    dragContainer.className = 'drag-container';
                    
                    // Source container
                    const sourceContainer = document.createElement('div');
                    sourceContainer.className = 'drag-source';
                    
                    q.items.forEach(item => {
                        const dragItem = document.createElement('div');
                        dragItem.className = 'drag-item';
                        dragItem.draggable = true;
                        dragItem.dataset.value = item;
                        dragItem.textContent = item;
                        
                        dragItem.addEventListener('dragstart', handleDragStart);
                        dragItem.addEventListener('dragend', handleDragEnd);
                        
                        sourceContainer.appendChild(dragItem);
                    });
                    
                    dragContainer.appendChild(sourceContainer);
                    
                    // Target container
                    const targetContainer = document.createElement('div');
                    targetContainer.className = 'drag-target';
                    
                    Array(q.answer.length).fill(0).forEach((_, i) => {
                        const dropzone = document.createElement('div');
                        dropzone.className = 'dropzone';
                        dropzone.dataset.index = i;
                        dropzone.textContent = 'Drop here';
                        
                        dropzone.addEventListener('dragover', handleDragOver);
                        dropzone.addEventListener('drop', (e) => {
                            handleDrop(e);
                            updateQuizProgress(quizType);
                        });
                        
                        targetContainer.appendChild(dropzone);
                        
                        if (i < q.answer.length - 1) {
                            const arrow = document.createElement('span');
                            arrow.className = 'text-2xl text-gray-500';
                            arrow.textContent = '';
                            targetContainer.appendChild(arrow);
                        }
                    });
                    
                    dragContainer.appendChild(targetContainer);
                    questionDiv.appendChild(dragContainer);
                }
                
                container.appendChild(questionDiv);
            });
        }
        
        function generatePostQuizUI() {
            ui.postquizQuestions.innerHTML = '';
            
            postQuizQuestions.forEach((q, index) => {
                const questionDiv = document.createElement('div');
                questionDiv.className = 'quiz-question';
                questionDiv.innerHTML = `<div class="question-text">${index + 1}. ${q.question}</div>`;
                
                if (q.type === 'multiple-choice') {
                    const optionsDiv = document.createElement('div');
                    optionsDiv.className = 'quiz-options';
                    
                    q.options.forEach(option => {
                        const optionBtn = document.createElement('button');
                        optionBtn.className = 'quiz-option';
                        optionBtn.textContent = option;
                        optionBtn.dataset.questionIndex = index;
                        optionBtn.dataset.answer = option;
                        
                        optionBtn.addEventListener('click', function() {
                            // Remove selected class from all options for this question
                            ui.postquizQuestions.querySelectorAll(`.quiz-option[data-question-index="${index}"]`).forEach(btn => {
                                btn.classList.remove('selected');
                            });
                            
                            // Add selected class to clicked option
                            this.classList.add('selected');
                            
                            // Update progress
                            updateQuizProgress('postquiz');
                            playSound('click');
                        });
                        
                        optionsDiv.appendChild(optionBtn);
                    });
                    
                    questionDiv.appendChild(optionsDiv);
                } else if (q.type === 'fill-in-the-blank') {
                    const inputContainer = document.createElement('div');
                    inputContainer.className = 'flex items-center space-x-2';
                    inputContainer.innerHTML = `
                        <span>Ca + 2HO  </span>
                        <input type="text" id="blank-product-${index}" class="px-3 py-2 bg-gray-800 border border-gray-700 rounded text-white" placeholder="...">
                        <span> + </span>
                        <input type="text" id="blank-gas-${index}" class="px-3 py-2 bg-gray-800 border border-gray-700 rounded text-white" placeholder="...">
                    `;
                    
                    // Add event listeners to inputs
                    inputContainer.querySelectorAll('input').forEach(input => {
                        input.addEventListener('input', () => updateQuizProgress('postquiz'));
                    });
                    
                    questionDiv.appendChild(inputContainer);
                } else if (q.type === 'drag-and-drop') {
                    // Similar to pre-quiz drag-and-drop
                    const dragContainer = document.createElement('div');
                    dragContainer.className = 'drag-container';
                    
                    // Source container
                    const sourceContainer = document.createElement('div');
                    sourceContainer.className = 'drag-source';
                    
                    q.items.forEach(item => {
                        const dragItem = document.createElement('div');
                        dragItem.className = 'drag-item';
                        dragItem.draggable = true;
                        dragItem.dataset.value = item;
                        dragItem.textContent = item;
                        
                        dragItem.addEventListener('dragstart', handleDragStart);
                        dragItem.addEventListener('dragend', handleDragEnd);
                        
                        sourceContainer.appendChild(dragItem);
                    });
                    
                    dragContainer.appendChild(sourceContainer);
                    
                    // Reactivity indicators
                    const reactivityContainer = document.createElement('div');
                    reactivityContainer.className = 'flex items-center justify-center space-x-4 my-2';
                    reactivityContainer.innerHTML = `
                        <span class="text-sm text-gray-500">Least Reactive</span>
                        <span class="text-3xl text-gray-400"></span>
                        <span class="text-sm text-gray-500">Most Reactive</span>
                    `;
                    dragContainer.appendChild(reactivityContainer);
                    
                    // Target container
                    const targetContainer = document.createElement('div');
                    targetContainer.className = 'drag-target';
                    
                    Array(q.answer.length).fill(0).forEach((_, i) => {
                        const dropzone = document.createElement('div');
                        dropzone.className = 'dropzone';
                        dropzone.dataset.index = i;
                        dropzone.textContent = 'Drop here';
                        
                        dropzone.addEventListener('dragover', handleDragOver);
                        dropzone.addEventListener('drop', (e) => {
                            handleDrop(e);
                            updateQuizProgress('postquiz');
                        });
                        
                        targetContainer.appendChild(dropzone);
                        
                        if (i < q.answer.length - 1) {
                            const arrow = document.createElement('span');
                            arrow.className = 'text-3xl text-gray-400';
                            arrow.textContent = '';
                            targetContainer.appendChild(arrow);
                        }
                    });
                    
                    dragContainer.appendChild(targetContainer);
                    questionDiv.appendChild(dragContainer);
                } else if (q.type === 'mcq-flame-colours') {
                    q.subQuestions.forEach(sq => {
                        const subQuestionDiv = document.createElement('div');
                        subQuestionDiv.className = 'mb-4';
                        subQuestionDiv.innerHTML = `<p class="font-medium text-white">${sq.label}:</p>`;
                        
                        const optionsDiv = document.createElement('div');
                        optionsDiv.className = 'flex flex-wrap gap-2 mt-2';
                        
                        sq.options.forEach(option => {
                            const optionBtn = document.createElement('button');
                            optionBtn.className = 'quiz-option';
                            optionBtn.textContent = option;
                            optionBtn.dataset.questionIndex = index;
                            optionBtn.dataset.subLabel = sq.label;
                            optionBtn.dataset.answer = option;
                            
                            optionBtn.addEventListener('click', function() {
                                // Remove selected class from all options for this sub-question
                                ui.postquizQuestions.querySelectorAll(`.quiz-option[data-question-index="${index}"][data-sub-label="${sq.label}"]`).forEach(btn => {
                                    btn.classList.remove('selected');
                                });
                                
                                // Add selected class to clicked option
                                this.classList.add('selected');
                                
                                // Update progress
                                updateQuizProgress('postquiz');
                                playSound('click');
                            });
                            
                            optionsDiv.appendChild(optionBtn);
                        });
                        
                        subQuestionDiv.appendChild(optionsDiv);
                        questionDiv.appendChild(subQuestionDiv);
                    });
                } else if (q.type === 'short-answer') {
                    q.subQuestions.forEach(sq => {
                        const answerDiv = document.createElement('div');
                        answerDiv.className = 'flex items-center space-x-2 mb-3';
                        answerDiv.innerHTML = `
                            <span class="font-medium text-white">${sq.label}:</span>
                            <input type="text" id="short-answer-${sq.label.toLowerCase()}-${index}" class="px-3 py-2 bg-gray-800 border border-gray-700 rounded text-white" placeholder="...">
                        `;
                        
                        // Add event listener
                        answerDiv.querySelector('input').addEventListener('input', () => updateQuizProgress('postquiz'));
                        
                        questionDiv.appendChild(answerDiv);
                    });
                } else if (q.type === 'true-or-false') {
                    const optionsDiv = document.createElement('div');
                    optionsDiv.className = 'flex space-x-4';
                    
                    ['True', 'False'].forEach(option => {
                        const optionBtn = document.createElement('button');
                        optionBtn.className = 'quiz-option';
                        optionBtn.textContent = option;
                        optionBtn.dataset.questionIndex = index;
                        optionBtn.dataset.answer = option;
                        
                        optionBtn.addEventListener('click', function() {
                            // Remove selected class from all options for this question
                            ui.postquizQuestions.querySelectorAll(`.quiz-option[data-question-index="${index}"]`).forEach(btn => {
                                btn.classList.remove('selected');
                            });
                            
                            // Add selected class to clicked option
                            this.classList.add('selected');
                            
                            // Update progress
                            updateQuizProgress('postquiz');
                            playSound('click');
                        });
                        
                        optionsDiv.appendChild(optionBtn);
                    });
                    
                    questionDiv.appendChild(optionsDiv);
                } else if (q.type === 'equation-balancing') {
                    const equationDiv = document.createElement('div');
                    equationDiv.className = 'flex items-center space-x-2';
                    equationDiv.innerHTML = `
                        <input type="text" id="coeff-1-${index}" class="px-3 py-2 bg-gray-800 border border-gray-700 rounded text-white w-16 text-center" placeholder="1">
                        <span class="text-white">MgCO  </span>
                        <input type="text" id="coeff-2-${index}" class="px-3 py-2 bg-gray-800 border border-gray-700 rounded text-white w-16 text-center" placeholder="1">
                        <span class="text-white">MgO + </span>
                        <input type="text" id="coeff-3-${index}" class="px-3 py-2 bg-gray-800 border border-gray-700 rounded text-white w-16 text-center" placeholder="1">
                        <span class="text-white">CO</span>
                    `;
                    
                    // Add event listeners
                    equationDiv.querySelectorAll('input').forEach(input => {
                        input.addEventListener('input', () => updateQuizProgress('postquiz'));
                    });
                    
                    questionDiv.appendChild(equationDiv);
                } else if (q.type === 'match-the-pair') {
                    const matchContainer = document.createElement('div');
                    matchContainer.className = 'grid grid-cols-1 md:grid-cols-2 gap-6 mt-2';
                    
                    // Observations column
                    const observationsCol = document.createElement('div');
                    observationsCol.innerHTML = '<h4 class="font-semibold mb-3 text-white">Observations</h4>';
                    
                    const observationsContainer = document.createElement('div');
                    observationsContainer.className = 'space-y-3';
                    
                    const shuffledObservations = [...q.items.map(i => i.observation)].sort(() => Math.random() - 0.5);
                    
                    shuffledObservations.forEach(obs => {
                        const matchItem = document.createElement('div');
                        matchItem.className = 'match-item p-3 bg-gray-800 rounded-lg shadow cursor-move';
                        matchItem.draggable = true;
                        matchItem.dataset.value = obs;
                        matchItem.textContent = obs;
                        
                        matchItem.addEventListener('dragstart', handleDragStart);
                        matchItem.addEventListener('dragend', handleDragEnd);
                        
                        observationsContainer.appendChild(matchItem);
                    });
                    
                    observationsCol.appendChild(observationsContainer);
                    matchContainer.appendChild(observationsCol);
                    
                    // Metals column
                    const metalsCol = document.createElement('div');
                    metalsCol.innerHTML = '<h4 class="font-semibold mb-3 text-white">Metals</h4>';
                    
                    const metalsContainer = document.createElement('div');
                    metalsContainer.className = 'space-y-3';
                    
                    q.items.forEach(item => {
                        const dropzone = document.createElement('div');
                        dropzone.className = 'dropzone-match p-3 bg-gray-800 rounded-lg border-2 border-dashed border-gray-700';
                        dropzone.dataset.value = item.metal;
                        dropzone.textContent = item.metal;
                        
                        dropzone.addEventListener('dragover', handleDragOver);
                        dropzone.addEventListener('drop', (e) => {
                            handleDrop(e);
                            updateQuizProgress('postquiz');
                        });
                        
                        metalsContainer.appendChild(dropzone);
                    });
                    
                    metalsCol.appendChild(metalsContainer);
                    matchContainer.appendChild(metalsCol);
                    
                    questionDiv.appendChild(matchContainer);
                } else if (q.type === 'extended-response') {
                    const textarea = document.createElement('textarea');
                    textarea.id = `extended-response-${index}`;
                    textarea.className = 'w-full h-32 p-3 bg-gray-800 border border-gray-700 rounded text-white resize-none';
                    textarea.placeholder = 'Type your answer here...';
                    
                    // Add event listener
                    textarea.addEventListener('input', () => updateQuizProgress('postquiz'));
                    
                    questionDiv.appendChild(textarea);
                }
                
                ui.postquizQuestions.appendChild(questionDiv);
            });
        }
        
        function updateQuizProgress(quizType) {
            const questions = quizType === 'prequiz' ? preQuizQuestions : postQuizQuestions;
            const container = quizType === 'prequiz' ? ui.prequizQuestions : ui.postquizQuestions;
            const progressText = quizType === 'prequiz' ? ui.prequizProgressText : ui.postquizProgressText;
            const progressBar = quizType === 'prequiz' ? ui.prequizProgressBar : ui.postquizProgressBar;
            
            let answeredQuestions = 0;
            
            questions.forEach((q, index) => {
                const questionDiv = container.children[index];
                
                if (q.type === 'multiple-choice' || q.type === 'click-to-select' || q.type === 'true-or-false') {
                    if (questionDiv.querySelector('.quiz-option.selected')) {
                        answeredQuestions++;
                    }
                } else if (q.type === 'drag-and-drop') {
                    const dropzones = questionDiv.querySelectorAll('.dropzone');
                    let allFilled = true;
                    dropzones.forEach(dropzone => {
                        if (!dropzone.querySelector('.drag-item') && dropzone.textContent !== 'Drop here') {
                            allFilled = false;
                        }
                    });
                    if (allFilled) {
                        answeredQuestions++;
                    }
                } else if (q.type === 'fill-in-the-blank') {
                    const inputs = questionDiv.querySelectorAll('input[type="text"]');
                    let allFilled = true;
                    inputs.forEach(input => {
                        if (!input.value.trim()) {
                            allFilled = false;
                        }
                    });
                    if (allFilled) {
                        answeredQuestions++;
                    }
                } else if (q.type === 'mcq-flame-colours') {
                    let allAnswered = true;
                    q.subQuestions.forEach(sq => {
                        if (!questionDiv.querySelector(`.quiz-option.selected[data-sub-label="${sq.label}"]`)) {
                            allAnswered = false;
                        }
                    });
                    if (allAnswered) {
                        answeredQuestions++;
                    }
                } else if (q.type === 'short-answer') {
                    const inputs = questionDiv.querySelectorAll('input[type="text"]');
                    let allFilled = true;
                    inputs.forEach(input => {
                        if (!input.value.trim()) {
                            allFilled = false;
                        }
                    });
                    if (allFilled) {
                        answeredQuestions++;
                    }
                } else if (q.type === 'equation-balancing') {
                    const inputs = questionDiv.querySelectorAll('input[type="text"]');
                    let allFilled = true;
                    inputs.forEach(input => {
                        if (!input.value.trim()) {
                            allFilled = false;
                        }
                    });
                    if (allFilled) {
                        answeredQuestions++;
                    }
                } else if (q.type === 'match-the-pair') {
                    const dropzones = questionDiv.querySelectorAll('.dropzone-match');
                    let allFilled = true;
                    dropzones.forEach(dropzone => {
                        if (!dropzone.querySelector('.match-item')) {
                            allFilled = false;
                        }
                    });
                    if (allFilled) {
                        answeredQuestions++;
                    }
                } else if (q.type === 'extended-response') {
                    const textarea = questionDiv.querySelector('textarea');
                    if (textarea.value.trim()) {
                        answeredQuestions++;
                    }
                }
            });
            
            progressText.textContent = `${answeredQuestions}/${questions.length}`;
            progressBar.style.width = `${(answeredQuestions / questions.length) * 100}%`;
        }
        
        // Drag and Drop Handlers
        function handleDragStart(e) {
            const data = {
                value: e.target.dataset.value,
                originType: e.target.parentElement.dataset.type || 'source',
                originId: e.target.parentElement.id || ''
            };
            e.dataTransfer.setData('text/plain', JSON.stringify(data));
            e.target.classList.add('dragging');
        }
        
        function handleDragEnd(e) {
            e.target.classList.remove('dragging');
        }
        
        function handleDragOver(e) {
            e.preventDefault();
            e.currentTarget.classList.add('drag-over');
        }
        
        function handleDrop(e) {
            e.preventDefault();
            e.currentTarget.classList.remove('drag-over');
            
            const data = JSON.parse(e.dataTransfer.getData('text/plain'));
            const draggedElement = document.querySelector(`.drag-item[data-value="${data.value}"], .match-item[data-value="${data.value}"]`);
            
            if (!draggedElement) return;
            
            // If dropping on source container
            if (e.currentTarget.dataset.type === 'source' || e.currentTarget.classList.contains('drag-source')) {
                // Only move if not already in source
                if (data.originType !== 'source') {
                    e.currentTarget.appendChild(draggedElement);
                }
            } 
            // If dropping on target dropzone
            else {
                // Check if dropzone already has an item
                const existingItem = e.currentTarget.querySelector('.drag-item, .match-item');
                
                if (existingItem) {
                    // If dragged from source container
                    if (data.originType === 'source' || !data.originId) {
                        // Move existing item back to source
                        const sourceContainer = document.querySelector('.drag-source');
                        if (sourceContainer) {
                            sourceContainer.appendChild(existingItem);
                        }
                        // Move dragged element to current dropzone
                        e.currentTarget.appendChild(draggedElement);
                    } 
                    // If dragged from another dropzone
                    else {
                        // Swap items
                        const originDropzone = document.getElementById(data.originId);
                        if (originDropzone) {
                            originDropzone.appendChild(existingItem);
                        }
                        e.currentTarget.appendChild(draggedElement);
                    }
                } else {
                    // Dropzone is empty, just append
                    e.currentTarget.appendChild(draggedElement);
                }
                
                // Clear placeholder text if it exists
                if (e.currentTarget.textContent.trim() === 'Drop here' || e.currentTarget.textContent.trim() === 'Drop here') {
                    e.currentTarget.textContent = '';
                }
            }
        }
        
        // Check Answers
        function checkAnswers(questions, container, resultsDiv, isPostQuiz) {
            let score = 0;
            let totalScore = 0;
            
            questions.forEach((q, index) => {
                const questionDiv = container.children[index];
                let isCorrect = false;
                
                if (q.type === 'multiple-choice' || q.type === 'click-to-select') {
                    const selectedOption = questionDiv.querySelector('.quiz-option.selected');
                    if (selectedOption && selectedOption.dataset.answer === q.answer) {
                        isCorrect = true;
                    }
                    
                    const allOptions = questionDiv.querySelectorAll('.quiz-option');
                    allOptions.forEach(option => {
                        option.disabled = true;
                        if (option.dataset.answer === q.answer) {
                            option.classList.add('correct');
                        } else if (option.classList.contains('selected')) {
                            option.classList.add('incorrect');
                        }
                    });
                } else if (q.type === 'drag-and-drop') {
                    const orderedItems = [...questionDiv.querySelectorAll('.dropzone')].map(zone => {
                        const item = zone.querySelector('.drag-item');
                        return item ? item.dataset.value : null;
                    });
                    
                    if (orderedItems.every(item => item !== null) && JSON.stringify(orderedItems) === JSON.stringify(q.answer)) {
                        isCorrect = true;
                    }
                    
                    const dropzones = questionDiv.querySelectorAll('.dropzone');
                    dropzones.forEach((zone, itemIndex) => {
                        const item = zone.querySelector('.drag-item');
                        if (item) {
                            if (item.dataset.value === q.answer[itemIndex]) {
                                item.classList.add('bg-green-900', 'border-green-500');
                            } else {
                                item.classList.add('bg-red-900', 'border-red-500');
                            }
                            item.draggable = false;
                            item.style.cursor = 'default';
                        }
                        zone.style.borderColor = 'transparent';
                        zone.style.cursor = 'default';
                    });
                    
                    if (!isCorrect) {
                        const correctOrderDiv = document.createElement('p');
                        correctOrderDiv.className = "mt-2 text-sm text-green-400";
                        correctOrderDiv.textContent = `Correct Order: ${q.answer.join('  ')}`;
                        questionDiv.appendChild(correctOrderDiv);
                    }
                } else if (q.type === 'fill-in-the-blank') {
                    const productInput = questionDiv.querySelector(`#blank-product-${index}`);
                    const gasInput = questionDiv.querySelector(`#blank-gas-${index}`);
                    if (productInput.value.trim() === q.blanks[0].answer && gasInput.value.trim() === q.blanks[1].answer) {
                        isCorrect = true;
                    }
                    productInput.disabled = true;
                    gasInput.disabled = true;
                    const resultP = document.createElement('p');
                    resultP.className = "mt-2 text-sm";
                    if (isCorrect) {
                        resultP.textContent = `Correct!`;
                        resultP.classList.add('text-green-400');
                    } else {
                        resultP.textContent = `Incorrect. Correct answer: Ca + 2HO  Ca(OH) + H`;
                        resultP.classList.add('text-red-400');
                    }
                    questionDiv.appendChild(resultP);
                } else if (q.type === 'mcq-flame-colours') {
                    const subQuestions = q.subQuestions;
                    let allCorrect = true;
                    subQuestions.forEach(sq => {
                        const selectedOption = questionDiv.querySelector(`.quiz-option.selected[data-sub-label="${sq.label}"]`);
                        if (!selectedOption || selectedOption.dataset.answer !== sq.answer) {
                            allCorrect = false;
                        }
                        questionDiv.querySelectorAll(`.quiz-option[data-sub-label="${sq.label}"]`).forEach(btn => {
                            btn.disabled = true;
                            if (btn.dataset.answer === sq.answer) {
                                btn.classList.add('correct');
                            } else if (btn.classList.contains('selected')) {
                                btn.classList.add('incorrect');
                            }
                        });
                    });
                    isCorrect = allCorrect;
                } else if (q.type === 'short-answer') {
                    const saInputs = questionDiv.querySelectorAll('input[type="text"]');
                    let saCorrect = true;
                    saInputs.forEach((input, saIndex) => {
                        const label = q.subQuestions[saIndex].label.toLowerCase();
                        const answer = q.subQuestions[saIndex].answer;
                        if (input.value.trim() !== answer) {
                            saCorrect = false;
                        }
                        input.disabled = true;
                        const resultSpan = document.createElement('span');
                        resultSpan.className = "ml-2 text-sm";
                        if (input.value.trim() === answer) {
                            resultSpan.textContent = ``;
                            resultSpan.classList.add('text-green-400');
                        } else {
                            resultSpan.textContent = ` (Correct: ${answer})`;
                            resultSpan.classList.add('text-red-400');
                        }
                        input.parentElement.appendChild(resultSpan);
                    });
                    isCorrect = saCorrect;
                } else if (q.type === 'true-or-false') {
                    const selectedOption = questionDiv.querySelector('.quiz-option.selected');
                    if (selectedOption && selectedOption.dataset.answer === q.answer) {
                        isCorrect = true;
                    }
                    const allOptions = questionDiv.querySelectorAll('.quiz-option');
                    allOptions.forEach(option => {
                        option.disabled = true;
                        if (option.dataset.answer === q.answer) {
                            option.classList.add('correct');
                        } else if (option.classList.contains('selected')) {
                            option.classList.add('incorrect');
                        }
                    });
                } else if (q.type === 'equation-balancing') {
                    const coeffInputs = questionDiv.querySelectorAll('input[type="text"]');
                    let eqCorrect = true;
                    coeffInputs.forEach((input, eqIndex) => {
                        if (input.value.trim() !== q.blanks[eqIndex].answer) {
                            eqCorrect = false;
                        }
                        input.disabled = true;
                        if (input.value.trim() === q.blanks[eqIndex].answer) {
                            input.classList.add('bg-green-900', 'border-green-500');
                        } else {
                            input.classList.add('bg-red-900', 'border-red-500');
                        }
                    });
                    isCorrect = eqCorrect;
                } else if (q.type === 'match-the-pair') {
                    let mpCorrect = true;
                    const dropzones = questionDiv.querySelectorAll('.dropzone-match');
                    dropzones.forEach(zone => {
                        const metal = zone.dataset.value;
                        const observationElement = zone.querySelector('.match-item');
                        if (!observationElement || q.matches[observationElement.dataset.value] !== metal) {
                            mpCorrect = false;
                            if (observationElement) {
                                observationElement.classList.add('bg-red-900', 'border-red-500');
                            }
                        } else {
                            observationElement.classList.add('bg-green-900', 'border-green-500');
                        }
                    });
                    isCorrect = mpCorrect;
                    const unmatchedItems = questionDiv.querySelectorAll('.match-item:not(.bg-green-900)');
                    unmatchedItems.forEach(item => {
                        item.draggable = false;
                        item.classList.add('bg-red-900', 'border-red-500');
                    });
                } else if (q.type === 'extended-response') {
                    const responseArea = questionDiv.querySelector('textarea');
                    responseArea.disabled = true;
                    const correctResponse = document.createElement('div');
                    correctResponse.className = "mt-3 p-3 bg-blue-900 bg-opacity-30 rounded-lg text-sm text-blue-300";
                    correctResponse.innerHTML = `<b>Model Answer:</b> ${q.answer}`;
                    questionDiv.appendChild(correctResponse);
                    isCorrect = true; // Don't penalize score for this.
                }
                
                if (isCorrect) {
                    score++;
                }
                totalScore++;
            });
            
            resultsDiv.textContent = `You scored ${score} out of ${totalScore}!`;
            resultsDiv.className = 'mt-4 text-xl font-semibold text-blue-400';
            
            // Award points for quiz completion
            const points = isPostQuiz ? 50 : 25;
            awardPoints(points);
            
            // Save quiz score
            const quizKey = isPostQuiz ? 'postQuiz' : 'preQuiz';
            userProgress.quizScores[quizKey] = score;
            saveUserProgress();
            
            // Award achievement for quiz mastery
            if (score === totalScore) {
                awardAchievement('quiz-master');
            }
            
            if (!isPostQuiz) {
                localStorage.setItem(`${appId}-preQuizCompleted`, 'true');
            }
            
            setTimeout(() => {
                showSection('dashboard');
            }, isPostQuiz ? 5000 : 3000);
        }
        
        // Show Message
        function showMessage(message) {
            ui.messageText.textContent = message;
            ui.messageBox.classList.remove('hidden');
            playSound('error');
        }
        
        // Hide Message
        function hideMessage() {
            ui.messageBox.classList.add('hidden');
        }
        
        // Show Section
        function showSection(sectionName) {
            // Hide all sections
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Show selected section
            document.getElementById(`${sectionName}-section`).classList.add('active');
            
            // Update navigation
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
                if (item.dataset.section === sectionName) {
                    item.classList.add('active');
                }
            });
            
            // Close mobile menu
            ui.sidebar.classList.remove('active');
            
            // Award points for section exploration
            if (!userProgress.completedSections.includes(sectionName)) {
                userProgress.completedSections.push(sectionName);
                awardPoints(5);
            }
        }
        
        // Share Progress
        function shareProgress() {
            const progressSummary = `
                 Group 1 & 2 Chemistry Explorer Progress 
                
                 Points: ${userProgress.points}
                 Streak: ${userProgress.streak} days
                 Achievements: ${userProgress.achievements.length}/6
                
                Sections Completed:
                ${userProgress.completedSections.map(section => ` ${section}`).join('\n')}
                
                Quiz Scores:
                Pre-Quiz: ${userProgress.quizScores.preQuiz || 'Not taken'}
                Post-Quiz: ${userProgress.quizScores.postQuiz || 'Not taken'}
            `;
            
            if (navigator.share) {
                navigator.share({
                    title: 'Group 1 & 2 Chemistry Explorer Progress',
                    text: progressSummary
                });
            } else {
                // Fallback - copy to clipboard
                navigator.clipboard.writeText(progressSummary).then(() => {
                    showNotification("Progress copied to clipboard!", 'success');
                });
            }
        }
        
        // Initialize Application
        document.addEventListener('DOMContentLoaded', async () => {
            await firebaseInit();
            initAudio();
            
            // Create particles
            createParticles();
            
            // Theme toggle
            ui.themeToggle.addEventListener('click', () => {
                document.body.classList.toggle('light-mode');
                const isLightMode = document.body.classList.contains('light-mode');
                ui.themeIcon.className = isLightMode ? 'fas fa-sun' : 'fas fa-moon';
                ui.themeText.textContent = isLightMode ? 'Light' : 'Dark';
                
                // Save theme preference
                localStorage.setItem('theme', isLightMode ? 'light' : 'dark');
                playSound('click');
            });
            
            // Load saved theme
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'light') {
                document.body.classList.add('light-mode');
                ui.themeIcon.className = 'fas fa-sun';
                ui.themeText.textContent = 'Light';
            }
            
            // Landing page enter button
            ui.enterAppBtn.addEventListener('click', () => {
                ui.landingPage.style.display = 'none';
                ui.mainApp.style.display = 'block';
                showSection('dashboard');
                playSound('click');
                
                // Award first steps achievement
                awardAchievement('first-steps');
            });
            
            // Mobile menu toggle
            ui.mobileMenuToggle.addEventListener('click', () => {
                ui.sidebar.classList.toggle('active');
                playSound('click');
            });
            
            // Navigation
            document.querySelectorAll('.nav-item').forEach(item => {
                item.addEventListener('click', (e) => {
                    e.preventDefault();
                    const section = item.dataset.section;
                    if (section) {
                        showSection(section);
                        playSound('click');
                    }
                });
            });
            
            // Dashboard cards
            document.querySelectorAll('.dashboard-card').forEach(card => {
                card.addEventListener('click', () => {
                    const section = card.dataset.section;
                    if (section) {
                        showSection(section);
                        playSound('click');
                    }
                });
            });
            
            // Close message button
            ui.closeMessageBtn.addEventListener('click', () => {
                hideMessage();
                playSound('click');
            });
            
            // Help button
            ui.helpButton.addEventListener('click', () => {
                ui.helpModal.classList.add('active');
                playSound('click');
            });
            
            // Close help modal
            ui.helpClose.addEventListener('click', () => {
                ui.helpModal.classList.remove('active');
                playSound('click');
            });
            
            // Safety guide button
            ui.safetyGuideBtn.addEventListener('click', () => {
                ui.safetyModal.classList.add('active');
                playSound('click');
            });
            
            // Close safety modal
            ui.safetyClose.addEventListener('click', () => {
                ui.safetyModal.classList.remove('active');
                playSound('click');
            });
            
            // Audio toggle
            ui.audioToggle.addEventListener('click', () => {
                audioEnabled = !audioEnabled;
                ui.audioIcon.className = audioEnabled ? 'fas fa-volume-up' : 'fas fa-volume-mute';
                ui.audioText.textContent = audioEnabled ? 'Sound On' : 'Sound Off';
                localStorage.setItem('audioEnabled', audioEnabled);
                playSound('click');
            });
            
            // Load saved audio preference
            const savedAudioPref = localStorage.getItem('audioEnabled');
            if (savedAudioPref === 'false') {
                audioEnabled = false;
                ui.audioIcon.className = 'fas fa-volume-mute';
                ui.audioText.textContent = 'Sound Off';
            }
            
            // 3D Atom controls
            document.getElementById('rotate-left-btn').addEventListener('mousedown', () => {
                controls.rotateLeft = true;
                playSound('click');
            });
            document.getElementById('rotate-left-btn').addEventListener('mouseup', () => controls.rotateLeft = false);
            document.getElementById('rotate-right-btn').addEventListener('mousedown', () => {
                controls.rotateRight = true;
                playSound('click');
            });
            document.getElementById('rotate-right-btn').addEventListener('mouseup', () => controls.rotateRight = false);
            document.getElementById('zoom-in-btn').addEventListener('mousedown', () => {
                controls.zoomIn = true;
                playSound('click');
            });
            document.getElementById('zoom-in-btn').addEventListener('mouseup', () => controls.zoomIn = false);
            document.getElementById('zoom-out-btn').addEventListener('mousedown', () => {
                controls.zoomOut = true;
                playSound('click');
            });
            document.getElementById('zoom-out-btn').addEventListener('mouseup', () => controls.zoomOut = false);
            document.getElementById('reset-view-btn').addEventListener('click', () => {
                camera.position.set(0, 0, 5);
                camera.lookAt(0, 0, 0);
                playSound('click');
            });
            
            // Animate electrons button
            document.getElementById('animate-electrons-btn').addEventListener('click', () => {
                electronAnimation = !electronAnimation;
                document.getElementById('animate-electrons-btn').classList.toggle('bg-blue-600');
                playSound('click');
            });
            
            // Visualization mode buttons
            document.querySelectorAll('.viz-mode').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.viz-mode').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    visualizationMode = btn.dataset.mode;
                    
                    // Recreate atom with new visualization mode
                    if (currentElement) {
                        create3DAtom(currentElement);
                    }
                    playSound('click');
                });
            });
            
            // Share progress button
            ui.shareProgress.addEventListener('click', shareProgress);
            ui.shareAchievementsBtn.addEventListener('click', shareProgress);
            
            // Initialize components
            init3DAtomViewer();
            initElementsGrid();
            initLearnContent();
            initReactionSimulator();
            initPeriodicTable();
            initMolecularBuilder();
            initQuizzes();
            
            // Show default element in atom viewer
            const defaultElement = elementsData.Lithium;
            create3DAtom(defaultElement);
            currentElement = defaultElement;
        });
    </script>
</body>
</html>

