
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Group 2 Alkaline Earth Metals - Chemistry</title>
    <meta name="description" content="Interactive learning platform for mastering Group 2 Alkaline Earth Metals in chemistry">
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <!-- Add Google Auth Provider -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <!-- jsPDF for PDF export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <!-- Howler for sound effects -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/howler/2.2.3/howler.min.js"></script>
    <!-- Chart.js for data visualization -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom@2.0.1/dist/chartjs-plugin-zoom.min.js"></script>
    <link rel="icon" type="image/png" href="https://andrewung2009.github.io/TheCuriousChemist/TheCuriousChemist.png">
    <!-- Custom Styles -->
    <style>
        :root {
            --primary: #3b82f6;
            --primary-dark: #2563eb;
            --secondary: #8b5cf6;
            --accent: #f59e0b;
            --success: #10b981;
            --danger: #ef4444;
            --gray-50: #0f172a;
            --gray-100: #1e293b;
            --gray-200: #334155;
            --gray-300: #475569;
            --gray-400: #64748b;
            --gray-500: #6b7280;
            --gray-600: #4b5563;
            --gray-700: #374151;
            --gray-800: #1f2937;
            --gray-900: #111827;
            
            /* Consistent color scheme */
            --bg-primary: #0f172a;
            --bg-card: #1e293b;
            --bg-card-hover: #334155;
            --text-primary: #f1f5f9;
            --text-secondary: #cbd5e1;
            --text-tertiary: #94a3b8;
            --border-color: #334155;
            --accent-bg: rgba(59, 130, 246, 0.1);
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-primary);
            color: var(--text-secondary);
            overflow-x: hidden;
        }

        /* Landing page styles - completely dark */
        #landingPage {
            background-color: var(--bg-primary);
        }

        #landingPage .bg-white {
            background-color: var(--bg-card) !important;
        }

        #landingPage .text-gray-800 {
            color: var(--text-primary) !important;
        }

        #landingPage .text-gray-600 {
            color: var(--text-secondary) !important;
        }

        #landingPage .text-indigo-600,
        #landingPage .text-blue-600 {
            color: var(--primary) !important;
        }

        #landingPage .text-green-600 {
            color: var(--success) !important;
        }

        #landingPage .text-purple-600 {
            color: var(--secondary) !important;
        }

        #landingPage .bg-blue-50 {
            background-color: var(--accent-bg) !important;
        }

        #landingPage .bg-green-50 {
            background-color: rgba(16, 185, 129, 0.1) !important;
        }

        #landingPage .bg-purple-50 {
            background-color: rgba(139, 92, 246, 0.1) !important;
        }

        /* Enhanced content card with consistent styling */
        .content-card {
            background: var(--bg-card);
            border-radius: 1rem;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3), 0 2px 4px -1px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
            border-top: 4px solid var(--primary);
            position: relative;
            overflow: hidden;
            border: 1px solid var(--border-color);
        }

        .content-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            transform: scaleX(0);
            transition: transform 0.3s ease;
            transform-origin: left;
        }

        .content-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.4), 0 4px 6px -2px rgba(0, 0, 0, 0.3);
            border-color: var(--primary);
        }

        .content-card:hover::before {
            transform: scaleX(1);
        }

        /* Fix for invisible headings and progress text */
        .content-card h3, 
        .content-card h2, 
        .content-card h1 {
            color: var(--text-primary) !important;
        }

        /* Progress section specific fixes */
        #progressPercentage {
            color: var(--primary) !important;
        }

        .progress-tracker h3 {
            color: var(--text-primary) !important;
        }

        .progress-tracker .text-xl {
            color: var(--text-primary) !important;
        }

        /* Fix for all section headings */
        .content-section h3 {
            color: var(--text-primary) !important;
        }

        .content-section h2 {
            color: var(--text-primary) !important;
        }

        /* Enhanced Sidebar Styles */
        .sidebar {
            position: fixed;
            top: 0;
            left: 0;
            height: 100vh;
            width: 280px;
            background: var(--bg-card);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3), 0 2px 4px -1px rgba(0, 0, 0, 0.2);
            z-index: 100;
            overflow-y: auto;
            transition: transform 0.3s ease;
            display: flex;
            flex-direction: column;
        }

        .sidebar-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border-color);
        }

        .logo-container {
            display: flex;
            align-items: center;
        }

        .search-container {
            padding: 1rem 1.5rem;
            border-bottom: 1px solid var(--border-color);
        }

        .search-box {
            position: relative;
        }

        .search-box input {
            width: 100%;
            padding: 0.6rem 0.6rem 0.6rem 2.5rem;
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
            font-size: 0.875rem;
            transition: all 0.3s ease;
            background: var(--bg-card-hover);
            color: var(--text-secondary);
        }

        .search-box input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
        }

        .search-box i {
            position: absolute;
            left: 0.8rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-tertiary);
        }

        .nav-section {
            padding: 1rem 0;
            border-bottom: 1px solid var(--border-color);
        }

        .nav-section-title {
            padding: 0 1.5rem 0.5rem;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--text-tertiary);
        }

        .nav-items {
            display: flex;
            flex-direction: column;
        }

        .nav-item {
            display: flex;
            align-items: center;
            padding: 0.75rem 1.5rem;
            color: var(--text-secondary);
            text-decoration: none;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .nav-item::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            width: 4px;
            background: var(--primary);
            transform: scaleY(0);
            transition: transform 0.3s ease;
        }

        .nav-item:hover::before {
            transform: scaleY(1);
        }

        .nav-item:hover {
            background: var(--accent-bg);
            color: var(--primary);
        }

        .nav-item.active {
            background: var(--accent-bg);
            color: var(--primary);
            font-weight: 600;
        }

        .nav-item.active::before {
            transform: scaleY(1);
        }

        .nav-item.completed {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success);
        }

        .nav-item.completed::before {
            background: var(--success);
        }

        .nav-check {
            margin-left: auto;
            color: var(--success);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .nav-item.completed .nav-check {
            opacity: 1;
        }

        .nav-lock {
            margin-left: auto;
            color: var(--text-tertiary);
            opacity: 1;
            transition: opacity 0.3s ease;
        }

        .nav-item.completed .nav-lock {
            opacity: 0;
        }

        .nav-badge {
            margin-left: auto;
            background: var(--danger);
            color: var(--text-primary);
            font-size: 0.625rem;
            font-weight: 600;
            padding: 0.125rem 0.375rem;
            border-radius: 9999px;
            min-width: 1.25rem;
            text-align: center;
        }

        .nav-icon {
            margin-right: 0.75rem;
        }

        .user-section {
            margin-top: auto;
            padding: 1.5rem;
            border-top: 1px solid var(--border-color);
        }

        .xp-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding: 0.75rem;
            background: rgba(245, 158, 11, 0.1);
            border-radius: 0.5rem;
        }

        .xp-label {
            display: flex;
            align-items: center;
            font-weight: 500;
            color: var(--accent);
        }

        .xp-value {
            font-weight: 700;
            font-size: 1.125rem;
            color: var(--accent);
        }

        .badges-container {
            margin-bottom: 1rem;
        }

        .badges-label {
            font-size: 0.875rem;
            font-weight: 500;
            margin-bottom: 0.5rem;
            color: var(--text-secondary);
        }

        .badges-list {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .settings-container {
            margin-bottom: 1rem;
        }

        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.75rem;
        }

        .setting-label {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .user-info {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding-top: 1rem;
            border-top: 1px solid var(--border-color);
        }

        .user-details {
            flex: 1;
        }

        .user-name {
            font-weight: 600;
            color: var(--text-primary);
        }

        .user-email {
            font-size: 0.75rem;
            color: var(--text-tertiary);
        }

        .logout-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 2rem;
            height: 2rem;
            border-radius: 0.5rem;
            background: var(--bg-card-hover);
            color: var(--text-tertiary);
            transition: all 0.3s ease;
        }

        .logout-btn:hover {
            background: var(--danger);
            color: var(--text-primary);
            transform: rotate(90deg);
        }

        .main-content {
            margin-left: 280px;
            padding: 2rem;
            min-height: 100vh;
        }

        /* Enhanced element grid with consistent styling */
        .element-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 2rem;
            margin: 2rem 0;
        }

        .element-card {
            background: var(--bg-card);
            border-radius: 1rem;
            padding: 1.5rem;
            text-align: center;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3), 0 2px 4px -1px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            cursor: pointer;
            border: 1px solid var(--border-color);
        }

        .element-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            transform: scaleX(0);
            transition: transform 0.3s ease;
            transform-origin: left;
        }

        .element-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.4), 0 4px 6px -2px rgba(0, 0, 0, 0.3);
            border-color: var(--primary);
        }

        .element-card:hover::before {
            transform: scaleX(1);
        }

        .element-image {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            margin: 0 auto 1rem;
            object-fit: cover;
            border: 3px solid var(--border-color);
            transition: all 0.3s ease;
        }

        .element-card:hover .element-image {
            border-color: var(--primary);
            transform: scale(1.1);
        }

        /* Enhanced tabs with consistent styling */
        .tabs {
            display: flex;
            border-bottom: 2px solid var(--border-color);
            margin-bottom: 2rem;
        }

        .tab {
            padding: 0.75rem 1.5rem;
            cursor: pointer;
            background: none;
            border: none;
            font-weight: 500;
            color: var(--text-tertiary);
            transition: all 0.3s ease;
            position: relative;
            margin-right: 1rem;
        }

        .tab::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--primary);
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }

        .tab:hover {
            color: var(--primary);
            transform: translateY(-2px);
        }

        .tab.active {
            color: var(--primary);
        }

        .tab.active::after {
            transform: scaleX(1);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Enhanced trend table with consistent styling */
        .trend-table {
            width: 100%;
            border-collapse: collapse;
            margin: 2rem 0;
            background: var(--bg-card);
            border-radius: 0.5rem;
            overflow: hidden;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3), 0 2px 4px -1px rgba(0, 0, 0, 0.2);
        }

        .trend-table th {
            background: var(--primary);
            color: var(--text-primary);
            padding: 1rem;
            text-align: left;
            font-weight: 600;
        }

        .trend-table td {
            padding: 1rem;
            border-bottom: 1px solid var(--border-color);
            color: var(--text-secondary);
        }

        .trend-table tr:last-child td {
            border-bottom: none;
        }

        .trend-table tr:nth-child(even) {
            background: var(--bg-card-hover);
        }

        .trend-table tr {
            transition: all 0.3s ease;
        }

        .trend-table tr:hover {
            background: var(--accent-bg);
            transform: scale(1.01);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        /* Enhanced buttons with consistent styling */
        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            font-family: 'Inter', sans-serif;
            position: relative;
            overflow: hidden;
            margin: 0.5rem 0;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 0.5rem;
            opacity: 0;
            transition: opacity 0.3s ease;
            transform: translateY(100%);
        }

        .btn:hover::before {
            opacity: 1;
            transform: translateY(0);
        }

        .btn-primary {
            background-color: var(--primary);
            color: var(--text-primary);
        }

        .btn-primary:hover {
            background-color: var(--primary-dark);
            transform: translateY(-2px);
        }

        .btn-success {
            background-color: var(--success);
            color: var(--text-primary);
        }

        .btn-success:hover {
            background-color: #059669;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background-color: var(--bg-card-hover);
            color: var(--text-secondary);
        }

        .btn-secondary:hover {
            background-color: #64748b;
            transform: translateY(-2px);
        }

        .btn-danger {
            background-color: var(--danger);
            color: var(--text-primary);
        }

        .btn-danger:hover {
            background-color: #dc2626;
            transform: translateY(-2px);
        }

        .btn-sm {
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
        }

        /* Enhanced highlight box with consistent styling */
        .highlight-box {
            background: var(--accent-bg);
            border-left: 4px solid var(--primary);
            padding: 1.5rem;
            border-radius: 0.5rem;
            margin: 1.5rem 0;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .highlight-box::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, var(--accent-bg), rgba(139, 92, 246, 0.1));
            transform: translateX(-100%);
            transition: transform 0.3s ease;
        }

        .highlight-box:hover {
            transform: translateX(8px);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3), 0 2px 4px -1px rgba(0, 0, 0, 0.2);
        }

        .highlight-box:hover::before {
            transform: translateX(0);
        }

        .highlight-box h4 {
            color: var(--primary);
            font-weight: 600;
            margin-bottom: 0.75rem;
        }

        .highlight-box p {
            color: var(--text-secondary);
            line-height: 1.6;
        }

        /* Enhanced equation box with consistent styling */
        .equation-box {
            background: var(--bg-card-hover);
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
            padding: 1.5rem;
            margin: 1.5rem 0;
            text-align: center;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .equation-box::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--accent-bg);
            transform: scale(0);
            transition: transform 0.3s ease;
            border-radius: 0.5rem;
        }

        .equation-box:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.4), 0 4px 6px -2px rgba(0, 0, 0, 0.3);
            border-color: var(--primary);
        }

        .equation-box:hover::before {
            transform: scale(1);
        }

        .equation-box .equation {
            font-family: 'Courier New', monospace;
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-secondary);
            margin: 0.75rem 0;
            position: relative;
            z-index: 1;
        }

        /* Enhanced progress bar */
        .progress-bar {
            width: 100%;
            height: 8px;
            background: var(--bg-card-hover);
            border-radius: 0.5rem;
            overflow: hidden;
            margin: 1.5rem 0;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            transition: width 0.6s ease;
            position: relative;
            overflow: hidden;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            background: linear-gradient(
                90deg,
                rgba(255, 255, 255, 0),
                rgba(255, 255, 255, 0.3),
                rgba(255, 255, 255, 0)
            );
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        /* Enhanced modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
            z-index: 9999;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            overflow: auto;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background-color: var(--bg-card);
            border-radius: 1rem;
            padding: 2rem;
            max-width: 800px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
            margin: auto;
            position: relative;
            border: 1px solid var(--border-color);
        }

        /* Modal content specific styling */
        .modal-content h2 {
            color: var(--text-primary) !important;
            font-weight: bold;
        }

        .modal-content h3 {
            color: var(--text-primary) !important;
            font-weight: 600;
        }

        .modal-content h4 {
            color: var(--text-primary) !important;
            font-weight: 600;
        }

        .modal-content .bg-gray-100 {
            background-color: var(--bg-card-hover) !important;
            border: 1px solid var(--border-color) !important;
        }

        .modal-content .bg-blue-50 {
            background-color: var(--accent-bg) !important;
            border: 1px solid var(--primary) !important;
        }

        .modal-content .border-blue-500 {
            border-color: var(--primary) !important;
        }

        .modal-content .text-blue-800 {
            color: var(--primary) !important;
        }

        .modal-content .text-gray-800 {
            color: var(--text-primary) !important;
        }

        .modal-content .text-gray-500 {
            color: var(--text-tertiary) !important;
        }

        .modal-content .text-gray-700 {
            color: var(--text-tertiary) !important;
        }

        .modal-content .equation {
            color: var(--text-secondary) !important;
            font-family: 'Courier New', monospace;
        }

        .modal-content .quiz-option {
            background: var(--bg-card) !important;
            border: 1px solid var(--border-color) !important;
            color: var(--text-secondary) !important;
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            margin: 0.5rem 0;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .modal-content .quiz-option:hover {
            background: var(--accent-bg) !important;
            border-color: var(--primary) !important;
            transform: translateY(-2px);
        }

        .modal-content .quiz-option.selected {
            background: var(--accent-bg) !important;
            border-color: var(--primary) !important;
        }

        .modal-content .quiz-option.correct {
            background: rgba(16, 185, 129, 0.1) !important;
            border-color: var(--success) !important;
            color: var(--success) !important;
        }

        .modal-content .quiz-option.incorrect {
            background: rgba(239, 68, 68, 0.1) !important;
            border-color: var(--danger) !important;
            color: var(--danger) !important;
        }

        /* Group details specific styles */
        .group-details-container {
            max-width: 100%;
            box-sizing: border-box;
        }

        .group-announcement {
            background: var(--bg-card);
            border-radius: 0.5rem;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3), 0 2px 4px -1px rgba(0, 0, 0, 0.2);
            border-left: 4px solid var(--primary);
        }

        .resource-item {
            background: var(--bg-card);
            border-radius: 0.5rem;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3), 0 2px 4px -1px rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: flex-start;
            border-left: 4px solid var(--secondary);
        }

        .resource-icon {
            margin-right: 1rem;
            color: var(--primary);
            font-size: 1.25rem;
        }

        .resource-info {
            flex: 1;
        }

        .resource-name {
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }

        .resource-meta {
            font-size: 0.875rem;
            color: var(--text-tertiary);
        }

        .resource-description {
            margin-top: 0.75rem;
            color: var(--text-secondary);
        }

        .resource-actions {
            display: flex;
            gap: 0.75rem;
        }

        .resource-btn {
            background: none;
            border: none;
            color: var(--text-tertiary);
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 0.25rem;
            transition: all 0.2s ease;
        }

        .resource-btn:hover {
            background: var(--bg-card-hover);
            color: var(--text-secondary);
        }

        .group-chat-container {
            background: var(--bg-card);
            border-radius: 0.5rem;
            padding: 1.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3), 0 2px 4px -1px rgba(0, 0, 0, 0.2);
            border-left: 4px solid var(--success);
        }

        .group-chat {
            height: 300px;
            overflow-y: auto;
            margin-bottom: 1.5rem;
            padding: 1rem;
            background: var(--bg-primary);
            border-radius: 0.25rem;
        }

        .chat-message {
            margin-bottom: 1rem;
            padding: 0.75rem;
            border-radius: 0.5rem;
        }

        .chat-message.own {
            background: var(--primary);
            color: var(--text-primary);
            margin-left: 2rem;
        }

        .chat-input {
            display: flex;
            gap: 0.75rem;
        }

        .chat-input input {
            flex: 1;
        }

        /* Enhanced quiz option with consistent styling */
        .quiz-option {
            padding: 1.25rem;
            border: 2px solid var(--border-color);
            border-radius: 0.5rem;
            margin: 1rem 0;
            cursor: pointer;
            transition: all 0.3s ease;
            background: var(--bg-card);
            display: flex;
            align-items: center;
            position: relative;
            overflow: hidden;
            transform: translateY(0);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            color: var(--text-secondary);
        }

        .quiz-option::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, var(--accent-bg), rgba(139, 92, 246, 0.2));
            transform: scale(0);
            transition: transform 0.3s ease;
            border-radius: 0.5rem;
            z-index: 0;
        }

        .quiz-option:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.4), 0 4px 6px -2px rgba(0, 0, 0, 0.3);
            border-color: var(--primary);
            background: var(--accent-bg);
        }

        .quiz-option:hover::before {
            transform: scale(1);
        }

        .quiz-option.selected {
            border-color: var(--primary);
            background: var(--accent-bg);
            transform: translateY(-3px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.4), 0 4px 6px -2px rgba(0, 0, 0, 0.3);
        }

        .quiz-option.correct {
            border-color: var(--success);
            background: rgba(16, 185, 129, 0.1);
            animation: correctPulse 0.8s ease;
        }

        .quiz-option.incorrect {
            border-color: var(--danger);
            background: rgba(239, 68, 68, 0.1);
            animation: incorrectShake 0.6s ease;
        }

        @keyframes correctPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); box-shadow: 0 0 20px rgba(16, 185, 129, 0.5); }
            100% { transform: scale(1); }
        }

        @keyframes incorrectShake {
            0%, 100% { transform: translateX(0); }
            20% { transform: translateX(-10px); }
            40% { transform: translateX(10px); }
            60% { transform: translateX(-8px); }
            80% { transform: translateX(8px); }
        }

        .quiz-option.disabled {
            pointer-events: none;
            opacity: 0.7;
        }

        .quiz-option input {
            margin-right: 1.25rem;
            position: relative;
            z-index: 1;
        }

        .quiz-option label {
            cursor: pointer;
            flex: 1;
            position: relative;
            z-index: 1;
            transition: color 0.3s ease;
            color: var(--text-secondary);
        }

        .quiz-option:hover label {
            color: var(--primary);
            font-weight: 600;
        }

        /* Enhanced toast notification */
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--bg-card);
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            z-index: 2000;
            display: flex;
            align-items: center;
            transform: translateX(400px);
            transition: transform 0.3s ease;
            max-width: 400px;
        }

        .toast.show {
            transform: translateX(0);
        }

        .toast.success {
            border-left: 4px solid var(--success);
        }

        .toast.error {
            border-left: 4px solid var(--danger);
        }

        .toast.info {
            border-left: 4px solid var(--primary);
        }

        .toast-icon {
            margin-right: 16px;
            font-size: 1.25rem;
        }

        .toast.success .toast-icon {
            color: var(--success);
        }

        .toast.error .toast-icon {
            color: var(--danger);
        }

        .toast.info .toast-icon {
            color: var(--primary);
        }

        .toast-message {
            flex: 1;
        }

        .toast-title {
            font-weight: 600;
            margin-bottom: 6px;
            color: var(--text-primary);
        }

        .toast-description {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        /* Enhanced tooltip styles */
        .tooltip {
            position: relative;
            display: inline-block;
            cursor: help;
        }

        .tooltip .tooltiptext {
            visibility: hidden;
            width: 250px;
            background-color: var(--bg-card-hover);
            color: var(--text-secondary);
            text-align: center;
            border-radius: 6px;
            padding: 12px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -125px;
            opacity: 0;
            transition: all 0.3s ease;
            font-size: 0.875rem;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            transform: translateY(10px);
        }

        .tooltip .tooltiptext::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: var(--bg-card-hover) transparent transparent transparent;
        }

        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
            transform: translateY(0);
        }

        .tooltip-icon {
            color: var(--primary);
            font-size: 0.875rem;
            margin-left: 0.25rem;
            vertical-align: super;
            animation: bounce 2s infinite;
            text-decoration: underline dotted;
            text-underline-offset: 2px;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-3px); }
        }

        /* Enhanced element hover effects */
        .element-hover {
            display: inline-block;
            position: relative;
            cursor: pointer;
            font-weight: 600;
            color: var(--primary);
            padding: 4px 6px;
            border-radius: 4px;
            transition: all 0.3s ease;
            text-decoration: underline dotted;
            text-underline-offset: 2px;
            margin: 0 2px;
        }

        .element-hover:hover {
            background: var(--accent-bg);
            transform: scale(1.05);
        }

        .element-hover .element-info {
            visibility: hidden;
            background-color: var(--bg-card-hover);
            color: var(--text-secondary);
            text-align: center;
            border-radius: 6px;
            padding: 8px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%) translateY(10px);
            opacity: 0;
            transition: all 0.3s ease;
            font-size: 0.875rem;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            white-space: nowrap;
        }

        .element-hover .element-info::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: var(--bg-card-hover) transparent transparent transparent;
        }

        .element-hover:hover .element-info {
            visibility: visible;
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }

        /* Enhanced Periodic Table Styles */
        .periodic-table {
            display: grid;
            grid-template-columns: repeat(18, 1fr);
            gap: 0.5rem;
            margin: 2rem 0;
        }

        .element {
            aspect-ratio: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: var(--bg-card-hover);
            border-radius: 0.25rem;
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            color: var(--text-secondary);
        }

        .element::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 0;
        }

        .element:hover {
            transform: scale(1.15);
            z-index: 10;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .element:hover::before {
            opacity: 0.2;
        }

        .element:hover > * {
            position: relative;
            z-index: 1;
            color: var(--text-primary);
        }

        .element.group1 {
            background: var(--accent-bg);
            color: var(--primary);
            font-weight: 600;
        }

        .element-symbol {
            font-weight: 600;
            font-size: 1rem;
        }

        .element-number {
            font-size: 0.625rem;
            position: absolute;
            top: 0.25rem;
            left: 0.25rem;
        }

        .element-name {
            font-size: 0.5rem;
            position: absolute;
            bottom: 0.25rem;
            left: 0;
            right: 0;
            text-align: center;
        }

        /* Enhanced keyword hover effects */
        .keyword {
            display: inline-block;
            position: relative;
            cursor: pointer;
            color: var(--primary);
            font-weight: 600;
            padding: 4px 6px;
            border-radius: 4px;
            transition: all 0.3s ease;
            text-decoration: underline dotted;
            text-underline-offset: 2px;
            margin: 0 2px;
        }

        .keyword:hover {
            background: var(--accent-bg);
            transform: scale(1.05);
        }

        .keyword .keyword-info {
            visibility: hidden;
            background-color: var(--bg-card-hover);
            color: var(--text-secondary);
            text-align: center;
            border-radius: 6px;
            padding: 8px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%) translateY(10px);
            opacity: 0;
            transition: all 0.3s ease;
            font-size: 0.875rem;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            width: 200px;
        }

        .keyword .keyword-info::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: var(--bg-card-hover) transparent transparent transparent;
        }

        .keyword:hover .keyword-info {
            visibility: visible;
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }

        /* Enhanced valence electron flash effect */
        .valence-electron {
            display: inline-block;
            background: var(--accent-bg);
            color: var(--primary);
            font-weight: 600;
            padding: 0.5rem 0.75rem;
            border-radius: 0.25rem;
            margin: 0 0.5rem;
            cursor: pointer;
            position: relative;
            transition: all 0.3s ease;
            text-decoration: underline dotted;
            text-underline-offset: 2px;
        }

        .valence-electron:hover {
            background: rgba(59, 130, 246, 0.2);
            box-shadow: 0 0 15px rgba(59, 130, 246, 0.5);
            transform: scale(1.1);
        }

        .valence-electron .valence-info {
            visibility: hidden;
            background-color: var(--bg-card-hover);
            color: var(--text-secondary);
            text-align: center;
            border-radius: 6px;
            padding: 8px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%) translateY(10px);
            opacity: 0;
            transition: all 0.3s ease;
            font-size: 0.875rem;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            width: 250px;
        }

        .valence-electron .valence-info::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: var(--bg-card-hover) transparent transparent transparent;
        }

        .valence-electron:hover .valence-info {
            visibility: visible;
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }

        /* Enhanced Discussion Styles */
        .discussion-post {
            background: var(--bg-card);
            border-radius: 0.75rem;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3), 0 2px 4px -1px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            border: 1px solid var(--border-color);
        }

        .discussion-post::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            transform: scaleX(0);
            transition: transform 0.3s ease;
            transform-origin: left;
        }

        .discussion-post:hover {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.4), 0 4px 6px -2px rgba(0, 0, 0, 0.3);
            transform: translateY(-3px);
            border-color: var(--primary);
        }

        .discussion-post:hover::before {
            transform: scaleX(1);
        }

        .post-header {
            display: flex;
            align-items: center;
            margin-bottom: 1rem;
        }

        .post-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-primary);
            font-weight: 600;
            margin-right: 1rem;
            transition: transform 0.3s ease;
        }

        .discussion-post:hover .post-avatar {
            transform: scale(1.1);
        }

        .post-meta {
            flex: 1;
        }

        .post-author {
            font-weight: 600;
            color: var(--text-primary);
        }

        .post-time {
            font-size: 0.875rem;
            color: var(--text-tertiary);
        }

        .post-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.75rem;
        }

        .post-content {
            color: var(--text-secondary);
            line-height: 1.6;
            margin-bottom: 1rem;
        }

        .post-actions {
            display: flex;
            gap: 1.25rem;
            padding-top: 1rem;
            border-top: 1px solid var(--border-color);
        }

        .post-action {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--text-tertiary);
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.875rem;
            padding: 0.5rem;
            border-radius: 0.25rem;
        }

        .post-action:hover {
            color: var(--primary);
            background: var(--accent-bg);
            transform: translateY(-2px);
        }

        .post-action.voted {
            color: var(--primary);
        }

        .comments-section {
            margin-top: 1.5rem;
            padding-left: 1.5rem;
            border-left: 3px solid var(--border-color);
        }

        /* Enhanced comment styles */
        .comment {
            background: var(--bg-card);
            border-radius: 0.5rem;
            padding: 1rem;
            margin-bottom: 0.75rem;
            transition: all 0.3s ease;
            border: 1px solid var(--border-color);
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
        }

        .comment:hover {
            transform: translateX(5px);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .comment-header {
            display: flex;
            align-items: center;
            margin-bottom: 0.75rem;
        }

        .comment-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-primary);
            font-size: 0.875rem;
            font-weight: 600;
            margin-right: 1rem;
            flex-shrink: 0;
        }

        .comment-author {
            font-weight: 600;
            color: var(--text-primary);
            font-size: 0.95rem;
        }

        .comment-time {
            font-size: 0.75rem;
            color: var(--text-tertiary);
            margin-left: auto;
        }

        .comment-content {
            color: var(--text-secondary);
            font-size: 0.95rem;
            line-height: 1.5;
            margin-left: 2.5rem;
        }

        .comments-section {
            margin-top: 1.5rem;
            padding: 1.5rem;
            border-left: 3px solid var(--border-color);
            background: var(--bg-primary);
            border-radius: 0.5rem;
        }

        /* Enhanced Study Group Styles */
        .study-group-card {
            background: var(--bg-card);
            border-radius: 0.75rem;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3), 0 2px 4px -1px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            border: 1px solid var(--border-color);
        }

        .study-group-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            transform: scaleX(0);
            transition: transform 0.3s ease;
            transform-origin: left;
        }

        .study-group-card:hover {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.4), 0 4px 6px -2px rgba(0, 0, 0, 0.3);
            transform: translateY(-3px);
            border-color: var(--primary);
        }

        .study-group-card:hover::before {
            transform: scaleX(1);
        }

        .group-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 1rem;
        }

        .group-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .group-topic {
            display: inline-block;
            background: var(--primary);
            color: var(--text-primary);
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            margin-top: 0.5rem;
            transition: all 0.3s ease;
        }

        .group-topic:hover {
            transform: scale(1.05);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .group-description {
            color: var(--text-secondary);
            line-height: 1.6;
            margin-bottom: 1rem;
        }

        .group-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .group-members {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .member-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-primary);
            font-weight: 600;
            font-size: 0.75rem;
            border: 2px solid var(--bg-card);
            transition: all 0.3s ease;
        }

        .member-avatar:hover {
            transform: scale(1.1);
            z-index: 1;
        }

        .group-stats {
            font-size: 0.875rem;
            color: var(--text-tertiary);
        }

        .group-actions {
            display: flex;
            gap: 0.75rem;
        }

        .empty-state {
            text-align: center;
            padding: 3rem 1rem;
            color: var(--text-tertiary);
        }

        .empty-state-icon {
            font-size: 3rem;
            color: var(--bg-card-hover);
            margin-bottom: 1rem;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .empty-state-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 0.75rem;
            color: var(--text-primary);
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            font-weight: 500;
            color: var(--text-secondary);
            margin-bottom: 0.75rem;
        }

        .form-input {
            width: 100%;
            padding: 0.875rem;
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: var(--bg-card-hover);
            color: var(--text-secondary);
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
            transform: translateY(-2px);
        }

        .form-textarea {
            resize: vertical;
            min-height: 120px;
        }

        /* Enhanced Quiz Enhancement Styles */
        .feedback-system {
            background: var(--bg-card);
            border-radius: 1rem;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3), 0 2px 4px -1px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            border: 1px solid var(--border-color);
        }

        .feedback-system::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, var(--accent-bg), rgba(139, 92, 246, 0.05));
            transform: scale(0);
            transition: transform 0.3s ease;
        }

        .feedback-system:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.4), 0 4px 6px -2px rgba(0, 0, 0, 0.3);
            border-color: var(--primary);
        }

        .feedback-system:hover::before {
            transform: scale(1);
        }

        .reaction-buttons {
            display: flex;
            gap: 1.25rem;
            margin-top: 1.25rem;
        }

        .reaction-btn {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1.25rem;
            border-radius: 0.5rem;
            background: var(--bg-card-hover);
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            position: relative;
            overflow: hidden;
        }

        .reaction-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--accent-bg);
            transform: scale(0);
            transition: transform 0.3s ease;
            border-radius: 0.5rem;
        }

        .reaction-btn:hover {
            background: var(--border-color);
            transform: translateY(-3px);
        }

        .reaction-btn:hover::before {
            transform: scale(1);
        }

        .reaction-btn.active {
            background: var(--primary);
            color: var(--text-primary);
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .xp-display {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            background: linear-gradient(135deg, var(--accent), #d97706);
            color: var(--text-primary);
            padding: 0.75rem 1.25rem;
            border-radius: 9999px;
            font-weight: 600;
            font-size: 0.875rem;
            transition: all 0.3s ease;
        }

        .xp-display:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .badge {
            display: inline-flex;
            align-items: center;
            gap: 0.375rem;
            background: linear-gradient(135deg, var(--secondary), #7c3aed);
            color: var(--text-primary);
            padding: 0.375rem 0.875rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-right: 0.75rem;
            transition: all 0.3s ease;
        }

        .badge:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        /* Leaderboard styles */
        .leaderboard-table {
            width: 100%;
            border-collapse: collapse;
            margin: 2rem 0;
            background: var(--bg-card);
            border-radius: 0.5rem;
            overflow: hidden;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3), 0 2px 4px -1px rgba(0, 0, 0, 0.2);
        }

        .leaderboard-table th {
            background: var(--primary);
            color: var(--text-primary);
            padding: 1rem;
            text-align: center;
            font-weight: 600;
            border-right: 1px solid rgba(255, 255, 255, 0.2);
        }

        .leaderboard-table th:last-child {
            border-right: none;
        }

        .leaderboard-table td {
            padding: 1rem;
            border-bottom: 1px solid var(--border-color);
            text-align: center;
            border-right: 1px solid var(--border-color);
            color: var(--text-secondary);
        }

        .leaderboard-table td:last-child {
            border-right: none;
        }

        .leaderboard-table tr:last-child td {
            border-bottom: none;
        }

        .leaderboard-table tr:nth-child(even) {
            background: var(--bg-card-hover);
        }

        .leaderboard-table tr:hover {
            background: var(--accent-bg);
        }

        .leaderboard-rank {
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--bg-card-hover);
            border-radius: 50%;
            font-weight: 600;
            margin: 0 auto;
            transition: all 0.3s ease;
        }

        .leaderboard-rank.first {
            background: linear-gradient(135deg, var(--accent), #d97706);
            color: var(--text-primary);
        }

        .leaderboard-rank.second {
            background: linear-gradient(135deg, #9ca3af, #6b7280);
            color: var(--text-primary);
        }

        .leaderboard-rank.third {
            background: linear-gradient(135deg, #cd7c2f, #92400e);
            color: var(--text-primary);
        }

        .leaderboard-entry:hover .leaderboard-rank {
            transform: scale(1.1);
        }

        .daily-challenge {
            background: linear-gradient(135deg, var(--success), #059669);
            color: var(--text-primary);
            border-radius: 1rem;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3), 0 2px 4px -1px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .daily-challenge::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
            transform: translateX(-100%);
            transition: transform 0.6s ease;
        }

        .daily-challenge:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.4), 0 4px 6px -2px rgba(0, 0, 0, 0.3);
        }

        .daily-challenge:hover::before {
            transform: translateX(0);
        }

        .daily-challenge h3 {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 0.75rem;
        }

        .daily-challenge p {
            margin-bottom: 1.25rem;
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--bg-card-hover);
            transition: .4s;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: var(--text-primary);
            transition: .4s;
        }

        input:checked + .slider {
            background-color: var(--primary);
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }

        .slider.round {
            border-radius: 24px;
        }

        .slider.round:before {
            border-radius: 50%;
        }

        /* Enhanced interactive elements */
        .interactive-element {
            position: relative;
            cursor: pointer;
            transition: all 0.3s ease;
            border-radius: 0.25rem;
            padding: 0.375rem 0.5rem;
            display: inline-block;
            margin: 0 0.25rem;
        }

        .interactive-element:hover {
            background-color: var(--accent-bg);
            transform: translateY(-2px);
        }

        .interactive-element .quiz-popup {
            position: absolute;
            background: var(--bg-card);
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3), 0 2px 4px -1px rgba(0, 0, 0, 0.2);
            padding: 1rem;
            width: 300px;
            z-index: 100;
            display: none;
            top: 100%;
            left: 50%;
            transform: translateX(-50%) translateY(10px);
            opacity: 0;
            transition: all 0.3s ease;
        }

        .interactive-element:hover .quiz-popup {
            display: block;
            opacity: 1;
            transform: translateX(-50%) translateY(5px);
        }

        .interactive-element .quiz-popup h4 {
            margin-top: 0;
            color: var(--primary);
        }

        .interactive-element .quiz-popup .quiz-options {
            margin-top: 0.75rem;
        }

        .interactive-element .quiz-popup .quiz-option {
            padding: 0.5rem;
            margin: 0.375rem 0;
            border-radius: 0.25rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .interactive-element .quiz-popup .quiz-option:hover {
            background-color: var(--accent-bg);
        }

        .interactive-element .quiz-popup .quiz-option.correct {
            background-color: rgba(16, 185, 129, 0.1);
            color: var(--success);
        }

        .interactive-element .quiz-popup .quiz-option.incorrect {
            background-color: rgba(239, 68, 68, 0.1);
            color: var(--danger);
        }

        /* =================== */
        /* GRAPH STYLES */
        /* =================== */

        /* Graph Controls - Enhanced with Toggle Buttons */
        .graph-controls {
            background: var(--bg-card);
            padding: 1.5rem;
            border-radius: 0.75rem;
            border: 1px solid var(--border-color);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3), 0 2px 4px -1px rgba(0, 0, 0, 0.2);
            margin-bottom: 1.5rem;
        }
        
        .graph-toggle-container {
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
            margin-bottom: 1rem;
        }
        
        .graph-toggle {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 30px;
        }
        
        .graph-toggle input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .graph-toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--bg-card-hover);
            transition: .4s;
            border-radius: 34px;
            border: 1px solid var(--border-color);
        }
        
        .graph-toggle-slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 3px;
            background-color: var(--text-tertiary);
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .graph-toggle-slider {
            background-color: var(--primary);
            border-color: var(--primary);
        }
        
        input:checked + .graph-toggle-slider:before {
            transform: translateX(30px);
            background-color: var(--text-primary);
        }
        
        .graph-toggle-label {
            display: flex;
            align-items: center;
            margin-left: 0.75rem;
            font-weight: 500;
            color: var(--text-secondary);
        }
        
        .graph-toggle-label .color-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 0.5rem;
        }
        
        .graph-toggle-group {
            display: flex;
            align-items: center;
            margin-bottom: 0.75rem;
        }
        
        .graph-view-buttons {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
        }
        
        .graph-view-btn {
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-weight: 500;
            transition: all 0.2s;
            background-color: var(--bg-card-hover);
            color: var(--text-secondary);
            border: 1px solid var(--border-color);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .graph-view-btn:hover {
            background-color: var(--accent-bg);
            border-color: var(--primary);
            color: var(--primary);
        }
        
        .graph-view-btn.active {
            background-color: var(--primary);
            color: var(--text-primary);
            border-color: var(--primary);
        }
        
        /* Graph Container */
        .graph-container {
            background: var(--bg-card);
            padding: 2rem;
            border-radius: 0.75rem;
            border: 1px solid var(--border-color);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3), 0 2px 4px -1px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
        }
        
        .graph-container:hover {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.4), 0 4px 6px -2px rgba(0, 0, 0, 0.3);
            border-color: var(--primary);
        }
        
        .graph-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }
        
        .graph-header h3 {
            color: var(--text-primary) !important;
            font-size: 1.5rem;
            font-weight: 600;
        }
        
        .graph-actions {
            display: flex;
            gap: 0.5rem;
        }
        
        .graph-action-btn {
            width: 2.5rem;
            height: 2.5rem;
            border-radius: 0.5rem;
            background: var(--bg-card-hover);
            border: 1px solid var(--border-color);
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .graph-action-btn:hover {
            background: var(--primary);
            color: var(--text-primary);
            transform: scale(1.1);
        }
        
        .chart-wrapper {
            position: relative;
            height: 400px;
            width: 100%;
        }
        
        /* Chart Colors - Using theme colors */
        .chart-primary {
            background-color: var(--primary) !important;
            fill: var(--primary) !important;
            stroke: var(--primary) !important;
        }
        
        .chart-secondary {
            background-color: var(--secondary) !important;
            fill: var(--secondary) !important;
            stroke: var(--secondary) !important;
        }
        
        .chart-accent {
            background-color: var(--accent) !important;
            fill: var(--accent) !important;
            stroke: var(--accent) !important;
        }
        
        .chart-success {
            background-color: var(--success) !important;
            fill: var(--success) !important;
            stroke: var(--success) !important;
        }
        
        .chart-danger {
            background-color: var(--danger) !important;
            fill: var(--danger) !important;
            stroke: var(--danger) !important;
        }
        
        /* Chart specific color palette */
        .chart-color-1 { color: var(--primary) !important; background: var(--primary) !important; fill: var(--primary) !important; }
        .chart-color-2 { color: var(--secondary) !important; background: var(--secondary) !important; fill: var(--secondary) !important; }
        .chart-color-3 { color: var(--accent) !important; background: var(--accent) !important; fill: var(--accent) !important; }
        .chart-color-4 { color: var(--success) !important; background: var(--success) !important; fill: var(--success) !important; }
        .chart-color-5 { color: var(--danger) !important; background: var(--danger) !important; fill: var(--danger) !important; }
        .chart-color-6 { color: #06b6d4 !important; background: #06b6d4 !important; fill: #06b6d4 !important; }
        .chart-color-7 { color: var(--secondary) !important; background: var(--secondary) !important; fill: var(--secondary) !important; }
        .chart-color-8 { color: #ec4899 !important; background: #ec4899 !important; fill: #ec4899 !important; }
        
        /* Chart axis and grid colors */
        .chart-axis {
            stroke: var(--border-color) !important;
            color: var(--text-tertiary) !important;
        }
        
        .chart-grid {
            stroke: var(--border-color) !important;
            opacity: 0.3 !important;
        }
        
        .chart-label {
            fill: var(--text-secondary) !important;
            color: var(--text-secondary) !important;
        }
        
        .chart-title {
            fill: var(--text-primary) !important;
            color: var(--text-primary) !important;
            font-weight: 600 !important;
        }
        
        /* Chart legend colors */
        .chart-legend-text {
            fill: var(--text-secondary) !important;
            color: var(--text-secondary) !important;
        }
        
        /* Chart tooltip colors */
        .chart-tooltip {
            background: var(--bg-card) !important;
            border: 1px solid var(--border-color) !important;
            color: var(--text-secondary) !important;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3) !important;
        }
        
        .chart-tooltip-title {
            color: var(--text-primary) !important;
            font-weight: 600 !important;
        }
        
        /* Element Selector */
        .element-selector {
            background: var(--bg-card);
            padding: 1.5rem;
            border-radius: 0.75rem;
            border: 1px solid var(--border-color);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3), 0 2px 4px -1px rgba(0, 0, 0, 0.2);
        }
        
        .element-selector h4 {
            color: var(--text-primary) !important;
            margin-bottom: 1rem;
        }
        
        .element-checkboxes {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
        }
        
        .element-checkbox {
            display: flex;
            align-items: center;
            padding: 0.75rem;
            background: var(--bg-card-hover);
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }
        
        .element-checkbox:hover {
            background: var(--accent-bg);
            border-color: var(--primary);
            transform: translateY(-2px);
        }
        
        .element-checkbox input[type="checkbox"] {
            margin-right: 0.75rem;
            width: 1.25rem;
            height: 1.25rem;
            cursor: pointer;
            accent-color: var(--primary);
        }
        
        .element-color {
            display: inline-block;
            width: 1rem;
            height: 1rem;
            border-radius: 50%;
            margin-right: 0.5rem;
            border: 2px solid var(--text-primary);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        
        /* Data Table */
        .data-table-container {
            background: var(--bg-card);
            padding: 1.5rem;
            border-radius: 0.75rem;
            border: 1px solid var(--border-color);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3), 0 2px 4px -1px rgba(0, 0, 0, 0.2);
        }
        
        .data-table-container h4 {
            color: var(--text-primary) !important;
            margin-bottom: 1rem;
        }
        
        .data-table-wrapper {
            overflow-x: auto;
            border-radius: 0.5rem;
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            background: var(--bg-card-hover);
            border-radius: 0.5rem;
            overflow: hidden;
        }
        
        .data-table th, .data-table td {
            padding: 0.75rem 1rem;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
            color: var(--text-secondary);
        }
        
        .data-table th {
            background: var(--primary);
            color: var(--text-primary);
            font-weight: 600;
            white-space: nowrap;
        }
        
        .data-table tr:hover {
            background: var(--accent-bg);
        }
        
        .data-table tr:last-child td {
            border-bottom: none;
        }
        
        .highlighted-row {
            background: var(--accent-bg) !important;
            border-left: 4px solid var(--primary);
        }
        
        /* Graph Quiz */
        .graph-quiz-container {
            margin-top: 2rem;
        }
        
        .graph-quiz-option {
            display: block;
            padding: 0.75rem 1rem;
            background: var(--bg-card-hover);
            border: 2px solid var(--border-color);
            border-radius: 0.5rem;
            margin-bottom: 0.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            color: var(--text-secondary);
        }
        
        .graph-quiz-option:hover {
            background: var(--accent-bg);
            border-color: var(--primary);
            transform: translateX(5px);
        }
        
        .graph-quiz-option.selected {
            background: var(--accent-bg);
            border-color: var(--primary);
        }
        
        .graph-quiz-option.correct {
            background: rgba(16, 185, 129, 0.1);
            border-color: var(--success);
            color: var(--success);
        }
        
        .graph-quiz-option.incorrect {
            background: rgba(239, 68, 68, 0.1);
            border-color: var(--danger);
            color: var(--danger);
        }
        
        /* Loading Animation */
        .graph-loading {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 400px;
            color: var(--text-tertiary);
        }
        
        .graph-loading i {
            font-size: 2rem;
            animation: spin 1s linear infinite;
            margin-right: 1rem;
            color: var(--primary);
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Canvas and SVG chart overrides */
        canvas {
            background: transparent !important;
        }
        
        svg {
            background: transparent !important;
        }
        
        /* Override chart library default colors */
        .chart-bar rect,
        .chart-line path,
        .chart-area path,
        .chart-pie path,
        .chart-donut path {
            transition: all 0.3s ease !important;
        }
        
        .chart-bar rect:hover,
        .chart-line path:hover,
        .chart-area path:hover,
        .chart-pie path:hover,
        .chart-donut path:hover {
            opacity: 0.8 !important;
            filter: brightness(1.1) !important;
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .graph-controls {
                padding: 1rem;
            }
            
            .graph-toggle-container {
                flex-direction: column;
                gap: 0.5rem;
            }
            
            .graph-toggle-group {
                width: 100%;
            }
            
            .graph-view-buttons {
                flex-wrap: wrap;
            }
            
            .graph-container {
                padding: 1rem;
            }
            
            .chart-wrapper {
                height: 300px;
            }
            
            .element-checkboxes {
                grid-template-columns: 1fr;
            }
            
            .graph-header {
                flex-direction: column;
                gap: 1rem;
                align-items: flex-start;
            }
            
            .data-table {
                font-size: 0.875rem;
            }
            
            .data-table th,
            .data-table td {
                padding: 0.5rem;
            }
        }

        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
            }
            .sidebar.active {
                transform: translateX(0);
            }
            .main-content {
                margin-left: 0;
            }
            .element-grid {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            }
            .discussion-controls {
                flex-direction: column;
                align-items: stretch;
            }
            .search-box {
                min-width: auto;
            }
        }

        /* Loading spinner */
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-radius: 50%;
            border-top: 4px solid var(--primary);
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 2rem auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Section complete button styles */
        .section-complete-btn {
            transition: all 0.3s ease;
        }

        .section-complete-btn:hover {
            transform: translateY(-3px);
        }

        /* Unmark complete button styles */
        .btn-unmark {
            background: var(--accent);
            color: var(--text-primary);
            box-shadow: 0 4px 6px rgba(245, 158, 11, 0.3);
        }

        .btn-unmark:hover {
            background: #d97706;
            transform: translateY(-3px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        /* Feedback button styles */
        .feedback-button {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: var(--primary);
            color: var(--text-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 999;
        }

        .feedback-button:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 16px rgba(59, 130, 246, 0.5);
        }

        .feedback-button i {
            font-size: 24px;
        }

        /* Back to Home Button */
        .back-to-home-btn {
            position: fixed;
            bottom: 90px;
            right: 20px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--secondary);
            color: var(--text-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(139, 92, 246, 0.4);
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 998;
            border: none;
        }

        .back-to-home-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 16px rgba(139, 92, 246, 0.5);
            background: var(--primary);
        }

        .back-to-home-btn i {
            font-size: 20px;
        }

        /* Magic link styles */
        .magic-link-form {
            margin-top: 1rem;
        }

        .magic-link-input {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
            margin-bottom: 1rem;
            font-size: 1rem;
            background: var(--bg-card-hover);
            color: var(--text-secondary);
        }

        .magic-link-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
        }

        .magic-link-button {
            width: 100%;
            padding: 0.75rem;
            background: var(--primary);
            color: var(--text-primary);
            border: none;
            border-radius: 0.5rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .magic-link-button:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }

        .magic-link-message {
            margin-top: 1rem;
            padding: 0.75rem;
            border-radius: 0.5rem;
            font-size: 0.875rem;
            text-align: center;
        }

        .magic-link-message.success {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success);
            border: 1px solid rgba(16, 185, 129, 0.3);
        }

        .magic-link-message.error {
            background: rgba(239, 68, 68, 0.1);
            color: var(--danger);
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        /* Mobile menu button */
        .mobile-menu-btn {
            display: none;
            position: fixed;
            top: 1rem;
            left: 1rem;
            z-index: 101;
            background: var(--primary);
            color: var(--text-primary);
            border: none;
            border-radius: 0.5rem;
            width: 3rem;
            height: 3rem;
            font-size: 1.25rem;
            cursor: pointer;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .mobile-menu-btn:hover {
            background: var(--primary-dark);
            transform: scale(1.05);
        }

        @media (max-width: 767px) {
            .mobile-menu-btn {
                display: flex;
                align-items: center;
                justify-content: center;
            }
        }

        /* Fix for card titles */
        .element-card h4 {
            color: var(--text-primary) !important;
        }

        /* Fix for sidebar headings */
        .sidebar h1 {
            color: var(--text-primary) !important;
        }

        .sidebar h3 {
            color: var(--text-tertiary) !important;
        }

        /* Fix for modal headings */
        .modal-content h2 {
            color: var(--text-primary) !important;
        }

        .modal-content h3 {
            color: var(--text-primary) !important;
        }

        .modal-content h4 {
            color: var(--text-primary) !important;
        }

        /* Fix for form labels */
        .form-label {
            color: var(--text-secondary) !important;
        }

        /* Fix for button text */
        .btn {
            color: #ffffff !important;
        }

        .btn-secondary {
            color: var(--text-secondary) !important;
        }

        /* Fix for table headers */
        .trend-table th {
            color: #ffffff !important;
        }

        .trend-table td {
            color: var(--text-secondary) !important;
        }

        /* Fix for tab text */
        .tab {
            color: var(--text-tertiary) !important;
        }

        .tab.active {
            color: var(--primary) !important;
        }

        /* Fix for highlight box text */
        .highlight-box h4 {
            color: var(--primary) !important;
        }

        .highlight-box p {
            color: var(--text-secondary) !important;
        }

        /* Fix for equation box text */
        .equation-box .equation {
            color: var(--text-secondary) !important;
        }

        /* Fix for quiz options */
        .quiz-option label {
            color: var(--text-secondary) !important;
        }

        /* Fix for discussion posts */
        .post-title {
            color: var(--text-primary) !important;
        }

        .post-author {
            color: var(--text-primary) !important;
        }

        .post-content {
            color: var(--text-secondary) !important;
        }

        /* Fix for study groups */
        .group-title {
            color: var(--text-primary) !important;
        }

        .group-description {
            color: var(--text-secondary) !important;
        }

        /* Fix for empty states */
        .empty-state-title {
            color: var(--text-primary) !important;
        }

        .empty-state p {
            color: var(--text-tertiary) !important;
        }

        /* Fix for user info */
        .user-name {
            color: var(--text-primary) !important;
        }

        .user-email {
            color: var(--text-tertiary) !important;
        }

        /* Fix for XP display */
        .xp-label {
            color: var(--accent) !important;
        }

        .xp-value {
            color: var(--accent) !important;
        }

        /* Fix for badges */
        .badges-label {
            color: var(--text-secondary) !important;
        }

        /* Fix for settings */
        .setting-label {
            color: var(--text-secondary) !important;
        }

        /* Fix for daily challenge */
        .daily-challenge h3 {
            color: #ffffff !important;
        }

        .daily-challenge p {
            color: #ffffff !important;
        }

        /* Fix for leaderboard */
        .leaderboard-table th {
            color: #ffffff !important;
        }

        .leaderboard-table td {
            color: var(--text-secondary) !important;
        }

        /* Fix for feedback system */
        .feedback-system h3 {
            color: var(--text-primary) !important;
        }

        .feedback-system h4 {
            color: var(--text-primary) !important;
        }

        /* Fix for tooltips */
        .tooltip .tooltiptext {
            color: var(--text-secondary) !important;
        }

        /* Fix for search input */
        .search-box input {
            color: var(--text-secondary) !important;
        }

        /* Fix for nav items */
        .nav-item {
            color: var(--text-secondary) !important;
        }

        .nav-item.active {
            color: var(--primary) !important;
        }

        .nav-item:hover {
            color: var(--primary) !important;
        }

        /* Fix for nav section titles */
        .nav-section-title {
            color: var(--text-tertiary) !important;
        }

        /* Fix for resource items */
        .resource-name {
            color: var(--text-primary) !important;
        }

        .resource-meta {
            color: var(--text-tertiary) !important;
        }

        .resource-description {
            color: var(--text-secondary) !important;
        }

        /* Fix for comments */
        .comment-author {
            color: var(--text-primary) !important;
        }

        .comment-content {
            color: var(--text-secondary) !important;
        }

        /* Fix for form inputs */
        .form-input {
            color: var(--text-secondary) !important;
        }

        .form-textarea {
            color: var(--text-secondary) !important;
        }

        /* Fix for magic link */
        .magic-link-input {
            color: var(--text-secondary) !important;
        }

        /* Fix for reaction buttons */
        .reaction-btn {
            color: var(--text-secondary) !important;
        }

        /* Fix for toast notifications */
        .toast-title {
            color: var(--text-primary) !important;
        }

        .toast-description {
            color: var(--text-secondary) !important;
        }

        /* Fix for interactive elements */
        .interactive-element {
            color: var(--primary) !important;
        }

        .keyword {
            color: var(--primary) !important;
        }

        .valence-electron {
            color: var(--primary) !important;
        }

        .element-hover {
            color: var(--primary) !important;
        }

        /* Fix for periodic table */
        .element {
            color: var(--text-secondary) !important;
        }

        .element.group1 {
            color: var(--primary) !important;
        }

        /* Fix for post actions */
        .post-action {
            color: var(--text-tertiary) !important;
        }

        .post-action:hover {
            color: var(--primary) !important;
        }

        /* Fix for group stats */
        .group-stats {
            color: var(--text-tertiary) !important;
        }

        /* Fix for badges */
        .badge {
            color: #ffffff !important;
        }

        /* Fix for XP display */
        .xp-display {
            color: #ffffff !important;
        }

        /* Fix for landing page */
        #landingPage h1 {
            color: var(--text-primary) !important;
        }

        #landingPage h3 {
            color: var(--text-primary) !important;
        }

        #landingPage p {
            color: var(--text-secondary) !important;
        }

        /* Fix for all text in general */
        .text-gray-800 {
            color: var(--text-primary) !important;
        }

        .text-gray-700 {
            color: var(--text-secondary) !important;
        }

        .text-gray-600 {
            color: var(--text-tertiary) !important;
        }

        .text-indigo-600 {
            color: var(--primary) !important;
        }

        .text-indigo-800 {
            color: var(--primary) !important;
        }

        .text-blue-600 {
            color: var(--primary) !important;
        }

        .text-blue-800 {
            color: var(--primary) !important;
        }

        .text-green-600 {
            color: var(--success) !important;
        }

        .text-green-800 {
            color: var(--success) !important;
        }

        .text-purple-600 {
            color: var(--secondary) !important;
        }

        .text-purple-800 {
            color: var(--secondary) !important;
        }

        .text-red-800 {
            color: var(--danger) !important;
        }

        .text-orange-800 {
            color: var(--accent) !important;
        }

        .text-yellow-800 {
            color: #eab308 !important;
        }

        .text-sm {
            color: inherit !important;
        }

        .text-xs {
            color: inherit !important;
        }

        .text-lg {
            color: inherit !important;
        }

        .text-xl {
            color: inherit !important;
        }

        .text-2xl {
            color: inherit !important;
        }

        .text-3xl {
            color: inherit !important;
        }

        .text-4xl {
            color: inherit !important;
        }

        /* Fix for font weight classes */
        .font-semibold {
            color: inherit !important;
        }

        .font-bold {
            color: inherit !important;
        }

        .font-medium {
            color: inherit !important;
        }

        /* Fix for specific elements that might still be invisible */
        #overview-section h3,
        #elements-section h3,
        #properties-section h3,
        #reactions-section h3,
        #quiz-section h3,
        #discussion-section h3,
        #study-groups-section h3,
        #leaderboard-section h3 {
            color: var(--text-primary) !important;
        }

        #progressPercentage,
        #userXP,
        #userName,
        #userEmail {
            color: var(--text-secondary) !important;
        }

        #progressPercentage {
            color: var(--primary) !important;
        }

        /* Fix for key points and concepts in highlight boxes */
        .highlight-box ul li {
            color: var(--text-secondary) !important;
        }

        .highlight-box ul li span {
            color: var(--text-secondary) !important;
        }

        /* Fix for gradient background boxes - Elements tab style */
        .bg-gray-100 {
            background: var(--bg-card-hover) !important;
            border: 1px solid var(--border-color) !important;
        }

        .bg-blue-50 {
            background: var(--accent-bg) !important;
            border: 1px solid var(--primary) !important;
        }

        .bg-gradient-to-r {
            background: linear-gradient(to right, var(--accent-bg), rgba(139, 92, 246, 0.1)) !important;
            border: 1px solid var(--border-color) !important;
        }

        .bg-gradient-to-r .text-indigo-800 {
            color: #93c5fd !important;
        }

        .bg-gradient-to-r .text-blue-800 {
            color: #93c5fd !important;
        }

        .bg-gradient-to-r .text-green-800 {
            color: #86efac !important;
        }

        .bg-gradient-to-r .text-purple-800 {
            color: #c4b5fd !important;
        }

        .bg-gradient-to-r .text-red-800 {
            color: #fca5a5 !important;
        }

        .bg-gradient-to-r .text-orange-800 {
            color: #fdba74 !important;
        }

        .bg-gradient-to-r .text-yellow-800 {
            color: #fde047 !important;
        }

        /* Fix for all list items */
        ul li {
            color: var(--text-secondary) !important;
        }

        ol li {
            color: var(--text-secondary) !important;
        }

        /* Fix for list items with specific classes */
        .list-disc li {
            color: var(--text-secondary) !important;
        }

        .space-y-3 li {
            color: var(--text-secondary) !important;
        }

        .space-y-2 li {
            color: var(--text-secondary) !important;
        }

        /* Fix for flex items with text */
        .flex items-center span {
            color: var(--text-secondary) !important;
        }

        .flex items-start span {
            color: var(--text-secondary) !important;
        }

        /* Fix for grid items text */
        .grid-cols-1 div {
            color: var(--text-secondary) !important;
        }

        .grid-cols-2 div {
            color: var(--text-secondary) !important;
        }

        .grid-cols-3 div {
            color: var(--text-secondary) !important;
        }

        .grid-cols-4 div {
            color: var(--text-secondary) !important;
        }

        /* Fix for table content */
        table td {
            color: var(--text-secondary) !important;
        }

        table th {
            color: var(--text-primary) !important;
        }

        /* Fix for description text */
        .text-gray-500 {
            color: var(--text-tertiary) !important;
        }

        .text-gray-400 {
            color: var(--text-tertiary) !important;
        }

        /* Fix for meta information */
        .meta {
            color: var(--text-tertiary) !important;
        }

        /* Fix for subtitle text */
        .subtitle {
            color: var(--text-tertiary) !important;
        }

        /* Fix for caption text */
        .caption {
            color: var(--text-tertiary) !important;
        }

        /* Fix for small text */
        small {
            color: var(--text-tertiary) !important;
        }

        /* Fix for emphasis text */
        em {
            color: var(--text-secondary) !important;
        }

        /* Fix for strong text within paragraphs */
        p strong {
            color: var(--text-primary) !important;
        }

        /* Fix for links */
        a {
            color: var(--primary) !important;
        }

        a:hover {
            color: #60a5fa !important;
        }

        /* Fix for code blocks */
        code {
            color: var(--text-secondary) !important;
            background: var(--bg-card-hover) !important;
        }

        pre {
            color: var(--text-secondary) !important;
            background: var(--bg-card-hover) !important;
        }

        /* Fix for blockquotes */
        blockquote {
            color: var(--text-secondary) !important;
            border-left-color: var(--border-color) !important;
        }

        /* Fix for definitions */
        dt {
            color: var(--text-primary) !important;
        }

        dd {
            color: var(--text-secondary) !important;
        }

        /* Fix for abbreviations */
        abbr {
            color: var(--text-secondary) !important;
        }

        /* Fix for citations */
        cite {
            color: var(--text-tertiary) !important;
        }

        /* Fix for time elements */
        time {
            color: var(--text-tertiary) !important;
        }

        /* Fix for data attributes */
        data {
            color: var(--text-secondary) !important;
        }

        /* Fix for mark elements */
        mark {
            color: #1f2937 !important;
            background: #fbbf24 !important;
        }

        /* Fix for deleted text */
        del {
            color: var(--text-tertiary) !important;
            text-decoration: line-through;
        }

        /* Fix for inserted text */
        ins {
            color: var(--success) !important;
            text-decoration: underline;
        }

        /* Fix for variable text */
        var {
            color: var(--text-primary) !important;
            font-style: italic;
        }

        /* Fix for sample output */
        samp {
            color: var(--text-secondary) !important;
            background: var(--bg-card-hover) !important;
        }

        /* Fix for keyboard text */
        kbd {
            color: var(--text-secondary) !important;
            background: var(--bg-card-hover) !important;
            border: 1px solid var(--border-color) !important;
        }

        /* Elements tab specific styling */
        .element-card {
            background: var(--bg-card) !important;
            border: 1px solid var(--border-color) !important;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3), 0 2px 4px -1px rgba(0, 0, 0, 0.2) !important;
        }

        .element-card:hover {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.4), 0 4px 6px -2px rgba(0, 0, 0, 0.3) !important;
            border-color: var(--primary) !important;
        }

        .element-card h4 {
            color: var(--text-primary) !important;
            font-weight: 600 !important;
        }

        .element-card .text-sm {
            color: var(--text-tertiary) !important;
        }

        .element-card .text-gray-600 {
            color: var(--text-tertiary) !important;
        }

        /* Apply elements tab styling to all sections */
        .content-card {
            background: var(--bg-card) !important;
            border: 1px solid var(--border-color) !important;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3), 0 2px 4px -1px rgba(0, 0, 0, 0.2) !important;
        }

        .content-card:hover {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.4), 0 4px 6px -2px rgba(0, 0, 0, 0.3) !important;
            border-color: var(--primary) !important;
        }

        /* Make all sections look like elements tab */
        .bg-gradient-to-r {
            background: linear-gradient(to right, var(--accent-bg), rgba(139, 92, 246, 0.1)) !important;
            border: 1px solid var(--border-color) !important;
            padding: 1.5rem !important;
            border-radius: 0.5rem !important;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3), 0 2px 4px -1px rgba(0, 0, 0, 0.2) !important;
        }

        .bg-gradient-to-r:hover {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.4), 0 4px 6px -2px rgba(0, 0, 0, 0.3) !important;
            border-color: var(--primary) !important;
        }

        /* Fix for all gradient containers */
        .bg-gradient-to-br {
            background: linear-gradient(to bottom right, var(--accent-bg), rgba(139, 92, 246, 0.1)) !important;
            border: 1px solid var(--border-color) !important;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3), 0 2px 4px -1px rgba(0, 0, 0, 0.2) !important;
        }

        .bg-gradient-to-br:hover {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.4), 0 4px 6px -2px rgba(0, 0, 0, 0.3) !important;
        }

        /* Fix for progress tracker */
        .grid-cols-4 > div {
            background: var(--bg-card) !important;
            border: 1px solid var(--border-color) !important;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3), 0 2px 4px -1px rgba(0, 0, 0, 0.2) !important;
        }

        .grid-cols-4 > div:hover {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.4), 0 4px 6px -2px rgba(0, 0, 0, 0.3) !important;
        }

        /* Fix for quiz section */
        #quiz-section .bg-gradient-to-r {
            background: linear-gradient(to right, var(--accent-bg), rgba(139, 92, 246, 0.1)) !important;
            border: 1px solid var(--border-color) !important;
        }

        #quiz-section .bg-gradient-to-r:hover {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.4), 0 4px 6px -2px rgba(0, 0, 0, 0.3) !important;
        }

        /* Fix for discussion section */
        #discussion-section .content-card {
            background: var(--bg-card) !important;
            border: 1px solid var(--border-color) !important;
        }

        #discussion-section .content-card:hover {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.4), 0 4px 6px -2px rgba(0, 0, 0, 0.3) !important;
        }

        /* Fix for study groups section */
        #study-groups-section .content-card {
            background: var(--bg-card) !important;
            border: 1px solid var(--border-color) !important;
        }

        #study-groups-section .content-card:hover {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.4), 0 4px 6px -2px rgba(0, 0, 0, 0.3) !important;
        }

        /* Fix for leaderboard section */
        #leaderboard-section .content-card {
            background: var(--bg-card) !important;
            border: 1px solid var(--border-color) !important;
        }

        #leaderboard-section .content-card:hover {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.4), 0 4px 6px -2px rgba(0, 0, 0, 0.3) !important;
        }

        /* Fix for daily challenge */
        .daily-challenge {
            background: linear-gradient(135deg, var(--success), #059669) !important;
            border: 1px solid var(--border-color) !important;
        }

        .daily-challenge:hover {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.4), 0 4px 6px -2px rgba(0, 0, 0, 0.3) !important;
        }

        /* Fix for feedback system */
        .feedback-system {
            background: var(--bg-card) !important;
            border: 1px solid var(--border-color) !important;
        }

        .feedback-system:hover {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.4), 0 4px 6px -2px rgba(0, 0, 0, 0.3) !important;
        }

        /* Fix for all cards to match elements tab style */
        .card {
            background: var(--bg-card) !important;
            border: 1px solid var(--border-color) !important;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3), 0 2px 4px -1px rgba(0, 0, 0, 0.2) !important;
        }

        .card:hover {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.4), 0 4px 6px -2px rgba(0, 0, 0, 0.3) !important;
            border-color: var(--primary) !important;
        }

        /* Fix for all containers */
        .container {
            background: var(--bg-card) !important;
            border: 1px solid var(--border-color) !important;
        }

        .container:hover {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.4), 0 4px 6px -2px rgba(0, 0, 0, 0.3) !important;
        }

        /* Fix for wrapper elements */
        .wrapper {
            background: var(--bg-card) !important;
            border: 1px solid var(--border-color) !important;
        }

        .wrapper:hover {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.4), 0 4px 6px -2px rgba(0, 0, 0, 0.3) !important;
        }

        /* Fix for section containers */
        section {
            background: var(--bg-primary) !important;
        }

        section .content-card {
            background: var(--bg-card) !important;
            border: 1px solid var(--border-color) !important;
        }

        section .content-card:hover {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.4), 0 4px 6px -2px rgba(0, 0, 0, 0.3) !important;
        }

        /* Additional styles for data visualization */
        .graph-controls {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
        }
        
        .graph-btn {
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            font-weight: 500;
            transition: all 0.2s;
            background-color: var(--bg-card-hover);
            color: var(--text-secondary);
            border: none;
            cursor: pointer;
        }
        
        .graph-btn:hover {
            background-color: var(--accent-bg);
            color: var(--primary);
        }
        
        .graph-btn.active {
            background-color: var(--primary);
            color: var(--text-primary);
        }
        
        .graph-container {
            background-color: var(--bg-card);
            border-radius: 0.5rem;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
            padding: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .graph-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        
        .graph-actions {
            display: flex;
            gap: 0.5rem;
        }
        
        .graph-action-btn {
            padding: 0.5rem;
            border-radius: 0.25rem;
            background-color: var(--bg-card-hover);
            border: none;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .graph-action-btn:hover {
            background-color: var(--accent-bg);
        }
        
        .chart-wrapper {
            position: relative;
            height: 400px;
        }
        
        .element-selector {
            background-color: var(--bg-card);
            border-radius: 0.5rem;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        
        .element-checkboxes {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .element-checkbox {
            display: flex;
            align-items: center;
            cursor: pointer;
        }
        
        .element-checkbox input {
            margin-right: 0.5rem;
        }
        
        .element-color {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 0.5rem;
        }
        
        .data-table-container {
            background-color: var(--bg-card);
            border-radius: 0.5rem;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        
        .data-table-wrapper {
            overflow-x: auto;
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .data-table th, .data-table td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }
        
        .data-table th {
            background-color: var(--primary);
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .data-table tr:hover {
            background-color: var(--accent-bg);
        }
        
        .graph-quiz-container {
            margin-top: 2rem;
        }
        
        /* Google Sign-In Button Styles */
        .google-signin-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
            background-color: var(--bg-card-hover);
            color: var(--text-secondary);
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
            padding: 0.75rem 1.5rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
        }
        
        .google-signin-btn:hover {
            background-color: var(--accent-bg);
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            transform: translateY(-2px);
        }
        
        .google-signin-btn i {
            font-size: 1.25rem;
        }

        /* Remove all instances of white background */
        .bg-white {
            background-color: var(--bg-card) !important;
        }

        /* Ensure all text is visible */
        h1, h2, h3, h4, h5, h6 {
            color: var(--text-primary) !important;
        }

        p, span, li, td, th {
            color: var(--text-secondary) !important;
        }

        /* Fix for all text in general */
        .text-white {
            color: var(--text-primary) !important;
        }
    </style>
</head>
<body>
    <!-- Landing Page -->
    <div id="landingPage" class="min-h-screen flex items-center justify-center p-6">
        <div class="bg-white rounded-2xl p-8 max-w-2xl w-full text-center shadow-2xl transform transition-all duration-500 hover:scale-105">
            <div class="text-6xl mb-6 text-indigo-600 animate-pulse">
                <i class="fas fa-atom"></i>
            </div>
            <h1 class="text-4xl font-bold text-gray-800 mb-4">Group 2 Alkaline Earth Metals</h1>
            <p class="text-lg text-gray-600 mb-8">Master Chemistry through Interactive Learning</p>
            <div class="grid grid-cols-3 gap-8 mb-8">
                <div class="bg-blue-50 p-6 rounded-xl transform transition-all duration-300 hover:scale-110 hover:shadow-lg">
                    <i class="fas fa-book-open text-3xl text-blue-600 mb-3 transform transition-all duration-300 hover:scale-110"></i>
                    <h3 class="font-semibold">Learn</h3>
                    <p class="text-sm text-gray-600">Interactive content</p>
                </div>
                <div class="bg-green-50 p-6 rounded-xl transform transition-all duration-300 hover:scale-110 hover:shadow-lg">
                    <i class="fas fa-chart-line text-3xl text-green-600 mb-3 transform transition-all duration-300 hover:scale-110"></i>
                    <h3 class="font-semibold">Track</h3>
                    <p class="text-sm text-gray-600">Progress monitoring</p>
                </div>
                <div class="bg-purple-50 p-6 rounded-xl transform transition-all duration-300 hover:scale-110 hover:shadow-lg">
                    <i class="fas fa-graduation-cap text-3xl text-purple-600 mb-3 transform transition-all duration-300 hover:scale-110"></i>
                    <h3 class="font-semibold">Test</h3>
                    <p class="text-sm text-gray-600">Innovative quiz</p>
                </div>
            </div>
            <div class="space-y-6">
                <button onclick="showLoginModal()" class="btn btn-primary w-full transform transition-all duration-300 hover:scale-105">
                    <i class="fas fa-sign-in-alt mr-2"></i>
                    Sign In to Begin
                </button>
            </div>
        </div>
    </div>
    <!-- Main App -->
    <div id="mainApp" style="display: none;">
        <!-- Sidebar -->
        <nav class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="logo-container">
                    <i class="fas fa-atom text-indigo-600 text-2xl mr-3 transform transition-all duration-300 hover:rotate-180"></i>
                    <div>
                        <h1 class="text-xl font-bold text-gray-800">Group 2 Alkaline Earth Metals</h1>
                        <p class="text-sm text-gray-600">Chemistry</p>
                    </div>
                </div>
            </div>
            <!-- Search Bar -->
            <div class="search-container">
                <div class="search-box">
                    <i class="fas fa-search"></i>
                    <input type="text" id="searchInput" placeholder="Search content...">
                </div>
            </div>
            <!-- Main Navigation -->
            <div class="nav-section">
                <h3 class="nav-section-title">Learning Path</h3>
                <div class="nav-items">
                    <a href="#" class="nav-item active" id="nav-overview" onclick="navigateToSection('overview')">
                        <i class="fas fa-home nav-icon"></i>
                        <span>Overview</span>
                        <i class="fas fa-check nav-check"></i>
                    </a>
                    <a href="#" class="nav-item locked" id="nav-elements" onclick="navigateToSection('elements')">
                        <i class="fas fa-th nav-icon"></i>
                        <span>Elements</span>
                        <i class="fas fa-lock nav-lock"></i>
                        <i class="fas fa-check nav-check"></i>
                    </a>
                    <a href="#" class="nav-item locked" id="nav-properties" onclick="navigateToSection('properties')">
                        <i class="fas fa-chart-line nav-icon"></i>
                        <span>Properties</span>
                        <i class="fas fa-lock nav-lock"></i>
                        <i class="fas fa-check nav-check"></i>
                    </a>
                    <a href="#" class="nav-item locked" id="nav-reactions" onclick="navigateToSection('reactions')">
                        <i class="fas fa-flask nav-icon"></i>
                        <span>Reactions</span>
                        <i class="fas fa-lock nav-lock"></i>
                        <i class="fas fa-check nav-check"></i>
                    </a>
                    <a href="#" class="nav-item locked" id="nav-quiz" onclick="navigateToSection('quiz')">
                        <i class="fas fa-graduation-cap nav-icon"></i>
                        <span>Quiz</span>
                        <i class="fas fa-lock nav-lock"></i>
                        <i class="fas fa-check nav-check"></i>
                    </a>
                </div>
            </div>
            <!-- Community Section -->
            <div class="nav-section">
                <h3 class="nav-section-title">Community</h3>
                <div class="nav-items">
                    <a href="#" class="nav-item" id="nav-discussion" onclick="navigateToSection('discussion')">
                        <i class="fas fa-comments nav-icon"></i>
                        <span>Discussion</span>
                        <span class="nav-badge">3</span>
                    </a>
                    <a href="#" class="nav-item" id="nav-study-groups" onclick="navigateToSection('study-groups')">
                        <i class="fas fa-users nav-icon"></i>
                        <span>Study Groups</span>
                        <span class="nav-badge">2</span>
                    </a>
                    <a href="#" class="nav-item" id="nav-leaderboard" onclick="navigateToSection('leaderboard')">
                        <i class="fas fa-trophy nav-icon"></i>
                        <span>Leaderboard</span>
                    </a>
                </div>
            </div>
            <!-- Tools Section -->
            <div class="nav-section">
                <h3 class="nav-section-title">Tools</h3>
                <div class="nav-items">
                    <a href="#" class="nav-item" onclick="showFeedbackModal()">
                        <i class="fas fa-comment-dots nav-icon"></i>
                        <span>Feedback</span>
                    </a>
                    <a href="#" class="nav-item" onclick="exportToPDF()">
                        <i class="fas fa-file-pdf nav-icon"></i>
                        <span>Export Notes</span>
                    </a>
                </div>
            </div>
            <!-- User Section -->
            <div class="user-section">
                <div class="xp-container">
                    <div class="xp-label">
                        <i class="fas fa-star text-yellow-500"></i>
                        <span>Your XP</span>
                    </div>
                    <div class="xp-value" id="userXP">0</div>
                </div>
                <div class="badges-container">
                    <div class="badges-label">Badges</div>
                    <div id="userBadges" class="badges-list">
                        <!-- Badges will be loaded here -->
                    </div>
                </div>
                <div class="user-info">
                    <div class="user-details">
                        <div class="user-name" id="userName">User</div>
                        <div class="user-email" id="userEmail">user@example.com</div>
                    </div>
                    <button onclick="signOut()" class="logout-btn">
                        <i class="fas fa-sign-out-alt"></i>
                    </button>
                </div>
            </div>
        </nav>
        <!-- Main Content -->
        <main class="main-content">
            <!-- Daily Challenge -->
            <div id="dailyChallenge" class="daily-challenge" style="display: none;">
                <h3><i class="fas fa-calendar-day mr-2"></i> Daily Challenge</h3>
                <p id="dailyChallengeQuestion">Loading daily challenge...</p>
                <button onclick="showDailyChallengeModal()" class="btn btn-secondary transform transition-all duration-300 hover:scale-105">
                    <i class="fas fa-play mr-2"></i>
                    Take Challenge
                </button>
            </div>
            <!-- Progress Tracker -->
            <div class="content-card">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-bold text-gray-800">Your Progress</h3>
                    <div class="text-xl font-bold text-indigo-600" id="progressPercentage">0%</div>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="overallProgressFill" style="width: 0%"></div>
                </div>
                <div class="grid grid-cols-4 gap-6 mt-6">
                    <div class="text-center p-4 bg-gray-100 rounded-lg transform transition-all duration-300 hover:scale-105" id="progress-overview">
                        <i class="fas fa-home text-gray-600 mb-3 transform transition-all duration-300 hover:scale-110"></i>
                        <div class="text-sm font-medium text-gray-700">Overview</div>
                        <div class="text-xs text-gray-500 mt-1">Not Started</div>
                    </div>
                    <div class="text-center p-4 bg-gray-100 rounded-lg transform transition-all duration-300 hover:scale-105" id="progress-elements">
                        <i class="fas fa-th text-gray-600 mb-3 transform transition-all duration-300 hover:scale-110"></i>
                        <div class="text-sm font-medium text-gray-700">Elements</div>
                        <div class="text-xs text-gray-500 mt-1">Locked</div>
                    </div>
                    <div class="text-center p-4 bg-gray-100 rounded-lg transform transition-all duration-300 hover:scale-105" id="progress-properties">
                        <i class="fas fa-chart-line text-gray-600 mb-3 transform transition-all duration-300 hover:scale-110"></i>
                        <div class="text-sm font-medium text-gray-700">Properties</div>
                        <div class="text-xs text-gray-500 mt-1">Locked</div>
                    </div>
                    <div class="text-center p-4 bg-gray-100 rounded-lg transform transition-all duration-300 hover:scale-105" id="progress-quiz">
                        <i class="fas fa-graduation-cap text-gray-600 mb-3 transform transition-all duration-300 hover:scale-110"></i>
                        <div class="text-sm font-medium text-gray-700">Quiz</div>
                        <div class="text-xs text-gray-500 mt-1">Locked</div>
                    </div>
                </div>
            </div>
            <!-- Overview Section -->
            <section id="overview-section" class="content-section">
                <div class="content-card">
                    <h3 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                        <i class="fas fa-info-circle mr-3 text-indigo-600 transform transition-all duration-300 hover:scale-110"></i>
                        Introduction to Group 2 Alkaline Earth Metals
                    </h3>
                    <div class="mb-8">
                        <div class="bg-gradient-to-r from-blue-50 to-indigo-50 p-6 rounded-lg border-l-4 border-indigo-500 shadow-sm hover:shadow-md transition-shadow duration-300">
                            <h4 class="font-semibold text-indigo-800 mb-3">Key Concepts</h4>
                            <ul class="space-y-3 text-gray-700">
                                <li class="flex items-start">
                                    <i class="fas fa-check-circle text-green-500 mt-1 mr-3"></i>
                                    <span>Group 2 elements: <span class="interactive-element font-semibold text-indigo-600" onclick="showElementQuiz('beryllium')">Beryllium (Be)</span>, <span class="interactive-element font-semibold text-indigo-600" onclick="showElementQuiz('magnesium')">Magnesium (Mg)</span>, <span class="interactive-element font-semibold text-indigo-600" onclick="showElementQuiz('calcium')">Calcium (Ca)</span>, Strontium (Sr), Barium (Ba), Radium (Ra)</span>
                                </li>
                                <li class="flex items-start">
                                    <i class="fas fa-check-circle text-green-500 mt-1 mr-3"></i>
                                    <span>Known as <span class="interactive-element font-semibold text-indigo-600" onclick="showTermQuiz('alkaline-earth-metals')">alkaline earth metals</span></span>
                                </li>
                                <li class="flex items-start">
                                    <i class="fas fa-check-circle text-green-500 mt-1 mr-3"></i>
                                    <span>Outer shell: <span class="interactive-element font-semibold text-indigo-600" onclick="showTermQuiz('valence-electrons')">2 valence electrons</span></span>
                                </li>
                                <li class="flex items-start">
                                    <i class="fas fa-check-circle text-green-500 mt-1 mr-3"></i>
                                    <span>Form +2 ions by losing these electrons</span>
                                </li>
                                <li class="flex items-start">
                                    <i class="fas fa-check-circle text-green-500 mt-1 mr-3"></i>
                                    <span>Less reactive than Group 1 metals</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <!-- Key Properties with Tooltips -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                        <div class="bg-gradient-to-br from-blue-50 to-indigo-50 p-6 rounded-lg shadow-sm hover:shadow-md transition-shadow duration-300">
                            <h4 class="font-semibold text-indigo-800 mb-3 flex items-center">
                                <i class="fas fa-atom mr-2"></i> Key Properties
                            </h4>
                            <ul class="space-y-3 text-gray-700">
                                <li><span class="interactive-element font-medium text-indigo-600" onclick="showTermQuiz('hardness')">Harder than Group 1 metals</span></li>
                                <li><span class="interactive-element font-medium text-indigo-600" onclick="showTermQuiz('melting-point')">Higher melting points</span></li>
                                <li><span class="interactive-element font-medium text-indigo-600" onclick="showTermQuiz('density')">Higher densities</span></li>
                                <li><span class="interactive-element font-medium text-indigo-600" onclick="showTermQuiz('reactivity')">Reactive with water and oxygen</span></li>
                                <li><span class="interactive-element font-medium text-indigo-600" onclick="showTermQuiz('flame-test')">Characteristic flame test colors</span></li>
                            </ul>
                        </div>
                        <div class="bg-gradient-to-br from-purple-50 to-indigo-50 p-6 rounded-lg shadow-sm hover:shadow-md transition-shadow duration-300">
                            <h4 class="font-semibold text-indigo-800 mb-3 flex items-center">
                                <i class="fas fa-chart-line mr-2"></i> Trends
                            </h4>
                            <ul class="space-y-3 text-gray-700">
                                <li><span class="interactive-element font-medium text-indigo-600" onclick="showTrendQuiz('melting-point')">Melting Point</span> <i class="fas fa-arrow-down text-red-500"></i> down group</li>
                                <li><span class="interactive-element font-medium text-indigo-600" onclick="showTrendQuiz('density')">Density</span> <i class="fas fa-arrow-up text-green-500"></i> down group</li>
                                <li><span class="interactive-element font-medium text-indigo-600" onclick="showTrendQuiz('reactivity')">Reactivity</span> <i class="fas fa-arrow-up text-green-500"></i> down group</li>
                                <li>Atomic radius <i class="fas fa-arrow-up text-green-500"></i> down group</li>
                            </ul>
                        </div>
                    </div>
                    <!-- Interactive Element Quiz Popup -->
                    <div id="elementQuizPopup" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                        <div class="bg-white rounded-lg p-6 max-w-md w-full shadow-xl">
                            <h3 class="text-xl font-bold mb-4" id="elementQuizTitle">Element Quiz</h3>
                            <p id="elementQuizQuestion" class="mb-4"></p>
                            <div id="elementQuizOptions" class="space-y-2 mb-4"></div>
                            <div id="elementQuizFeedback" class="mb-4 p-3 rounded-lg hidden"></div>
                            <button onclick="closeElementQuiz()" class="btn btn-primary w-full">Close</button>
                        </div>
                    </div>
                    <!-- YouTube Video -->
                    <div class="mt-8">
                        <h4 class="font-semibold mb-3">Learn More:</h4>
                        <div class="aspect-w-16 aspect-h-9">
                            <iframe src="https://www.youtube.com/embed/5M1d2g7d4i8" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen class="w-full h-64 rounded-lg transform transition-all duration-300 hover:scale-105"></iframe>
                        </div>
                    </div>
                    <div class="flex justify-center mt-6">
                        <button id="overview-complete-btn" class="btn btn-success section-complete-btn transform transition-all duration-300 hover:scale-105" onclick="completeSection('overview')">
                            <i class="fas fa-check mr-2"></i>
                            Mark as Complete
                        </button>
                    </div>
                </div>
            </section>
            <!-- Elements Section -->
            <section id="elements-section" class="content-section" style="display: none;">
                <div class="content-card">
                    <h3 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                        <i class="fas fa-th mr-3 text-indigo-600 transform transition-all duration-300 hover:scale-110"></i>
                        Group 2 Elements
                    </h3>
                    <!-- Interactive Periodic Table -->
                    <div class="mb-8">
                        <h4 class="font-semibold mb-3">Interactive Periodic Table</h4>
                        <div class="periodic-table">
                            <!-- Simplified periodic table with Group 2 highlighted -->
                            <div class="element group2" data-element="Be" onclick="showElementDetails('Beryllium', 'Be', 4, '2,2')">
                                <span class="element-number">4</span>
                                <span class="element-symbol">Be</span>
                                <span class="element-name">Beryllium</span>
                            </div>
                            <div class="element" data-element="Mg" onclick="showElementDetails('Magnesium', 'Mg', 12, '2,8,2')">
                                <span class="element-number">12</span>
                                <span class="element-symbol">Mg</span>
                                <span class="element-name">Magnesium</span>
                            </div>
                            <div class="element" data-element="Ca" onclick="showElementDetails('Calcium', 'Ca', 20, '2,8,8,2')">
                                <span class="element-number">20</span>
                                <span class="element-symbol">Ca</span>
                                <span class="element-name">Calcium</span>
                            </div>
                            <div class="element" data-element="Sr" onclick="showElementDetails('Strontium', 'Sr', 38, '2,8,18,8,2')">
                                <span class="element-number">38</span>
                                <span class="element-symbol">Sr</span>
                                <span class="element-name">Strontium</span>
                            </div>
                            <div class="element" data-element="Ba" onclick="showElementDetails('Barium', 'Ba', 56, '2,8,18,18,8,2')">
                                <span class="element-number">56</span>
                                <span class="element-symbol">Ba</span>
                                <span class="element-name">Barium</span>
                            </div>
                            <div class="element" data-element="Ra" onclick="showElementDetails('Radium', 'Ra', 88, '2,8,18,32,18,8,2')">
                                <span class="element-number">88</span>
                                <span class="element-symbol">Ra</span>
                                <span class="element-name">Radium</span>
                            </div>
                        </div>
                    </div>
                    <!-- Element Details Modal -->
                    <div id="elementDetailsModal" class="modal">
                        <div class="modal-content">
                            <div class="flex justify-between items-center mb-6">
                                <h2 class="text-2xl font-bold text-gray-800" id="elementDetailsName">Element Details</h2>
                                <button onclick="closeElementDetails()" class="text-gray-500 hover:text-gray-700 transform transition-all duration-300 hover:scale-110">
                                    <i class="fas fa-times text-xl"></i>
                                </button>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                                <div>
                                    <div class="bg-gray-100 p-5 rounded-lg mb-5">
                                        <h3 class="font-semibold text-gray-800 mb-3">Atomic Information</h3>
                                        <p><strong>Symbol:</strong> <span id="elementDetailsSymbol"></span></p>
                                        <p><strong>Atomic Number:</strong> <span id="elementDetailsNumber"></span></p>
                                        <p><strong>Electron Configuration:</strong> <span id="elementDetailsConfig"></span></p>
                                    </div>
                                    <div class="bg-gray-100 p-5 rounded-lg">
                                        <h3 class="font-semibold text-gray-800 mb-3">Properties</h3>
                                        <p><strong>Melting Point:</strong> <span id="elementDetailsMP"></span></p>
                                        <p><strong>Density:</strong> <span id="elementDetailsDensity"></span></p>
                                        <p><strong>Reactivity:</strong> <span id="elementDetailsReactivity"></span></p>
                                    </div>
                                </div>
                                <div>
                                    <div class="bg-gray-100 p-5 rounded-lg mb-5">
                                        <h3 class="font-semibold text-gray-800 mb-3">Uses</h3>
                                        <p id="elementDetailsUses"></p>
                                    </div>
                                    <div class="bg-gray-100 p-5 rounded-lg">
                                        <h3 class="font-semibold text-gray-800 mb-3">Fun Fact</h3>
                                        <p id="elementDetailsFact"></p>
                                    </div>
                                </div>
                            </div>
                            <div class="bg-blue-50 p-5 rounded-lg border-l-4 border-blue-500">
                                <h3 class="font-semibold text-blue-800 mb-3">Quick Quiz</h3>
                                <p id="elementDetailsQuizQuestion"></p>
                                <div id="elementDetailsQuizOptions" class="mt-3 space-y-2"></div>
                                <div id="elementDetailsQuizFeedback" class="mt-3 p-3 rounded-lg hidden"></div>
                            </div>
                        </div>
                    </div>
                    <div class="element-grid">
                        <div class="element-card" onclick="showElementDetails('Beryllium', 'Be', 4, '2,2')">
                            <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/3/30/Beryllium_crystal_bar_and_1cm3_cube.jpg/1200px-Beryllium_crystal_bar_and_1cm3_cube.jpg" alt="Beryllium" class="element-image">
                            <h4 class="font-bold text-lg">Beryllium (Be)</h4>
                            <p class="text-sm text-gray-600">Atomic: 4</p>
                            <p class="text-sm text-gray-600">Electron: 2,2</p>
                            <div class="text-xs text-gray-500 mt-2">Lightest structural metal, used in aerospace</div>
                        </div>
                        <div class="element-card" onclick="showElementDetails('Magnesium', 'Mg', 12, '2,8,2')">
                            <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/5/55/Magnesium_crystal_and_1cm3_cube.jpg/1200px-Magnesium_crystal_and_1cm3_cube.jpg" alt="Magnesium" class="element-image">
                            <h4 class="font-bold text-lg">Magnesium (Mg)</h4>
                            <p class="text-sm text-gray-600">Atomic: 12</p>
                            <p class="text-sm text-gray-600">Electron: 2,8,2</p>
                            <div class="text-xs text-gray-500 mt-2">Bright white flame, essential for life</div>
                        </div>
                        <div class="element-card" onclick="showElementDetails('Calcium', 'Ca', 20, '2,8,8,2')">
                            <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/3/30/Calcium_crystal_and_1cm3_cube.jpg/1200px-Calcium_crystal_and_1cm3_cube.jpg" alt="Calcium" class="element-image">
                            <h4 class="font-bold text-lg">Calcium (Ca)</h4>
                            <p class="text-sm text-gray-600">Atomic: 20</p>
                            <p class="text-sm text-gray-600">Electron: 2,8,8,2</p>
                            <div class="text-xs text-gray-500 mt-2">Brick-red flame, bones and teeth</div>
                        </div>
                        <div class="element-card" onclick="showElementDetails('Strontium', 'Sr', 38, '2,8,18,8,2')">
                            <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/4/4a/Strontium_crystal_and_1cm3_cube.jpg/1200px-Strontium_crystal_and_1cm3_cube.jpg" alt="Strontium" class="element-image">
                            <h4 class="font-bold text-lg">Strontium (Sr)</h4>
                            <p class="text-sm text-gray-600">Atomic: 38</p>
                            <p class="text-sm text-gray-600">Electron: 2,8,18,8,2</p>
                            <div class="text-xs text-gray-500 mt-2">Crimson flame, fireworks</div>
                        </div>
                        <div class="element-card" onclick="showElementDetails('Barium', 'Ba', 56, '2,8,18,18,8,2')">
                            <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/8/86/Barium_crystal_and_1cm3_cube.jpg/1200px-Barium_crystal_and_1cm3_cube.jpg" alt="Barium" class="element-image">
                            <h4 class="font-bold text-lg">Barium (Ba)</h4>
                            <p class="text-sm text-gray-600">Atomic: 56</p>
                            <p class="text-sm text-gray-600">Electron: 2,8,18,18,8,2</p>
                            <div class="text-xs text-gray-500 mt-2">Green flame, medical imaging</div>
                        </div>
                        <div class="element-card" onclick="showElementDetails('Radium', 'Ra', 88, '2,8,18,32,18,8,2')">
                            <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/9/9c/Radium_crystal.jpg/1200px-Radium_crystal.jpg" alt="Radium" class="element-image">
                            <h4 class="font-bold text-lg">Radium (Ra)</h4>
                            <p class="text-sm text-gray-600">Atomic: 88</p>
                            <p class="text-sm text-gray-600">Electron: 2,8,18,32,18,8,2</p>
                            <div class="text-xs text-gray-500 mt-2">Radioactive, glow-in-the-dark</div>
                        </div>
                    </div>
                    <div class="flex justify-center mt-6">
                        <button id="elements-complete-btn" class="btn btn-success section-complete-btn transform transition-all duration-300 hover:scale-105" onclick="completeSection('elements')">
                            <i class="fas fa-check mr-2"></i>
                            Mark as Complete
                        </button>
                    </div>
                </div>
            </section>
            <!-- Properties Section -->
            <section id="properties-section" class="content-section" style="display: none;">
                <div class="content-card">
                    <h3 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                        <i class="fas fa-chart-line mr-3 text-indigo-600 transform transition-all duration-300 hover:scale-110"></i>
                        Trends in Group 2
                    </h3>
                    <div class="tabs">
                        <button class="tab active" onclick="showTab('melting-point')">Melting Point</button>
                        <button class="tab" onclick="showTab('density')">Density</button>
                        <button class="tab" onclick="showTab('reactivity')">Reactivity</button>
                        <button class="tab" onclick="showTab('data-visualization')">Data Visualization</button>
                    </div>
                    <div id="melting-point" class="tab-content active">
                        <div class="bg-gradient-to-r from-blue-50 to-indigo-50 p-6 rounded-lg border-l-4 border-indigo-500 shadow-sm hover:shadow-md transition-shadow duration-300 mb-6">
                            <h4 class="font-semibold text-indigo-800 mb-3">Key Points</h4>
                            <ul class="list-disc pl-6 space-y-2 text-gray-700">
                                <li>Melting point <strong>decreases</strong> down Group 2</li>
                                <li>Due to increasing atomic size and weaker metallic bonding</li>
                                <li>Be: 1287C  Ra: 700C</li>
                            </ul>
                        </div>
                        <!-- Trend Explanation Modal -->
                        <div id="trendExplanationModal" class="modal">
                            <div class="modal-content">
                                <div class="flex justify-between items-center mb-6">
                                    <h2 class="text-2xl font-bold text-gray-800" id="trendExplanationTitle">Trend Explanation</h2>
                                    <button onclick="closeTrendExplanation()" class="text-gray-500 hover:text-gray-700 transform transition-all duration-300 hover:scale-110">
                                        <i class="fas fa-times text-xl"></i>
                                    </button>
                                </div>
                                <div class="mb-6">
                                    <h3 class="text-lg font-semibold mb-3" id="trendExplanationHeading">Heading</h3>
                                    <p id="trendExplanationContent" class="text-gray-700 mb-5"></p>
                                    <div class="bg-blue-50 p-5 rounded-lg border-l-4 border-blue-500">
                                        <h4 class="font-semibold text-blue-800 mb-3">Quick Quiz</h4>
                                        <p id="trendExplanationQuizQuestion"></p>
                                        <div id="trendExplanationQuizOptions" class="mt-3 space-y-2"></div>
                                        <div id="trendExplanationQuizFeedback" class="mt-3 p-3 rounded-lg hidden"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="density" class="tab-content">
                        <div class="bg-gradient-to-r from-blue-50 to-indigo-50 p-6 rounded-lg border-l-4 border-indigo-500 shadow-sm hover:shadow-md transition-shadow duration-300 mb-6">
                            <h4 class="font-semibold text-indigo-800 mb-3">Key Points</h4>
                            <ul class="list-disc pl-6 space-y-2 text-gray-700">
                                <li>Density <strong>increases</strong> down Group 2</li>
                                <li>All Group 2 elements are denser than water</li>
                                <li>Be: 1.85 g/cm  Ra: 5.5 g/cm</li>
                            </ul>
                        </div>
                        <table class="trend-table">
                            <thead>
                                <tr>
                                    <th>Element</th>
                                    <th>Density (g/cm)</th>
                                    <th>Trend Explanation</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr onclick="showTrendExplanation('density', 'beryllium')">
                                    <td>Beryllium</td>
                                    <td>1.85</td>
                                    <td>Lightest in the group, still denser than water</td>
                                </tr>
                                <tr onclick="showTrendExplanation('density', 'magnesium')">
                                    <td>Magnesium</td>
                                    <td>1.74</td>
                                    <td>Slightly less dense than beryllium</td>
                                </tr>
                                <tr onclick="showTrendExplanation('density', 'calcium')">
                                    <td>Calcium</td>
                                    <td>1.55</td>
                                    <td>Continuing the trend</td>
                                </tr>
                                <tr onclick="showTrendExplanation('density', 'strontium')">
                                    <td>Strontium</td>
                                    <td>2.64</td>
                                    <td>Significant increase in density</td>
                                </tr>
                                <tr onclick="showTrendExplanation('density', 'barium')">
                                    <td>Barium</td>
                                    <td>3.62</td>
                                    <td>Continuing the trend</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div id="reactivity" class="tab-content">
                        <div class="bg-gradient-to-r from-blue-50 to-indigo-50 p-6 rounded-lg border-l-4 border-indigo-500 shadow-sm hover:shadow-md transition-shadow duration-300 mb-6">
                            <h4 class="font-semibold text-indigo-800 mb-3">Key Points</h4>
                            <ul class="list-disc pl-6 space-y-2 text-gray-700">
                                <li>Reactivity <strong>increases</strong> down Group 2</li>
                                <li>Outer electrons further from nucleus, easier to lose</li>
                                <li>Reaction with water becomes more vigorous</li>
                            </ul>
                        </div>
                        <div class="highlight-box">
                            <h4>Reactivity Series</h4>
                            <p>Most Reactive: Barium > Strontium > Calcium > Magnesium > Beryllium :Least Reactive</p>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-8">
                            <div class="bg-gradient-to-br from-red-50 to-orange-50 p-6 rounded-lg shadow-sm hover:shadow-md transition-shadow duration-300">
                                <h4 class="font-semibold text-red-800 mb-3">Beryllium Reaction</h4>
                                <p class="text-gray-700">Does not react with water at room temperature</p>
                                <button onclick="showReactionVideo('beryllium')" class="btn btn-primary btn-sm mt-3">Watch Reaction</button>
                            </div>
                            <div class="bg-gradient-to-br from-orange-50 to-yellow-50 p-6 rounded-lg shadow-sm hover:shadow-md transition-shadow duration-300">
                                <h4 class="font-semibold text-orange-800 mb-3">Magnesium Reaction</h4>
                                <p class="text-gray-700">Reacts slowly with hot water, steam</p>
                                <button onclick="showReactionVideo('magnesium')" class="btn btn-primary btn-sm mt-3">Watch Reaction</button>
                            </div>
                            <div class="bg-gradient-to-br from-yellow-50 to-green-50 p-6 rounded-lg shadow-sm hover:shadow-md transition-shadow duration-300">
                                <h4 class="font-semibold text-yellow-800 mb-3">Calcium Reaction</h4>
                                <p class="text-gray-700">Reacts steadily with cold water</p>
                                <button onclick="showReactionVideo('calcium')" class="btn btn-primary btn-sm mt-3">Watch Reaction</button>
                            </div>
                            <div class="bg-gradient-to-br from-green-50 to-blue-50 p-6 rounded-lg shadow-sm hover:shadow-md transition-shadow duration-300">
                                <h4 class="font-semibold text-green-800 mb-3">Barium Reaction</h4>
                                <p class="text-gray-700">Reacts vigorously with water</p>
                                <button onclick="showReactionVideo('barium')" class="btn btn-primary btn-sm mt-3">Watch Reaction</button>
                            </div>
                        </div>
                    </div>
                    <!-- Data Visualization Tab -->
                    <div id="data-visualization" class="tab-content">
                        <div class="bg-gradient-to-r from-blue-50 to-indigo-50 p-6 rounded-lg border-l-4 border-indigo-500 shadow-sm hover:shadow-md transition-shadow duration-300 mb-6">
                            <h4 class="font-semibold text-indigo-800 mb-3">Interactive Data Visualization</h4>
                            <p class="text-gray-700">Explore Group 2 element properties through interactive graphs. Toggle different properties to compare them on the same chart.</p>
                        </div>
                        
                        <!-- Enhanced Graph Controls with Toggle Buttons -->
                        <div class="graph-controls">
                            <h4 class="text-lg font-semibold mb-3 text-gray-800">Toggle Properties to Display</h4>
                            <div class="graph-toggle-container">
                                <div class="graph-toggle-group">
                                    <label class="graph-toggle">
                                        <input type="checkbox" id="toggle-melting-point" checked onchange="toggleGraphProperty('melting-point')">
                                        <span class="graph-toggle-slider"></span>
                                    </label>
                                    <div class="graph-toggle-label">
                                        <span class="color-indicator" style="background-color: #3b82f6;"></span>
                                        Melting Point (C)
                                    </div>
                                </div>
                                
                                <div class="graph-toggle-group">
                                    <label class="graph-toggle">
                                        <input type="checkbox" id="toggle-density" checked onchange="toggleGraphProperty('density')">
                                        <span class="graph-toggle-slider"></span>
                                    </label>
                                    <div class="graph-toggle-label">
                                        <span class="color-indicator" style="background-color: #8b5cf6;"></span>
                                        Density (g/cm)
                                    </div>
                                </div>
                                
                                <div class="graph-toggle-group">
                                    <label class="graph-toggle">
                                        <input type="checkbox" id="toggle-reactivity" onchange="toggleGraphProperty('reactivity')">
                                        <span class="graph-toggle-slider"></span>
                                    </label>
                                    <div class="graph-toggle-label">
                                        <span class="color-indicator" style="background-color: #10b981;"></span>
                                        Reactivity Level
                                    </div>
                                </div>
                                
                                <div class="graph-toggle-group">
                                    <label class="graph-toggle">
                                        <input type="checkbox" id="toggle-atomic-radius" onchange="toggleGraphProperty('atomic-radius')">
                                        <span class="graph-toggle-slider"></span>
                                    </label>
                                    <div class="graph-toggle-label">
                                        <span class="color-indicator" style="background-color: #f59e0b;"></span>
                                        Atomic Radius (pm)
                                    </div>
                                </div>
                            </div>
                            
                            <div class="graph-view-buttons">
                                <button class="graph-view-btn active" id="view-line" onclick="changeGraphView('line')">
                                    <i class="fas fa-chart-line"></i>
                                    Line Chart
                                </button>
                                <button class="graph-view-btn" id="view-bar" onclick="changeGraphView('bar')">
                                    <i class="fas fa-chart-bar"></i>
                                    Bar Chart
                                </button>
                                <button class="graph-view-btn" id="view-scatter" onclick="changeGraphView('scatter')">
                                    <i class="fas fa-chart-scatter"></i>
                                    Scatter Plot
                                </button>
                            </div>
                        </div>
                        
                        <!-- Main Graph Container -->
                        <div class="graph-container">
                            <div class="graph-header">
                                <h3 id="graph-title">Group 2 Properties Comparison</h3>
                                <div class="graph-actions">
                                    <button onclick="resetZoom()" class="graph-action-btn" title="Reset Zoom">
                                        <i class="fas fa-search-minus"></i>
                                    </button>
                                    <button onclick="downloadGraph()" class="graph-action-btn" title="Download Graph">
                                        <i class="fas fa-download"></i>
                                    </button>
                                    <button onclick="toggleAnimation()" class="graph-action-btn" title="Toggle Animation">
                                        <i class="fas fa-play"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="chart-wrapper">
                                <canvas id="mainChart"></canvas>
                            </div>
                        </div>
                        
                        <!-- Element Selector -->
                        <div class="element-selector">
                            <h4 class="text-lg font-semibold mb-3 text-gray-800">Select Elements to Highlight</h4>
                            <div class="element-checkboxes">
                                <label class="element-checkbox">
                                    <input type="checkbox" value="Be" onchange="toggleElement('Be')" checked>
                                    <span class="element-color" style="background-color: #FF6384;"></span>
                                    Beryllium
                                </label>
                                <label class="element-checkbox">
                                    <input type="checkbox" value="Mg" onchange="toggleElement('Mg')" checked>
                                    <span class="element-color" style="background-color: #36A2EB;"></span>
                                    Magnesium
                                </label>
                                <label class="element-checkbox">
                                    <input type="checkbox" value="Ca" onchange="toggleElement('Ca')" checked>
                                    <span class="element-color" style="background-color: #FFCE56;"></span>
                                    Calcium
                                </label>
                                <label class="element-checkbox">
                                    <input type="checkbox" value="Sr" onchange="toggleElement('Sr')" checked>
                                    <span class="element-color" style="background-color: #4BC0C0;"></span>
                                    Strontium
                                </label>
                                <label class="element-checkbox">
                                    <input type="checkbox" value="Ba" onchange="toggleElement('Ba')" checked>
                                    <span class="element-color" style="background-color: #9966FF;"></span>
                                    Barium
                                </label>
                                <label class="element-checkbox">
                                    <input type="checkbox" value="Ra" onchange="toggleElement('Ra')" checked>
                                    <span class="element-color" style="background-color: #FF9F40;"></span>
                                    Radium
                                </label>
                            </div>
                        </div>
                        
                        <!-- Data Table -->
                        <div class="data-table-container">
                            <h4 class="text-lg font-semibold mb-3 text-gray-800">Property Data</h4>
                            <div class="data-table-wrapper">
                                <table class="data-table" id="propertyTable">
                                    <thead>
                                        <tr>
                                            <th>Element</th>
                                            <th>Atomic Number</th>
                                            <th>Melting Point (C)</th>
                                            <th>Density (g/cm)</th>
                                            <th>Reactivity Level</th>
                                            <th>Atomic Radius (pm)</th>
                                        </tr>
                                    </thead>
                                    <tbody id="dataTableBody">
                                        <!-- Data will be populated by JavaScript -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        
                        <!-- Quiz Integration -->
                        <div class="graph-quiz-container mt-8">
                            <div class="bg-gradient-to-r from-green-50 to-emerald-50 p-6 rounded-lg border-l-4 border-green-500 shadow-sm hover:shadow-md transition-shadow duration-300">
                                <h4 class="font-semibold text-green-800 mb-3">
                                    <i class="fas fa-question-circle mr-2"></i>Graph-Based Quiz
                                </h4>
                                <p id="graph-quiz-question" class="mb-4">Loading question...</p>
                                <div id="graph-quiz-options" class="space-y-2"></div>
                                <div id="graph-quiz-feedback" class="mt-4 p-3 rounded-lg hidden"></div>
                            </div>
                        </div>
                    </div>
                    <div class="flex justify-center mt-6">
                        <button id="properties-complete-btn" class="btn btn-success section-complete-btn transform transition-all duration-300 hover:scale-105" onclick="completeSection('properties')">
                            <i class="fas fa-check mr-2"></i>
                            Mark as Complete
                        </button>
                    </div>
                </div>
            </section>
            <!-- Reactions Section -->
            <section id="reactions-section" class="content-section" style="display: none;">
                <div class="content-card">
                    <h3 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                        <i class="fas fa-flask mr-3 text-indigo-600 transform transition-all duration-300 hover:scale-110"></i>
                        Reactions of Group 2 Metals
                    </h3>
                    <div class="tabs">
                        <button class="tab active" onclick="showTab('water')">With Water</button>
                        <button class="tab" onclick="showTab('oxygen')">With Oxygen</button>
                    </div>
                    <div id="water" class="tab-content active">
                        <div class="bg-gradient-to-r from-blue-50 to-indigo-50 p-6 rounded-lg border-l-4 border-indigo-500 shadow-sm hover:shadow-md transition-shadow duration-300 mb-6">
                            <h4 class="font-semibold text-indigo-800 mb-3">Key Points</h4>
                            <ul class="list-disc pl-6 space-y-2 text-gray-700">
                                <li>Group 2 metals react with water (except Be)</li>
                                <li>Products: Metal hydroxide + Hydrogen gas</li>
                                <li>Reactivity increases down the group</li>
                            </ul>
                        </div>
                        <div class="equation-box">
                            <p class="text-gray-700 mb-3">General equation:</p>
                            <p class="equation">M(s) + 2HO(l)  M(OH)(aq) + H(g)</p>
                        </div>
                        <div class="highlight-box">
                            <h4>Observations</h4>
                            <ul class="list-disc pl-6 space-y-1">
                                <li><strong>Beryllium:</strong> Does not react with water</li>
                                <li><strong>Magnesium:</strong> Reacts slowly with hot water/steam</li>
                                <li><strong>Calcium:</strong> Reacts steadily with cold water</li>
                            </ul>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mt-8">
                            <div class="bg-gradient-to-br from-blue-50 to-indigo-50 p-6 rounded-lg shadow-sm hover:shadow-md transition-shadow duration-300">
                                <h4 class="font-semibold text-blue-800 mb-3">Magnesium + Water</h4>
                                <p class="equation text-sm">Mg(s) + 2HO(l)  Mg(OH)(aq) + H(g)</p>
                                <button onclick="showReactionDetails('magnesium-water')" class="btn btn-primary btn-sm mt-3">View Details</button>
                            </div>
                            <div class="bg-gradient-to-br from-purple-50 to-indigo-50 p-6 rounded-lg shadow-sm hover:shadow-md transition-shadow duration-300">
                                <h4 class="font-semibold text-purple-800 mb-3">Calcium + Water</h4>
                                <p class="equation text-sm">Ca(s) + 2HO(l)  Ca(OH)(aq) + H(g)</p>
                                <button onclick="showReactionDetails('calcium-water')" class="btn btn-primary btn-sm mt-3">View Details</button>
                            </div>
                            <div class="bg-gradient-to-br from-pink-50 to-purple-50 p-6 rounded-lg shadow-sm hover:shadow-md transition-shadow duration-300">
                                <h4 class="font-semibold text-pink-800 mb-3">Barium + Water</h4>
                                <p class="equation text-sm">Ba(s) + 2HO(l)  Ba(OH)(aq) + H(g)</p>
                                <button onclick="showReactionDetails('barium-water')" class="btn btn-primary btn-sm mt-3">View Details</button>
                            </div>
                        </div>
                    </div>
                    <div id="oxygen" class="tab-content">
                        <div class="bg-gradient-to-r from-blue-50 to-indigo-50 p-6 rounded-lg border-l-4 border-indigo-500 shadow-sm hover:shadow-md transition-shadow duration-300 mb-6">
                            <h4 class="font-semibold text-indigo-800 mb-3">Key Points</h4>
                            <ul class="list-disc pl-6 space-y-2 text-gray-700">
                                <li>Group 2 metals react with oxygen when heated</li>
                                <li>Form oxides (MO) when heated in oxygen</li>
                            </ul>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                            <div class="bg-gradient-to-br from-blue-50 to-indigo-50 p-6 rounded-lg shadow-sm hover:shadow-md transition-shadow duration-300">
                                <h5 class="font-semibold text-blue-800">Magnesium</h5>
                                <p class="text-blue-600">Forms MgO (oxide)</p>
                                <p class="equation text-sm mt-3">2Mg(s) + O(g)  2MgO(s)</p>
                                <button onclick="showReactionDetails('magnesium-oxygen')" class="btn btn-primary btn-sm mt-3">View Details</button>
                            </div>
                            <div class="bg-gradient-to-br from-green-50 to-emerald-50 p-6 rounded-lg shadow-sm hover:shadow-md transition-shadow duration-300">
                                <h5 class="font-semibold text-green-800">Calcium</h5>
                                <p class="text-green-600">Forms CaO (oxide)</p>
                                <p class="equation text-sm mt-3">2Ca(s) + O(g)  2CaO(s)</p>
                                <button onclick="showReactionDetails('calcium-oxygen')" class="btn btn-primary btn-sm mt-3">View Details</button>
                            </div>
                            <div class="bg-gradient-to-br from-purple-50 to-pink-50 p-6 rounded-lg shadow-sm hover:shadow-md transition-shadow duration-300">
                                <h5 class="font-semibold text-purple-800">Barium</h5>
                                <p class="text-purple-600">Forms BaO (oxide)</p>
                                <p class="equation text-sm mt-3">2Ba(s) + O(g)  2BaO(s)</p>
                                <button onclick="showReactionDetails('barium-oxygen')" class="btn btn-primary btn-sm mt-3">View Details</button>
                            </div>
                        </div>
                        <div class="bg-gradient-to-r from-yellow-50 to-orange-50 p-6 rounded-lg border-l-4 border-orange-500 shadow-sm hover:shadow-md transition-shadow duration-300 mt-8">
                            <h4 class="font-semibold text-orange-800 mb-3">Trend in Oxide Formation</h4>
                            <p class="text-gray-700">All Group 2 metals form simple oxides (MO) when heated in oxygen. These oxides are basic and react with water to form metal hydroxides.</p>
                            <button onclick="showOxideTrendQuiz()" class="btn btn-primary btn-sm mt-3">Test Your Knowledge</button>
                        </div>
                    </div>
                    <!-- Reaction Details Modal -->
                    <div id="reactionDetailsModal" class="modal">
                        <div class="modal-content">
                            <div class="flex justify-between items-center mb-6">
                                <h2 class="text-2xl font-bold text-gray-800" id="reactionDetailsTitle">Reaction Details</h2>
                                <button onclick="closeReactionDetails()" class="text-gray-500 hover:text-gray-700 transform transition-all duration-300 hover:scale-110">
                                    <i class="fas fa-times text-xl"></i>
                                </button>
                            </div>
                            <div class="mb-6">
                                <div class="bg-gray-100 p-5 rounded-lg mb-5">
                                    <h3 class="font-semibold text-gray-800 mb-3">Chemical Equation</h3>
                                    <p class="equation text-lg" id="reactionDetailsEquation"></p>
                                </div>
                                <div class="bg-gray-100 p-5 rounded-lg mb-5">
                                    <h3 class="font-semibold text-gray-800 mb-3">Observations</h3>
                                    <p id="reactionDetailsObservations"></p>
                                </div>
                                <div class="bg-gray-100 p-5 rounded-lg mb-5">
                                    <h3 class="font-semibold text-gray-800 mb-3">Explanation</h3>
                                    <p id="reactionDetailsExplanation"></p>
                                </div>
                                <div class="bg-blue-50 p-5 rounded-lg border-l-4 border-blue-500">
                                    <h4 class="font-semibold text-blue-800 mb-3">Quick Quiz</h4>
                                    <p id="reactionDetailsQuizQuestion"></p>
                                    <div id="reactionDetailsQuizOptions" class="mt-3 space-y-2"></div>
                                    <div id="reactionDetailsQuizFeedback" class="mt-3 p-3 rounded-lg hidden"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="flex justify-center mt-6">
                        <button id="reactions-complete-btn" class="btn btn-success section-complete-btn transform transition-all duration-300 hover:scale-105" onclick="completeSection('reactions')">
                            <i class="fas fa-check mr-2"></i>
                            Mark as Complete
                        </button>
                    </div>
                </div>
            </section>
            <!-- Quiz Section -->
            <section id="quiz-section" class="content-section" style="display: none;">
                <div class="content-card">
                    <h3 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                        <i class="fas fa-graduation-cap mr-3 text-indigo-600 transform transition-all duration-300 hover:scale-110"></i>
                        Test Your Knowledge
                    </h3>
                    <div class="bg-gradient-to-r from-indigo-50 to-purple-50 p-8 rounded-lg border-l-4 border-indigo-500 shadow-sm hover:shadow-md transition-shadow duration-300 mb-8">
                        <div class="flex items-center mb-6">
                            <i class="fas fa-info-circle text-indigo-600 text-3xl mr-4"></i>
                            <div>
                                <h4 class="font-semibold text-indigo-800">Quiz Instructions</h4>
                                <p class="text-gray-700">This quiz contains 10 multiple-choice questions about Group 2 Alkaline Earth Metals. Take your time to answer each question carefully. You can navigate between questions using the Previous and Next buttons.</p>
                            </div>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mt-6">
                            <div class="bg-white p-5 rounded-lg shadow-sm">
                                <div class="text-3xl font-bold text-indigo-600">10</div>
                                <div class="text-sm text-gray-600">Questions</div>
                            </div>
                            <div class="bg-white p-5 rounded-lg shadow-sm">
                                <div class="text-3xl font-bold text-indigo-600">5 min</div>
                                <div class="text-sm text-gray-600">Time Limit</div>
                            </div>
                            <div class="bg-white p-5 rounded-lg shadow-sm">
                                <div class="text-3xl font-bold text-indigo-600">80%</div>
                                <div class="text-sm text-gray-600">Passing Score</div>
                            </div>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
                        <div class="bg-gradient-to-br from-green-50 to-emerald-50 p-6 rounded-lg shadow-sm hover:shadow-md transition-shadow duration-300">
                            <h4 class="font-semibold text-green-800 mb-3 flex items-center">
                                <i class="fas fa-trophy mr-2"></i> Rewards
                            </h4>
                            <ul class="space-y-3 text-gray-700">
                                <li class="flex items-start">
                                    <i class="fas fa-star text-yellow-500 mt-1 mr-3"></i>
                                    <span>Earn up to 20 XP points</span>
                                </li>
                                <li class="flex items-start">
                                    <i class="fas fa-medal text-yellow-500 mt-1 mr-3"></i>
                                    <span>Unlock "Quiz Master" badge with 80%+ score</span>
                                </li>
                                <li class="flex items-start">
                                    <i class="fas fa-certificate text-yellow-500 mt-1 mr-3"></i>
                                    <span>Get completion certificate</span>
                                </li>
                            </ul>
                        </div>
                        <div class="bg-gradient-to-br from-blue-50 to-indigo-50 p-6 rounded-lg shadow-sm hover:shadow-md transition-shadow duration-300">
                            <h4 class="font-semibold text-blue-800 mb-3 flex items-center">
                                <i class="fas fa-lightbulb mr-2"></i> Tips
                            </h4>
                            <ul class="space-y-3 text-gray-700">
                                <li class="flex items-start">
                                    <i class="fas fa-check-circle text-green-500 mt-1 mr-3"></i>
                                    <span>Review all sections before attempting</span>
                                </li>
                                <li class="flex items-start">
                                    <i class="fas fa-check-circle text-green-500 mt-1 mr-3"></i>
                                    <span>Pay attention to trends down the group</span>
                                </li>
                                <li class="flex items-start">
                                    <i class="fas fa-check-circle text-green-500 mt-1 mr-3"></i>
                                    <span>Remember the exceptions (like beryllium's reactivity)</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <div class="text-center">
                        <button onclick="startQuiz()" class="btn btn-primary transform transition-all duration-300 hover:scale-105">
                            <i class="fas fa-play mr-2"></i>
                            Start Quiz
                        </button>
                    </div>
                </div>
            </section>
            <!-- Discussion Section -->
            <section id="discussion-section" class="content-section" style="display: none;">
                <div class="content-card">
                    <div class="flex justify-between items-center mb-8">
                        <h3 class="text-2xl font-bold text-gray-800 flex items-center">
                            <i class="fas fa-comments mr-3 text-indigo-600 transform transition-all duration-300 hover:scale-110"></i>
                            Discussion Forum
                        </h3>
                        <button onclick="showCreatePostModal()" class="btn btn-primary transform transition-all duration-300 hover:scale-105">
                            <i class="fas fa-plus mr-2"></i>
                            New Post
                        </button>
                    </div>
                    <!-- Discussion Controls -->
                    <div class="flex flex-col md:flex-row gap-4 mb-8">
                        <div class="search-box flex-1">
                            <i class="fas fa-search"></i>
                            <input type="text" id="discussionSearch" placeholder="Search discussions..." onkeyup="filterDiscussions()">
                        </div>
                        <div class="flex gap-3">
                            <button class="filter-btn active px-5 py-2 bg-indigo-600 text-white rounded-lg" onclick="sortDiscussions('newest')">Newest</button>
                            <button class="filter-btn px-5 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300" onclick="sortDiscussions('oldest')">Oldest</button>
                            <button class="filter-btn px-5 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300" onclick="sortDiscussions('popular')">Most Popular</button>
                        </div>
                    </div>
                    <div id="discussionPosts">
                        <div class="empty-state">
                            <div class="empty-state-icon">
                                <i class="fas fa-comments"></i>
                            </div>
                            <h3 class="empty-state-title">No Posts Yet</h3>
                            <p class="empty-state-description">Be the first to start a discussion about Group 2 Alkaline Earth Metals.</p>
                        </div>
                    </div>
                </div>
            </section>
            <!-- Study Groups Section -->
            <section id="study-groups-section" class="content-section" style="display: none;">
                <div class="content-card">
                    <div class="flex justify-between items-center mb-8">
                        <h3 class="text-2xl font-bold text-gray-800 flex items-center">
                            <i class="fas fa-users mr-3 text-indigo-600 transform transition-all duration-300 hover:scale-110"></i>
                            Study Groups
                        </h3>
                        <button onclick="showCreateGroupModal()" class="btn btn-primary transform transition-all duration-300 hover:scale-105">
                            <i class="fas fa-plus mr-2"></i>
                            Create Group
                        </button>
                    </div>
                    <div id="studyGroupsList">
                        <div class="empty-state">
                            <div class="empty-state-icon">
                                <i class="fas fa-users"></i>
                            </div>
                            <h3 class="empty-state-title">No Study Groups Yet</h3>
                            <p class="empty-state-description">Create your first study group to collaborate with peers.</p>
                        </div>
                    </div>
                </div>
            </section>
            <!-- Leaderboard Section -->
            <section id="leaderboard-section" class="content-section" style="display: none;">
                <div class="content-card">
                    <h3 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                        <i class="fas fa-trophy mr-3 text-indigo-600 transform transition-all duration-300 hover:scale-110"></i>
                        Leaderboard
                    </h3>
                    <div id="leaderboardContent">
                        <div class="spinner"></div>
                    </div>
                </div>
            </section>
        </main>
        <!-- Feedback Button -->
        <button class="feedback-button" onclick="showFeedbackModal()" title="Leave Feedback">
            <i class="fas fa-comment-alt"></i>
        </button>
    </div>
    <!-- Login Modal -->
    <div id="loginModal" class="modal">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-8">
                <h2 class="text-2xl font-bold text-gray-800">Welcome to Chemistry Mastery</h2>
                <button onclick="closeLoginModal()" class="text-gray-500 hover:text-gray-700 transform transition-all duration-300 hover:scale-110">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <div class="mb-8">
                <button onclick="signInWithGoogle()" class="google-signin-btn">
                    <i class="fab fa-google"></i>
                    Sign in with Google
                </button>
            </div>
            <div class="text-center text-gray-600">
                <p>By signing in, you agree to our Terms of Service and Privacy Policy.</p>
            </div>
        </div>
    </div>
    <!-- Quiz Modal -->
    <div id="quizModal" class="modal quiz-modal">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl font-bold text-gray-800">Group 2 Quiz</h2>
                <button onclick="closeQuiz()" class="text-gray-500 hover:text-gray-700 transform transition-all duration-300 hover:scale-110">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <div id="quizProgress" class="mb-6">
                <div class="flex justify-between items-center mb-3">
                    <span class="text-sm text-gray-600">Question <span id="currentQuestion">1</span> of <span id="totalQuestions">10</span></span>
                    <span class="text-sm text-gray-600">Score: <span id="currentScore">0</span></span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill" style="width: 10%"></div>
                </div>
            </div>
            <div id="quizContent">
                <div class="mb-8">
                    <h3 class="text-lg font-semibold mb-5" id="questionText">Loading question...</h3>
                    <div id="optionsContainer"></div>
                </div>
                <div id="feedback" class="hidden mb-5 p-4 rounded-lg text-sm"></div>
                <div class="flex justify-between items-center">
                    <button id="prevButton" class="btn btn-secondary hidden" onclick="previousQuestion()">
                        <i class="fas fa-arrow-left"></i>
                        Previous
                    </button>
                    <div class="flex gap-3">
                        <button id="submitButton" class="btn btn-primary" onclick="submitAnswer()">
                            Submit Answer
                        </button>
                        <button id="nextButton" class="btn btn-primary hidden" onclick="nextQuestion()">
                            Next
                            <i class="fas fa-arrow-right ml-1"></i>
                        </button>
                    </div>
                </div>
            </div>
            <div id="quizResults" class="hidden text-center">
                <i class="fas fa-trophy text-5xl text-yellow-500 mb-6"></i>
                <h3 class="text-2xl font-bold mb-4">Quiz Complete!</h3>
                <div class="text-4xl font-bold text-indigo-600 mb-4" id="finalScore">0/10</div>
                <p class="text-gray-600 mb-8" id="scoreMessage">Great job!</p>
                <button onclick="closeQuiz()" class="btn btn-primary transform transition-all duration-300 hover:scale-105">
                    <i class="fas fa-check"></i>
                    Finish
                </button>
            </div>
        </div>
    </div>
    <!-- Feedback Modal -->
    <div id="feedbackModal" class="modal">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-8">
                <h2 class="text-2xl font-bold text-gray-800">Send Feedback</h2>
                <button onclick="closeFeedbackModal()" class="text-gray-500 hover:text-gray-700 transform transition-all duration-300 hover:scale-110">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <form id="feedbackForm" class="space-y-5" onsubmit="handleFeedback(event)">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Your Feedback</label>
                    <textarea id="feedbackText" class="w-full px-5 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 form-textarea" placeholder="What do you think about this app?" required></textarea>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Rate your experience</label>
                    <div class="reaction-buttons">
                        <button type="button" class="reaction-btn" id="thumbsDownBtn" onclick="setFeedbackRating(1)">
                            <i class="fas fa-thumbs-down"></i>
                            <span>Thumbs Down</span>
                        </button>
                        <button type="button" class="reaction-btn" id="thumbsUpBtn" onclick="setFeedbackRating(2)">
                            <i class="fas fa-thumbs-up"></i>
                            <span>Thumbs Up</span>
                        </button>
                    </div>
                    <input type="hidden" id="feedbackRating" value="0">
                </div>
                <button type="submit" class="btn btn-primary w-full transform transition-all duration-300 hover:scale-105">
                    <i class="fas fa-paper-plane mr-2"></i>
                    Send Feedback
                </button>
            </form>
        </div>
    </div>
    <!-- Daily Challenge Modal -->
    <div id="dailyChallengeModal" class="modal">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-8">
                <h2 class="text-2xl font-bold text-gray-800">Daily Challenge</h2>
                <button onclick="closeDailyChallengeModal()" class="text-gray-500 hover:text-gray-700 transform transition-all duration-300 hover:scale-110">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <div class="mb-6">
                <h3 class="text-lg font-semibold mb-4" id="dailyChallengeQuestionText">Loading daily challenge...</h3>
                <div id="dailyChallengeOptions"></div>
            </div>
            <div id="dailyChallengeFeedback" class="hidden mb-5 p-4 rounded-lg text-sm"></div>
            <div class="flex justify-between items-center">
                <button onclick="closeDailyChallengeModal()" class="btn btn-secondary transform transition-all duration-300 hover:scale-105">
                    Skip
                </button>
                <button id="dailyChallengeSubmitBtn" class="btn btn-primary transform transition-all duration-300 hover:scale-105" onclick="submitDailyChallenge()">
                    Submit Answer
                </button>
            </div>
        </div>
    </div>
    <!-- Quiz Question Modal -->
    <div id="quizQuestionModal" class="modal quiz-question-modal">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-8">
                <h2 class="text-2xl font-bold text-gray-800" id="quizQuestionTitle">Quick Quiz</h2>
                <button onclick="closeQuizQuestionModal()" class="text-gray-500 hover:text-gray-700 transform transition-all duration-300 hover:scale-110">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <div class="mb-8">
                <div class="quiz-question" id="quizQuestionText">Loading question...</div>
                <div id="quizQuestionAnswers"></div>
                <div id="quizQuestionFeedback" class="quiz-feedback hidden"></div>
            </div>
            <div class="flex justify-end">
                <button onclick="closeQuizQuestionModal()" class="btn btn-secondary mr-3 transform transition-all duration-300 hover:scale-105">
                    Close
                </button>
            </div>
        </div>
    </div>
    <!-- Create Post Modal -->
    <div id="createPostModal" class="modal">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-8">
                <h2 class="text-2xl font-bold text-gray-800">Create New Post</h2>
                <button onclick="closeCreatePostModal()" class="text-gray-500 hover:text-gray-700 transform transition-all duration-300 hover:scale-110">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <form id="createPostForm" onsubmit="handleCreatePost(event)" class="space-y-5">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Post Title</label>
                    <input type="text" id="postTitle" class="w-full px-5 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" placeholder="Enter your post title..." required>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Content</label>
                    <textarea id="postContent" class="w-full px-5 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 form-textarea" placeholder="Share your thoughts..." required></textarea>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Tags (comma separated)</label>
                    <input type="text" id="postTags" class="w-full px-5 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" placeholder="e.g., homework, questions, magnesium">
                </div>
                <button type="submit" class="btn btn-primary w-full transform transition-all duration-300 hover:scale-105">
                    <i class="fas fa-paper-plane mr-2"></i>
                    Create Post
                </button>
            </form>
        </div>
    </div>
    <!-- Edit Post Modal -->
    <div id="editPostModal" class="modal">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-8">
                <h2 class="text-2xl font-bold text-gray-800">Edit Post</h2>
                <button onclick="closeEditPostModal()" class="text-gray-500 hover:text-gray-700 transform transition-all duration-300 hover:scale-110">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <form id="editPostForm" onsubmit="handleEditPost(event)" class="space-y-5">
                <input type="hidden" id="editPostId">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Post Title</label>
                    <input type="text" id="editPostTitle" class="w-full px-5 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" required>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Content</label>
                    <textarea id="editPostContent" class="w-full px-5 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 form-textarea" required></textarea>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Tags (comma separated)</label>
                    <input type="text" id="editPostTags" class="w-full px-5 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                </div>
                <button type="submit" class="btn btn-primary w-full transform transition-all duration-300 hover:scale-105">
                    <i class="fas fa-save mr-2"></i>
                    Save Changes
                </button>
            </form>
        </div>
    </div>
    <!-- Create Group Modal -->
    <div id="createGroupModal" class="modal">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-8">
                <h2 class="text-2xl font-bold text-gray-800">Create Study Group</h2>
                <button onclick="closeCreateGroupModal()" class="text-gray-500 hover:text-gray-700 transform transition-all duration-300 hover:scale-110">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <form id="createGroupForm" onsubmit="handleCreateGroup(event)" class="space-y-5">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Group Name</label>
                    <input type="text" id="groupName" class="w-full px-5 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" placeholder="Enter group name..." required>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Topic</label>
                    <select id="groupTopic" class="w-full px-5 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" required>
                        <option value="">Select a topic</option>
                        <option value="melting-point">Melting Point Trends</option>
                        <option value="density">Density Trends</option>
                        <option value="reactivity">Reactivity Series</option>
                        <option value="reactions">Chemical Reactions</option>
                        <option value="electron-configuration">Electron Configuration</option>
                        <option value="experiments">Laboratory Experiments</option>
                        <option value="exam-prep">Exam Preparation</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Description</label>
                    <textarea id="groupDescription" class="w-full px-5 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 form-textarea" placeholder="Describe your study group..." required></textarea>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Maximum Members</label>
                    <input type="number" id="groupMaxMembers" class="w-full px-5 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" min="2" max="20" value="10" required>
                </div>
                <button type="submit" class="btn btn-primary w-full transform transition-all duration-300 hover:scale-105">
                    <i class="fas fa-users mr-2"></i>
                    Create Group
                </button>
            </form>
        </div>
    </div>
    <!-- Group Details Modal -->
    <div id="groupDetailsModal" class="modal">
        <div class="modal-content">
            <div id="groupDetailsContent">
                <!-- Content will be populated dynamically -->
            </div>
        </div>
    </div>
    <!-- Toast Container -->
    <div id="toastContainer"></div>
    <script>// Firebase configuration
const firebaseConfig = {
    apiKey: "AIzaSyBOp4x0lTFvmt2s3MQKBRYmZT9IJ2ZaRi8",
    authDomain: "group-1-alkali-metals.firebaseapp.com",
    databaseURL: "https://group-1-alkali-metals-default-rtdb.firebaseio.com",
    projectId: "group-1-alkali-metals",
    storageBucket: "group-1-alkali-metals.firebasestorage.app",
    messagingSenderId: "806417495419",
    appId: "1:806417495419:web:5b80607e8a23e96da4f9de",
    measurementId: "G-S76E52MQ37"
};

// Initialize Firebase
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const database = firebase.database();

// Create a reference to the "Group 2 Metals" subset
const group2MetalsRef = database.ref('Group2Metals');

// Global variables
let currentUser = null;
let userData = null;
let currentSection = 'overview';
let completedSections = [];
let quizQuestions = [];
let currentQuestion = 0;
let score = 0;
let selectedOption = null;
let answerSubmitted = false;
let quizAnswers = [];
let discussionPosts = [];
let studyGroups = [];
let currentSort = 'newest';
let soundEnabled = true;
let dailyChallenge = null;
let dailyChallengeAnswered = false;
let mainChart = null;
let currentGraphType = 'line';
let selectedElements = ['Be', 'Mg', 'Ca', 'Sr', 'Ba', 'Ra'];
let activeProperties = ['melting-point', 'density']; // Start with melting point and density active

// Element data for graphs
const elementData = {
    'Be': { name: 'Beryllium', atomicNumber: 4, meltingPoint: 1287, density: 1.85, reactivity: 1, atomicRadius: 112 },
    'Mg': { name: 'Magnesium', atomicNumber: 12, meltingPoint: 650, density: 1.74, reactivity: 2, atomicRadius: 150 },
    'Ca': { name: 'Calcium', atomicNumber: 20, meltingPoint: 842, density: 1.55, reactivity: 3, atomicRadius: 180 },
    'Sr': { name: 'Strontium', atomicNumber: 38, meltingPoint: 777, density: 2.64, reactivity: 4, atomicRadius: 200 },
    'Ba': { name: 'Barium', atomicNumber: 56, meltingPoint: 727, density: 3.62, reactivity: 5, atomicRadius: 215 },
    'Ra': { name: 'Radium', atomicNumber: 88, meltingPoint: 700, density: 5.5, reactivity: 6, atomicRadius: 221 }
};

// Property configuration for graph
const propertyConfig = {
    'melting-point': {
        label: 'Melting Point (C)',
        color: '#3b82f6',
        yAxisID: 'y'
    },
    'density': {
        label: 'Density (g/cm)',
        color: '#8b5cf6',
        yAxisID: 'y'
    },
    'reactivity': {
        label: 'Reactivity Level',
        color: '#10b981',
        yAxisID: 'y'
    },
    'atomic-radius': {
        label: 'Atomic Radius (pm)',
        color: '#f59e0b',
        yAxisID: 'y'
    }
};

// Quiz questions for terms
const termQuizQuestions = {
    'beryllium': {
        question: "What is the atomic number of Beryllium?",
        options: ["2", "3", "4", "5"],
        correct: 2,
        explanation: "Beryllium has an atomic number of 4, meaning it has 4 protons in its nucleus."
    },
    'magnesium': {
        question: "What color flame does Magnesium produce when burned?",
        options: ["Red", "Yellow", "Green", "Bright white"],
        correct: 3,
        explanation: "Magnesium produces a bright white flame when burned, which is why it's used in fireworks and flares."
    },
    'calcium': {
        question: "How does Calcium react with cold water?",
        options: ["No reaction", "Fizzes slowly", "Fizzes steadily", "Fizzes violently"],
        correct: 2,
        explanation: "Calcium reacts steadily with cold water, producing calcium hydroxide and hydrogen gas."
    },
    'alkaline-earth-metals': {
        question: "Why are Group 2 elements called alkaline earth metals?",
        options: ["They are alkaline in nature", "They form alkaline solutions with water", "Their oxides form alkaline solutions in water", "They react with alkalis"],
        correct: 2,
        explanation: "Group 2 elements are called alkaline earth metals because their oxides react with water to form alkaline (basic) solutions."
    },
    'valence-electrons': {
        question: "How many valence electrons do Group 2 elements have?",
        options: ["1", "2", "3", "7"],
        correct: 1,
        explanation: "All Group 2 elements have 2 valence electrons in their outer shell, which they readily lose to form +2 ions."
    },
    'hardness': {
        question: "How do Group 2 metals compare to Group 1 metals in terms of hardness?",
        options: ["Softer than Group 1", "Harder than Group 1", "Same hardness", "Variable hardness"],
        correct: 1,
        explanation: "Group 2 metals are harder than Group 1 metals due to stronger metallic bonding from higher charge density."
    },
    'melting-point': {
        question: "Which Group 2 metal has the highest melting point?",
        options: ["Beryllium", "Magnesium", "Calcium", "Barium"],
        correct: 0,
        explanation: "Beryllium has the highest melting point (1287C) due to its small atomic size and strong metallic bonding."
    },
    'density': {
        question: "How does density generally change down Group 2?",
        options: ["Decreases", "Increases", "Remains constant", "Varies randomly"],
        correct: 1,
        explanation: "Density generally increases down Group 2 as atomic mass increases more significantly than atomic volume."
    },
    'reactivity': {
        question: "Which Group 2 metal is the most reactive?",
        options: ["Beryllium", "Magnesium", "Calcium", "Barium"],
        correct: 3,
        explanation: "Reactivity increases down Group 2, making Barium the most reactive element in the group."
    },
    'flame-test': {
        question: "What flame color does Calcium produce?",
        options: ["Red", "Yellow", "Green", "Brick-red"],
        correct: 3,
        explanation: "Calcium produces a brick-red flame in flame tests, which is characteristic of calcium ions."
    }
};

// Trend quiz questions
const trendQuizQuestions = {
    'melting-point': {
        question: "Why does melting point generally decrease down Group 2?",
        options: [
            "Atomic size increases, metallic bonds weaken",
            "Atomic size decreases, metallic bonds strengthen",
            "Electron configuration changes",
            "Nuclear charge increases"
        ],
        correct: 0,
        explanation: "As we move down Group 2, atomic size increases due to additional electron shells. This increases the distance between positive nuclei and delocalized electrons, weakening the metallic bonds and lowering the melting point."
    },
    'density': {
        question: "Why does density increase down Group 2?",
        options: [
            "Atomic mass increases more than atomic volume",
            "Atomic volume increases more than atomic mass",
            "Crystal structure changes",
            "Electron configuration changes"
        ],
        correct: 0,
        explanation: "Density increases down Group 2 because the increase in atomic mass is proportionally greater than the increase in atomic volume."
    },
    'reactivity': {
        question: "Why does reactivity increase down Group 2?",
        options: [
            "Nuclear charge increases",
            "Atomic radius increases, making it easier to lose outer electrons",
            "Electron shielding decreases",
            "Ionization energy increases"
        ],
        correct: 1,
        explanation: "As we move down Group 2, the atomic radius increases due to additional electron shells. The outer electrons are further from the nucleus and experience more shielding, making them easier to lose and increasing reactivity."
    }
};

// Element details
const elementDetails = {
    'Beryllium': {
        symbol: 'Be',
        atomicNumber: 4,
        electronConfig: '2,2',
        meltingPoint: '1287C',
        density: '1.85 g/cm',
        reactivity: 'Lowest in group',
        uses: 'Aerospace alloys, X-ray windows, nuclear reactors',
        fact: 'Beryllium is transparent to X-rays and is used in X-ray windows.',
        quizQuestion: "What is the primary use of Beryllium in aerospace applications?",
        quizOptions: [
            "Fuel for rockets",
            "Lightweight structural alloys",
            "Thermal insulation",
            "Electrical wiring"
        ],
        quizCorrect: 1,
        quizExplanation: "Beryllium is used in lightweight structural alloys for aerospace applications due to its high strength-to-weight ratio and stiffness."
    },
    'Magnesium': {
        symbol: 'Mg',
        atomicNumber: 12,
        electronConfig: '2,8,2',
        meltingPoint: '650C',
        density: '1.74 g/cm',
        reactivity: 'Moderate',
        uses: 'Alloys, fireworks, medicine',
        fact: 'Magnesium is essential for human health and is involved in over 300 biochemical reactions.',
        quizQuestion: "What compound of Magnesium is commonly used as a supplement?",
        quizOptions: [
            "Magnesium hydroxide",
            "Magnesium carbonate",
            "Magnesium oxide",
            "Magnesium sulfate"
        ],
        quizCorrect: 2,
        quizExplanation: "Magnesium oxide is commonly used as a dietary supplement to prevent and treat low levels of magnesium in the blood."
    },
    'Calcium': {
        symbol: 'Ca',
        atomicNumber: 20,
        electronConfig: '2,8,8,2',
        meltingPoint: '842C',
        density: '1.55 g/cm',
        reactivity: 'Moderate to high',
        uses: 'Building materials, cement, bones',
        fact: 'Calcium is the most abundant mineral in the human body and is essential for bone health.',
        quizQuestion: "Why is Calcium important for the human body?",
        quizOptions: [
            "It strengthens bones and teeth",
            "It aids in muscle contraction and nerve function",
            "It helps in blood clotting",
            "All of the above"
        ],
        quizCorrect: 3,
        quizExplanation: "Calcium is essential for all these functions: strengthening bones and teeth, muscle contraction, nerve function, and blood clotting."
    },
    'Strontium': {
        symbol: 'Sr',
        atomicNumber: 38,
        electronConfig: '2,8,18,8,2',
        meltingPoint: '777C',
        density: '2.64 g/cm',
        reactivity: 'High',
        uses: 'Fireworks, ceramics, magnets',
        fact: 'Strontium-90 is a radioactive isotope used in medical applications and nuclear power.',
        quizQuestion: "What is Strontium primarily used for in fireworks?",
        quizOptions: [
            "Creating white sparks",
            "Creating red color",
            "Creating blue color",
            "Creating sound effects"
        ],
        quizCorrect: 1,
        quizExplanation: "Strontium compounds are used in fireworks to create a brilliant red color due to their characteristic crimson flame."
    },
    'Barium': {
        symbol: 'Ba',
        atomicNumber: 56,
        electronConfig: '2,8,18,18,8,2',
        meltingPoint: '727C',
        density: '3.62 g/cm',
        reactivity: 'Very high',
        uses: 'Medical imaging, drilling fluids, vacuum tubes',
        fact: 'Barium sulfate is used in medical imaging because it\'s opaque to X-rays but safe to ingest.',
        quizQuestion: "Why is Barium sulfate used in medical imaging?",
        quizOptions: [
            "It\'s radioactive and can be tracked",
            "It\'s opaque to X-rays but safe to ingest",
            "It enhances MRI contrast",
            "It\'s fluorescent under UV light"
        ],
        quizCorrect: 1,
        quizExplanation: "Barium sulfate is used in medical imaging because it\'s opaque to X-rays, allowing doctors to see the digestive tract, but it\'s insoluble and safe to ingest."
    },
    'Radium': {
        symbol: 'Ra',
        atomicNumber: 88,
        electronConfig: '2,8,18,32,18,8,2',
        meltingPoint: '700C',
        density: '5.5 g/cm',
        reactivity: 'Highest',
        uses: 'Cancer treatment, research',
        fact: 'Radium is highly radioactive and was discovered by Marie and Pierre Curie in 1898.',
        quizQuestion: "Why is Radium rarely used today?",
        quizOptions: [
            "It\'s too expensive to extract",
            "It\'s highly radioactive and dangerous",
            "It\'s not reactive enough",
            "It\'s toxic to humans"
        ],
        quizCorrect: 1,
        quizExplanation: "Radium is highly radioactive and dangerous to handle, which limits its use to specialized medical and research applications."
    }
};

// Reaction details
const reactionDetails = {
    'magnesium-water': {
        equation: "Mg(s) + 2HO(l)  Mg(OH)(aq) + H(g)",
        observations: "Magnesium reacts very slowly with cold water, but reacts readily with steam to produce magnesium oxide and hydrogen gas.",
        explanation: "Magnesium has a protective oxide layer that prevents reaction with cold water. When heated or reacted with steam, this layer is disrupted and the reaction proceeds.",
        quizQuestion: "Why does Magnesium react slowly with cold water?",
        quizOptions: [
            "It has a protective oxide layer",
            "It\'s not reactive enough",
            "Water is not a strong enough reactant",
            "Magnesium is too stable"
        ],
        quizCorrect: 0,
        quizExplanation: "Magnesium has a protective oxide layer on its surface that prevents reaction with cold water. This layer must be disrupted for the reaction to occur."
    },
    'calcium-water': {
        equation: "Ca(s) + 2HO(l)  Ca(OH)(aq) + H(g)",
        observations: "Calcium fizzes steadily in cold water, producing bubbles of hydrogen gas. The solution becomes milky due to calcium hydroxide.",
        explanation: "Calcium reacts with cold water to produce calcium hydroxide and hydrogen gas. The reaction is more vigorous than magnesium but less than heavier Group 2 metals.",
        quizQuestion: "What makes the solution milky when Calcium reacts with water?",
        quizOptions: [
            "Calcium oxide",
            "Calcium hydroxide",
            "Hydrogen gas",
            "Calcium carbonate"
        ],
        quizCorrect: 1,
        quizExplanation: "Calcium hydroxide is slightly soluble in water, creating a milky suspension that gives the solution its characteristic appearance."
    },
    'barium-water': {
        equation: "Ba(s) + 2HO(l)  Ba(OH)(aq) + H(g)",
        observations: "Barium reacts vigorously with water, producing hydrogen gas rapidly. The reaction is exothermic and can be explosive.",
        explanation: "Barium is highly reactive due to its large atomic size and low ionization energy. It readily loses its two valence electrons to form Ba ions.",
        quizQuestion: "Why is Barium more reactive than Calcium?",
        options: [
            "It has more protons",
            "It has a larger atomic radius",
            "It has more electron shells",
            "It has a higher density"
        ],
        correct: 1,
        explanation: "Barium has a larger atomic radius than calcium, making its outer electrons easier to lose, which increases its reactivity."
    },
    'magnesium-oxygen': {
        equation: "2Mg(s) + O(g)  2MgO(s)",
        observations: "Magnesium burns with a bright white flame to form white magnesium oxide powder.",
        explanation: "Magnesium reacts with oxygen to form magnesium oxide. The reaction is highly exothermic and produces a characteristic bright white light.",
        quizQuestion: "What color flame does Magnesium produce when burned?",
        options: [
            "Red",
            "Yellow",
            "Green",
            "Bright white"
        ],
        correct: 3,
        quizExplanation: "Magnesium produces a bright white flame when burned due to the high temperature of the reaction and the properties of magnesium oxide."
    },
    'calcium-oxygen': {
        equation: "2Ca(s) + O(g)  2CaO(s)",
        observations: "Calcium burns with an orange-red flame to form white calcium oxide.",
        explanation: "Calcium reacts with oxygen to form calcium oxide. The reaction is less vigorous than magnesium but still produces a visible flame.",
        quizQuestion: "What product forms when Calcium burns in oxygen?",
        options: [
            "Calcium peroxide",
            "Calcium oxide",
            "Calcium superoxide",
            "Calcium hydroxide"
        ],
        correct: 1,
        quizExplanation: "Calcium forms calcium oxide (CaO) when burned in oxygen, which is a typical oxide formed by Group 2 metals."
    },
    'barium-oxygen': {
        equation: "Ba(s) + O(g)  BaO(s)",
        observations: "Barium burns with a greenish-white flame to form barium peroxide.",
        explanation: "Barium forms a peroxide (BaO) when burned in oxygen. This contains the peroxide ion (O) with an oxygen-oxygen single bond.",
        quizQuestion: "What type of oxide does Barium form when burned in excess oxygen?",
        options: [
            "Normal oxide (BaO)",
            "Peroxide (BaO)",
            "Superoxide (BaO)",
            "No oxide is formed"
        ],
        correct: 1,
        quizExplanation: "Barium forms barium peroxide (BaO) when burned in oxygen, which contains the peroxide ion (O)."
    }
};

// All MCQ Quiz Questions
quizQuestions = [
    {
        question: "What is the electron configuration of the outer shell of all Group 2 elements?",
        options: ["1 electron", "2 electrons", "8 electrons", "Variable number of electrons"],
        correct: 1,
        explanation: "All Group 2 elements have two electrons in their outer shell, which they readily lose to form +2 ions."
    },
    {
        question: "Which of the following statements about the reactivity of Group 2 metals is correct?",
        options: ["Reactivity decreases down the group", "Reactivity increases down the group", "Reactivity stays the same down the group", "Reactivity is highest for beryllium"],
        correct: 1,
        explanation: "Reactivity increases down Group 2 because the outer electrons are further from the nucleus and easier to lose."
    },
    {
        question: "When Group 2 metals react with water, what products are formed?",
        options: ["Metal oxide and hydrogen", "Metal hydroxide and hydrogen", "Metal oxide and oxygen", "Metal hydroxide and oxygen"],
        correct: 1,
        explanation: "The general equation is: M(s) + 2HO(l)  M(OH)(aq) + H(g)"
    },
    {
        question: "Which Group 2 metal does not react with water at room temperature?",
        options: ["Beryllium", "Magnesium", "Calcium", "Barium"],
        correct: 0,
        explanation: "Beryllium does not react with water at room temperature due to its protective oxide layer and high ionization energy."
    },
    {
        question: "What color flame does calcium produce in a flame test?",
        options: ["Red", "Yellow", "Green", "Brick-red"],
        correct: 3,
        explanation: "Calcium produces a brick-red flame in flame tests, which is characteristic of calcium ions."
    },
    {
        question: "Which statement about the melting point of Group 2 metals is correct?",
        options: ["Melting point increases down the group", "Melting point decreases down the group", "Melting point is highest for barium", "Melting point is constant across the group"],
        correct: 1,
        explanation: "The melting point decreases down Group 2 due to increasing atomic size and weaker metallic bonding."
    },
    {
        question: "Which Group 2 metal is used in medical imaging as a contrast agent?",
        options: ["Beryllium", "Magnesium", "Calcium", "Barium"],
        correct: 3,
        explanation: "Barium sulfate is used as a contrast agent in medical imaging because it's opaque to X-rays but safe to ingest."
    },
    {
        question: "What happens when magnesium ribbon is burned in oxygen?",
        options: ["It produces a red flame and forms MgO", "It produces a bright white flame and forms MgO", "It produces a green flame and forms MgO", "It doesn't burn in oxygen"],
        correct: 1,
        explanation: "Magnesium burns with a bright white flame in oxygen to form white magnesium oxide powder."
    },
    {
        question: "Which Group 2 metal is essential for plant growth?",
        options: ["Beryllium", "Magnesium", "Strontium", "Barium"],
        correct: 1,
        explanation: "Magnesium is essential for plant growth as it's the central atom in chlorophyll, the molecule responsible for photosynthesis."
    },
    {
        question: "Which Group 2 metal is used in fireworks to produce a red color?",
        options: ["Beryllium", "Magnesium", "Strontium", "Barium"],
        correct: 2,
        explanation: "Strontium compounds are used in fireworks to produce a brilliant red color due to their characteristic crimson flame."
    }
];

// Daily challenges
const dailyChallenges = [
    {
        question: "Which Group 2 metal is used in medical imaging as a contrast agent?",
        options: ["Beryllium", "Magnesium", "Calcium", "Barium"],
        correct: 3,
        explanation: "Barium sulfate is used as a contrast agent in medical imaging because it's opaque to X-rays but safe to ingest."
    },
    {
        question: "What color flame does calcium produce when burned?",
        options: ["Red", "Yellow", "Green", "Brick-red"],
        correct: 3,
        explanation: "Calcium produces a brick-red flame in flame tests, which is characteristic of calcium ions."
    },
    {
        question: "Which Group 2 metal has the highest melting point?",
        options: ["Beryllium", "Magnesium", "Calcium", "Barium"],
        correct: 0,
        explanation: "Beryllium has the highest melting point (1287C) due to its small atomic size and strong metallic bonding."
    },
    {
        question: "What is the main use of magnesium in the human body?",
        options: ["Bone formation", "Muscle contraction", "Oxygen transport", "Energy production"],
        correct: 1,
        explanation: "Magnesium is essential for proper muscle contraction, nerve function, and maintaining fluid balance in the body."
    },
    {
        question: "Which Group 2 metal is essential for plant growth?",
        options: ["Beryllium", "Magnesium", "Strontium", "Barium"],
        correct: 1,
        explanation: "Magnesium is essential for plant growth as it's the central atom in chlorophyll, the molecule responsible for photosynthesis."
    }
];

// Graph quiz questions
const graphQuizQuestions = [
    {
        question: "Which element has the highest melting point?",
        options: ["Beryllium", "Magnesium", "Calcium", "Barium"],
        correct: 0,
        explanation: "Beryllium has the highest melting point at 1287C due to its small atomic size and strong metallic bonding."
    },
    {
        question: "What is the trend for density down Group 2?",
        options: ["Decreases", "Increases", "Remains constant", "No pattern"],
        correct: 1,
        explanation: "Density increases down Group 2 as atomic mass increases more significantly than atomic volume."
    },
    {
        question: "Which element is the most reactive?",
        options: ["Beryllium", "Magnesium", "Calcium", "Barium"],
        correct: 3,
        explanation: "Barium is the most reactive due to its large atomic radius and low ionization energy."
    }
];

// Initialize app
function initApp() {
    // Check authentication state
    auth.onAuthStateChanged((user) => {
        if (user) {
            currentUser = user;
            loadUserData();
        } else {
            showLandingPage();
        }
    });
    
    // Initialize search functionality
    document.getElementById('searchInput').addEventListener('input', function(e) {
        const searchTerm = e.target.value.toLowerCase();
        // We'll search through the content of the current section
        if (searchTerm === '') {
            // Show all content
            document.querySelectorAll('.content-card').forEach(card => {
                card.style.display = 'block';
            });
        } else {
            document.querySelectorAll('.content-card').forEach(card => {
                const text = card.textContent.toLowerCase();
                if (text.includes(searchTerm)) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        }
    });
    
    // Initialize periodic table interactions
    document.querySelectorAll('.element').forEach(element => {
        element.addEventListener('click', function() {
            const elementName = this.querySelector('.element-name').textContent;
            showToast('info', 'Element Info', `You clicked on ${elementName}`);
        });
    });
    
    // Add event listeners to all complete buttons
    const sections = ['overview', 'elements', 'properties', 'reactions', 'quiz'];
    sections.forEach(section => {
        const button = document.getElementById(`${section}-complete-btn`);
        if (button) {
            button.addEventListener('click', function() {
                completeSection(section);
            });
        }
    });
}

// Navigation functions
function navigateToSection(sectionName) {
    // Check if section is locked
    const navItem = document.getElementById(`nav-${sectionName}`);
    if (navItem && navItem.classList.contains('locked')) {
        showToast('info', 'Section Locked', 'Please complete previous sections first.');
        return;
    }
    
    // Hide all sections
    const sections = document.querySelectorAll('.content-section');
    sections.forEach(section => {
        section.style.display = 'none';
    });
    
    // Show selected section
    const sectionElement = document.getElementById(`${sectionName}-section`);
    if (sectionElement) {
        sectionElement.style.display = 'block';
    }
    
    // Update active nav item
    const navItems = document.querySelectorAll('.nav-item');
    navItems.forEach(item => {
        item.classList.remove('active');
    });
    
    if (navItem) {
        navItem.classList.add('active');
    }
    
    currentSection = sectionName;
    
    // Load leaderboard if that section is selected
    if (sectionName === 'leaderboard') {
        loadLeaderboard();
    }
    
    // Initialize graph if properties section is selected
    if (sectionName === 'properties') {
        setTimeout(() => {
            initializeGraph();
            populateDataTable();
            loadGraphQuiz();
        }, 100);
    }
}

// Show main app
function showMainApp() {
    document.getElementById('landingPage').style.display = 'none';
    document.getElementById('mainApp').style.display = 'block';
    
    // Update user info
    document.getElementById('userName').textContent = userData.displayName || 'User';
    document.getElementById('userEmail').textContent = currentUser.email || 'user@example.com';
    
    // Update XP and badges
    updateUserXP();
    updateUserBadges();
    
    // Update progress
    updateProgressTracker();
    updateSectionCompletionStatus();
    
    // Load discussion posts and study groups
    loadDiscussionPosts();
    loadStudyGroups();
    loadLeaderboard();
    
    // Check for daily challenge
    checkDailyChallenge();
}

// Load user data from Firebase
function loadUserData() {
    const userRef = group2MetalsRef.child('users').child(currentUser.uid);
    userRef.once('value').then((snapshot) => {
        if (snapshot.exists()) {
            userData = snapshot.val();
            completedSections = userData.completedSections || [];
            showMainApp();
        } else {
            // Create new user profile
            const newUser = {
                uid: currentUser.uid,
                email: currentUser.email,
                displayName: currentUser.displayName || 'User',
                completedSections: [],
                savedPosts: [],
                xp: 0,
                badges: [],
                createdAt: firebase.database.ServerValue.TIMESTAMP
            };
            
            userRef.set(newUser).then(() => {
                userData = newUser;
                completedSections = [];
                showMainApp();
            });
        }
    }).catch((error) => {
        console.error("Error loading user data:", error);
        showToast('error', 'Error', 'Failed to load your data.');
    });
}

// Show landing page
function showLandingPage() {
    document.getElementById('landingPage').style.display = 'flex';
    document.getElementById('mainApp').style.display = 'none';
}

// Update user XP display
function updateUserXP() {
    const xp = userData.xp || 0;
    document.getElementById('userXP').textContent = xp;
}

// Update user badges display
function updateUserBadges() {
    const badges = userData.badges || [];
    const badgesContainer = document.getElementById('userBadges');
    badgesContainer.innerHTML = '';
    
    if (badges.length === 0) {
        badgesContainer.innerHTML = '<span class="text-sm text-gray-500">No badges yet</span>';
        return;
    }
    
    badges.forEach(badge => {
        const badgeElement = document.createElement('div');
        badgeElement.className = 'badge';
        badgeElement.innerHTML = `<i class="fas fa-medal"></i>`;
        badgeElement.title = badge;
        badgesContainer.appendChild(badgeElement);
    });
}

// Check for daily challenge
function checkDailyChallenge() {
    const today = new Date().toISOString().split('T')[0];
    const challengeRef = group2MetalsRef.child('dailyChallenges').child(today);
    
    challengeRef.once('value').then((snapshot) => {
        if (snapshot.exists()) {
            dailyChallenge = snapshot.val();
            
            // Check if user has completed today's challenge
            const userChallengeRef = group2MetalsRef.child('users').child(currentUser.uid).child('dailyChallenges').child(today);
            userChallengeRef.once('value').then((userSnapshot) => {
                if (!userSnapshot.exists()) {
                    // Show daily challenge
                    document.getElementById('dailyChallenge').style.display = 'block';
                    document.getElementById('dailyChallengeQuestion').textContent = dailyChallenge.question;
                }
            });
        } else {
            // Create a new daily challenge for today
            const randomChallenge = dailyChallenges[Math.floor(Math.random() * dailyChallenges.length)];
            challengeRef.set(randomChallenge).then(() => {
                dailyChallenge = randomChallenge;
                document.getElementById('dailyChallenge').style.display = 'block';
                document.getElementById('dailyChallengeQuestion').textContent = dailyChallenge.question;
            });
        }
    });
}

// Show daily challenge modal
function showDailyChallengeModal() {
    if (!dailyChallenge) return;
    
    document.getElementById('dailyChallengeModal').classList.add('active');
    document.getElementById('dailyChallengeQuestionText').textContent = dailyChallenge.question;
    
    const optionsContainer = document.getElementById('dailyChallengeOptions');
    optionsContainer.innerHTML = '';
    
    dailyChallenge.options.forEach((option, index) => {
        const optionDiv = document.createElement('div');
        optionDiv.className = 'quiz-option';
        optionDiv.dataset.index = index;
        
        const input = document.createElement('input');
        input.type = 'radio';
        input.name = 'daily-challenge-option';
        input.id = `daily-option-${index}`;
        input.value = index;
        
        const label = document.createElement('label');
        label.htmlFor = `daily-option-${index}`;
        label.textContent = option;
        
        optionDiv.appendChild(input);
        optionDiv.appendChild(label);
        
        optionDiv.onclick = () => selectDailyChallengeOption(index);
        
        optionsContainer.appendChild(optionDiv);
    });
    
    // Reset feedback
    document.getElementById('dailyChallengeFeedback').classList.add('hidden');
    document.getElementById('dailyChallengeSubmitBtn').disabled = true;
    dailyChallengeAnswered = false;
}

// Close daily challenge modal
function closeDailyChallengeModal() {
    document.getElementById('dailyChallengeModal').classList.remove('active');
}

// Select daily challenge option
function selectDailyChallengeOption(index) {
    if (dailyChallengeAnswered) return;
    
    const options = document.querySelectorAll('#dailyChallengeOptions .quiz-option');
    options.forEach(option => {
        option.classList.remove('selected');
        const input = option.querySelector('input');
        input.checked = false;
    });
    
    options[index].classList.add('selected');
    options[index].querySelector('input').checked = true;
    
    document.getElementById('dailyChallengeSubmitBtn').disabled = false;
}

// Submit daily challenge
function submitDailyChallenge() {
    if (dailyChallengeAnswered) return;
    
    const selectedOption = document.querySelector('#dailyChallengeOptions .quiz-option.selected');
    if (!selectedOption) return;
    
    const selectedIndex = parseInt(selectedOption.dataset.index);
    const isCorrect = selectedIndex === dailyChallenge.correct;
    
    const feedback = document.getElementById('dailyChallengeFeedback');
    if (isCorrect) {
        feedback.className = 'mb-5 p-4 rounded-lg bg-green-100 text-green-800 text-sm';
        feedback.textContent = 'Correct! ' + dailyChallenge.explanation;
        
        // Award XP
        const newXp = (userData.xp || 0) + 5;
        const userRef = group2MetalsRef.child('users').child(currentUser.uid);
        userRef.update({
            xp: newXp
        }).then(() => {
            userData.xp = newXp;
            updateUserXP();
            
            if (soundEnabled) correctSound.play();
            showToast('success', 'Daily Challenge Complete!', 'You earned 5 XP!');
        });
    } else {
        feedback.className = 'mb-5 p-4 rounded-lg bg-red-100 text-red-800 text-sm';
        feedback.textContent = 'Incorrect. ' + dailyChallenge.explanation;
        
        if (soundEnabled) incorrectSound.play();
    }
    
    feedback.classList.remove('hidden');
    document.getElementById('dailyChallengeSubmitBtn').disabled = true;
    dailyChallengeAnswered = true;
    
    // Mark as completed
    const today = new Date().toISOString().split('T')[0];
    const userChallengeRef = group2MetalsRef.child('users').child(currentUser.uid).child('dailyChallenges').child(today);
    userChallengeRef.set(true);
    
    // Hide daily challenge banner
    document.getElementById('dailyChallenge').style.display = 'none';
}

// Tab functions
function showTab(tabName) {
    // Hide all tab contents
    const tabContents = document.querySelectorAll('.tab-content');
    tabContents.forEach(content => {
        content.classList.remove('active');
    });
    
    // Remove active class from all tabs
    const tabs = document.querySelectorAll('.tab');
    tabs.forEach(tab => {
        tab.classList.remove('active');
    });
    
    // Show selected tab content
    const tabContent = document.getElementById(tabName);
    if (tabContent) {
        tabContent.classList.add('active');
    }
    
    // Add active class to clicked tab
    const activeTab = document.querySelector(`[onclick="showTab('${tabName}')"]`);
    if (activeTab) {
        activeTab.classList.add('active');
    }
    
    // Initialize graph if data visualization tab is selected
    if (tabName === 'data-visualization') {
        setTimeout(() => {
            initializeGraph();
            populateDataTable();
            loadGraphQuiz();
        }, 100);
    }
}

// Complete section function with all fixes
function completeSection(sectionName) {
    if (completedSections.includes(sectionName)) {
        // If already completed, unmark as complete
        unmarkSectionComplete(sectionName);
        return;
    }
    
    completedSections.push(sectionName);
    
    // Award XP
    const xpAwarded = 10;
    const newXp = (userData.xp || 0) + xpAwarded;
    
    // Check for badges
    const newBadges = [...(userData.badges || [])];
    let badgeEarned = false;
    
    if (completedSections.length === 1 && !newBadges.includes('First Steps')) {
        newBadges.push('First Steps');
        badgeEarned = true;
    }
    
    if (completedSections.length === 4 && !newBadges.includes('Metal Master')) {
        newBadges.push('Metal Master');
        badgeEarned = true;
    }
    
    // Save to Firebase
    if (currentUser && userData) {
        const userRef = group2MetalsRef.child('users').child(currentUser.uid);
        const updates = {
            completedSections: completedSections,
            xp: newXp
        };
        
        if (badgeEarned) {
            updates.badges = newBadges;
        }
        
        // Use set instead of update to ensure the data is saved correctly
        userRef.set({
            ...userData,
            ...updates
        }).then(() => {
            // Update local userData
            userData.completedSections = completedSections;
            userData.xp = newXp;
            if (badgeEarned) {
                userData.badges = newBadges;
            }
            
            updateUserXP();
            updateUserBadges();
            
            // Play sounds if enabled (with fallback)
            try {
                if (typeof soundEnabled !== 'undefined' && soundEnabled) {
                    if (typeof completeSound !== 'undefined') completeSound.play();
                    if (badgeEarned && typeof badgeSound !== 'undefined') badgeSound.play();
                }
            } catch (e) {
                console.log("Sound playback failed:", e);
            }
            
            showToast('success', 'Section Complete!', `Great job! You've completed this section and earned ${xpAwarded} XP.`);
            
            if (badgeEarned) {
                showToast('success', 'Badge Earned!', `You've earned a new badge: ${newBadges[newBadges.length - 1]}`);
            }
            
            updateSectionCompletionStatus();
            updateProgressTracker();
            updateSectionButtons();
            
            // Navigate to next section if available
            const sectionOrder = ['overview', 'elements', 'properties', 'reactions', 'quiz'];
            const currentIndex = sectionOrder.indexOf(sectionName);
            if (currentIndex < sectionOrder.length - 1) {
                const nextSection = sectionOrder[currentIndex + 1];
                navigateToSection(nextSection);
            }
        }).catch((error) => {
            console.error("Error saving progress:", error);
            
            // Try an alternative approach if the first one fails
            userRef.update(updates).then(() => {
                // Update local userData
                userData.completedSections = completedSections;
                userData.xp = newXp;
                if (badgeEarned) {
                    userData.badges = newBadges;
                }
                
                updateUserXP();
                updateUserBadges();
                
                showToast('success', 'Section Complete!', `Great job! You've completed this section and earned ${xpAwarded} XP.`);
                
                updateSectionCompletionStatus();
                updateProgressTracker();
                updateSectionButtons();
            }).catch((updateError) => {
                console.error("Error with alternative save:", updateError);
                showToast('error', 'Error', 'Failed to save your progress. Please try again.');
                
                // Revert the local changes if save failed
                completedSections = completedSections.filter(section => section !== sectionName);
            });
        });
    } else {
        showToast('error', 'Error', 'You must be signed in to save progress.');
    }
}

function unmarkSectionComplete(sectionName) {
    // Remove from completed sections
    completedSections = completedSections.filter(section => section !== sectionName);
    
    // Update UI
    updateSectionCompletionStatus();
    updateProgressTracker();
    updateSectionButtons();
    
    // Save to Firebase
    if (currentUser && userData) {
        const userRef = group2MetalsRef.child('users').child(currentUser.uid);
        
        // Use set instead of update to ensure the data is saved correctly
        userRef.set({
            ...userData,
            completedSections: completedSections
        }).then(() => {
            // Update local userData
            userData.completedSections = completedSections;
            
            showToast('info', 'Section Unmarked', `You've unmarked ${sectionName} as complete.`);
        }).catch((error) => {
            console.error("Error updating progress:", error);
            
            // Try an alternative approach if the first one fails
            userRef.update({
                completedSections: completedSections
            }).then(() => {
                // Update local userData
                userData.completedSections = completedSections;
                
                showToast('info', 'Section Unmarked', `You've unmarked ${sectionName} as complete.`);
            }).catch((updateError) => {
                console.error("Error with alternative update:", updateError);
                showToast('error', 'Error', 'Failed to update your progress. Please try again.');
                
                // Revert the local changes if update failed
                completedSections.push(sectionName);
                updateSectionCompletionStatus();
                updateProgressTracker();
                updateSectionButtons();
            });
        });
    } else {
        showToast('error', 'Error', 'You must be signed in to save progress.');
    }
}

// Enhanced updateSectionButtons function
function updateSectionButtons() {
    // Update each section's complete button
    const sections = ['overview', 'elements', 'properties', 'reactions', 'quiz'];
    sections.forEach(section => {
        const button = document.getElementById(`${section}-complete-btn`);
        if (button) {
            if (completedSections.includes(section)) {
                button.innerHTML = '<i class="fas fa-times mr-2"></i>Unmark as Complete';
                button.classList.remove('btn-success');
                button.classList.add('btn-unmark');
                button.setAttribute('onclick', `completeSection('${section}')`);
            } else {
                button.innerHTML = '<i class="fas fa-check mr-2"></i>Mark as Complete';
                button.classList.remove('btn-unmark');
                button.classList.add('btn-success');
                button.setAttribute('onclick', `completeSection('${section}')`);
            }
        }
    });
}

// Enhanced updateSectionCompletionStatus function
function updateSectionCompletionStatus() {
    // Update nav items
    const navItems = document.querySelectorAll('.nav-item');
    navItems.forEach(item => {
        const section = item.id.replace('nav-', '');
        if (completedSections.includes(section)) {
            item.classList.remove('locked');
            item.classList.add('completed');
        } else {
            item.classList.remove('completed');
        }
    });
    
    // Unlock next sections
    const sectionOrder = ['overview', 'elements', 'properties', 'reactions', 'quiz'];
    sectionOrder.forEach((section, index) => {
        if (completedSections.includes(section) && index < sectionOrder.length - 1) {
            const nextSection = sectionOrder[index + 1];
            const nextNavItem = document.getElementById(`nav-${nextSection}`);
            if (nextNavItem) {
                nextNavItem.classList.remove('locked');
            }
        }
    });
    
    // Check if all sections are completed to unlock quiz
    const allSectionsCompleted = ['overview', 'elements', 'properties', 'reactions'].every(section => 
        completedSections.includes(section)
    );
    
    if (allSectionsCompleted) {
        const quizNavItem = document.getElementById('nav-quiz');
        if (quizNavItem) {
            quizNavItem.classList.remove('locked');
        }
    }
    
    // Update progress items
    const sections = ['overview', 'elements', 'properties', 'quiz'];
    sections.forEach(section => {
        const progressItem = document.getElementById(`progress-${section}`);
        if (progressItem) {
            const statusElement = progressItem.querySelector('.text-xs');
            
            if (completedSections.includes(section)) {
                progressItem.classList.add('bg-green-100');
                statusElement.textContent = 'Completed';
                statusElement.classList.remove('text-gray-500');
                statusElement.classList.add('text-green-600');
            } else if (section === 'quiz' && completedSections.length === 4) {
                progressItem.classList.remove('bg-gray-100');
                progressItem.classList.add('bg-blue-100');
                statusElement.textContent = 'Available';
                statusElement.classList.remove('text-gray-500');
                statusElement.classList.add('text-blue-600');
            }
        }
    });
}

// Enhanced updateProgressTracker function
function updateProgressTracker() {
    const totalSections = 4; // overview, elements, properties, reactions
    const completedCount = completedSections.length;
    const percentage = Math.round((completedCount / totalSections) * 100);
    
    document.getElementById('progressPercentage').textContent = `${percentage}%`;
    document.getElementById('overallProgressFill').style.width = `${percentage}%`;
    
    // Update progress items
    const sections = ['overview', 'elements', 'properties', 'quiz'];
    sections.forEach(section => {
        const progressItem = document.getElementById(`progress-${section}`);
        if (progressItem) {
            const statusElement = progressItem.querySelector('.text-xs');
            
            if (completedSections.includes(section)) {
                progressItem.classList.add('bg-green-100');
                statusElement.textContent = 'Completed';
                statusElement.classList.remove('text-gray-500');
                statusElement.classList.add('text-green-600');
            } else if (section === 'quiz' && completedSections.length === 4) {
                progressItem.classList.remove('bg-gray-100');
                progressItem.classList.add('bg-blue-100');
                statusElement.textContent = 'Available';
                statusElement.classList.remove('text-gray-500');
                statusElement.classList.add('text-blue-600');
            }
        }
    });
}

// Interactive element quiz functions
function showElementQuiz(element) {
    const question = termQuizQuestions[element];
    if (!question) return;
    
    const popup = document.getElementById('elementQuizPopup');
    const title = document.getElementById('elementQuizTitle');
    const questionText = document.getElementById('elementQuizQuestion');
    const optionsContainer = document.getElementById('elementQuizOptions');
    const feedback = document.getElementById('elementQuizFeedback');
    
    title.textContent = `${element.charAt(0).toUpperCase() + element.slice(1)} Quiz`;
    questionText.textContent = question.question;
    
    optionsContainer.innerHTML = '';
    question.options.forEach((option, index) => {
        const optionDiv = document.createElement('div');
        optionDiv.className = 'quiz-option';
        optionDiv.textContent = option;
        optionDiv.onclick = () => checkElementQuizAnswer(index, question.correct, question.explanation);
        optionsContainer.appendChild(optionDiv);
    });
    
    feedback.classList.add('hidden');
    popup.classList.remove('hidden');
}

function checkElementQuizAnswer(selectedIndex, correctIndex, explanation) {
    const options = document.querySelectorAll('#elementQuizOptions .quiz-option');
    const feedback = document.getElementById('elementQuizFeedback');
    
    options.forEach((option, index) => {
        option.onclick = null; // Disable further clicks
        if (index === correctIndex) {
            option.classList.add('correct');
        } else if (index === selectedIndex) {
            option.classList.add('incorrect');
        }
    });
    
    if (selectedIndex === correctIndex) {
        feedback.className = 'mb-5 p-4 rounded-lg bg-green-100 text-green-800';
        feedback.textContent = 'Correct! ' + explanation;
        if (soundEnabled) correctSound.play();
    } else {
        feedback.className = 'mb-5 p-4 rounded-lg bg-red-100 text-red-800';
        feedback.textContent = 'Incorrect. ' + explanation;
        if (soundEnabled) incorrectSound.play();
    }
    
    feedback.classList.remove('hidden');
}

function closeElementQuiz() {
    document.getElementById('elementQuizPopup').classList.add('hidden');
}

// Term quiz functions
function showTermQuiz(term) {
    const question = termQuizQuestions[term];
    if (!question) return;
    
    document.getElementById('quizQuestionModal').classList.add('active');
    document.getElementById('quizQuestionTitle').textContent = `Quick Quiz: ${term.replace('-', ' ')}`;
    document.getElementById('quizQuestionText').textContent = question.question;
    
    const answersContainer = document.getElementById('quizQuestionAnswers');
    answersContainer.innerHTML = '';
    
    question.options.forEach((option, index) => {
        const answerDiv = document.createElement('div');
        answerDiv.className = 'quiz-option';
        answerDiv.textContent = option;
        answerDiv.onclick = () => selectTermQuizAnswer(index, question.correct, question.explanation);
        answersContainer.appendChild(answerDiv);
    });
    
    // Reset feedback
    document.getElementById('quizQuestionFeedback').classList.add('hidden');
}

function selectTermQuizAnswer(index, correctIndex, explanation) {
    const answers = document.querySelectorAll('#quizQuestionAnswers .quiz-option');
    const feedback = document.getElementById('quizQuestionFeedback');
    
    answers.forEach(answer => {
        answer.style.pointerEvents = 'none';
    });
    
    if (index === correctIndex) {
        answers[index].classList.add('correct');
        feedback.className = 'quiz-feedback correct';
        feedback.textContent = 'Correct! ' + explanation;
        
        if (soundEnabled) correctSound.play();
    } else {
        answers[index].classList.add('incorrect');
        feedback.className = 'quiz-feedback incorrect';
        feedback.textContent = 'Incorrect. ' + explanation;
        
        if (soundEnabled) incorrectSound.play();
    }
    
    feedback.classList.remove('hidden');
}

function closeQuizQuestionModal() {
    document.getElementById('quizQuestionModal').classList.remove('active');
}

// Trend quiz functions
function showTrendQuiz(trend) {
    const question = trendQuizQuestions[trend];
    if (!question) return;
    
    document.getElementById('quizQuestionModal').classList.add('active');
    document.getElementById('quizQuestionTitle').textContent = `Trend Quiz: ${trend.replace('-', ' ')}`;
    document.getElementById('quizQuestionText').textContent = question.question;
    
    const answersContainer = document.getElementById('quizQuestionAnswers');
    answersContainer.innerHTML = '';
    
    question.options.forEach((option, index) => {
        const answerDiv = document.createElement('div');
        answerDiv.className = 'quiz-option';
        answerDiv.textContent = option;
        answerDiv.onclick = () => selectTrendQuizAnswer(index, question.correct, question.explanation);
        answersContainer.appendChild(answerDiv);
    });
    
    // Reset feedback
    document.getElementById('quizQuestionFeedback').classList.add('hidden');
}

function selectTrendQuizAnswer(index, correctIndex, explanation) {
    const answers = document.querySelectorAll('#quizQuestionAnswers .quiz-option');
    const feedback = document.getElementById('quizQuestionFeedback');
    
    answers.forEach(answer => {
        answer.style.pointerEvents = 'none';
    });
    
    if (index === correctIndex) {
        answers[index].classList.add('correct');
        feedback.className = 'quiz-feedback correct';
        feedback.textContent = 'Correct! ' + explanation;
        
        if (soundEnabled) correctSound.play();
    } else {
        answers[index].classList.add('incorrect');
        feedback.className = 'quiz-feedback incorrect';
        feedback.textContent = 'Incorrect. ' + explanation;
        
        if (soundEnabled) incorrectSound.play();
    }
    
    feedback.classList.remove('hidden');
}

// Element details functions
function showElementDetails(name, symbol, atomicNumber, electronConfig) {
    const details = elementDetails[name];
    if (!details) return;
    
    document.getElementById('elementDetailsName').textContent = name;
    document.getElementById('elementDetailsSymbol').textContent = symbol;
    document.getElementById('elementDetailsNumber').textContent = atomicNumber;
    document.getElementById('elementDetailsConfig').textContent = electronConfig;
    document.getElementById('elementDetailsMP').textContent = details.meltingPoint;
    document.getElementById('elementDetailsDensity').textContent = details.density;
    document.getElementById('elementDetailsReactivity').textContent = details.reactivity;
    document.getElementById('elementDetailsUses').textContent = details.uses;
    document.getElementById('elementDetailsFact').textContent = details.fact;
    
    // Setup quiz
    document.getElementById('elementDetailsQuizQuestion').textContent = details.quizQuestion;
    const optionsContainer = document.getElementById('elementDetailsQuizOptions');
    optionsContainer.innerHTML = '';
    
    details.quizOptions.forEach((option, index) => {
        const optionDiv = document.createElement('div');
        optionDiv.className = 'quiz-option';
        optionDiv.textContent = option;
        optionDiv.onclick = () => checkElementDetailsQuizAnswer(index, details.quizCorrect, details.quizExplanation);
        optionsContainer.appendChild(optionDiv);
    });
    
    document.getElementById('elementDetailsQuizFeedback').classList.add('hidden');
    document.getElementById('elementDetailsModal').classList.add('active');
}

function checkElementDetailsQuizAnswer(selectedIndex, correctIndex, explanation) {
    const options = document.querySelectorAll('#elementDetailsQuizOptions .quiz-option');
    const feedback = document.getElementById('elementDetailsQuizFeedback');
    
    options.forEach((option, index) => {
        option.onclick = null; // Disable further clicks
        if (index === correctIndex) {
            option.classList.add('correct');
        } else if (index === selectedIndex) {
            option.classList.add('incorrect');
        }
    });
    
    if (selectedIndex === correctIndex) {
        feedback.className = 'mt-3 p-4 rounded-lg bg-green-100 text-green-800';
        feedback.textContent = 'Correct! ' + explanation;
        if (soundEnabled) correctSound.play();
    } else {
        feedback.className = 'mt-3 p-4 rounded-lg bg-red-100 text-red-800';
        feedback.textContent = 'Incorrect. ' + explanation;
        if (soundEnabled) incorrectSound.play();
    }
    
    feedback.classList.remove('hidden');
}

function closeElementDetails() {
    document.getElementById('elementDetailsModal').classList.remove('active');
}

// Trend explanation functions
function showTrendExplanation(trend, element) {
    let title, heading, content, quizQuestion, quizOptions, quizCorrect, quizExplanation;
    
    if (trend === 'melting-point') {
        title = 'Melting Point Trend';
        heading = `Melting Point of ${element.charAt(0).toUpperCase() + element.slice(1)}`;
        
        if (element === 'beryllium') {
            content = 'Beryllium has the highest melting point in Group 2 (1287C) due to its small atomic size and strong metallic bonding. The small size of beryllium atoms means the positive nuclei are closer to the delocalized electrons, resulting in stronger metallic bonds that require more energy to break.';
        } else if (element === 'magnesium') {
            content = 'Magnesium has a lower melting point (650C) than beryllium due to its larger atomic size. The increased atomic radius means the positive nuclei are further from the delocalized electrons, weakening the metallic bonds and requiring less energy to break them.';
        } else if (element === 'calcium') {
            content = 'Calcium has an even lower melting point (842C) due to its larger atomic size. The additional electron shell increases the atomic radius significantly, further weakening the metallic bonds.';
        } else if (element === 'strontium') {
            content = 'Strontium has a very low melting point (777C) due to its large atomic size. The increased distance between positive nuclei and delocalized electrons results in very weak metallic bonds.';
        } else if (element === 'barium') {
            content = 'Barium has the lowest melting point in Group 2 (727C) due to its largest atomic size. The significant distance between positive nuclei and delocalized electrons results in extremely weak metallic bonds that require very little energy to break.';
        }
        
        quizQuestion = "Why does melting point decrease down Group 2?";
        quizOptions = [
            "Atomic size increases, metallic bonds weaken",
            "Atomic size decreases, metallic bonds strengthen",
            "Electron configuration changes",
            "Nuclear charge increases"
        ];
        quizCorrect = 0;
        quizExplanation = "As we move down Group 2, atomic size increases due to additional electron shells. This increases the distance between positive nuclei and delocalized electrons, weakening the metallic bonds and lowering the melting point.";
    } else if (trend === 'density') {
        title = 'Density Trend';
        heading = `Density of ${element.charAt(0).toUpperCase() + element.slice(1)}`;
        
        if (element === 'beryllium') {
            content = 'Beryllium has a density of 1.85 g/cm. Its relatively low density is due to its small atomic mass combined with a compact atomic structure.';
        } else if (element === 'magnesium') {
            content = 'Magnesium has a lower density (1.74 g/cm) than beryllium. The increase in atomic volume is proportionally greater than the increase in atomic mass compared to beryllium.';
        } else if (element === 'calcium') {
            content = 'Calcium has a lower density (1.55 g/cm) than magnesium. The increase in atomic volume is proportionally greater than the increase in atomic mass compared to magnesium.';
        } else if (element === 'strontium') {
            content = 'Strontium has a higher density (2.64 g/cm) than calcium. The increase in atomic mass is proportionally greater than the increase in atomic volume, following the general trend of increasing density down the group.';
        } else if (element === 'barium') {
            content = 'Barium has the highest density in Group 2 (3.62 g/cm). The significant increase in atomic mass compared to the increase in atomic volume results in the highest density in the group.';
        }
        
        quizQuestion = "Why does density increase down Group 2?";
        quizOptions = [
            "Atomic mass increases more than atomic volume",
            "Atomic volume increases more than atomic mass",
            "Crystal structure changes",
            "Electron configuration changes"
        ];
        quizCorrect = 0;
        quizExplanation = "Density increases down Group 2 because the increase in atomic mass is proportionally greater than the increase in atomic volume.";
    }
    
    document.getElementById('trendExplanationTitle').textContent = title;
    document.getElementById('trendExplanationHeading').textContent = heading;
    document.getElementById('trendExplanationContent').textContent = content;
    document.getElementById('trendExplanationQuizQuestion').textContent = quizQuestion;
    
    const optionsContainer = document.getElementById('trendExplanationQuizOptions');
    optionsContainer.innerHTML = '';
    
    quizOptions.forEach((option, index) => {
        const optionDiv = document.createElement('div');
        optionDiv.className = 'quiz-option';
        optionDiv.textContent = option;
        optionDiv.onclick = () => checkTrendExplanationQuizAnswer(index, quizCorrect, quizExplanation);
        optionsContainer.appendChild(optionDiv);
    });
    
    document.getElementById('trendExplanationQuizFeedback').classList.add('hidden');
    document.getElementById('trendExplanationModal').classList.add('active');
}

function checkTrendExplanationQuizAnswer(selectedIndex, correctIndex, explanation) {
    const options = document.querySelectorAll('#trendExplanationQuizOptions .quiz-option');
    const feedback = document.getElementById('trendExplanationQuizFeedback');
    
    options.forEach((option, index) => {
        option.onclick = null; // Disable further clicks
        if (index === correctIndex) {
            option.classList.add('correct');
        } else if (index === selectedIndex) {
            option.classList.add('incorrect');
        }
    });
    
    if (selectedIndex === correctIndex) {
        feedback.className = 'mt-3 p-4 rounded-lg bg-green-100 text-green-800';
        feedback.textContent = 'Correct! ' + explanation;
        if (soundEnabled) correctSound.play();
    } else {
        feedback.className = 'mt-3 p-4 rounded-lg bg-red-100 text-red-800';
        feedback.textContent = 'Incorrect. ' + explanation;
        if (soundEnabled) incorrectSound.play();
    }
    
    feedback.classList.remove('hidden');
}

function closeTrendExplanation() {
    document.getElementById('trendExplanationModal').classList.remove('active');
}

// Reaction details functions
function showReactionDetails(reaction) {
    const details = reactionDetails[reaction];
    if (!details) return;
    
    document.getElementById('reactionDetailsTitle').textContent = `${reaction.replace('-', ' ').replace(/\b\w/g, l => l.toUpperCase())}`;
    document.getElementById('reactionDetailsEquation').textContent = details.equation;
    document.getElementById('reactionDetailsObservations').textContent = details.observations;
    document.getElementById('reactionDetailsExplanation').textContent = details.explanation;
    
    // Setup quiz
    document.getElementById('reactionDetailsQuizQuestion').textContent = details.quizQuestion;
    const optionsContainer = document.getElementById('reactionDetailsQuizOptions');
    optionsContainer.innerHTML = '';
    
    details.quizOptions.forEach((option, index) => {
        const optionDiv = document.createElement('div');
        optionDiv.className = 'quiz-option';
        optionDiv.textContent = option;
        optionDiv.onclick = () => checkReactionDetailsQuizAnswer(index, details.quizCorrect, details.quizExplanation);
        optionsContainer.appendChild(optionDiv);
    });
    
    document.getElementById('reactionDetailsQuizFeedback').classList.add('hidden');
    document.getElementById('reactionDetailsModal').classList.add('active');
}

function checkReactionDetailsQuizAnswer(selectedIndex, correctIndex, explanation) {
    const options = document.querySelectorAll('#reactionDetailsQuizOptions .quiz-option');
    const feedback = document.getElementById('reactionDetailsQuizFeedback');
    
    options.forEach((option, index) => {
        option.onclick = null; // Disable further clicks
        if (index === correctIndex) {
            option.classList.add('correct');
        } else if (index === selectedIndex) {
            option.classList.add('incorrect');
        }
    });
    
    if (selectedIndex === correctIndex) {
        feedback.className = 'mt-3 p-4 rounded-lg bg-green-100 text-green-800';
        feedback.textContent = 'Correct! ' + explanation;
        if (soundEnabled) correctSound.play();
    } else {
        feedback.className = 'mt-3 p-4 rounded-lg bg-red-100 text-red-800';
        feedback.textContent = 'Incorrect. ' + explanation;
        if (soundEnabled) incorrectSound.play();
    }
    
    feedback.classList.remove('hidden');
}

function closeReactionDetails() {
    document.getElementById('reactionDetailsModal').classList.remove('active');
}

function showReactionVideo(element) {
    // Create a modal to show the video
    const modal = document.createElement('div');
    modal.className = 'modal';
    modal.style.zIndex = '1001'; // Ensure it's on top
    
    // Define video URLs for each element (replace with actual video URLs)
    const videoUrls = {
        'magnesium': 'https://www.youtube.com/embed/uQk3Dk6IpQ',
        'calcium': 'https://www.youtube.com/embed/5aDH6N2v3s8',
        'barium': 'https://www.youtube.com/embed/6F3HlJn5c5s',
        'strontium': 'https://www.youtube.com/embed/d26hCR5FQgU'
    };
    
    // Get the video URL for the selected element
    const videoUrl = videoUrls[element] || 'https://www.youtube.com/embed/TGZs93DzMDY'; // Default video
    
    // Set modal content
    modal.innerHTML = `
        <div class="modal-content" style="max-width: 900px;">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-gray-800 capitalize">${element} Reaction with Water</h2>
                <button class="close-video-modal text-gray-500 hover:text-gray-700 p-3 rounded-full hover:bg-gray-100 transition-colors">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            
            <div class="aspect-w-16 aspect-h-9 mb-6">
                <iframe id="video-iframe" src="${videoUrl}" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen class="w-full h-96 rounded-lg"></iframe>
            </div>
            
            <div class="bg-blue-50 p-6 rounded-lg border-l-4 border-blue-500">
                <h3 class="font-semibold text-blue-800 mb-3">Observations</h3>
                <p id="reactionVideoObservations">Loading observations...</p>
            </div>
            
            <div class="flex justify-end mt-6">
                <button class="close-video-modal btn btn-secondary transform transition-all duration-300 hover:scale-105">
                    Close
                </button>
            </div>
        </div>
    `;
    
    // Add modal to the body
    document.body.appendChild(modal);
    
    // Show modal
    setTimeout(() => {
        modal.classList.add('active');
    }, 10);
    
    // Set observations based on element
    const observations = {
        'magnesium': 'Magnesium reacts very slowly with cold water due to a protective oxide layer, but reacts readily with steam.',
        'calcium': 'Calcium fizzes steadily in cold water, producing bubbles of hydrogen gas. The solution becomes milky.',
        'barium': 'Barium reacts vigorously with water, producing hydrogen gas rapidly. The reaction is exothermic.',
        'strontium': 'Strontium reacts steadily with water, producing hydrogen gas and heat.'
    };
    
    document.getElementById('reactionVideoObservations').textContent = observations[element] || 'Observations not available.';
    
    // Add event listeners to close buttons
    const closeButtons = modal.querySelectorAll('.close-video-modal');
    closeButtons.forEach(button => {
        button.addEventListener('click', function() {
            // Stop the video by clearing the iframe src
            const iframe = document.getElementById('video-iframe');
            if (iframe) {
                iframe.src = '';
            }
            
            // Remove the modal from the DOM
            modal.remove();
        });
    });
}

function showOxideTrendQuiz() {
    const question = {
        question: "Which type of oxide does Barium form when burned in excess oxygen?",
        options: [
            "Normal oxide (BaO)",
            "Peroxide (BaO)",
            "Superoxide (BaO)",
            "No oxide is formed"
        ],
        correct: 1,
        explanation: "Barium forms barium peroxide (BaO) when burned in oxygen. This contains the peroxide ion (O) with an oxygen-oxygen single bond."
    };
    
    document.getElementById('quizQuestionModal').classList.add('active');
    document.getElementById('quizQuestionTitle').textContent = 'Oxide Trend Quiz';
    document.getElementById('quizQuestionText').textContent = question.question;
    
    const answersContainer = document.getElementById('quizQuestionAnswers');
    answersContainer.innerHTML = '';
    
    question.options.forEach((option, index) => {
        const answerDiv = document.createElement('div');
        answerDiv.className = 'quiz-option';
        answerDiv.textContent = option;
        answerDiv.onclick = () => selectOxideTrendQuizAnswer(index, question.correct, question.explanation);
        answersContainer.appendChild(answerDiv);
    });
    
    // Reset feedback
    document.getElementById('quizQuestionFeedback').classList.add('hidden');
}

function selectOxideTrendQuizAnswer(index, correctIndex, explanation) {
    const answers = document.querySelectorAll('#quizQuestionAnswers .quiz-option');
    const feedback = document.getElementById('quizQuestionFeedback');
    
    answers.forEach(answer => {
        answer.style.pointerEvents = 'none';
    });
    
    if (index === correctIndex) {
        answers[index].classList.add('correct');
        feedback.className = 'quiz-feedback correct';
        feedback.textContent = 'Correct! ' + explanation;
        
        if (soundEnabled) correctSound.play();
    } else {
        answers[index].classList.add('incorrect');
        feedback.className = 'quiz-feedback incorrect';
        feedback.textContent = 'Incorrect. ' + explanation;
        
        if (soundEnabled) incorrectSound.play();
    }
    
    feedback.classList.remove('hidden');
}

// Quiz Functions
function startQuiz() {
    currentQuestion = 0;
    score = 0;
    selectedOption = null;
    answerSubmitted = false;
    quizAnswers = [];
    
    document.getElementById('quizModal').classList.add('active');
    document.getElementById('quizProgress').style.display = 'block';
    document.getElementById('quizContent').style.display = 'block';
    document.getElementById('quizResults').style.display = 'none';
    
    document.getElementById('currentQuestion').textContent = currentQuestion + 1;
    document.getElementById('totalQuestions').textContent = quizQuestions.length;
    document.getElementById('currentScore').textContent = score;
    document.getElementById('progressFill').style.width = ((currentQuestion + 1) / quizQuestions.length * 100) + '%';
    
    loadQuestion();
    
    // Add anti-cheating measures
    addAntiCheatingMeasures();
}

function addAntiCheatingMeasures() {
    // Disable right-click
    document.getElementById('quizModal').addEventListener('contextmenu', e => e.preventDefault());
    
    // Disable text selection
    document.getElementById('quizModal').addEventListener('selectstart', e => e.preventDefault());
    document.getElementById('quizModal').addEventListener('mousedown', e => e.preventDefault());
    
    // Warn before leaving
    window.addEventListener('beforeunload', preventQuizExit);
}

function removeAntiCheatingMeasures() {
    // Re-enable right-click
    document.getElementById('quizModal').removeEventListener('contextmenu', e => e.preventDefault());
    
    // Re-enable text selection
    document.getElementById('quizModal').removeEventListener('selectstart', e => e.preventDefault());
    document.getElementById('quizModal').removeEventListener('mousedown', e => e.preventDefault());
    
    // Remove beforeunload listener
    window.removeEventListener('beforeunload', preventQuizExit);
}

function preventQuizExit(e) {
    if (document.getElementById('quizModal').classList.contains('active')) {
        e.preventDefault();
        e.returnValue = '';
        return '';
    }
}

function loadQuestion() {
    const question = quizQuestions[currentQuestion];
    document.getElementById('questionText').textContent = question.question;
    
    const optionsContainer = document.getElementById('optionsContainer');
    optionsContainer.innerHTML = '';
    
    // Check if this question has been answered already
    const answeredQuestion = quizAnswers[currentQuestion];
    
    // Load MCQ options
    question.options.forEach((option, index) => {
        const optionDiv = document.createElement('div');
        optionDiv.className = 'quiz-option';
        if (answeredQuestion) {
            optionDiv.classList.add('disabled');
            if (answeredQuestion.selected === index) {
                optionDiv.classList.add(answeredQuestion.isCorrect ? 'correct' : 'incorrect');
            }
        }
        optionDiv.dataset.index = index;
        
        const input = document.createElement('input');
        input.type = 'radio';
        input.name = 'quiz-option';
        input.id = `option-${index}`;
        input.value = index;
        if (answeredQuestion && answeredQuestion.selected === index) {
            input.checked = true;
        }
        if (answeredQuestion) {
            input.disabled = true;
        }
        
        const label = document.createElement('label');
        label.htmlFor = `option-${index}`;
        label.textContent = option;
        
        optionDiv.appendChild(input);
        optionDiv.appendChild(label);
        
        if (!answeredQuestion) {
            optionDiv.onclick = () => selectOption(index);
        }
        optionsContainer.appendChild(optionDiv);
    });
    
    // Show/hide navigation buttons
    document.getElementById('prevButton').classList.toggle('hidden', currentQuestion === 0);
    
    // Show submit button if not answered, show next button if answered
    if (answeredQuestion) {
        document.getElementById('submitButton').style.display = 'none';
        document.getElementById('nextButton').classList.remove('hidden');
        
        // Show feedback for answered question
        const feedback = document.getElementById('feedback');
        if (answeredQuestion.isCorrect) {
            feedback.className = 'mb-5 p-4 rounded-lg bg-green-100 text-green-800 text-sm';
            feedback.textContent = 'Correct! ' + question.explanation;
        } else {
            feedback.className = 'mb-5 p-4 rounded-lg bg-red-100 text-red-800 text-sm';
            feedback.textContent = 'Incorrect. ' + question.explanation;
        }
        feedback.classList.remove('hidden');
    } else {
        document.getElementById('submitButton').style.display = 'inline-flex';
        document.getElementById('nextButton').classList.add('hidden');
        document.getElementById('feedback').classList.add('hidden');
    }
    
    selectedOption = answeredQuestion ? answeredQuestion.selected : null;
    answerSubmitted = !!answeredQuestion;
}

function selectOption(index) {
    if (answerSubmitted) return;
    
    const options = document.querySelectorAll('.quiz-option');
    options.forEach(option => {
        option.classList.remove('selected');
        const input = option.querySelector('input');
        input.checked = false;
    });
    
    options[index].classList.add('selected');
    options[index].querySelector('input').checked = true;
    
    selectedOption = index;
    document.getElementById('submitButton').disabled = false;
}

function submitAnswer() {
    if (answerSubmitted) return;
    
    const question = quizQuestions[currentQuestion];
    const isCorrect = selectedOption === question.correct;
    const feedback = document.getElementById('feedback');
    
    quizAnswers[currentQuestion] = {
        selected: selectedOption,
        submitted: true,
        isCorrect: isCorrect
    };
    
    // Store quiz analytics in Firebase
    const analyticsRef = group2MetalsRef.child('quizAnalytics').child(currentQuestion);
    analyticsRef.transaction((analytics) => {
        if (!analytics) {
            analytics = { correct: 0, incorrect: 0 };
        }
        if (isCorrect) {
            analytics.correct++;
        } else {
            analytics.incorrect++;
        }
        return analytics;
    });
    
    if (isCorrect) {
        feedback.className = 'mb-5 p-4 rounded-lg bg-green-100 text-green-800 text-sm';
        feedback.textContent = 'Correct! ' + question.explanation;
        score++;
        
        if (soundEnabled) correctSound.play();
    } else {
        feedback.className = 'mb-5 p-4 rounded-lg bg-red-100 text-red-800 text-sm';
        feedback.textContent = 'Incorrect. ' + question.explanation;
        
        if (soundEnabled) incorrectSound.play();
    }
    
    feedback.classList.remove('hidden');
    document.getElementById('submitButton').style.display = 'none';
    document.getElementById('nextButton').classList.remove('hidden');
    document.getElementById('currentScore').textContent = score;
    
    answerSubmitted = true;
}

function nextQuestion() {
    currentQuestion++;
    
    if (currentQuestion >= quizQuestions.length) {
        showResults();
        return;
    }
    
    document.getElementById('currentQuestion').textContent = currentQuestion + 1;
    document.getElementById('progressFill').style.width = ((currentQuestion + 1) / quizQuestions.length * 100) + '%';
    loadQuestion();
}

function previousQuestion() {
    if (currentQuestion > 0) {
        currentQuestion--;
        document.getElementById('currentQuestion').textContent = currentQuestion + 1;
        document.getElementById('progressFill').style.width = ((currentQuestion + 1) / quizQuestions.length * 100) + '%';
        loadQuestion();
    }
}

function showResults() {
    document.getElementById('quizProgress').style.display = 'none';
    document.getElementById('quizContent').style.display = 'none';
    document.getElementById('quizResults').style.display = 'block';
    
    const percentage = Math.round((score / quizQuestions.length) * 100);
    document.getElementById('finalScore').textContent = `${score}/${quizQuestions.length}`;
    
    let message = '';
    if (percentage >= 80) {
        message = 'Excellent! You have a strong understanding of Group 2 elements.';
    } else if (percentage >= 60) {
        message = 'Good job! You have a solid foundation to build upon.';
    } else if (percentage >= 40) {
        message = 'Not bad! Review the materials to improve your understanding.';
    } else {
        message = 'Keep practicing! Review the materials carefully.';
    }
    
    document.getElementById('scoreMessage').textContent = message;
    
    // Award XP for quiz completion
    const quizXP = Math.round((score / quizQuestions.length) * 20); // Max 20 XP for perfect score
    const newXp = (userData.xp || 0) + quizXP;
    
    // Check for quiz badge
    const newBadges = [...(userData.badges || [])];
    let badgeEarned = false;
    
    if (percentage >= 80 && !newBadges.includes('Quiz Master')) {
        newBadges.push('Quiz Master');
        badgeEarned = true;
    }
    
    // Save to Firebase
    const userRef = group2MetalsRef.child('users').child(currentUser.uid);
    const updates = {
        xp: newXp
    };
    
    if (badgeEarned) {
        updates.badges = newBadges;
    }
    
    userRef.update(updates).then(() => {
        userData.xp = newXp;
        if (badgeEarned) {
            userData.badges = newBadges;
        }
        
        updateUserXP();
        updateUserBadges();
        
        if (soundEnabled) {
            completeSound.play();
            if (badgeEarned) badgeSound.play();
        }
        
        if (badgeEarned) {
            showToast('success', 'Badge Earned!', `You've earned a new badge: ${newBadges[newBadges.length - 1]}`);
        }
    });
    
    // Remove anti-cheating measures
    removeAntiCheatingMeasures();
}

function closeQuiz() {
    document.getElementById('quizModal').classList.remove('active');
    removeAntiCheatingMeasures();
}

// Feedback System Functions
function showFeedbackModal() {
    if (!currentUser) {
        showToast('error', 'Sign in required', 'Please sign in to provide feedback.');
        showLoginModal();
        return;
    }
    document.getElementById('feedbackModal').classList.add('active');
}

function closeFeedbackModal() {
    document.getElementById('feedbackModal').classList.remove('active');
    document.getElementById('feedbackForm').reset();
    document.getElementById('feedbackRating').value = '0';
    // Reset thumbs
    document.querySelectorAll('#feedbackModal .fa-thumbs-up, #feedbackModal .fa-thumbs-down').forEach(icon => {
        icon.classList.remove('fas', 'text-yellow-500');
        icon.classList.add('far', 'text-gray-400');
    });
}

function setFeedbackRating(rating) {
    document.getElementById('feedbackRating').value = rating;
    // Update the thumbs
    document.querySelectorAll('#feedbackModal .fa-thumbs-up, #feedbackModal .fa-thumbs-down').forEach(icon => {
        icon.classList.remove('fas', 'text-yellow-500');
        icon.classList.add('far', 'text-gray-400');
    });
    if (rating === 1) {
        const thumbsDown = document.querySelector('#feedbackModal .fa-thumbs-down');
        thumbsDown.classList.remove('far', 'text-gray-400');
        thumbsDown.classList.add('fas', 'text-yellow-500');
    } else if (rating === 2) {
        const thumbsUp = document.querySelector('#feedbackModal .fa-thumbs-up');
        thumbsUp.classList.remove('far', 'text-gray-400');
        thumbsUp.classList.add('fas', 'text-yellow-500');
    }
}

function handleFeedback(event) {
    event.preventDefault();
    const text = document.getElementById('feedbackText').value.trim();
    const rating = document.getElementById('feedbackRating').value;
    if (!text) {
        showToast('error', 'Missing Feedback', 'Please enter your feedback.');
        return;
    }
    // Save feedback to Firebase
    const feedbackRef = group2MetalsRef.child('feedback').push();
    feedbackRef.set({
        userId: currentUser.uid,
        userName: userData.displayName,
        text: text,
        rating: rating,
        timestamp: firebase.database.ServerValue.TIMESTAMP
    }).then(() => {
        showToast('success', 'Feedback Sent', 'Thank you for your feedback.');
        closeFeedbackModal();
    }).catch((error) => {
        console.error("Error sending feedback:", error);
        showToast('error', 'Error', 'Failed to send feedback.');
    });
}

// Export to PDF
function exportToPDF() {
    // Define the filename of your pre-existing PDF
    const pdfFileName = "Alkaline Earth Metals.pdf";
    
    // Create a temporary link element to trigger download
    const link = document.createElement('a');
    link.href = pdfFileName;  // Just the filename, no path
    link.download = pdfFileName;
    
    // Append to body, click, and remove
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    
    // Show success notification with filename
    showToast('success', 'Export Successful', `Downloading: ${pdfFileName}`);
}

// Discussion functions
function showCreatePostModal() {
    if (!currentUser) {
        showToast('error', 'Sign in required', 'Please sign in to create posts.');
        showLoginModal();
        return;
    }
    document.getElementById('createPostModal').classList.add('active');
}

function closeCreatePostModal() {
    document.getElementById('createPostModal').classList.remove('active');
    document.getElementById('createPostForm').reset();
}

function showEditPostModal(postId) {
    if (!currentUser) {
        showToast('error', 'Sign in required', 'Please sign in to edit posts.');
        showLoginModal();
        return;
    }
    
    const post = discussionPosts.find(p => p.id === postId);
    if (!post) return;
    
    document.getElementById('editPostId').value = postId;
    document.getElementById('editPostTitle').value = post.title;
    document.getElementById('editPostContent').value = post.content;
    document.getElementById('editPostTags').value = post.tags ? post.tags.join(', ') : '';
    
    document.getElementById('editPostModal').classList.add('active');
}

function closeEditPostModal() {
    document.getElementById('editPostModal').classList.remove('active');
    document.getElementById('editPostForm').reset();
}

function handleCreatePost(event) {
    event.preventDefault();
    
    const title = document.getElementById('postTitle').value.trim();
    const content = document.getElementById('postContent').value.trim();
    const tags = document.getElementById('postTags').value.trim();
    
    if (!title || !content) {
        showToast('error', 'Missing Fields', 'Please fill in all required fields.');
        return;
    }
    
    const postsRef = group2MetalsRef.child('discussionPosts').push();
    const newPost = {
        authorId: currentUser.uid,
        authorName: userData.displayName,
        title: title,
        content: content,
        tags: tags ? tags.split(',').map(tag => tag.trim()) : [],
        upvotes: 0,
        downvotes: 0,
        votes: {},
        comments: 0,
        saved: 0,
        createdAt: firebase.database.ServerValue.TIMESTAMP
    };
    
    postsRef.set(newPost).then(() => {
        showToast('success', 'Post Created!', 'Your post has been published successfully.');
        closeCreatePostModal();
    }).catch((error) => {
        console.error("Error creating post:", error);
        showToast('error', 'Error', 'Failed to create post.');
    });
}

function handleEditPost(event) {
    event.preventDefault();
    
    const postId = document.getElementById('editPostId').value;
    const title = document.getElementById('editPostTitle').value.trim();
    const content = document.getElementById('editPostContent').value.trim();
    const tags = document.getElementById('editPostTags').value.trim();
    
    if (!title || !content) {
        showToast('error', 'Missing Fields', 'Please fill in all required fields.');
        return;
    }
    
    const postRef = group2MetalsRef.child('discussionPosts').child(postId);
    postRef.once('value').then((snapshot) => {
        const post = snapshot.val();
        
        if (!post) {
            showToast('error', 'Error', 'Post not found.');
            return;
        }
        
        if (post.authorId !== currentUser.uid) {
            showToast('error', 'Permission Denied', 'You can only edit your own posts.');
            return;
        }
        
        const updates = {};
        updates['/title'] = title;
        updates['/content'] = content;
        updates['/tags'] = tags ? tags.split(',').map(tag => tag.trim()) : [];
        updates['/editedAt'] = firebase.database.ServerValue.TIMESTAMP;
        
        postRef.update(updates).then(() => {
            showToast('success', 'Post Updated!', 'Your post has been updated successfully.');
            closeEditPostModal();
        }).catch((error) => {
            console.error("Error updating post:", error);
            showToast('error', 'Error', 'Failed to update post.');
        });
    }).catch((error) => {
        console.error("Error getting post:", error);
        showToast('error', 'Error', 'Failed to update post.');
    });
}

function loadDiscussionPosts() {
    const postsContainer = document.getElementById('discussionPosts');
    postsContainer.innerHTML = '<div class="spinner"></div>';
    
    const postsRef = group2MetalsRef.child('discussionPosts');

    postsRef.orderByChild('createdAt').on('value', (snapshot) => {
        postsContainer.innerHTML = '';
        
        if (!snapshot.exists()) {
            postsContainer.innerHTML = `
                <div class="empty-state">
                    <div class="empty-state-icon">
                        <i class="fas fa-comments"></i>
                    </div>
                    <h3 class="empty-state-title">No Posts Yet</h3>
                    <p class="empty-state-description">Be the first to start a discussion about Group 2 Alkaline Earth Metals.</p>
                </div>`;
            return;
        }
        
        discussionPosts = [];
        snapshot.forEach((childSnapshot) => {
            discussionPosts.push({
                id: childSnapshot.key,
                ...childSnapshot.val()
            });
        });
        
        // Sort based on current sort option
        sortDiscussionPosts();
        
        discussionPosts.forEach(post => {
            const postElement = createDiscussionPostElement(post);
            postsContainer.appendChild(postElement);
        });
    }, (error) => {
        console.error("Error loading discussion posts:", error);
        postsContainer.innerHTML = '<p class="text-gray-500 text-center">Error loading posts.</p>';
    });
}

function sortDiscussionPosts() {
    switch(currentSort) {
        case 'newest':
            discussionPosts.sort((a, b) => {
                return new Date(b.createdAt) - new Date(a.createdAt);
            });
            break;
        case 'oldest':
            discussionPosts.sort((a, b) => {
                return new Date(a.createdAt) - new Date(b.createdAt);
            });
            break;
        case 'popular':
            discussionPosts.sort((a, b) => {
                const aScore = (a.upvotes || 0) - (a.downvotes || 0);
                const bScore = (b.upvotes || 0) - (b.downvotes || 0);
                return bScore - aScore;
            });
            break;
    }
}

function sortDiscussions(sortType) {
    currentSort = sortType;
    
    // Update active button
    document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.classList.remove('active', 'bg-indigo-600', 'text-white');
        btn.classList.add('bg-gray-200', 'text-gray-700');
    });
    event.target.classList.remove('bg-gray-200', 'text-gray-700');
    event.target.classList.add('active', 'bg-indigo-600', 'text-white');
    
    // Re-sort and re-render
    sortDiscussionPosts();
    
    const postsContainer = document.getElementById('discussionPosts');
    postsContainer.innerHTML = '';
    
    discussionPosts.forEach(post => {
        const postElement = createDiscussionPostElement(post);
        postsContainer.appendChild(postElement);
    });
}

function filterDiscussions() {
    const searchTerm = document.getElementById('discussionSearch').value.toLowerCase();
    
    const postsContainer = document.getElementById('discussionPosts');
    postsContainer.innerHTML = '';
    
    const filteredPosts = discussionPosts.filter(post => {
        return post.title.toLowerCase().includes(searchTerm) || 
               post.content.toLowerCase().includes(searchTerm) ||
               (post.tags && post.tags.some(tag => tag.toLowerCase().includes(searchTerm)));
    });
    
    if (filteredPosts.length === 0) {
        postsContainer.innerHTML = `
            <div class="empty-state">
                <div class="empty-state-icon">
                    <i class="fas fa-search"></i>
                </div>
                <h3 class="empty-state-title">No Posts Found</h3>
                <p class="empty-state-description">No posts match your search criteria.</p>
            </div>`;
        return;
    }
    
    filteredPosts.forEach(post => {
        const postElement = createDiscussionPostElement(post);
        postsContainer.appendChild(postElement);
    });
}

function createDiscussionPostElement(post) {
    const postDiv = document.createElement('div');
    postDiv.className = 'discussion-post';
    
    const date = new Date(post.createdAt);
    const formattedDate = date.toLocaleDateString();
    const formattedTime = date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
    
    const isAuthor = currentUser && post.authorId === currentUser.uid;
    const userVote = post.votes && post.votes[currentUser.uid];
    const isSaved = userData && userData.savedPosts && userData.savedPosts.includes(post.id);
    
    postDiv.innerHTML = `
        <div class="post-header">
            <div class="post-avatar">${post.authorName ? post.authorName.charAt(0).toUpperCase() : 'A'}</div>
            <div class="post-meta">
                <div class="post-author">${post.authorName || 'Anonymous'}</div>
                <div class="post-time">${formattedDate} at ${formattedTime}</div>
            </div>
        </div>
        <h3 class="post-title">${post.title}</h3>
        <div class="post-content">${post.content}</div>
        ${post.tags && post.tags.length > 0 ? `
            <div class="mt-3">
                ${post.tags.map(tag => `<span class="post-tag">#${tag}</span>`).join('')}
            </div>
        ` : ''}
        <div class="post-actions">
            <div class="post-action ${userVote === true ? 'voted' : ''}" onclick="togglePostVote('${post.id}', 'up')">
                <i class="fas fa-arrow-up"></i>
                <span>${post.upvotes || 0}</span>
            </div>
            <div class="post-action ${userVote === false ? 'voted' : ''}" onclick="togglePostVote('${post.id}', 'down')">
                <i class="fas fa-arrow-down"></i>
                <span>${post.downvotes || 0}</span>
            </div>
            <div class="post-action" onclick="toggleComments('${post.id}')">
                <i class="fas fa-comment"></i>
                <span>${post.comments || 0}</span>
            </div>
            <div class="post-action ${isSaved ? 'voted' : ''}" onclick="toggleSavePost('${post.id}')">
                <i class="fas fa-bookmark"></i>
                <span>${post.saved || 0}</span>
            </div>
            ${isAuthor ? `
                <div class="post-action" onclick="showEditPostModal('${post.id}')">
                    <i class="fas fa-edit"></i>
                    Edit
                </div>
                <div class="post-action text-red-500" onclick="deletePost('${post.id}')">
                    <i class="fas fa-trash"></i>
                    Delete
                </div>
            ` : ''}
        </div>
        <div id="comments-${post.id}" class="comments-section" style="display: none;">
            <div class="mb-4">
                <form onsubmit="addComment(event, '${post.id}')" class="flex gap-3">
                    <input type="text" id="comment-input-${post.id}" class="form-input flex-1" placeholder="Add a comment...">
                    <button type="submit" class="btn btn-primary">Comment</button>
                </form>
            </div>
            <div id="comments-list-${post.id}"></div>
        </div>
    `;
    
    // Load comments for this post
    loadPostComments(post.id);
    
    return postDiv;
}

function togglePostVote(postId, voteType) {
    if (!currentUser) {
        showToast('error', 'Sign in required', 'Please sign in to vote on posts.');
        showLoginModal();
        return;
    }
    
    const postRef = group2MetalsRef.child('discussionPosts').child(postId);
    postRef.once('value').then((snapshot) => {
        const post = snapshot.val();
        
        if (!post) {
            showToast('error', 'Error', 'Post not found.');
            return;
        }
        
        const votes = post.votes || {};
        const currentVote = votes[currentUser.uid];
        const upvotes = post.upvotes || 0;
        const downvotes = post.downvotes || 0;
        
        let newUpvotes = upvotes;
        let newDownvotes = downvotes;
        let newVotes = { ...votes };
        
        if (voteType === 'up') {
            if (currentVote === true) {
                // Remove upvote
                delete newVotes[currentUser.uid];
                newUpvotes = Math.max(0, upvotes - 1);
            } else {
                // Add or change to upvote
                newVotes[currentUser.uid] = true;
                newUpvotes = upvotes + 1;
                if (currentVote === false) {
                    // Was downvoted before
                    newDownvotes = Math.max(0, downvotes - 1);
                }
            }
        } else { // voteType === 'down'
            if (currentVote === false) {
                // Remove downvote
                delete newVotes[currentUser.uid];
                newDownvotes = Math.max(0, downvotes - 1);
            } else {
                // Add or change to downvote
                newVotes[currentUser.uid] = false;
                newDownvotes = downvotes + 1;
                if (currentVote === true) {
                    // Was upvoted before
                    newUpvotes = Math.max(0, upvotes - 1);
                }
            }
        }
        
        const updates = {};
        updates['/upvotes'] = newUpvotes;
        updates['/downvotes'] = newDownvotes;
        updates['/votes'] = newVotes;
        
        postRef.update(updates).catch((error) => {
            console.error("Error voting on post:", error);
            showToast('error', 'Error', 'Failed to vote on post.');
        });
    }).catch((error) => {
        console.error("Error getting post:", error);
        showToast('error', 'Error', 'Failed to vote on post.');
    });
}

function toggleSavePost(postId) {
    if (!currentUser) {
        showToast('error', 'Sign in required', 'Please sign in to save posts.');
        showLoginModal();
        return;
    }
    
    const userRef = group2MetalsRef.child('users').child(currentUser.uid);
    userRef.once('value').then((snapshot) => {
        const userData = snapshot.val();
        const savedPosts = userData.savedPosts || [];
        
        const postRef = group2MetalsRef.child('discussionPosts').child(postId);
        
        if (savedPosts.includes(postId)) {
            // Remove from saved posts
            const newSavedPosts = savedPosts.filter(id => id !== postId);
            
            // Decrement saved count
            postRef.transaction((post) => {
                if (post) {
                    post.saved = Math.max(0, (post.saved || 0) - 1);
                }
                return post;
            });
            
            // Update user data
            userRef.update({
                savedPosts: newSavedPosts
            }).then(() => {
                // Update local user data
                userData.savedPosts = newSavedPosts;
                
                showToast('info', 'Post Unsaved', 'This post has been removed from your saved posts.');
            });
        } else {
            // Add to saved posts
            const newSavedPosts = [...savedPosts, postId];
            
            // Increment saved count
            postRef.transaction((post) => {
                if (post) {
                    post.saved = (post.saved || 0) + 1;
                }
                return post;
            });
            
            // Update user data
            userRef.update({
                savedPosts: newSavedPosts
            }).then(() => {
                // Update local user data
                userData.savedPosts = newSavedPosts;
                
                showToast('success', 'Post Saved!', 'This post has been added to your saved posts.');
            });
        }
    }).catch((error) => {
        console.error("Error saving post:", error);
        showToast('error', 'Error', 'Failed to save post.');
    });
}

function deletePost(postId) {
    if (!confirm('Are you sure you want to delete this post?')) {
        return;
    }
    
    const postRef = group2MetalsRef.child('discussionPosts').child(postId);
    postRef.remove().then(() => {
        showToast('success', 'Post Deleted', 'Your post has been deleted successfully.');
    }).catch((error) => {
        console.error("Error deleting post:", error);
        showToast('error', 'Error', 'Failed to delete post.');
    });
}

function toggleComments(postId) {
    const commentsSection = document.getElementById(`comments-${postId}`);
    if (commentsSection.style.display === 'none') {
        commentsSection.style.display = 'block';
        // Focus on comment input
        const commentInput = document.getElementById(`comment-input-${postId}`);
        if (commentInput) {
            commentInput.focus();
        }
        
        // Ensure comments are loaded and visible
        loadPostComments(postId);
    } else {
        commentsSection.style.display = 'none';
    }
}

function loadPostComments(postId) {
    const commentsContainer = document.getElementById(`comments-list-${postId}`);
    if (!commentsContainer) return;
    
    // Show loading indicator
    commentsContainer.innerHTML = '<div class="text-center py-3"><div class="spinner"></div></div>';
    
    const commentsRef = group2MetalsRef.child('postComments').orderByChild('postId').equalTo(postId);
    commentsRef.on('value', (snapshot) => {
        commentsContainer.innerHTML = '';
        
        if (!snapshot.exists()) {
            commentsContainer.innerHTML = '<p class="text-gray-500 text-center py-3">No comments yet. Be the first to comment!</p>';
            return;
        }
        
        const commentsArray = [];
        snapshot.forEach((childSnapshot) => {
            commentsArray.push({
                id: childSnapshot.key,
                ...childSnapshot.val()
            });
        });
        
        // Sort by creation date (oldest first)
        commentsArray.sort((a, b) => {
            return new Date(a.createdAt) - new Date(b.createdAt);
        });
        
        if (commentsArray.length === 0) {
            commentsContainer.innerHTML = '<p class="text-gray-500 text-center py-3">No comments yet. Be the first to comment!</p>';
            return;
        }
        
        commentsArray.forEach(comment => {
            const commentElement = createCommentElement(comment);
            commentsContainer.appendChild(commentElement);
        });
    });
}

function createCommentElement(comment) {
    const commentDiv = document.createElement('div');
    commentDiv.className = 'comment mb-4 p-4 bg-white rounded-lg shadow-sm';
    
    const date = new Date(comment.createdAt);
    const formattedDate = date.toLocaleDateString();
    const formattedTime = date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
    const isAuthor = currentUser && comment.authorId === currentUser.uid;
    
    commentDiv.innerHTML = `
        <div class="flex items-start space-x-4">
            <div class="comment-avatar flex-shrink-0 w-10 h-10 rounded-full bg-indigo-100 flex items-center justify-center">
                <span class="text-indigo-800 font-medium">${comment.authorName ? comment.authorName.charAt(0).toUpperCase() : 'A'}</span>
            </div>
            <div class="flex-1">
                <div class="flex items-center justify-between">
                    <div class="comment-author font-semibold text-gray-800">${comment.authorName || 'Anonymous'}</div>
                    <div class="comment-time text-xs text-gray-500">${formattedDate} at ${formattedTime}</div>
                </div>
                <div class="comment-content mt-2 text-gray-700">${comment.content}</div>
            </div>
        </div>
        ${isAuthor ? `
            <div class="mt-3">
                <button onclick="deleteComment('${comment.id}', '${comment.postId}')" class="text-red-500 text-sm hover:text-red-700 flex items-center">
                    <i class="fas fa-trash mr-2"></i>Delete
                </button>
            </div>
        ` : ''}
    `;
    
    return commentDiv;
}

function addComment(event, postId) {
    event.preventDefault();
    
    if (!currentUser) {
        showToast('error', 'Sign in required', 'Please sign in to comment.');
        showLoginModal();
        return;
    }
    
    const commentInput = document.getElementById(`comment-input-${postId}`);
    const content = commentInput.value.trim();
    
    if (!content) {
        showToast('error', 'Empty Comment', 'Please enter a comment before posting.');
        return;
    }
    
    const commentsRef = group2MetalsRef.child('postComments').push();
    const newComment = {
        postId: postId,
        authorId: currentUser.uid,
        authorName: userData.displayName,
        content: content,
        createdAt: firebase.database.ServerValue.TIMESTAMP
    };
    
    commentsRef.set(newComment).then(() => {
        // Update comment count on post
        const postRef = group2MetalsRef.child('discussionPosts').child(postId);
        postRef.transaction((post) => {
            if (post) {
                post.comments = (post.comments || 0) + 1;
            }
            return post;
        });
        
        // Clear input field
        commentInput.value = '';
        
        // Show success message
        showToast('success', 'Comment Added', 'Your comment has been posted successfully.');
        
        // Load comments for this post to update the UI
        loadPostComments(postId);
    }).catch((error) => {
        console.error("Error adding comment:", error);
        showToast('error', 'Error', 'Failed to post comment.');
    });
}

function deleteComment(commentId, postId) {
    if (!confirm('Are you sure you want to delete this comment?')) {
        return;
    }
    
    const commentRef = group2MetalsRef.child('postComments').child(commentId);
    commentRef.remove().then(() => {
        // Update comment count on post
        const postRef = group2MetalsRef.child('discussionPosts').child(postId);
        postRef.transaction((post) => {
            if (post) {
                post.comments = Math.max(0, (post.comments || 0) - 1);
            }
            return post;
        });
        
        showToast('success', 'Comment Deleted', 'Your comment has been deleted successfully.');
        
        // Reload comments to update the UI
        loadPostComments(postId);
    }).catch((error) => {
        console.error("Error deleting comment:", error);
        showToast('error', 'Error', 'Failed to delete comment.');
    });
}

// Study Groups functions
function showCreateGroupModal() {
    if (!currentUser) {
        showToast('error', 'Sign in required', 'Please sign in to create study groups.');
        showLoginModal();
        return;
    }
    document.getElementById('createGroupModal').classList.add('active');
}

function closeCreateGroupModal() {
    document.getElementById('createGroupModal').classList.remove('active');
    document.getElementById('createGroupForm').reset();
}

function handleCreateGroup(event) {
    event.preventDefault();
    
    const name = document.getElementById('groupName').value.trim();
    const topic = document.getElementById('groupTopic').value;
    const description = document.getElementById('groupDescription').value.trim();
    const maxMembers = parseInt(document.getElementById('groupMaxMembers').value);
    
    if (!name || !topic || !description) {
        showToast('error', 'Missing Fields', 'Please fill in all fields.');
        return;
    }
    
    const groupsRef = group2MetalsRef.child('studyGroups').push();
    const newGroup = {
        name: name,
        topic: topic,
        description: description,
        maxMembers: maxMembers,
        creatorId: currentUser.uid,
        creatorName: userData.displayName,
        members: [currentUser.uid],
        memberCount: 1,
        announcements: [],
        resources: [],
        createdAt: firebase.database.ServerValue.TIMESTAMP,
        lastActivity: firebase.database.ServerValue.TIMESTAMP
    };
    
    groupsRef.set(newGroup).then(() => {
        showToast('success', 'Group Created!', 'Your study group has been created successfully.');
        closeCreateGroupModal();
    }).catch((error) => {
        console.error("Error creating study group:", error);
        showToast('error', 'Error', 'Failed to create study group.');
    });
}

function loadStudyGroups() {
    const groupsContainer = document.getElementById('studyGroupsList');
    groupsContainer.innerHTML = '<div class="spinner"></div>';
    
    const groupsRef = group2MetalsRef.child('studyGroups');
    groupsRef.on('value', (snapshot) => {
        groupsContainer.innerHTML = '';
        
        if (!snapshot.exists()) {
            groupsContainer.innerHTML = `
                <div class="empty-state">
                    <div class="empty-state-icon">
                        <i class="fas fa-users"></i>
                    </div>
                    <h3 class="empty-state-title">No Study Groups Yet</h3>
                    <p class="empty-state-description">Create your first study group to collaborate with peers.</p>
                </div>`;
            return;
        }
        
        studyGroups = [];
        snapshot.forEach((childSnapshot) => {
            studyGroups.push({
                id: childSnapshot.key,
                ...childSnapshot.val()
            });
        });
        
        // Create a document fragment to improve performance
        const fragment = document.createDocumentFragment();
        
        studyGroups.forEach(group => {
            const groupElement = createStudyGroupElement(group);
            fragment.appendChild(groupElement);
        });
        
        // Append all elements at once
        groupsContainer.appendChild(fragment);
    }, (error) => {
        console.error("Error loading study groups:", error);
        groupsContainer.innerHTML = '<p class="text-gray-500 text-center">Error loading study groups.</p>';
    });
}

function createStudyGroupElement(group) {
    const groupDiv = document.createElement('div');
    groupDiv.className = 'study-group-card';
    
    const isMember = currentUser && group.members && group.members.includes(currentUser.uid);
    const memberCount = group.members ? group.members.length : 0;
    const maxMembers = group.maxMembers || 10;
    const isFull = memberCount >= maxMembers;
    
    const createdDate = new Date(group.createdAt);
    const formattedDate = createdDate.toLocaleDateString();
    
    // Format topic for display
    const topicLabels = {
        'melting-point': 'Melting Point Trends',
        'density': 'Density Trends',
        'reactivity': 'Reactivity Series',
        'reactions': 'Chemical Reactions',
        'electron-configuration': 'Electron Configuration',
        'experiments': 'Laboratory Experiments',
        'exam-prep': 'Exam Preparation'
    };
    
    groupDiv.innerHTML = `
        <div class="group-header">
            <div>
                <h3 class="group-title">${group.name}</h3>
                <span class="group-topic">${topicLabels[group.topic] || group.topic}</span>
            </div>
        </div>
        <p class="group-description">${group.description}</p>
        <div class="group-meta">
            <div class="group-members">
                <div class="flex -space-x-2">
                    ${(group.members || []).slice(0, 5).map(member =>
                        `<div class="member-avatar" title="${member}">${member.charAt(0).toUpperCase()}</div>`
                    ).join('')}
                    ${(memberCount || 0) > 5 ?
                        `<div class="member-avatar">+${(memberCount || 0) - 5}</div>` : ''
                    }
                </div>
                <span class="ml-3 text-sm">${memberCount}/${maxMembers} members</span>
            </div>
            <div class="group-stats">
                Created on ${formattedDate}
            </div>
        </div>
        <div class="group-actions">
            <button onclick="showGroupDetails('${group.id}')" class="btn btn-primary btn-sm">
                <i class="fas fa-eye mr-2"></i>
                View Details
            </button>
            <button onclick="${isMember ? 'leaveStudyGroup' : 'joinStudyGroup'}('${group.id}')"
                    class="btn ${isMember ? 'btn-danger' : 'btn-primary'} btn-sm"
                    ${isFull && !isMember ? 'disabled' : ''}>
                ${isMember ? 'Leave Group' : isFull ? 'Full' : 'Join Group'}
            </button>
        </div>
    `;
    
    return groupDiv;
}

function showGroupDetails(groupId) {
    if (!currentUser) {
        showToast('error', 'Sign in required', 'Please sign in to view group details.');
        showLoginModal();
        return;
    }
    
    const group = studyGroups.find(g => g.id === groupId);
    if (!group) return;
    
    const isMember = currentUser && group.members && group.members.includes(currentUser.uid);
    
    // Format topic for display
    const topicLabels = {
        'melting-point': 'Melting Point Trends',
        'density': 'Density Trends',
        'reactivity': 'Reactivity Series',
        'reactions': 'Chemical Reactions',
        'electron-configuration': 'Electron Configuration',
        'experiments': 'Laboratory Experiments',
        'exam-prep': 'Exam Preparation'
    };
    
    // Create modal content
    const modalContent = `
        <div class="group-details-container">
            <div class="flex justify-between items-center mb-8">
                <h3 class="text-2xl font-bold text-gray-800">${group.name}</h3>
                <button onclick="closeGroupDetailsModal()" class="text-gray-500 hover:text-gray-700 p-3 rounded-full hover:bg-gray-100 transition-colors">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            
            <p class="text-gray-700 mb-8">${group.description}</p>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
                <div class="bg-gray-50 p-6 rounded-lg shadow-sm">
                    <h4 class="font-semibold text-gray-800 mb-4 flex items-center">
                        <i class="fas fa-info-circle mr-3 text-indigo-600"></i>
                        Group Info
                    </h4>
                    <p><strong>Created by:</strong> ${group.creatorName || 'Unknown'}</p>
                    <p><strong>Created on:</strong> ${new Date(group.createdAt).toLocaleDateString()}</p>
                    <p><strong>Members:</strong> ${group.members ? group.members.length : 0}/${group.maxMembers || 10}</p>
                </div>
                <div class="bg-gray-50 p-6 rounded-lg shadow-sm">
                    <h4 class="font-semibold text-gray-800 mb-4 flex items-center">
                        <i class="fas fa-users mr-3 text-indigo-600"></i>
                        Members
                    </h4>
                    <div class="space-y-3">
                        ${(group.members || []).map(memberId => {
                            // In a real app, we would fetch user details from the database
                            return `<div class="flex items-center">
                                <div class="w-8 h-8 rounded-full bg-indigo-100 flex items-center justify-center">
                                    <span class="text-indigo-800 font-medium text-sm">${memberId.charAt(0).toUpperCase()}</span>
                                </div>
                                <span>${memberId}</span>
                            </div>`;
                        }).join('')}
                    </div>
                </div>
            </div>
            
            <div class="bg-gray-50 p-6 rounded-lg shadow-sm mb-8">
                <h4 class="font-semibold text-gray-800 mb-4 flex items-center">
                    <i class="fas fa-bullhorn mr-3 text-indigo-600"></i>
                    Announcements
                </h4>
                <div id="groupAnnouncements">
                    ${(group.announcements || []).length > 0 ? 
                        group.announcements.map(announcement => `
                            <div class="group-announcement mb-4">
                                <div class="flex justify-between items-start mb-2">
                                    <h5 class="font-semibold">${announcement.title}</h5>
                                    <span class="text-sm text-gray-500">${new Date(announcement.createdAt).toLocaleDateString()}</span>
                                </div>
                                <p>${announcement.content}</p>
                            </div>
                        `).join('') :
                        '<p class="text-gray-500">No announcements yet.</p>'
                    }
                </div>
                ${isMember ? `
                    <button onclick="showAddAnnouncement('${groupId}')" class="btn btn-primary btn-sm mt-4">
                        <i class="fas fa-plus mr-2"></i>
                        Add Announcement
                    </button>
                ` : ''}
            </div>
            
            <div class="bg-gray-50 p-6 rounded-lg shadow-sm">
                <h4 class="font-semibold text-gray-800 mb-4 flex items-center">
                    <i class="fas fa-folder-open mr-3 text-indigo-600"></i>
                    Resources
                </h4>
                <div id="groupResources">
                    ${(group.resources || []).length > 0 ? 
                        group.resources.map(resource => `
                            <div class="resource-item mb-4">
                                <div class="resource-icon">
                                    <i class="fas fa-file-alt"></i>
                                </div>
                                <div class="resource-info">
                                    <div class="resource-name">${resource.name}</div>
                                    <div class="resource-meta">Added by ${resource.addedBy} on ${new Date(resource.addedAt).toLocaleDateString()}</div>
                                    <div class="resource-description">${resource.description}</div>
                                </div>
                                <div class="resource-actions">
                                    <button onclick="downloadResource('${resource.url}')" class="resource-btn">
                                        <i class="fas fa-download"></i>
                                    </button>
                                </div>
                            </div>
                        `).join('') :
                        '<p class="text-gray-500">No resources yet.</p>'
                    }
                </div>
                ${isMember ? `
                    <button onclick="showAddResource('${groupId}')" class="btn btn-primary btn-sm mt-4">
                        <i class="fas fa-plus mr-2"></i>
                        Add Resource
                    </button>
                ` : ''}
            </div>
            
            <div class="flex justify-end mt-8">
                <button onclick="closeGroupDetailsModal()" class="btn btn-secondary mr-3">
                    Close
                </button>
                ${isMember ? `
                    <button onclick="leaveStudyGroup('${groupId}')" class="btn btn-danger">
                        Leave Group
                    </button>
                ` : `
                    <button onclick="joinStudyGroup('${groupId}')" class="btn btn-primary">
                        Join Group
                    </button>
                `}
            </div>
        </div>
    `;
    
    // Set modal content and show modal
    document.getElementById('groupDetailsContent').innerHTML = modalContent;
    document.getElementById('groupDetailsModal').classList.add('active');
}

function closeGroupDetailsModal() {
    document.getElementById('groupDetailsModal').classList.remove('active');
}

function joinStudyGroup(groupId) {
    if (!currentUser) {
        showToast('error', 'Sign in required', 'Please sign in to join study groups.');
        showLoginModal();
        return;
    }
    
    const groupRef = group2MetalsRef.child('studyGroups').child(groupId);
    groupRef.once('value').then((snapshot) => {
        const group = snapshot.val();
        
        if (!group) {
            showToast('error', 'Error', 'Study group not found.');
            return;
        }
        
        const members = group.members || [];
        const maxMembers = group.maxMembers || 10;
        
        if (members.includes(currentUser.uid)) {
            showToast('info', 'Already a Member', 'You are already a member of this study group.');
            return;
        }
        
        if (members.length >= maxMembers) {
            showToast('error', 'Group Full', 'This study group is already full.');
            return;
        }
        
        // Add user to group
        members.push(currentUser.uid);
        
        const updates = {
            members: members,
            memberCount: members.length,
            lastActivity: firebase.database.ServerValue.TIMESTAMP
        };
        
        groupRef.update(updates).then(() => {
            showToast('success', 'Joined Group', 'You have successfully joined the study group.');
            
            // Add notification for group creator
            if (group.creatorId && group.creatorId !== currentUser.uid) {
                const notificationRef = group2MetalsRef.child('notifications').push();
                notificationRef.set({
                    userId: group.creatorId,
                    type: 'group_join',
                    message: `${userData.displayName} joined your study group "${group.name}"`,
                    groupId: groupId,
                    timestamp: firebase.database.ServerValue.TIMESTAMP,
                    read: false
                });
            }
        }).catch((error) => {
            console.error("Error joining study group:", error);
            showToast('error', 'Error', 'Failed to join study group.');
        });
    }).catch((error) => {
        console.error("Error getting study group:", error);
        showToast('error', 'Error', 'Failed to join study group.');
    });
}

function leaveStudyGroup(groupId) {
    if (!currentUser) {
        showToast('error', 'Sign in required', 'Please sign in to leave study groups.');
        showLoginModal();
        return;
    }
    
    if (!confirm('Are you sure you want to leave this study group?')) {
        return;
    }
    
    const groupRef = group2MetalsRef.child('studyGroups').child(groupId);
    groupRef.once('value').then((snapshot) => {
        const group = snapshot.val();
        
        if (!group) {
            showToast('error', 'Error', 'Study group not found.');
            return;
        }
        
        const members = group.members || [];
        
        if (!members.includes(currentUser.uid)) {
            showToast('info', 'Not a Member', 'You are not a member of this study group.');
            return;
        }
        
        // Remove user from group
        const updatedMembers = members.filter(member => member !== currentUser.uid);
        
        const updates = {
            members: updatedMembers,
            memberCount: updatedMembers.length,
            lastActivity: firebase.database.ServerValue.TIMESTAMP
        };
        
        groupRef.update(updates).then(() => {
            showToast('success', 'Left Group', 'You have successfully left the study group.');
            
            // If the user was the creator and there are no members left, delete the group
            if (group.creatorId === currentUser.uid && updatedMembers.length === 0) {
                groupRef.remove().then(() => {
                    showToast('info', 'Group Deleted', 'The study group has been deleted as it had no members.');
                }).catch((error) => {
                    console.error("Error deleting study group:", error);
                });
            }
            
            // Add notification for group creator if they're not the one leaving
            if (group.creatorId && group.creatorId !== currentUser.uid) {
                const notificationRef = group2MetalsRef.child('notifications').push();
                notificationRef.set({
                    userId: group.creatorId,
                    type: 'group_leave',
                    message: `${userData.displayName} left your study group "${group.name}"`,
                    groupId: groupId,
                    timestamp: firebase.database.ServerValue.TIMESTAMP,
                    read: false
                });
            }
        }).catch((error) => {
            console.error("Error leaving study group:", error);
            showToast('error', 'Error', 'Failed to leave study group.');
        });
    }).catch((error) => {
        console.error("Error getting study group:", error);
        showToast('error', 'Error', 'Failed to leave study group.');
    });
}

function showAddAnnouncement(groupId) {
    // This would open a modal to add an announcement
    // For simplicity, we'll just show a prompt
    const title = prompt('Announcement Title:');
    if (!title) return;
    
    const content = prompt('Announcement Content:');
    if (!content) return;
    
    const groupRef = group2MetalsRef.child('studyGroups').child(groupId);
    groupRef.once('value').then((snapshot) => {
        const group = snapshot.val();
        
        if (!group) {
            showToast('error', 'Error', 'Study group not found.');
            return;
        }
        
        const announcements = group.announcements || [];
        announcements.push({
            title: title,
            content: content,
            addedBy: userData.displayName,
            createdAt: firebase.database.ServerValue.TIMESTAMP
        });
        
        groupRef.update({
            announcements: announcements,
            lastActivity: firebase.database.ServerValue.TIMESTAMP
        }).then(() => {
            showToast('success', 'Announcement Added', 'Your announcement has been added to the group.');
            
            // Refresh group details
            showGroupDetails(groupId);
            
            // Notify group members
            (group.members || []).forEach(memberId => {
                if (memberId !== currentUser.uid) {
                    const notificationRef = group2MetalsRef.child('notifications').push();
                    notificationRef.set({
                        userId: memberId,
                        type: 'group_announcement',
                        message: `New announcement in "${group.name}": ${title}`,
                        groupId: groupId,
                        timestamp: firebase.database.ServerValue.TIMESTAMP,
                        read: false
                    });
                }
            });
        }).catch((error) => {
            console.error("Error adding announcement:", error);
            showToast('error', 'Error', 'Failed to add announcement.');
        });
    }).catch((error) => {
        console.error("Error getting study group:", error);
        showToast('error', 'Error', 'Failed to add announcement.');
    });
}

function showAddResource(groupId) {
    // This would open a modal to add a resource
    // For simplicity, we'll just show prompts
    const name = prompt('Resource Name:');
    if (!name) return;
    
    const description = prompt('Resource Description:');
    if (!description) return;
    
    const url = prompt('Resource URL:');
    if (!url) return;
    
    const groupRef = group2MetalsRef.child('studyGroups').child(groupId);
    groupRef.once('value').then((snapshot) => {
        const group = snapshot.val();
        
        if (!group) {
            showToast('error', 'Error', 'Study group not found.');
            return;
        }
        
        const resources = group.resources || [];
        resources.push({
            name: name,
            description: description,
            url: url,
            addedBy: userData.displayName,
            addedAt: firebase.database.ServerValue.TIMESTAMP
        });
        
        groupRef.update({
            resources: resources,
            lastActivity: firebase.database.ServerValue.TIMESTAMP
        }).then(() => {
            showToast('success', 'Resource Added', 'Your resource has been added to the group.');
            
            // Refresh group details
            showGroupDetails(groupId);
            
            // Notify group members
            (group.members || []).forEach(memberId => {
                if (memberId !== currentUser.uid) {
                    const notificationRef = group2MetalsRef.child('notifications').push();
                    notificationRef.set({
                        userId: memberId,
                        type: 'group_resource',
                        message: `New resource added to "${group.name}": ${name}`,
                        groupId: groupId,
                        timestamp: firebase.database.ServerValue.TIMESTAMP,
                        read: false
                    });
                }
            });
        }).catch((error) => {
            console.error("Error adding resource:", error);
            showToast('error', 'Error', 'Failed to add resource.');
        });
    }).catch((error) => {
        console.error("Error getting study group:", error);
        showToast('error', 'Error', 'Failed to add resource.');
    });
}

function downloadResource(url) {
    // In a real app, this would handle file downloads
    window.open(url, '_blank');
}

// Leaderboard functions
function loadLeaderboard() {
    const leaderboardContent = document.getElementById('leaderboardContent');
    leaderboardContent.innerHTML = '<div class="spinner"></div>';
    
    const usersRef = group2MetalsRef.child('users');
    usersRef.orderByChild('xp').limitToLast(10).on('value', (snapshot) => {
        leaderboardContent.innerHTML = '';
        
        if (!snapshot.exists()) {
            leaderboardContent.innerHTML = '<p class="text-gray-500 text-center">No users found.</p>';
            return;
        }
        
        const users = [];
        snapshot.forEach((childSnapshot) => {
            users.push({
                id: childSnapshot.key,
                ...childSnapshot.val()
            });
        });
        
        // Sort by XP (descending)
        users.sort((a, b) => (b.xp || 0) - (a.xp || 0));
        
        // Create leaderboard table
        const table = document.createElement('table');
        table.className = 'leaderboard-table';
        
        // Create table header
        const thead = document.createElement('thead');
        thead.innerHTML = `
            <tr>
                <th>Rank</th>
                <th>User</th>
                <th>XP</th>
                <th>Badges</th>
            </tr>
        `;
        table.appendChild(thead);
        
        // Create table body
        const tbody = document.createElement('tbody');
        users.forEach((user, index) => {
            const row = document.createElement('tr');
            row.className = 'leaderboard-entry';
            
            // Determine rank class for special styling
            let rankClass = '';
            if (index === 0) rankClass = 'first';
            else if (index === 1) rankClass = 'second';
            else if (index === 2) rankClass = 'third';
            
            row.innerHTML = `
                <td>
                    <div class="leaderboard-rank ${rankClass}">${index + 1}</div>
                </td>
                <td>${user.displayName || 'Anonymous'}</td>
                <td>${user.xp || 0}</td>
                <td>${(user.badges || []).length}</td>
            `;
            
            tbody.appendChild(row);
        });
        table.appendChild(tbody);
        
        leaderboardContent.appendChild(table);
    }, (error) => {
        console.error("Error loading leaderboard:", error);
        leaderboardContent.innerHTML = '<p class="text-gray-500 text-center">Error loading leaderboard.</p>';
    });
}

// Toast notification function
function showToast(type, title, message) {
    const toastContainer = document.getElementById('toastContainer');
    const toast = document.createElement('div');
    toast.className = `toast ${type}`;
    
    let icon = '';
    if (type === 'success') {
        icon = '<i class="fas fa-check-circle toast-icon"></i>';
    } else if (type === 'error') {
        icon = '<i class="fas fa-exclamation-circle toast-icon"></i>';
    } else if (type === 'info') {
        icon = '<i class="fas fa-info-circle toast-icon"></i>';
    }
    
    toast.innerHTML = `
        ${icon}
        <div class="toast-message">
            <div class="toast-title">${title}</div>
            <div class="toast-description">${message}</div>
        </div>
    `;
    
    toastContainer.appendChild(toast);
    
    // Show toast
    setTimeout(() => {
        toast.classList.add('show');
    }, 10);
    
    // Hide toast after 4 seconds
    setTimeout(() => {
        toast.classList.remove('show');
        setTimeout(() => {
            toastContainer.removeChild(toast);
        }, 400);
    }, 4000);
}

// Authentication functions
function showLoginModal() {
    document.getElementById('loginModal').classList.add('active');
}

function closeLoginModal() {
    document.getElementById('loginModal').classList.remove('active');
}

function signInWithGoogle() {
    const provider = new firebase.auth.GoogleAuthProvider();
    auth.signInWithPopup(provider).then((result) => {
        // This gives you a Google Access Token. You can use it to access the Google API.
        const credential = result.credential;
        const token = credential.accessToken;
        // The signed-in user info.
        const user = result.user;
        showToast('success', 'Welcome back!', 'You have been successfully signed in.');
        closeLoginModal();
    }).catch((error) => {
        // Handle Errors here.
        const errorCode = error.code;
        const errorMessage = error.message;
        console.error("Google sign-in error:", error);
        showToast('error', 'Sign in failed', errorMessage);
    });
}

function signOut() {
    auth.signOut().then(() => {
        showToast('info', 'Goodbye!', 'You have been successfully signed out.');
        showLandingPage();
    }).catch((error) => {
        console.error("Sign out error:", error);
        showToast('error', 'Error', 'Failed to sign out.');
    });
}

// Graph functions
function initializeGraph() {
    const ctx = document.getElementById('mainChart').getContext('2d');
    
    // Destroy existing chart if it exists
    if (mainChart) {
        mainChart.destroy();
    }
    
    // Create initial chart with active properties
    const chartData = getGraphData();
    
    mainChart = new Chart(ctx, {
        type: currentGraphType,
        data: chartData,
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    display: true,
                    labels: {
                        color: '#cbd5e1'
                    }
                },
                tooltip: {
                    backgroundColor: '#1e293b',
                    titleColor: '#f1f5f9',
                    bodyColor: '#cbd5e1',
                    borderColor: '#334155',
                    borderWidth: 1
                },
                zoom: {
                    zoom: {
                        wheel: {
                            enabled: true,
                        },
                        pinch: {
                            enabled: true
                        },
                        mode: 'xy',
                    },
                    limits: {
                        y: {min: 0, max: 1500},
                        x: {min: 0, max: 100}
                    }
                }
            },
            scales: {
                x: {
                    grid: {
                        color: '#334155',
                        borderColor: '#334155'
                    },
                    ticks: {
                        color: '#94a3b8'
                    },
                    title: {
                        display: true,
                        text: 'Atomic Number',
                        color: '#cbd5e1'
                    }
                },
                y: {
                    grid: {
                        color: '#334155',
                        borderColor: '#334155'
                    },
                    ticks: {
                        color: '#94a3b8'
                    },
                    title: {
                        display: true,
                        text: 'Value',
                        color: '#cbd5e1'
                    }
                }
            }
        }
    });
}

function getGraphData() {
    const labels = selectedElements.map(el => elementData[el].name);
    const datasets = [];
    
    // Add datasets for each active property
    activeProperties.forEach(property => {
        const config = propertyConfig[property];
        const data = selectedElements.map(el => elementData[el][getPropertyKey(property)]);
        
        datasets.push({
            label: config.label,
            data: data,
            borderColor: config.color,
            backgroundColor: config.color + '33', // Add transparency
            tension: 0.4,
            fill: false,
            pointRadius: 5,
            pointHoverRadius: 7
        });
    });
    
    return {
        labels: labels,
        datasets: datasets
    };
}

function getPropertyKey(property) {
    // Convert property name to the key in elementData
    switch(property) {
        case 'melting-point': return 'meltingPoint';
        case 'density': return 'density';
        case 'reactivity': return 'reactivity';
        case 'atomic-radius': return 'atomicRadius';
        default: return property;
    }
}

function toggleGraphProperty(property) {
    const index = activeProperties.indexOf(property);
    if (index > -1) {
        // Property is active, remove it
        activeProperties.splice(index, 1);
    } else {
        // Property is inactive, add it
        activeProperties.push(property);
    }
    
    // Update chart
    if (mainChart) {
        mainChart.data = getGraphData();
        mainChart.update();
    }
    
    // Update data table highlighting
    updateDataTableHighlighting();
}

function changeGraphView(viewType) {
    currentGraphType = viewType;
    
    // Update active button
    document.querySelectorAll('.graph-view-btn').forEach(btn => {
        btn.classList.remove('active');
    });
    document.getElementById(`view-${viewType}`).classList.add('active');
    
    // Update chart
    if (mainChart) {
        mainChart.config.type = viewType;
        mainChart.update();
    }
}

function toggleElement(element) {
    const index = selectedElements.indexOf(element);
    if (index > -1) {
        selectedElements.splice(index, 1);
    } else {
        selectedElements.push(element);
    }
    
    // Update chart
    if (mainChart) {
        mainChart.data = getGraphData();
        mainChart.update();
    }
    
    // Update data table highlighting
    updateDataTableHighlighting();
}

function resetZoom() {
    if (mainChart) {
        mainChart.resetZoom();
    }
}

function downloadGraph() {
    if (mainChart) {
        const link = document.createElement('a');
        link.download = 'graph.png';
        link.href = mainChart.toBase64Image();
        link.click();
    }
}

function toggleAnimation() {
    // Implement animation logic if needed
    showToast('info', 'Animation', 'Animation feature coming soon!');
}

function populateDataTable() {
    const tbody = document.getElementById('dataTableBody');
    tbody.innerHTML = '';
    
    selectedElements.forEach(element => {
        const data = elementData[element];
        const row = document.createElement('tr');
        row.dataset.element = element;
        
        row.innerHTML = `
            <td>${data.name}</td>
            <td>${data.atomicNumber}</td>
            <td>${data.meltingPoint}</td>
            <td>${data.density}</td>
            <td>${data.reactivity}</td>
            <td>${data.atomicRadius}</td>
        `;
        
        tbody.appendChild(row);
    });
    
    updateDataTableHighlighting();
}

function updateDataTableHighlighting() {
    const rows = document.querySelectorAll('#dataTableBody tr');
    rows.forEach(row => {
        const element = row.dataset.element;
        if (selectedElements.includes(element)) {
            row.classList.add('highlighted-row');
        } else {
            row.classList.remove('highlighted-row');
        }
    });
}

function loadGraphQuiz() {
    const question = graphQuizQuestions[Math.floor(Math.random() * graphQuizQuestions.length)];
    document.getElementById('graph-quiz-question').textContent = question.question;
    
    const optionsContainer = document.getElementById('graph-quiz-options');
    optionsContainer.innerHTML = '';
    
    question.options.forEach((option, index) => {
        const optionDiv = document.createElement('div');
        optionDiv.className = 'graph-quiz-option';
        optionDiv.textContent = option;
        optionDiv.onclick = () => checkGraphQuizAnswer(index, question.correct, question.explanation);
        optionsContainer.appendChild(optionDiv);
    });
    
    // Reset feedback
    document.getElementById('graph-quiz-feedback').classList.add('hidden');
}

function checkGraphQuizAnswer(selectedIndex, correctIndex, explanation) {
    const options = document.querySelectorAll('#graph-quiz-options .graph-quiz-option');
    const feedback = document.getElementById('graph-quiz-feedback');
    
    options.forEach((option, index) => {
        option.onclick = null; // Disable further clicks
        if (index === correctIndex) {
            option.classList.add('correct');
        } else if (index === selectedIndex) {
            option.classList.add('incorrect');
        }
    });
    
    if (selectedIndex === correctIndex) {
        feedback.className = 'mt-4 p-3 rounded-lg bg-green-100 text-green-800';
        feedback.textContent = 'Correct! ' + explanation;
        if (soundEnabled) correctSound.play();
    } else {
        feedback.className = 'mt-4 p-3 rounded-lg bg-red-100 text-red-800';
        feedback.textContent = 'Incorrect. ' + explanation;
        if (soundEnabled) incorrectSound.play();
    }
    
    feedback.classList.remove('hidden');
}

// Initialize the app when the page loads
window.onload = function() {
    initApp();
};</script>
</body>
</html>
